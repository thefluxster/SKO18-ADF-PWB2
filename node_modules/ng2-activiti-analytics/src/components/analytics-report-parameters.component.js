/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var forms_1 = require("@angular/forms");
var moment = require("moment");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var analytics_service_1 = require("../services/analytics.service");
var report_model_1 = require("../models/report.model");
var AnalyticsReportParametersComponent = AnalyticsReportParametersComponent_1 = (function () {
    function AnalyticsReportParametersComponent(translateService, analyticsService, formBuilder, logService) {
        this.translateService = translateService;
        this.analyticsService = analyticsService;
        this.formBuilder = formBuilder;
        this.logService = logService;
        this.debug = false;
        this.onSuccess = new core_1.EventEmitter();
        this.onError = new core_1.EventEmitter();
        this.onEdit = new core_1.EventEmitter();
        this.onFormValueChanged = new core_1.EventEmitter();
        this.onDropdownChanged = new core_1.EventEmitter();
        this.onSuccessReportParams = new core_1.EventEmitter();
        this.onSuccessParamOpt = new core_1.EventEmitter();
        this.isEditable = false;
        this.hideParameters = true;
        if (translateService) {
            translateService.addTranslationFolder('ng2-activiti-analytics', 'node_modules/ng2-activiti-analytics/src');
        }
    }
    AnalyticsReportParametersComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.initForm();
        this.dropDownSub = this.onDropdownChanged.subscribe(function (field) {
            var paramDependOn = _this.reportParameters.definition.parameters.find(function (p) { return p.dependsOn === field.id; });
            if (paramDependOn) {
                _this.retrieveParameterOptions(_this.reportParameters.definition.parameters, _this.appId, _this.reportId, field.value);
            }
        });
        this.paramOpts = this.onSuccessReportParams.subscribe(function (report) {
            if (report.hasParameters()) {
                _this.retrieveParameterOptions(report.definition.parameters, _this.appId);
            }
        });
        this.reportForm.valueChanges.subscribe(function (data) { return _this.onValueChanged(data); });
    };
    AnalyticsReportParametersComponent.prototype.ngOnChanges = function (changes) {
        this.isEditable = false;
        var reportId = changes['reportId'];
        if (reportId && reportId.currentValue) {
            this.getReportParams(reportId.currentValue);
        }
        var appId = changes['appId'];
        if (appId && (appId.currentValue || appId.currentValue === null)) {
            this.getReportParams(this.reportId);
        }
    };
    AnalyticsReportParametersComponent.prototype.initForm = function () {
        this.reportForm = this.formBuilder.group({
            dateRange: new forms_1.FormGroup({}),
            statusGroup: new forms_1.FormGroup({
                status: new forms_1.FormControl()
            }),
            processInstanceGroup: new forms_1.FormGroup({
                slowProcessInstanceInteger: new forms_1.FormControl()
            }),
            taskGroup: new forms_1.FormGroup({
                taskName: new forms_1.FormControl()
            }),
            typeFilteringGroup: new forms_1.FormGroup({
                typeFiltering: new forms_1.FormControl()
            }),
            dateIntervalGroup: new forms_1.FormGroup({
                dateRangeInterval: new forms_1.FormControl()
            }),
            durationGroup: new forms_1.FormGroup({
                duration: new forms_1.FormControl()
            }),
            processDefGroup: new forms_1.FormGroup({
                processDefinitionId: new forms_1.FormControl()
            })
        });
    };
    AnalyticsReportParametersComponent.prototype.getReportParams = function (reportId) {
        var _this = this;
        this.reportParamsSub = this.analyticsService.getReportParams(reportId).subscribe(function (res) {
            _this.reportParameters = res;
            if (_this.reportParameters.hasParameters()) {
                _this.onSuccessReportParams.emit(res);
            }
            else {
                _this.onSuccess.emit();
            }
        }, function (err) {
            _this.logService.error(err);
            _this.onError.emit(err);
        });
    };
    AnalyticsReportParametersComponent.prototype.retrieveParameterOptions = function (parameters, appId, reportId, processDefinitionId) {
        var _this = this;
        parameters.forEach(function (param) {
            _this.analyticsService.getParamValuesByType(param.type, appId, reportId, processDefinitionId).subscribe(function (opts) {
                param.options = opts;
                _this.onSuccessParamOpt.emit(opts);
            }, function (err) {
                _this.logService.error(err);
                _this.onError.emit(err);
            });
        });
    };
    AnalyticsReportParametersComponent.prototype.onProcessDefinitionChanges = function (field) {
        if (field.value) {
            this.onDropdownChanged.emit(field);
        }
    };
    AnalyticsReportParametersComponent.prototype.submit = function (values) {
        var reportParamQuery = this.convertFormValuesToReportParamQuery(values);
        this.onSuccess.emit(reportParamQuery);
    };
    AnalyticsReportParametersComponent.prototype.onValueChanged = function (values) {
        this.onFormValueChanged.emit(values);
        if (this.reportForm && this.reportForm.valid) {
            this.submit(values);
        }
    };
    AnalyticsReportParametersComponent.prototype.convertMomentDate = function (date) {
        return moment(date, AnalyticsReportParametersComponent_1.FORMAT_DATE_ACTIVITI, true)
            .format(AnalyticsReportParametersComponent_1.FORMAT_DATE_ACTIVITI) + 'T00:00:00.000Z';
    };
    AnalyticsReportParametersComponent.prototype.convertNumber = function (value) {
        return value != null ? parseInt(value, 10) : 0;
    };
    AnalyticsReportParametersComponent.prototype.convertFormValuesToReportParamQuery = function (values) {
        var reportParamQuery = new report_model_1.ReportQuery();
        reportParamQuery.dateRange.startDate = this.convertMomentDate(values.dateRange.startDate);
        reportParamQuery.dateRange.endDate = this.convertMomentDate(values.dateRange.endDate);
        reportParamQuery.status = values.statusGroup.status;
        reportParamQuery.processDefinitionId = values.processDefGroup.processDefinitionId;
        reportParamQuery.taskName = values.taskGroup.taskName;
        reportParamQuery.duration = values.durationGroup.duration;
        reportParamQuery.dateRangeInterval = values.dateIntervalGroup.dateRangeInterval;
        reportParamQuery.slowProcessInstanceInteger = this.convertNumber(values.processInstanceGroup.slowProcessInstanceInteger);
        reportParamQuery.typeFiltering = values.typeFilteringGroup.typeFiltering;
        return reportParamQuery;
    };
    AnalyticsReportParametersComponent.prototype.ngOnDestroy = function () {
        this.dropDownSub.unsubscribe();
        this.paramOpts.unsubscribe();
        if (this.reportParamsSub) {
            this.reportParamsSub.unsubscribe();
        }
    };
    AnalyticsReportParametersComponent.prototype.editEnable = function () {
        this.isEditable = true;
    };
    AnalyticsReportParametersComponent.prototype.editDisable = function () {
        this.isEditable = false;
    };
    AnalyticsReportParametersComponent.prototype.editTitle = function () {
        var _this = this;
        this.reportParamsSub = this.analyticsService.updateReport(this.reportParameters.id, this.reportParameters.name).subscribe(function (res) {
            _this.editDisable();
            _this.onEdit.emit(_this.reportParameters.name);
        }, function (err) {
            _this.logService.error(err);
            _this.onError.emit(err);
        });
    };
    AnalyticsReportParametersComponent.prototype.ngAfterViewChecked = function () {
        if (componentHandler) {
            componentHandler.upgradeAllRegistered();
        }
    };
    AnalyticsReportParametersComponent.prototype.toggleParameters = function () {
        this.hideParameters = !this.hideParameters;
    };
    AnalyticsReportParametersComponent.prototype.isParametersHide = function () {
        return this.hideParameters;
    };
    return AnalyticsReportParametersComponent;
}());
AnalyticsReportParametersComponent.FORMAT_DATE_ACTIVITI = 'YYYY-MM-DD';
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], AnalyticsReportParametersComponent.prototype, "appId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], AnalyticsReportParametersComponent.prototype, "reportId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], AnalyticsReportParametersComponent.prototype, "debug", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], AnalyticsReportParametersComponent.prototype, "onSuccess", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], AnalyticsReportParametersComponent.prototype, "onError", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], AnalyticsReportParametersComponent.prototype, "onEdit", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], AnalyticsReportParametersComponent.prototype, "onFormValueChanged", void 0);
AnalyticsReportParametersComponent = AnalyticsReportParametersComponent_1 = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'analytics-report-parameters',
        template: "<div class=\"report-container\">     <a class=\"mdl-navigation__link setting-button\" data-automation-id=\"settings\">         <button (click)=\"toggleParameters()\" class=\"mdl-button mdl-js-button mdl-button--fab mdl-button--colored\">             <i class=\"material-icons\">settings</i>         </button>         <span class=\"report-container-setting\">{{'ANALYTICS.MESSAGES.SETTING-TITLE' | translate}}</span>     </a>     <div class=\"col-md-6\" [class.is-hide]=\"isParametersHide()\" >         <div *ngIf=\"reportParameters\">             <form [formGroup]=\"reportForm\" novalidate>             <div *ngIf=\"isEditable\">                 <input                         type=\"text\"                         class=\"mdl-textfield__input large\"                         id=\"reportName\"                         autofocus                         data-automation-id=\"reportName\"                         [value]=\"reportParameters.name\"                         (input)=\"reportParameters.name=$event.target.value\"                         (blur)=\"editTitle($event)\"                         />             </div>             <div *ngIf=\"!isEditable\">                 <span class=\"icon-small\">                 <i class=\"material-icons\">mode_edit</i>                 <h4 (click)=\"editEnable()\">{{reportParameters.name}}</h4>                 </span>             </div><hr>             <div *ngFor=\"let field of reportParameters.definition.parameters\">                 <div [ngSwitch]=\"field.type\">                     <div *ngSwitchCase=\"'integer'\">                         <br>                         <number-widget [field]=\"field\" [group]=\"reportForm.controls.processInstanceGroup\" [controllerName]=\"'slowProcessInstanceInteger'\"                                        [required]=\"true\"></number-widget>                     </div>                     <div *ngSwitchCase=\"'duration'\">                         <br>                         <duration-widget [field]=\"field\" [group]=\"reportForm.controls.durationGroup\"                                          [controllerName]=\"'duration'\"></duration-widget>                     </div>                     <div *ngSwitchCase=\"'boolean'\">                         <br>                         <checkbox-widget [field]=\"field\" [group]=\"reportForm.controls.typeFilteringGroup\"                                          [controllerName]=\"'typeFiltering'\"></checkbox-widget>                     </div>                     <div *ngSwitchCase=\"'status'\">                         <br>                         <dropdown-widget [field]=\"field\" [group]=\"reportForm.controls.statusGroup\" [controllerName]=\"'status'\"                                          [required]=\"true\"></dropdown-widget>                     </div>                     <div *ngSwitchCase=\"'processDefinition'\">                         <br>                         <dropdown-widget [field]=\"field\" [group]=\"reportForm.controls.processDefGroup\" [controllerName]=\"'processDefinitionId'\"                                          [required]=\"true\" (fieldChanged)=\"onProcessDefinitionChanges(field)\"></dropdown-widget>                     </div>                     <div *ngSwitchCase=\"'task'\">                         <br>                         <dropdown-widget [field]=\"field\" [group]=\"reportForm.controls.taskGroup\" [controllerName]=\"'taskName'\"                                          [required]=\"true\"></dropdown-widget>                     </div>                     <div *ngSwitchCase=\"'dateRange'\">                         <br>                         <date-range-widget [field]=\"field\" [group]=\"reportForm.controls.dateRange\"></date-range-widget>                     </div>                     <div *ngSwitchCase=\"'dateInterval'\">                         <br>                         <dropdown-widget [field]=\"field\" [group]=\"reportForm.controls.dateIntervalGroup\" [controllerName]=\"'dateRangeInterval'\"                                          [required]=\"true\" [showDefaultOption]=\"false\"></dropdown-widget>                     </div>                     <div *ngSwitchDefault>                         <span>{{'ANALYTICS.MESSAGES.UNKNOWN-WIDGET-TYPE' | translate}}: {{field.type}}</span>                     </div>                 </div>             </div>             <div *ngIf=\"debug\">                 <p>ReportForm valid : {{ reportForm.valid }}</p>                 <p>ReportForm status : {{ reportForm.errors | json }}</p>                 <p>ReportForm FormGroup valid : {{reportForm && reportForm.controls.dateRange.valid | json }}</p>             </div>             </form>         </div>     </div> </div>",
        styles: [".dropdown-widget {     width: 100%; }  .dropdown-widget__select {     width: 100%; }  .dropdown-widget__invalid .dropdown-widget__select {     border-color: #d50000; }  .dropdown-widget__invalid .dropdown-widget__label {     color: #d50000; }  .dropdown-widget__invalid .dropdown-widget__label:after {     background-color: #d50000; }  .dropdown-widget__invalid .mdl-textfield__error {     visibility: visible !important; }  .large {     font-size: x-large;     margin-top: 24px;     margin-left: 12px; }  .icon-small i {     float: left;     margin-right: 10px;     display: none;     position: absolute; }  .icon-small h4 {     clear: left;     margin-left: 26px; }  .icon-small:hover {     color: rgb(68,138,255);     cursor: pointer; }  .icon-small:hover .material-icons {     display: block; }  .is-hide {     height: 0px;     overflow: hidden;     transition: height 0.5s; }  .report-container {     border: solid 1px rgb(212, 212, 212);     padding: 10px 10px 10px 10px; }  .report-container-setting {     padding-left: 10px; }"]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        analytics_service_1.AnalyticsService,
        forms_1.FormBuilder,
        ng2_alfresco_core_1.LogService])
], AnalyticsReportParametersComponent);
exports.AnalyticsReportParametersComponent = AnalyticsReportParametersComponent;
var AnalyticsReportParametersComponent_1;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYW5hbHl0aWNzLXJlcG9ydC1wYXJhbWV0ZXJzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7Ozs7Ozs7Ozs7O0FBRUgsc0NBVXVCO0FBQ3ZCLHdDQUFxRTtBQUNyRSwrQkFBaUM7QUFDakMsdURBQTJFO0FBQzNFLG1FQUFpRTtBQUNqRSx1REFLZ0M7QUFVaEMsSUFBYSxrQ0FBa0M7SUF5QzNDLDRDQUFvQixnQkFBNEMsRUFDNUMsZ0JBQWtDLEVBQ2xDLFdBQXdCLEVBQ3hCLFVBQXNCO1FBSHRCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBNEI7UUFDNUMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNsQyxnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN4QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBakMxQyxVQUFLLEdBQVksS0FBSyxDQUFDO1FBR3ZCLGNBQVMsR0FBRyxJQUFJLG1CQUFZLEVBQUUsQ0FBQztRQUcvQixZQUFPLEdBQUcsSUFBSSxtQkFBWSxFQUFFLENBQUM7UUFHN0IsV0FBTSxHQUFHLElBQUksbUJBQVksRUFBRSxDQUFDO1FBRzVCLHVCQUFrQixHQUFHLElBQUksbUJBQVksRUFBRSxDQUFDO1FBRXhDLHNCQUFpQixHQUFHLElBQUksbUJBQVksRUFBRSxDQUFDO1FBRXZDLDBCQUFxQixHQUFHLElBQUksbUJBQVksRUFBRSxDQUFDO1FBRTNDLHNCQUFpQixHQUFHLElBQUksbUJBQVksRUFBRSxDQUFDO1FBUy9CLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFDNUIsbUJBQWMsR0FBWSxJQUFJLENBQUM7UUFNbkMsRUFBRSxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1lBQ25CLGdCQUFnQixDQUFDLG9CQUFvQixDQUFDLHdCQUF3QixFQUFFLHlDQUF5QyxDQUFDLENBQUM7UUFDL0csQ0FBQztJQUNMLENBQUM7SUFFRCxxREFBUSxHQUFSO1FBQUEsaUJB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LENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUM1QyxDQUFDO0lBQ0wsQ0FBQztJQUVELDZEQUFnQixHQUFoQjtRQUNJLElBQUksQ0FBQyxjQUFjLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDO0lBQy9DLENBQUM7SUFFRCw2REFBZ0IsR0FBaEI7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQztJQUMvQixDQUFDO0lBQ0wseUNBQUM7QUFBRCxDQWpPQSxBQWlPQyxJQUFBO0FBL05pQix1REFBb0IsR0FBWSxZQUFZLENBQUM7QUFHM0Q7SUFEQyxZQUFLLEVBQUU7O2lFQUNNO0FBR2Q7SUFEQyxZQUFLLEVBQUU7O29FQUNTO0FBR2pCO0lBREMsWUFBSyxFQUFFOztpRUFDZTtBQUd2QjtJQURDLGFBQU0sRUFBRTs7cUVBQ3NCO0FBRy9CO0lBREMsYUFBTSxFQUFFOzttRUFDb0I7QUFHN0I7SUFEQyxhQUFNLEVBQUU7O2tFQUNtQjtBQUc1QjtJQURDLGFBQU0sRUFBRTs7OEVBQytCO0FBdkIvQixrQ0FBa0M7SUFOOUMsZ0JBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtRQUNuQixRQUFRLEVBQUUsNkJBQTZCO1FBQ3ZDLFFBQVEsRUFBRSxxbkpBQXFuSjtRQUMvbkosTUFBTSxFQUFFLENBQUMsNGdDQUE0Z0MsQ0FBQztLQUN6aEMsQ0FBQztxQ0EwQ3dDLDhDQUEwQjtRQUMxQixvQ0FBZ0I7UUFDckIsbUJBQVc7UUFDWiw4QkFBVTtHQTVDakMsa0NBQWtDLENBaU85QztBQWpPWSxnRkFBa0MiLCJmaWxlIjoiY29tcG9uZW50cy9hbmFseXRpY3MtcmVwb3J0LXBhcmFtZXRlcnMuY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBDb21wb25lbnQsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIE9uSW5pdCxcbiAgICBPbkNoYW5nZXMsXG4gICAgSW5wdXQsXG4gICAgT3V0cHV0LFxuICAgIFNpbXBsZUNoYW5nZXMsXG4gICAgT25EZXN0cm95LFxuICAgIEFmdGVyVmlld0NoZWNrZWRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1CdWlsZGVyLCBGb3JtQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCAqIGFzIG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHsgQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UsIExvZ1NlcnZpY2UgfSBmcm9tICduZzItYWxmcmVzY28tY29yZSc7XG5pbXBvcnQgeyBBbmFseXRpY3NTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYW5hbHl0aWNzLnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgICBSZXBvcnRQYXJhbWV0ZXJzTW9kZWwsXG4gICAgUmVwb3J0UXVlcnksXG4gICAgUGFyYW1ldGVyVmFsdWVNb2RlbCxcbiAgICBSZXBvcnRQYXJhbWV0ZXJEZXRhaWxzTW9kZWxcbn0gZnJvbSAnLi4vbW9kZWxzL3JlcG9ydC5tb2RlbCc7XG5cbmRlY2xhcmUgdmFyIGNvbXBvbmVudEhhbmRsZXI7XG5cbkBDb21wb25lbnQoe1xuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc2VsZWN0b3I6ICdhbmFseXRpY3MtcmVwb3J0LXBhcmFtZXRlcnMnLFxuICAgIHRlbXBsYXRlOiBcIjxkaXYgY2xhc3M9XFxcInJlcG9ydC1jb250YWluZXJcXFwiPiAgICAgPGEgY2xhc3M9XFxcIm1kbC1uYXZpZ2F0aW9uX19saW5rIHNldHRpbmctYnV0dG9uXFxcIiBkYXRhLWF1dG9tYXRpb24taWQ9XFxcInNldHRpbmdzXFxcIj4gICAgICAgICA8YnV0dG9uIChjbGljayk9XFxcInRvZ2dsZVBhcmFtZXRlcnMoKVxcXCIgY2xhc3M9XFxcIm1kbC1idXR0b24gbWRsLWpzLWJ1dHRvbiBtZGwtYnV0dG9uLS1mYWIgbWRsLWJ1dHRvbi0tY29sb3JlZFxcXCI+ICAgICAgICAgICAgIDxpIGNsYXNzPVxcXCJtYXRlcmlhbC1pY29uc1xcXCI+c2V0dGluZ3M8L2k+ICAgICAgICAgPC9idXR0b24+ICAgICAgICAgPHNwYW4gY2xhc3M9XFxcInJlcG9ydC1jb250YWluZXItc2V0dGluZ1xcXCI+e3snQU5BTFlUSUNTLk1FU1NBR0VTLlNFVFRJTkctVElUTEUnIHwgdHJhbnNsYXRlfX08L3NwYW4+ICAgICA8L2E+ICAgICA8ZGl2IGNsYXNzPVxcXCJjb2wtbWQtNlxcXCIgW2NsYXNzLmlzLWhpZGVdPVxcXCJpc1BhcmFtZXRlcnNIaWRlKClcXFwiID4gICAgICAgICA8ZGl2ICpuZ0lmPVxcXCJyZXBvcnRQYXJhbWV0ZXJzXFxcIj4gICAgICAgICAgICAgPGZvcm0gW2Zvcm1Hcm91cF09XFxcInJlcG9ydEZvcm1cXFwiIG5vdmFsaWRhdGU+ICAgICAgICAgICAgIDxkaXYgKm5nSWY9XFxcImlzRWRpdGFibGVcXFwiPiAgICAgICAgICAgICAgICAgPGlucHV0ICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XFxcInRleHRcXFwiICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkX19pbnB1dCBsYXJnZVxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgaWQ9XFxcInJlcG9ydE5hbWVcXFwiICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9mb2N1cyAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLWF1dG9tYXRpb24taWQ9XFxcInJlcG9ydE5hbWVcXFwiICAgICAgICAgICAgICAgICAgICAgICAgIFt2YWx1ZV09XFxcInJlcG9ydFBhcmFtZXRlcnMubmFtZVxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgKGlucHV0KT1cXFwicmVwb3J0UGFyYW1ldGVycy5uYW1lPSRldmVudC50YXJnZXQudmFsdWVcXFwiICAgICAgICAgICAgICAgICAgICAgICAgIChibHVyKT1cXFwiZWRpdFRpdGxlKCRldmVudClcXFwiICAgICAgICAgICAgICAgICAgICAgICAgIC8+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICA8ZGl2ICpuZ0lmPVxcXCIhaXNFZGl0YWJsZVxcXCI+ICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwiaWNvbi1zbWFsbFxcXCI+ICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cXFwibWF0ZXJpYWwtaWNvbnNcXFwiPm1vZGVfZWRpdDwvaT4gICAgICAgICAgICAgICAgIDxoNCAoY2xpY2spPVxcXCJlZGl0RW5hYmxlKClcXFwiPnt7cmVwb3J0UGFyYW1ldGVycy5uYW1lfX08L2g0PiAgICAgICAgICAgICAgICAgPC9zcGFuPiAgICAgICAgICAgICA8L2Rpdj48aHI+ICAgICAgICAgICAgIDxkaXYgKm5nRm9yPVxcXCJsZXQgZmllbGQgb2YgcmVwb3J0UGFyYW1ldGVycy5kZWZpbml0aW9uLnBhcmFtZXRlcnNcXFwiPiAgICAgICAgICAgICAgICAgPGRpdiBbbmdTd2l0Y2hdPVxcXCJmaWVsZC50eXBlXFxcIj4gICAgICAgICAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidpbnRlZ2VyJ1xcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgIDxicj4gICAgICAgICAgICAgICAgICAgICAgICAgPG51bWJlci13aWRnZXQgW2ZpZWxkXT1cXFwiZmllbGRcXFwiIFtncm91cF09XFxcInJlcG9ydEZvcm0uY29udHJvbHMucHJvY2Vzc0luc3RhbmNlR3JvdXBcXFwiIFtjb250cm9sbGVyTmFtZV09XFxcIidzbG93UHJvY2Vzc0luc3RhbmNlSW50ZWdlcidcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtyZXF1aXJlZF09XFxcInRydWVcXFwiPjwvbnVtYmVyLXdpZGdldD4gICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidkdXJhdGlvbidcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICA8YnI+ICAgICAgICAgICAgICAgICAgICAgICAgIDxkdXJhdGlvbi13aWRnZXQgW2ZpZWxkXT1cXFwiZmllbGRcXFwiIFtncm91cF09XFxcInJlcG9ydEZvcm0uY29udHJvbHMuZHVyYXRpb25Hcm91cFxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29udHJvbGxlck5hbWVdPVxcXCInZHVyYXRpb24nXFxcIj48L2R1cmF0aW9uLXdpZGdldD4gICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidib29sZWFuJ1xcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgIDxicj4gICAgICAgICAgICAgICAgICAgICAgICAgPGNoZWNrYm94LXdpZGdldCBbZmllbGRdPVxcXCJmaWVsZFxcXCIgW2dyb3VwXT1cXFwicmVwb3J0Rm9ybS5jb250cm9scy50eXBlRmlsdGVyaW5nR3JvdXBcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2NvbnRyb2xsZXJOYW1lXT1cXFwiJ3R5cGVGaWx0ZXJpbmcnXFxcIj48L2NoZWNrYm94LXdpZGdldD4gICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidzdGF0dXMnXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgPGJyPiAgICAgICAgICAgICAgICAgICAgICAgICA8ZHJvcGRvd24td2lkZ2V0IFtmaWVsZF09XFxcImZpZWxkXFxcIiBbZ3JvdXBdPVxcXCJyZXBvcnRGb3JtLmNvbnRyb2xzLnN0YXR1c0dyb3VwXFxcIiBbY29udHJvbGxlck5hbWVdPVxcXCInc3RhdHVzJ1xcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcmVxdWlyZWRdPVxcXCJ0cnVlXFxcIj48L2Ryb3Bkb3duLXdpZGdldD4gICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidwcm9jZXNzRGVmaW5pdGlvbidcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICA8YnI+ICAgICAgICAgICAgICAgICAgICAgICAgIDxkcm9wZG93bi13aWRnZXQgW2ZpZWxkXT1cXFwiZmllbGRcXFwiIFtncm91cF09XFxcInJlcG9ydEZvcm0uY29udHJvbHMucHJvY2Vzc0RlZkdyb3VwXFxcIiBbY29udHJvbGxlck5hbWVdPVxcXCIncHJvY2Vzc0RlZmluaXRpb25JZCdcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW3JlcXVpcmVkXT1cXFwidHJ1ZVxcXCIgKGZpZWxkQ2hhbmdlZCk9XFxcIm9uUHJvY2Vzc0RlZmluaXRpb25DaGFuZ2VzKGZpZWxkKVxcXCI+PC9kcm9wZG93bi13aWRnZXQ+ICAgICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICAgICAgPGRpdiAqbmdTd2l0Y2hDYXNlPVxcXCIndGFzaydcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICA8YnI+ICAgICAgICAgICAgICAgICAgICAgICAgIDxkcm9wZG93bi13aWRnZXQgW2ZpZWxkXT1cXFwiZmllbGRcXFwiIFtncm91cF09XFxcInJlcG9ydEZvcm0uY29udHJvbHMudGFza0dyb3VwXFxcIiBbY29udHJvbGxlck5hbWVdPVxcXCIndGFza05hbWUnXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtyZXF1aXJlZF09XFxcInRydWVcXFwiPjwvZHJvcGRvd24td2lkZ2V0PiAgICAgICAgICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICAgICAgICAgIDxkaXYgKm5nU3dpdGNoQ2FzZT1cXFwiJ2RhdGVSYW5nZSdcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICA8YnI+ICAgICAgICAgICAgICAgICAgICAgICAgIDxkYXRlLXJhbmdlLXdpZGdldCBbZmllbGRdPVxcXCJmaWVsZFxcXCIgW2dyb3VwXT1cXFwicmVwb3J0Rm9ybS5jb250cm9scy5kYXRlUmFuZ2VcXFwiPjwvZGF0ZS1yYW5nZS13aWRnZXQ+ICAgICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICAgICAgPGRpdiAqbmdTd2l0Y2hDYXNlPVxcXCInZGF0ZUludGVydmFsJ1xcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgIDxicj4gICAgICAgICAgICAgICAgICAgICAgICAgPGRyb3Bkb3duLXdpZGdldCBbZmllbGRdPVxcXCJmaWVsZFxcXCIgW2dyb3VwXT1cXFwicmVwb3J0Rm9ybS5jb250cm9scy5kYXRlSW50ZXJ2YWxHcm91cFxcXCIgW2NvbnRyb2xsZXJOYW1lXT1cXFwiJ2RhdGVSYW5nZUludGVydmFsJ1xcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcmVxdWlyZWRdPVxcXCJ0cnVlXFxcIiBbc2hvd0RlZmF1bHRPcHRpb25dPVxcXCJmYWxzZVxcXCI+PC9kcm9wZG93bi13aWRnZXQ+ICAgICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICAgICAgPGRpdiAqbmdTd2l0Y2hEZWZhdWx0PiAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj57eydBTkFMWVRJQ1MuTUVTU0FHRVMuVU5LTk9XTi1XSURHRVQtVFlQRScgfCB0cmFuc2xhdGV9fToge3tmaWVsZC50eXBlfX08L3NwYW4+ICAgICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgIDxkaXYgKm5nSWY9XFxcImRlYnVnXFxcIj4gICAgICAgICAgICAgICAgIDxwPlJlcG9ydEZvcm0gdmFsaWQgOiB7eyByZXBvcnRGb3JtLnZhbGlkIH19PC9wPiAgICAgICAgICAgICAgICAgPHA+UmVwb3J0Rm9ybSBzdGF0dXMgOiB7eyByZXBvcnRGb3JtLmVycm9ycyB8IGpzb24gfX08L3A+ICAgICAgICAgICAgICAgICA8cD5SZXBvcnRGb3JtIEZvcm1Hcm91cCB2YWxpZCA6IHt7cmVwb3J0Rm9ybSAmJiByZXBvcnRGb3JtLmNvbnRyb2xzLmRhdGVSYW5nZS52YWxpZCB8IGpzb24gfX08L3A+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICA8L2Zvcm0+ICAgICAgICAgPC9kaXY+ICAgICA8L2Rpdj4gPC9kaXY+XCIsXG4gICAgc3R5bGVzOiBbXCIuZHJvcGRvd24td2lkZ2V0IHsgICAgIHdpZHRoOiAxMDAlOyB9ICAuZHJvcGRvd24td2lkZ2V0X19zZWxlY3QgeyAgICAgd2lkdGg6IDEwMCU7IH0gIC5kcm9wZG93bi13aWRnZXRfX2ludmFsaWQgLmRyb3Bkb3duLXdpZGdldF9fc2VsZWN0IHsgICAgIGJvcmRlci1jb2xvcjogI2Q1MDAwMDsgfSAgLmRyb3Bkb3duLXdpZGdldF9faW52YWxpZCAuZHJvcGRvd24td2lkZ2V0X19sYWJlbCB7ICAgICBjb2xvcjogI2Q1MDAwMDsgfSAgLmRyb3Bkb3duLXdpZGdldF9faW52YWxpZCAuZHJvcGRvd24td2lkZ2V0X19sYWJlbDphZnRlciB7ICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZDUwMDAwOyB9ICAuZHJvcGRvd24td2lkZ2V0X19pbnZhbGlkIC5tZGwtdGV4dGZpZWxkX19lcnJvciB7ICAgICB2aXNpYmlsaXR5OiB2aXNpYmxlICFpbXBvcnRhbnQ7IH0gIC5sYXJnZSB7ICAgICBmb250LXNpemU6IHgtbGFyZ2U7ICAgICBtYXJnaW4tdG9wOiAyNHB4OyAgICAgbWFyZ2luLWxlZnQ6IDEycHg7IH0gIC5pY29uLXNtYWxsIGkgeyAgICAgZmxvYXQ6IGxlZnQ7ICAgICBtYXJnaW4tcmlnaHQ6IDEwcHg7ICAgICBkaXNwbGF5OiBub25lOyAgICAgcG9zaXRpb246IGFic29sdXRlOyB9ICAuaWNvbi1zbWFsbCBoNCB7ICAgICBjbGVhcjogbGVmdDsgICAgIG1hcmdpbi1sZWZ0OiAyNnB4OyB9ICAuaWNvbi1zbWFsbDpob3ZlciB7ICAgICBjb2xvcjogcmdiKDY4LDEzOCwyNTUpOyAgICAgY3Vyc29yOiBwb2ludGVyOyB9ICAuaWNvbi1zbWFsbDpob3ZlciAubWF0ZXJpYWwtaWNvbnMgeyAgICAgZGlzcGxheTogYmxvY2s7IH0gIC5pcy1oaWRlIHsgICAgIGhlaWdodDogMHB4OyAgICAgb3ZlcmZsb3c6IGhpZGRlbjsgICAgIHRyYW5zaXRpb246IGhlaWdodCAwLjVzOyB9ICAucmVwb3J0LWNvbnRhaW5lciB7ICAgICBib3JkZXI6IHNvbGlkIDFweCByZ2IoMjEyLCAyMTIsIDIxMik7ICAgICBwYWRkaW5nOiAxMHB4IDEwcHggMTBweCAxMHB4OyB9ICAucmVwb3J0LWNvbnRhaW5lci1zZXR0aW5nIHsgICAgIHBhZGRpbmctbGVmdDogMTBweDsgfVwiXVxufSlcbmV4cG9ydCBjbGFzcyBBbmFseXRpY3NSZXBvcnRQYXJhbWV0ZXJzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3Q2hlY2tlZCB7XG5cbiAgICBwdWJsaWMgc3RhdGljIEZPUk1BVF9EQVRFX0FDVElWSVRJOiBzdHJpbmcgPSAgJ1lZWVktTU0tREQnO1xuXG4gICAgQElucHV0KClcbiAgICBhcHBJZDogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICByZXBvcnRJZDogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICBkZWJ1ZzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgQE91dHB1dCgpXG4gICAgb25TdWNjZXNzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgb25FcnJvciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIG9uRWRpdCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIG9uRm9ybVZhbHVlQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIG9uRHJvcGRvd25DaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgb25TdWNjZXNzUmVwb3J0UGFyYW1zID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgb25TdWNjZXNzUGFyYW1PcHQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICByZXBvcnRQYXJhbWV0ZXJzOiBSZXBvcnRQYXJhbWV0ZXJzTW9kZWw7XG5cbiAgICByZXBvcnRGb3JtOiBGb3JtR3JvdXA7XG5cbiAgICBwcml2YXRlIGRyb3BEb3duU3ViO1xuICAgIHByaXZhdGUgcmVwb3J0UGFyYW1zU3ViO1xuICAgIHByaXZhdGUgcGFyYW1PcHRzO1xuICAgIHByaXZhdGUgaXNFZGl0YWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHByaXZhdGUgaGlkZVBhcmFtZXRlcnM6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSB0cmFuc2xhdGVTZXJ2aWNlOiBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFuYWx5dGljc1NlcnZpY2U6IEFuYWx5dGljc1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlKSB7XG4gICAgICAgIGlmICh0cmFuc2xhdGVTZXJ2aWNlKSB7XG4gICAgICAgICAgICB0cmFuc2xhdGVTZXJ2aWNlLmFkZFRyYW5zbGF0aW9uRm9sZGVyKCduZzItYWN0aXZpdGktYW5hbHl0aWNzJywgJ25vZGVfbW9kdWxlcy9uZzItYWN0aXZpdGktYW5hbHl0aWNzL3NyYycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuaW5pdEZvcm0oKTtcblxuICAgICAgICB0aGlzLmRyb3BEb3duU3ViID0gdGhpcy5vbkRyb3Bkb3duQ2hhbmdlZC5zdWJzY3JpYmUoKGZpZWxkKSA9PiB7XG4gICAgICAgICAgICBsZXQgcGFyYW1EZXBlbmRPbjogUmVwb3J0UGFyYW1ldGVyRGV0YWlsc01vZGVsID0gdGhpcy5yZXBvcnRQYXJhbWV0ZXJzLmRlZmluaXRpb24ucGFyYW1ldGVycy5maW5kKHAgPT4gcC5kZXBlbmRzT24gPT09IGZpZWxkLmlkKTtcbiAgICAgICAgICAgIGlmIChwYXJhbURlcGVuZE9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXRyaWV2ZVBhcmFtZXRlck9wdGlvbnModGhpcy5yZXBvcnRQYXJhbWV0ZXJzLmRlZmluaXRpb24ucGFyYW1ldGVycywgdGhpcy5hcHBJZCwgdGhpcy5yZXBvcnRJZCwgZmllbGQudmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnBhcmFtT3B0cyA9IHRoaXMub25TdWNjZXNzUmVwb3J0UGFyYW1zLnN1YnNjcmliZSgocmVwb3J0OiBSZXBvcnRQYXJhbWV0ZXJzTW9kZWwpID0+IHtcbiAgICAgICAgICAgIGlmIChyZXBvcnQuaGFzUGFyYW1ldGVycygpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXRyaWV2ZVBhcmFtZXRlck9wdGlvbnMocmVwb3J0LmRlZmluaXRpb24ucGFyYW1ldGVycywgdGhpcy5hcHBJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucmVwb3J0Rm9ybS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKGRhdGEgPT4gdGhpcy5vblZhbHVlQ2hhbmdlZChkYXRhKSk7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgICAgICB0aGlzLmlzRWRpdGFibGUgPSBmYWxzZTtcbiAgICAgICAgbGV0IHJlcG9ydElkID0gY2hhbmdlc1sncmVwb3J0SWQnXTtcbiAgICAgICAgaWYgKHJlcG9ydElkICYmIHJlcG9ydElkLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5nZXRSZXBvcnRQYXJhbXMocmVwb3J0SWQuY3VycmVudFZhbHVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBhcHBJZCA9IGNoYW5nZXNbJ2FwcElkJ107XG4gICAgICAgIGlmIChhcHBJZCAmJiAoYXBwSWQuY3VycmVudFZhbHVlIHx8IGFwcElkLmN1cnJlbnRWYWx1ZSA9PT0gbnVsbCkpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0UmVwb3J0UGFyYW1zKHRoaXMucmVwb3J0SWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5pdEZvcm0oKSB7XG4gICAgICAgIHRoaXMucmVwb3J0Rm9ybSA9IHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoe1xuICAgICAgICAgICAgZGF0ZVJhbmdlOiBuZXcgRm9ybUdyb3VwKHt9KSxcbiAgICAgICAgICAgIHN0YXR1c0dyb3VwOiBuZXcgRm9ybUdyb3VwKHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IG5ldyBGb3JtQ29udHJvbCgpXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHByb2Nlc3NJbnN0YW5jZUdyb3VwOiBuZXcgRm9ybUdyb3VwKHtcbiAgICAgICAgICAgICAgICBzbG93UHJvY2Vzc0luc3RhbmNlSW50ZWdlcjogbmV3IEZvcm1Db250cm9sKClcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdGFza0dyb3VwOiBuZXcgRm9ybUdyb3VwKHtcbiAgICAgICAgICAgICAgICB0YXNrTmFtZTogbmV3IEZvcm1Db250cm9sKClcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdHlwZUZpbHRlcmluZ0dyb3VwOiBuZXcgRm9ybUdyb3VwKHtcbiAgICAgICAgICAgICAgICB0eXBlRmlsdGVyaW5nOiBuZXcgRm9ybUNvbnRyb2woKVxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBkYXRlSW50ZXJ2YWxHcm91cDogbmV3IEZvcm1Hcm91cCh7XG4gICAgICAgICAgICAgICAgZGF0ZVJhbmdlSW50ZXJ2YWw6IG5ldyBGb3JtQ29udHJvbCgpXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGR1cmF0aW9uR3JvdXA6IG5ldyBGb3JtR3JvdXAoe1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBuZXcgRm9ybUNvbnRyb2woKVxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBwcm9jZXNzRGVmR3JvdXA6IG5ldyBGb3JtR3JvdXAoe1xuICAgICAgICAgICAgICAgIHByb2Nlc3NEZWZpbml0aW9uSWQ6IG5ldyBGb3JtQ29udHJvbCgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UmVwb3J0UGFyYW1zKHJlcG9ydElkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5yZXBvcnRQYXJhbXNTdWIgPSB0aGlzLmFuYWx5dGljc1NlcnZpY2UuZ2V0UmVwb3J0UGFyYW1zKHJlcG9ydElkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAocmVzOiBSZXBvcnRQYXJhbWV0ZXJzTW9kZWwpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlcG9ydFBhcmFtZXRlcnMgPSByZXM7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmVwb3J0UGFyYW1ldGVycy5oYXNQYXJhbWV0ZXJzKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblN1Y2Nlc3NSZXBvcnRQYXJhbXMuZW1pdChyZXMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25TdWNjZXNzLmVtaXQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGVycjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJldHJpZXZlUGFyYW1ldGVyT3B0aW9ucyhwYXJhbWV0ZXJzOiBSZXBvcnRQYXJhbWV0ZXJEZXRhaWxzTW9kZWxbXSwgYXBwSWQ6IHN0cmluZywgcmVwb3J0SWQ/OiBzdHJpbmcsIHByb2Nlc3NEZWZpbml0aW9uSWQ/OiBzdHJpbmcpIHtcbiAgICAgICAgcGFyYW1ldGVycy5mb3JFYWNoKChwYXJhbSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hbmFseXRpY3NTZXJ2aWNlLmdldFBhcmFtVmFsdWVzQnlUeXBlKHBhcmFtLnR5cGUsIGFwcElkLCByZXBvcnRJZCwgcHJvY2Vzc0RlZmluaXRpb25JZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChvcHRzOiBQYXJhbWV0ZXJWYWx1ZU1vZGVsW10pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW0ub3B0aW9ucyA9IG9wdHM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25TdWNjZXNzUGFyYW1PcHQuZW1pdChvcHRzKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnI6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBvblByb2Nlc3NEZWZpbml0aW9uQ2hhbmdlcyhmaWVsZDogYW55KSB7XG4gICAgICAgIGlmIChmaWVsZC52YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5vbkRyb3Bkb3duQ2hhbmdlZC5lbWl0KGZpZWxkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzdWJtaXQodmFsdWVzOiBhbnkpIHtcbiAgICAgICAgbGV0IHJlcG9ydFBhcmFtUXVlcnkgPSB0aGlzLmNvbnZlcnRGb3JtVmFsdWVzVG9SZXBvcnRQYXJhbVF1ZXJ5KHZhbHVlcyk7XG4gICAgICAgIHRoaXMub25TdWNjZXNzLmVtaXQocmVwb3J0UGFyYW1RdWVyeSk7XG4gICAgfVxuXG4gICAgb25WYWx1ZUNoYW5nZWQodmFsdWVzOiBhbnkpIHtcbiAgICAgICAgdGhpcy5vbkZvcm1WYWx1ZUNoYW5nZWQuZW1pdCh2YWx1ZXMpO1xuICAgICAgICBpZiAodGhpcy5yZXBvcnRGb3JtICYmIHRoaXMucmVwb3J0Rm9ybS52YWxpZCkge1xuICAgICAgICAgICAgdGhpcy5zdWJtaXQodmFsdWVzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBjb252ZXJ0TW9tZW50RGF0ZShkYXRlOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIG1vbWVudChkYXRlLCBBbmFseXRpY3NSZXBvcnRQYXJhbWV0ZXJzQ29tcG9uZW50LkZPUk1BVF9EQVRFX0FDVElWSVRJLCB0cnVlKVxuICAgICAgICAgICAgICAgIC5mb3JtYXQoQW5hbHl0aWNzUmVwb3J0UGFyYW1ldGVyc0NvbXBvbmVudC5GT1JNQVRfREFURV9BQ1RJVklUSSkgKyAnVDAwOjAwOjAwLjAwMFonO1xuICAgIH1cblxuICAgIHB1YmxpYyBjb252ZXJ0TnVtYmVyKHZhbHVlOiBzdHJpbmcpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdmFsdWUgIT0gbnVsbCA/IHBhcnNlSW50KHZhbHVlLCAxMCkgOiAwO1xuICAgIH1cblxuICAgIGNvbnZlcnRGb3JtVmFsdWVzVG9SZXBvcnRQYXJhbVF1ZXJ5KHZhbHVlczogYW55KTogUmVwb3J0UXVlcnkge1xuICAgICAgICBsZXQgcmVwb3J0UGFyYW1RdWVyeTogUmVwb3J0UXVlcnkgPSBuZXcgUmVwb3J0UXVlcnkoKTtcbiAgICAgICAgcmVwb3J0UGFyYW1RdWVyeS5kYXRlUmFuZ2Uuc3RhcnREYXRlID0gdGhpcy5jb252ZXJ0TW9tZW50RGF0ZSh2YWx1ZXMuZGF0ZVJhbmdlLnN0YXJ0RGF0ZSk7XG4gICAgICAgIHJlcG9ydFBhcmFtUXVlcnkuZGF0ZVJhbmdlLmVuZERhdGUgPSB0aGlzLmNvbnZlcnRNb21lbnREYXRlKHZhbHVlcy5kYXRlUmFuZ2UuZW5kRGF0ZSk7XG4gICAgICAgIHJlcG9ydFBhcmFtUXVlcnkuc3RhdHVzID0gdmFsdWVzLnN0YXR1c0dyb3VwLnN0YXR1cztcbiAgICAgICAgcmVwb3J0UGFyYW1RdWVyeS5wcm9jZXNzRGVmaW5pdGlvbklkID0gdmFsdWVzLnByb2Nlc3NEZWZHcm91cC5wcm9jZXNzRGVmaW5pdGlvbklkO1xuICAgICAgICByZXBvcnRQYXJhbVF1ZXJ5LnRhc2tOYW1lID0gdmFsdWVzLnRhc2tHcm91cC50YXNrTmFtZTtcbiAgICAgICAgcmVwb3J0UGFyYW1RdWVyeS5kdXJhdGlvbiA9IHZhbHVlcy5kdXJhdGlvbkdyb3VwLmR1cmF0aW9uO1xuICAgICAgICByZXBvcnRQYXJhbVF1ZXJ5LmRhdGVSYW5nZUludGVydmFsID0gdmFsdWVzLmRhdGVJbnRlcnZhbEdyb3VwLmRhdGVSYW5nZUludGVydmFsO1xuICAgICAgICByZXBvcnRQYXJhbVF1ZXJ5LnNsb3dQcm9jZXNzSW5zdGFuY2VJbnRlZ2VyID0gdGhpcy5jb252ZXJ0TnVtYmVyKHZhbHVlcy5wcm9jZXNzSW5zdGFuY2VHcm91cC5zbG93UHJvY2Vzc0luc3RhbmNlSW50ZWdlcik7XG4gICAgICAgIHJlcG9ydFBhcmFtUXVlcnkudHlwZUZpbHRlcmluZyA9IHZhbHVlcy50eXBlRmlsdGVyaW5nR3JvdXAudHlwZUZpbHRlcmluZztcbiAgICAgICAgcmV0dXJuIHJlcG9ydFBhcmFtUXVlcnk7XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuZHJvcERvd25TdWIudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgdGhpcy5wYXJhbU9wdHMudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgaWYgKHRoaXMucmVwb3J0UGFyYW1zU3ViKSB7XG4gICAgICAgICAgICB0aGlzLnJlcG9ydFBhcmFtc1N1Yi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGVkaXRFbmFibGUoKSB7XG4gICAgICAgIHRoaXMuaXNFZGl0YWJsZSA9ICB0cnVlO1xuICAgIH1cblxuICAgIHB1YmxpYyBlZGl0RGlzYWJsZSgpIHtcbiAgICAgICAgdGhpcy5pc0VkaXRhYmxlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcHVibGljIGVkaXRUaXRsZSgpIHtcbiAgICAgICAgdGhpcy5yZXBvcnRQYXJhbXNTdWIgPSB0aGlzLmFuYWx5dGljc1NlcnZpY2UudXBkYXRlUmVwb3J0KHRoaXMucmVwb3J0UGFyYW1ldGVycy5pZCwgdGhpcy5yZXBvcnRQYXJhbWV0ZXJzLm5hbWUpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChyZXM6IFJlcG9ydFBhcmFtZXRlcnNNb2RlbCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZWRpdERpc2FibGUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uRWRpdC5lbWl0KHRoaXMucmVwb3J0UGFyYW1ldGVycy5uYW1lKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IuZW1pdChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcbiAgICAgICAgLy8gd29ya2Fyb3VuZCBmb3IgTURMIGlzc3VlcyB3aXRoIGR5bmFtaWMgY29tcG9uZW50c1xuICAgICAgICBpZiAoY29tcG9uZW50SGFuZGxlcikge1xuICAgICAgICAgICAgY29tcG9uZW50SGFuZGxlci51cGdyYWRlQWxsUmVnaXN0ZXJlZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdG9nZ2xlUGFyYW1ldGVycygpIHtcbiAgICAgICAgdGhpcy5oaWRlUGFyYW1ldGVycyA9ICF0aGlzLmhpZGVQYXJhbWV0ZXJzO1xuICAgIH1cblxuICAgIGlzUGFyYW1ldGVyc0hpZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhpZGVQYXJhbWV0ZXJzO1xuICAgIH1cbn1cbiJdfQ==
