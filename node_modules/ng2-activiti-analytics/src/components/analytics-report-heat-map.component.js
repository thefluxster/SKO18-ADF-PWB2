/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var analytics_service_1 = require("../services/analytics.service");
var forms_1 = require("@angular/forms");
var AnalyticsReportHeatMapComponent = (function () {
    function AnalyticsReportHeatMapComponent(translateService, analyticsService, formBuilder) {
        this.translateService = translateService;
        this.analyticsService = analyticsService;
        this.formBuilder = formBuilder;
        this.onSuccess = new core_1.EventEmitter();
        this.onError = new core_1.EventEmitter();
        this.field = {};
        if (translateService) {
            translateService.addTranslationFolder('ng2-activiti-analytics', 'node_modules/ng2-activiti-analytics/src');
        }
    }
    AnalyticsReportHeatMapComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.initForm();
        this.field.id = 'metrics';
        this.field.value = 'totalCount';
        this.analyticsService.getMetricValues().subscribe(function (opts) {
            _this.field.options = opts;
            _this.onSuccess.emit(opts);
        });
    };
    AnalyticsReportHeatMapComponent.prototype.onMetricChanges = function (field) {
        if (field.value === 'totalCount') {
            this.currentMetric = this.report.totalCountValues;
            this.currentMetricColors = this.report.totalCountsPercentages;
            this.metricType = 'times';
        }
        else if (field.value === 'totalTime') {
            this.currentMetric = this.report.totalTimeValues;
            this.currentMetricColors = this.report.totalTimePercentages;
            this.metricType = 'hours';
        }
        else if (field.value === 'avgTime') {
            this.currentMetric = this.report.avgTimeValues;
            this.currentMetricColors = this.report.avgTimePercentages;
            this.metricType = 'hours';
        }
    };
    AnalyticsReportHeatMapComponent.prototype.initForm = function () {
        this.metricForm = this.formBuilder.group({
            metricGroup: new forms_1.FormGroup({
                metric: new forms_1.FormControl()
            })
        });
    };
    AnalyticsReportHeatMapComponent.prototype.hasMetric = function () {
        return (this.report.totalCountsPercentages ||
            this.report.totalTimePercentages ||
            this.report.avgTimePercentages) ? true : false;
    };
    return AnalyticsReportHeatMapComponent;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], AnalyticsReportHeatMapComponent.prototype, "report", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], AnalyticsReportHeatMapComponent.prototype, "onSuccess", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], AnalyticsReportHeatMapComponent.prototype, "onError", void 0);
AnalyticsReportHeatMapComponent = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'analytics-report-heat-map',
        template: "<h4>Process Heat map</h4> <div *ngIf=\"hasMetric()\">     <form [formGroup]=\"metricForm\" novalidate>         <dropdown-widget [field]=\"field\" [group]=\"metricForm.controls.metricGroup\" [controllerName]=\"'metric'\"                          (fieldChanged)=\"onMetricChanges(field)\" [showDefaultOption]=\"false\"></dropdown-widget>     </form>     <activiti-diagram *ngIf=\"currentMetric\" [processDefinitionId]=\"report.processDefinitionId\" [metricPercentages]=\"currentMetric\" [metricColor]=\"currentMetricColors\" [metricType]=\"metricType\"></activiti-diagram> </div> <div *ngIf=\"!hasMetric()\">No metric found</div>"
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        analytics_service_1.AnalyticsService,
        forms_1.FormBuilder])
], AnalyticsReportHeatMapComponent);
exports.AnalyticsReportHeatMapComponent = AnalyticsReportHeatMapComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYW5hbHl0aWNzLXJlcG9ydC1oZWF0LW1hcC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQUErRTtBQUMvRSx1REFBK0Q7QUFDL0QsbUVBQWlFO0FBQ2pFLHdDQUFxRTtBQU9yRSxJQUFhLCtCQUErQjtJQWtCeEMseUNBQW9CLGdCQUE0QyxFQUM1QyxnQkFBa0MsRUFDbEMsV0FBd0I7UUFGeEIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUE0QjtRQUM1QyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBZDVDLGNBQVMsR0FBRyxJQUFJLG1CQUFZLEVBQUUsQ0FBQztRQUcvQixZQUFPLEdBQUcsSUFBSSxtQkFBWSxFQUFFLENBQUM7UUFFN0IsVUFBSyxHQUFRLEVBQUUsQ0FBQztRQVVaLEVBQUUsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztZQUNuQixnQkFBZ0IsQ0FBQyxvQkFBb0IsQ0FBQyx3QkFBd0IsRUFBRSx5Q0FBeUMsQ0FBQyxDQUFDO1FBQy9HLENBQUM7SUFDTCxDQUFDO0lBRUQsa0RBQVEsR0FBUjtRQUFBLGlCQVdDO1FBVkcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxHQUFHLFNBQVMsQ0FBQztRQUMxQixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxZQUFZLENBQUM7UUFFaEMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGVBQWUsRUFBRSxDQUFDLFNBQVMsQ0FDN0MsVUFBQyxJQUFXO1lBQ1IsS0FBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1lBQzFCLEtBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlCLENBQUMsQ0FDSixDQUFDO0lBQ04sQ0FBQztJQUVELHlEQUFlLEdBQWYsVUFBZ0IsS0FBVTtRQUN0QixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxLQUFLLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDL0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDO1lBQ2xELElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLHNCQUFzQixDQUFDO1lBQzlELElBQUksQ0FBQyxVQUFVLEdBQUcsT0FBTyxDQUFDO1FBQzlCLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUM7WUFDakQsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQW9CLENBQUM7WUFDNUQsSUFBSSxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUM7UUFDOUIsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDbkMsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQztZQUMvQyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQztZQUMxRCxJQUFJLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQztRQUM5QixDQUFDO0lBQ0wsQ0FBQztJQUVELGtEQUFRLEdBQVI7UUFDSSxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDO1lBQ3JDLFdBQVcsRUFBRSxJQUFJLGlCQUFTLENBQUM7Z0JBQ3ZCLE1BQU0sRUFBRSxJQUFJLG1CQUFXLEVBQUU7YUFDNUIsQ0FBQztTQUNMLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxtREFBUyxHQUFUO1FBQ0ksTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxzQkFBc0I7WUFDMUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBb0I7WUFDaEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLElBQUksR0FBRyxLQUFLLENBQUM7SUFDbkQsQ0FBQztJQUVMLHNDQUFDO0FBQUQsQ0FyRUEsQUFxRUMsSUFBQTtBQWxFRztJQURDLFlBQUssRUFBRTs7K0RBQ0k7QUFHWjtJQURDLGFBQU0sRUFBRTs7a0VBQ3NCO0FBRy9CO0lBREMsYUFBTSxFQUFFOztnRUFDb0I7QUFUcEIsK0JBQStCO0lBTDNDLGdCQUFTLENBQUM7UUFDUCxRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7UUFDbkIsUUFBUSxFQUFFLDJCQUEyQjtRQUNyQyxRQUFRLEVBQUUscW5CQUFxbkI7S0FDbG9CLENBQUM7cUNBbUJ3Qyw4Q0FBMEI7UUFDMUIsb0NBQWdCO1FBQ3JCLG1CQUFXO0dBcEJuQywrQkFBK0IsQ0FxRTNDO0FBckVZLDBFQUErQiIsImZpbGUiOiJjb21wb25lbnRzL2FuYWx5dGljcy1yZXBvcnQtaGVhdC1tYXAuY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UgfSBmcm9tICduZzItYWxmcmVzY28tY29yZSc7XG5pbXBvcnQgeyBBbmFseXRpY3NTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYW5hbHl0aWNzLnNlcnZpY2UnO1xuaW1wb3J0IHsgRm9ybUdyb3VwLCBGb3JtQnVpbGRlciwgRm9ybUNvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbkBDb21wb25lbnQoe1xuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc2VsZWN0b3I6ICdhbmFseXRpY3MtcmVwb3J0LWhlYXQtbWFwJyxcbiAgICB0ZW1wbGF0ZTogXCI8aDQ+UHJvY2VzcyBIZWF0IG1hcDwvaDQ+IDxkaXYgKm5nSWY9XFxcImhhc01ldHJpYygpXFxcIj4gICAgIDxmb3JtIFtmb3JtR3JvdXBdPVxcXCJtZXRyaWNGb3JtXFxcIiBub3ZhbGlkYXRlPiAgICAgICAgIDxkcm9wZG93bi13aWRnZXQgW2ZpZWxkXT1cXFwiZmllbGRcXFwiIFtncm91cF09XFxcIm1ldHJpY0Zvcm0uY29udHJvbHMubWV0cmljR3JvdXBcXFwiIFtjb250cm9sbGVyTmFtZV09XFxcIidtZXRyaWMnXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgKGZpZWxkQ2hhbmdlZCk9XFxcIm9uTWV0cmljQ2hhbmdlcyhmaWVsZClcXFwiIFtzaG93RGVmYXVsdE9wdGlvbl09XFxcImZhbHNlXFxcIj48L2Ryb3Bkb3duLXdpZGdldD4gICAgIDwvZm9ybT4gICAgIDxhY3Rpdml0aS1kaWFncmFtICpuZ0lmPVxcXCJjdXJyZW50TWV0cmljXFxcIiBbcHJvY2Vzc0RlZmluaXRpb25JZF09XFxcInJlcG9ydC5wcm9jZXNzRGVmaW5pdGlvbklkXFxcIiBbbWV0cmljUGVyY2VudGFnZXNdPVxcXCJjdXJyZW50TWV0cmljXFxcIiBbbWV0cmljQ29sb3JdPVxcXCJjdXJyZW50TWV0cmljQ29sb3JzXFxcIiBbbWV0cmljVHlwZV09XFxcIm1ldHJpY1R5cGVcXFwiPjwvYWN0aXZpdGktZGlhZ3JhbT4gPC9kaXY+IDxkaXYgKm5nSWY9XFxcIiFoYXNNZXRyaWMoKVxcXCI+Tm8gbWV0cmljIGZvdW5kPC9kaXY+XCJcbn0pXG5leHBvcnQgY2xhc3MgQW5hbHl0aWNzUmVwb3J0SGVhdE1hcENvbXBvbmVudCBpbXBsZW1lbnRzICBPbkluaXQge1xuXG4gICAgQElucHV0KClcbiAgICByZXBvcnQ6IGFueTtcblxuICAgIEBPdXRwdXQoKVxuICAgIG9uU3VjY2VzcyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIG9uRXJyb3IgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBmaWVsZDogYW55ID0ge307XG5cbiAgICBtZXRyaWNGb3JtOiBGb3JtR3JvdXA7XG4gICAgY3VycmVudE1ldHJpYzogc3RyaW5nO1xuICAgIGN1cnJlbnRNZXRyaWNDb2xvcnM6IHN0cmluZztcbiAgICBtZXRyaWNUeXBlOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHRyYW5zbGF0ZVNlcnZpY2U6IEFsZnJlc2NvVHJhbnNsYXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYW5hbHl0aWNzU2VydmljZTogQW5hbHl0aWNzU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGZvcm1CdWlsZGVyOiBGb3JtQnVpbGRlcikge1xuICAgICAgICBpZiAodHJhbnNsYXRlU2VydmljZSkge1xuICAgICAgICAgICAgdHJhbnNsYXRlU2VydmljZS5hZGRUcmFuc2xhdGlvbkZvbGRlcignbmcyLWFjdGl2aXRpLWFuYWx5dGljcycsICdub2RlX21vZHVsZXMvbmcyLWFjdGl2aXRpLWFuYWx5dGljcy9zcmMnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLmluaXRGb3JtKCk7XG4gICAgICAgIHRoaXMuZmllbGQuaWQgPSAnbWV0cmljcyc7XG4gICAgICAgIHRoaXMuZmllbGQudmFsdWUgPSAndG90YWxDb3VudCc7XG5cbiAgICAgICAgdGhpcy5hbmFseXRpY3NTZXJ2aWNlLmdldE1ldHJpY1ZhbHVlcygpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChvcHRzOiBhbnlbXSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZmllbGQub3B0aW9ucyA9IG9wdHM7XG4gICAgICAgICAgICAgICAgdGhpcy5vblN1Y2Nlc3MuZW1pdChvcHRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBvbk1ldHJpY0NoYW5nZXMoZmllbGQ6IGFueSkge1xuICAgICAgICBpZiAoZmllbGQudmFsdWUgPT09ICd0b3RhbENvdW50Jykge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50TWV0cmljID0gdGhpcy5yZXBvcnQudG90YWxDb3VudFZhbHVlcztcbiAgICAgICAgICAgIHRoaXMuY3VycmVudE1ldHJpY0NvbG9ycyA9IHRoaXMucmVwb3J0LnRvdGFsQ291bnRzUGVyY2VudGFnZXM7XG4gICAgICAgICAgICB0aGlzLm1ldHJpY1R5cGUgPSAndGltZXMnO1xuICAgICAgICB9IGVsc2UgaWYgKGZpZWxkLnZhbHVlID09PSAndG90YWxUaW1lJykge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50TWV0cmljID0gdGhpcy5yZXBvcnQudG90YWxUaW1lVmFsdWVzO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50TWV0cmljQ29sb3JzID0gdGhpcy5yZXBvcnQudG90YWxUaW1lUGVyY2VudGFnZXM7XG4gICAgICAgICAgICB0aGlzLm1ldHJpY1R5cGUgPSAnaG91cnMnO1xuICAgICAgICB9IGVsc2UgaWYgKGZpZWxkLnZhbHVlID09PSAnYXZnVGltZScpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudE1ldHJpYyA9IHRoaXMucmVwb3J0LmF2Z1RpbWVWYWx1ZXM7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRNZXRyaWNDb2xvcnMgPSB0aGlzLnJlcG9ydC5hdmdUaW1lUGVyY2VudGFnZXM7XG4gICAgICAgICAgICB0aGlzLm1ldHJpY1R5cGUgPSAnaG91cnMnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5pdEZvcm0oKSB7XG4gICAgICAgIHRoaXMubWV0cmljRm9ybSA9IHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoe1xuICAgICAgICAgICAgbWV0cmljR3JvdXA6IG5ldyBGb3JtR3JvdXAoe1xuICAgICAgICAgICAgICAgIG1ldHJpYzogbmV3IEZvcm1Db250cm9sKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGhhc01ldHJpYygpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLnJlcG9ydC50b3RhbENvdW50c1BlcmNlbnRhZ2VzIHx8XG4gICAgICAgIHRoaXMucmVwb3J0LnRvdGFsVGltZVBlcmNlbnRhZ2VzIHx8XG4gICAgICAgIHRoaXMucmVwb3J0LmF2Z1RpbWVQZXJjZW50YWdlcykgPyB0cnVlIDogZmFsc2U7XG4gICAgfVxuXG59XG4iXX0=
