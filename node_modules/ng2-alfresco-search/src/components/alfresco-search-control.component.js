/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var forms_1 = require("@angular/forms");
var core_1 = require("@angular/core");
var Rx_1 = require("rxjs/Rx");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var alfresco_search_autocomplete_component_1 = require("./alfresco-search-autocomplete.component");
var search_term_validator_1 = require("./../forms/search-term-validator");
var AlfrescoSearchControlComponent = (function () {
    function AlfrescoSearchControlComponent(translateService) {
        this.translateService = translateService;
        this.searchTerm = '';
        this.inputType = 'text';
        this.autocomplete = false;
        this.expandable = true;
        this.searchChange = new core_1.EventEmitter();
        this.searchSubmit = new core_1.EventEmitter();
        this.fileSelect = new core_1.EventEmitter();
        this.expand = new core_1.EventEmitter();
        this.liveSearchEnabled = true;
        this.liveSearchTerm = '';
        this.liveSearchRoot = '-root-';
        this.liveSearchResultType = null;
        this.liveSearchResultSort = null;
        this.liveSearchMaxResults = 5;
        this.searchActive = false;
        this.searchValid = false;
        this.focusSubject = new Rx_1.Subject();
        this.searchControl = new forms_1.FormControl(this.searchTerm, forms_1.Validators.compose([forms_1.Validators.required, search_term_validator_1.SearchTermValidator.minAlphanumericChars(3)]));
    }
    AlfrescoSearchControlComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.searchControl.valueChanges.debounceTime(400).distinctUntilChanged()
            .subscribe(function (value) {
            _this.onSearchTermChange(value);
        });
        this.setupFocusEventHandlers();
        this.translateService.addTranslationFolder('ng2-alfresco-search', 'node_modules/ng2-alfresco-search/src');
    };
    AlfrescoSearchControlComponent.prototype.ngOnDestroy = function () {
        this.focusSubject.unsubscribe();
    };
    AlfrescoSearchControlComponent.prototype.onSearchTermChange = function (value) {
        this.searchValid = this.searchControl.valid;
        this.liveSearchTerm = this.searchValid ? value : '';
        this.searchControl.setValue(value, true);
        this.searchChange.emit({
            value: value,
            valid: this.searchValid
        });
    };
    AlfrescoSearchControlComponent.prototype.setupFocusEventHandlers = function () {
        var _this = this;
        var focusEvents = this.focusSubject.asObservable().debounceTime(50);
        focusEvents.filter(function ($event) {
            return $event.type === 'focusin' || $event.type === 'focus';
        }).subscribe(function ($event) {
            _this.onSearchFocus($event);
        });
        focusEvents.filter(function ($event) {
            return $event.type === 'focusout' || $event.type === 'blur';
        }).subscribe(function ($event) {
            _this.onSearchBlur($event);
        });
    };
    AlfrescoSearchControlComponent.prototype.getTextFieldClassName = function () {
        return 'mdl-textfield mdl-js-textfield' + (this.expandable ? ' mdl-textfield--expandable' : '');
    };
    AlfrescoSearchControlComponent.prototype.getTextFieldHolderClassName = function () {
        return this.expandable ? 'search-field mdl-textfield__expandable-holder' : 'search-field';
    };
    AlfrescoSearchControlComponent.prototype.getAutoComplete = function () {
        return this.autocomplete ? 'on' : 'off';
    };
    AlfrescoSearchControlComponent.prototype.onSearch = function (event) {
        this.searchControl.setValue(this.searchTerm, true);
        if (this.searchControl.valid) {
            this.searchSubmit.emit({
                value: this.searchTerm
            });
            this.searchInput.nativeElement.blur();
        }
    };
    AlfrescoSearchControlComponent.prototype.isAutoCompleteDisplayed = function () {
        return this.searchActive;
    };
    AlfrescoSearchControlComponent.prototype.setAutoCompleteDisplayed = function (display) {
        this.searchActive = display;
    };
    AlfrescoSearchControlComponent.prototype.onFileClicked = function (event) {
        this.setAutoCompleteDisplayed(false);
        this.fileSelect.emit(event);
    };
    AlfrescoSearchControlComponent.prototype.onSearchFocus = function ($event) {
        this.setAutoCompleteDisplayed(true);
    };
    AlfrescoSearchControlComponent.prototype.onSearchBlur = function ($event) {
        this.setAutoCompleteDisplayed(false);
    };
    AlfrescoSearchControlComponent.prototype.onFocus = function ($event) {
        if (this.expandable) {
            this.expand.emit({
                expanded: true
            });
        }
        this.focusSubject.next($event);
    };
    AlfrescoSearchControlComponent.prototype.onBlur = function ($event) {
        if (this.expandable && (this.searchControl.value === '' || this.searchControl.value === undefined)) {
            this.expand.emit({
                expanded: false
            });
        }
        this.focusSubject.next($event);
    };
    AlfrescoSearchControlComponent.prototype.onEscape = function () {
        this.setAutoCompleteDisplayed(false);
    };
    AlfrescoSearchControlComponent.prototype.onArrowDown = function () {
        if (this.isAutoCompleteDisplayed()) {
            this.liveSearchComponent.focusResult();
        }
        else {
            this.setAutoCompleteDisplayed(true);
        }
    };
    AlfrescoSearchControlComponent.prototype.onAutoCompleteFocus = function ($event) {
        this.focusSubject.next($event);
    };
    AlfrescoSearchControlComponent.prototype.onAutoCompleteReturn = function ($event) {
        if (this.searchInput) {
            this.searchInput.nativeElement.focus();
        }
    };
    AlfrescoSearchControlComponent.prototype.onAutoCompleteCancel = function ($event) {
        if (this.searchInput) {
            this.searchInput.nativeElement.focus();
        }
        this.setAutoCompleteDisplayed(false);
    };
    return AlfrescoSearchControlComponent;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], AlfrescoSearchControlComponent.prototype, "searchTerm", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], AlfrescoSearchControlComponent.prototype, "inputType", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], AlfrescoSearchControlComponent.prototype, "autocomplete", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], AlfrescoSearchControlComponent.prototype, "expandable", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], AlfrescoSearchControlComponent.prototype, "searchChange", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], AlfrescoSearchControlComponent.prototype, "searchSubmit", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], AlfrescoSearchControlComponent.prototype, "fileSelect", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], AlfrescoSearchControlComponent.prototype, "expand", void 0);
__decorate([
    core_1.ViewChild('searchInput', {}),
    __metadata("design:type", core_1.ElementRef)
], AlfrescoSearchControlComponent.prototype, "searchInput", void 0);
__decorate([
    core_1.ViewChild(alfresco_search_autocomplete_component_1.AlfrescoSearchAutocompleteComponent),
    __metadata("design:type", alfresco_search_autocomplete_component_1.AlfrescoSearchAutocompleteComponent)
], AlfrescoSearchControlComponent.prototype, "liveSearchComponent", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], AlfrescoSearchControlComponent.prototype, "liveSearchEnabled", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], AlfrescoSearchControlComponent.prototype, "liveSearchTerm", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], AlfrescoSearchControlComponent.prototype, "liveSearchRoot", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], AlfrescoSearchControlComponent.prototype, "liveSearchResultType", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], AlfrescoSearchControlComponent.prototype, "liveSearchResultSort", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Number)
], AlfrescoSearchControlComponent.prototype, "liveSearchMaxResults", void 0);
AlfrescoSearchControlComponent = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'alfresco-search-control',
        template: "<form #f=\"ngForm\" (ngSubmit)=\"onSearch(f.value)\">     <div [class]=\"getTextFieldClassName()\">         <label *ngIf=\"expandable\" class=\"mdl-button mdl-js-button mdl-button--icon\" for=\"searchControl\">             <i mdl-upgrade class=\"material-icons\">search</i>         </label>         <div [class]=\"getTextFieldHolderClassName()\">             <input mdl                    class=\"mdl-textfield__input\"                    [type]=\"inputType\"                    [autocomplete]=\"getAutoComplete()\"                    data-automation-id=\"search_input\"                    #searchInput                    id=\"searchControl\"                    [formControl]=\"searchControl\"                    [(ngModel)]=\"searchTerm\"                    (focus)=\"onFocus($event)\"                    (blur)=\"onBlur($event)\"                    (keyup.escape)=\"onEscape($event)\"                    (keyup.arrowdown)=\"onArrowDown($event)\"                    aria-labelledby=\"searchLabel\">             <label id=\"searchLabel\" class=\"mdl-textfield__label\" for=\"searchControl\">{{'SEARCH.CONTROL.LABEL' | translate}}</label>         </div>     </div> </form> <alfresco-search-autocomplete #autocomplete *ngIf=\"liveSearchEnabled\"                               [searchTerm]=\"liveSearchTerm\"                               [rootNodeId]=\"liveSearchRoot\"                               [resultType]=\"liveSearchResultType\"                               [resultSort]=\"liveSearchResultSort\"                               [maxResults]=\"liveSearchMaxResults\"                               [ngClass]=\"{active: searchActive, valid: searchValid}\"                               (fileSelect)=\"onFileClicked($event)\"                               (searchFocus)=\"onAutoCompleteFocus($event)\"                               (scrollBack)=\"onAutoCompleteReturn($event)\"                               (cancel)=\"onAutoCompleteCancel($event)\"></alfresco-search-autocomplete>",
        styles: [".search-field {     width: 267px; } @media only screen and (max-width: 400px) {     .search-field {         width: 200px;     } } @media only screen and (max-width: 320px) {     .search-field {         width: 160px;     } }"]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService])
], AlfrescoSearchControlComponent);
exports.AlfrescoSearchControlComponent = AlfrescoSearchControlComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWxmcmVzY28tc2VhcmNoLWNvbnRyb2wuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRzs7Ozs7Ozs7Ozs7QUFFSCx3Q0FBeUQ7QUFDekQsc0NBQWlIO0FBQ2pILDhCQUE4QztBQUM5Qyx1REFBK0Q7QUFDL0QsbUdBQStGO0FBQy9GLDBFQUF1RTtBQVF2RSxJQUFhLDhCQUE4QjtJQTBEdkMsd0NBQW9CLGdCQUE0QztRQUE1QyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQTRCO1FBdkRoRSxlQUFVLEdBQUcsRUFBRSxDQUFDO1FBR2hCLGNBQVMsR0FBRyxNQUFNLENBQUM7UUFHbkIsaUJBQVksR0FBWSxLQUFLLENBQUM7UUFHOUIsZUFBVSxHQUFZLElBQUksQ0FBQztRQUczQixpQkFBWSxHQUFHLElBQUksbUJBQVksRUFBRSxDQUFDO1FBR2xDLGlCQUFZLEdBQUcsSUFBSSxtQkFBWSxFQUFFLENBQUM7UUFHbEMsZUFBVSxHQUFHLElBQUksbUJBQVksRUFBRSxDQUFDO1FBR2hDLFdBQU0sR0FBRyxJQUFJLG1CQUFZLEVBQUUsQ0FBQztRQVc1QixzQkFBaUIsR0FBWSxJQUFJLENBQUM7UUFHbEMsbUJBQWMsR0FBVyxFQUFFLENBQUM7UUFHNUIsbUJBQWMsR0FBVyxRQUFRLENBQUM7UUFHbEMseUJBQW9CLEdBQVcsSUFBSSxDQUFDO1FBR3BDLHlCQUFvQixHQUFXLElBQUksQ0FBQztRQUdwQyx5QkFBb0IsR0FBVyxDQUFDLENBQUM7UUFFakMsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFFckIsZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFFWixpQkFBWSxHQUFHLElBQUksWUFBTyxFQUFjLENBQUM7UUFJN0MsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLG1CQUFXLENBQ2hDLElBQUksQ0FBQyxVQUFVLEVBQ2Ysa0JBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxrQkFBVSxDQUFDLFFBQVEsRUFB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LElBQUE7QUF0TUc7SUFEQyxZQUFLLEVBQUU7O2tFQUNRO0FBR2hCO0lBREMsWUFBSyxFQUFFOztpRUFDVztBQUduQjtJQURDLFlBQUssRUFBRTs7b0VBQ3NCO0FBRzlCO0lBREMsWUFBSyxFQUFFOztrRUFDbUI7QUFHM0I7SUFEQyxhQUFNLEVBQUU7O29FQUN5QjtBQUdsQztJQURDLGFBQU0sRUFBRTs7b0VBQ3lCO0FBR2xDO0lBREMsYUFBTSxFQUFFOztrRUFDdUI7QUFHaEM7SUFEQyxhQUFNLEVBQUU7OzhEQUNtQjtBQUs1QjtJQURDLGdCQUFTLENBQUMsYUFBYSxFQUFFLEVBQUUsQ0FBQzs4QkFDaEIsaUJBQVU7bUVBQUM7QUFHeEI7SUFEQyxnQkFBUyxDQUFDLDRFQUFtQyxDQUFDOzhCQUMxQiw0RUFBbUM7MkVBQUM7QUFHekQ7SUFEQyxZQUFLLEVBQUU7O3lFQUMwQjtBQUdsQztJQURDLFlBQUssRUFBRTs7c0VBQ29CO0FBRzVCO0lBREMsWUFBSyxFQUFFOztzRUFDMEI7QUFHbEM7SUFEQyxZQUFLLEVBQUU7OzRFQUM0QjtBQUdwQztJQURDLFlBQUssRUFBRTs7NEVBQzRCO0FBR3BDO0lBREMsWUFBSyxFQUFFOzs0RUFDeUI7QUFsRHhCLDhCQUE4QjtJQU4xQyxnQkFBUyxDQUFDO1FBQ1AsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1FBQ25CLFFBQVEsRUFBRSx5QkFBeUI7UUFDbkMsUUFBUSxFQUFFLGk4REFBaThEO1FBQzM4RCxNQUFNLEVBQUUsQ0FBQyxpT0FBaU8sQ0FBQztLQUM5TyxDQUFDO3FDQTJEd0MsOENBQTBCO0dBMUR2RCw4QkFBOEIsQ0F5TTFDO0FBek1ZLHdFQUE4QiIsImZpbGUiOiJjb21wb25lbnRzL2FsZnJlc2NvLXNlYXJjaC1jb250cm9sLmNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEZvcm1Db250cm9sLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT3V0cHV0LCBPbkluaXQsIE9uRGVzdHJveSwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzL1J4JztcbmltcG9ydCB7IEFsZnJlc2NvVHJhbnNsYXRpb25TZXJ2aWNlIH0gZnJvbSAnbmcyLWFsZnJlc2NvLWNvcmUnO1xuaW1wb3J0IHsgQWxmcmVzY29TZWFyY2hBdXRvY29tcGxldGVDb21wb25lbnQgfSBmcm9tICcuL2FsZnJlc2NvLXNlYXJjaC1hdXRvY29tcGxldGUuY29tcG9uZW50JztcbmltcG9ydCB7IFNlYXJjaFRlcm1WYWxpZGF0b3IgfSBmcm9tICcuLy4uL2Zvcm1zL3NlYXJjaC10ZXJtLXZhbGlkYXRvcic7XG5cbkBDb21wb25lbnQoe1xuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc2VsZWN0b3I6ICdhbGZyZXNjby1zZWFyY2gtY29udHJvbCcsXG4gICAgdGVtcGxhdGU6IFwiPGZvcm0gI2Y9XFxcIm5nRm9ybVxcXCIgKG5nU3VibWl0KT1cXFwib25TZWFyY2goZi52YWx1ZSlcXFwiPiAgICAgPGRpdiBbY2xhc3NdPVxcXCJnZXRUZXh0RmllbGRDbGFzc05hbWUoKVxcXCI+ICAgICAgICAgPGxhYmVsICpuZ0lmPVxcXCJleHBhbmRhYmxlXFxcIiBjbGFzcz1cXFwibWRsLWJ1dHRvbiBtZGwtanMtYnV0dG9uIG1kbC1idXR0b24tLWljb25cXFwiIGZvcj1cXFwic2VhcmNoQ29udHJvbFxcXCI+ICAgICAgICAgICAgIDxpIG1kbC11cGdyYWRlIGNsYXNzPVxcXCJtYXRlcmlhbC1pY29uc1xcXCI+c2VhcmNoPC9pPiAgICAgICAgIDwvbGFiZWw+ICAgICAgICAgPGRpdiBbY2xhc3NdPVxcXCJnZXRUZXh0RmllbGRIb2xkZXJDbGFzc05hbWUoKVxcXCI+ICAgICAgICAgICAgIDxpbnB1dCBtZGwgICAgICAgICAgICAgICAgICAgIGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkX19pbnB1dFxcXCIgICAgICAgICAgICAgICAgICAgIFt0eXBlXT1cXFwiaW5wdXRUeXBlXFxcIiAgICAgICAgICAgICAgICAgICAgW2F1dG9jb21wbGV0ZV09XFxcImdldEF1dG9Db21wbGV0ZSgpXFxcIiAgICAgICAgICAgICAgICAgICAgZGF0YS1hdXRvbWF0aW9uLWlkPVxcXCJzZWFyY2hfaW5wdXRcXFwiICAgICAgICAgICAgICAgICAgICAjc2VhcmNoSW5wdXQgICAgICAgICAgICAgICAgICAgIGlkPVxcXCJzZWFyY2hDb250cm9sXFxcIiAgICAgICAgICAgICAgICAgICAgW2Zvcm1Db250cm9sXT1cXFwic2VhcmNoQ29udHJvbFxcXCIgICAgICAgICAgICAgICAgICAgIFsobmdNb2RlbCldPVxcXCJzZWFyY2hUZXJtXFxcIiAgICAgICAgICAgICAgICAgICAgKGZvY3VzKT1cXFwib25Gb2N1cygkZXZlbnQpXFxcIiAgICAgICAgICAgICAgICAgICAgKGJsdXIpPVxcXCJvbkJsdXIoJGV2ZW50KVxcXCIgICAgICAgICAgICAgICAgICAgIChrZXl1cC5lc2NhcGUpPVxcXCJvbkVzY2FwZSgkZXZlbnQpXFxcIiAgICAgICAgICAgICAgICAgICAgKGtleXVwLmFycm93ZG93bik9XFxcIm9uQXJyb3dEb3duKCRldmVudClcXFwiICAgICAgICAgICAgICAgICAgICBhcmlhLWxhYmVsbGVkYnk9XFxcInNlYXJjaExhYmVsXFxcIj4gICAgICAgICAgICAgPGxhYmVsIGlkPVxcXCJzZWFyY2hMYWJlbFxcXCIgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGRfX2xhYmVsXFxcIiBmb3I9XFxcInNlYXJjaENvbnRyb2xcXFwiPnt7J1NFQVJDSC5DT05UUk9MLkxBQkVMJyB8IHRyYW5zbGF0ZX19PC9sYWJlbD4gICAgICAgICA8L2Rpdj4gICAgIDwvZGl2PiA8L2Zvcm0+IDxhbGZyZXNjby1zZWFyY2gtYXV0b2NvbXBsZXRlICNhdXRvY29tcGxldGUgKm5nSWY9XFxcImxpdmVTZWFyY2hFbmFibGVkXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbc2VhcmNoVGVybV09XFxcImxpdmVTZWFyY2hUZXJtXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcm9vdE5vZGVJZF09XFxcImxpdmVTZWFyY2hSb290XFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcmVzdWx0VHlwZV09XFxcImxpdmVTZWFyY2hSZXN1bHRUeXBlXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcmVzdWx0U29ydF09XFxcImxpdmVTZWFyY2hSZXN1bHRTb3J0XFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbbWF4UmVzdWx0c109XFxcImxpdmVTZWFyY2hNYXhSZXN1bHRzXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbbmdDbGFzc109XFxcInthY3RpdmU6IHNlYXJjaEFjdGl2ZSwgdmFsaWQ6IHNlYXJjaFZhbGlkfVxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZpbGVTZWxlY3QpPVxcXCJvbkZpbGVDbGlja2VkKCRldmVudClcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzZWFyY2hGb2N1cyk9XFxcIm9uQXV0b0NvbXBsZXRlRm9jdXMoJGV2ZW50KVxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNjcm9sbEJhY2spPVxcXCJvbkF1dG9Db21wbGV0ZVJldHVybigkZXZlbnQpXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2FuY2VsKT1cXFwib25BdXRvQ29tcGxldGVDYW5jZWwoJGV2ZW50KVxcXCI+PC9hbGZyZXNjby1zZWFyY2gtYXV0b2NvbXBsZXRlPlwiLFxuICAgIHN0eWxlczogW1wiLnNlYXJjaC1maWVsZCB7ICAgICB3aWR0aDogMjY3cHg7IH0gQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA0MDBweCkgeyAgICAgLnNlYXJjaC1maWVsZCB7ICAgICAgICAgd2lkdGg6IDIwMHB4OyAgICAgfSB9IEBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKG1heC13aWR0aDogMzIwcHgpIHsgICAgIC5zZWFyY2gtZmllbGQgeyAgICAgICAgIHdpZHRoOiAxNjBweDsgICAgIH0gfVwiXVxufSlcbmV4cG9ydCBjbGFzcyBBbGZyZXNjb1NlYXJjaENvbnRyb2xDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG5cbiAgICBASW5wdXQoKVxuICAgIHNlYXJjaFRlcm0gPSAnJztcblxuICAgIEBJbnB1dCgpXG4gICAgaW5wdXRUeXBlID0gJ3RleHQnO1xuXG4gICAgQElucHV0KClcbiAgICBhdXRvY29tcGxldGU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBJbnB1dCgpXG4gICAgZXhwYW5kYWJsZTogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBAT3V0cHV0KClcbiAgICBzZWFyY2hDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBzZWFyY2hTdWJtaXQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBmaWxlU2VsZWN0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgZXhwYW5kID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgc2VhcmNoQ29udHJvbDogRm9ybUNvbnRyb2w7XG5cbiAgICBAVmlld0NoaWxkKCdzZWFyY2hJbnB1dCcsIHt9KVxuICAgIHNlYXJjaElucHV0OiBFbGVtZW50UmVmO1xuXG4gICAgQFZpZXdDaGlsZChBbGZyZXNjb1NlYXJjaEF1dG9jb21wbGV0ZUNvbXBvbmVudClcbiAgICBsaXZlU2VhcmNoQ29tcG9uZW50OiBBbGZyZXNjb1NlYXJjaEF1dG9jb21wbGV0ZUNvbXBvbmVudDtcblxuICAgIEBJbnB1dCgpXG4gICAgbGl2ZVNlYXJjaEVuYWJsZWQ6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgQElucHV0KClcbiAgICBsaXZlU2VhcmNoVGVybTogc3RyaW5nID0gJyc7XG5cbiAgICBASW5wdXQoKVxuICAgIGxpdmVTZWFyY2hSb290OiBzdHJpbmcgPSAnLXJvb3QtJztcblxuICAgIEBJbnB1dCgpXG4gICAgbGl2ZVNlYXJjaFJlc3VsdFR5cGU6IHN0cmluZyA9IG51bGw7XG5cbiAgICBASW5wdXQoKVxuICAgIGxpdmVTZWFyY2hSZXN1bHRTb3J0OiBzdHJpbmcgPSBudWxsO1xuXG4gICAgQElucHV0KClcbiAgICBsaXZlU2VhcmNoTWF4UmVzdWx0czogbnVtYmVyID0gNTtcblxuICAgIHNlYXJjaEFjdGl2ZSA9IGZhbHNlO1xuXG4gICAgc2VhcmNoVmFsaWQgPSBmYWxzZTtcblxuICAgIHByaXZhdGUgZm9jdXNTdWJqZWN0ID0gbmV3IFN1YmplY3Q8Rm9jdXNFdmVudD4oKTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UpIHtcblxuICAgICAgICB0aGlzLnNlYXJjaENvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woXG4gICAgICAgICAgICB0aGlzLnNlYXJjaFRlcm0sXG4gICAgICAgICAgICBWYWxpZGF0b3JzLmNvbXBvc2UoW1ZhbGlkYXRvcnMucmVxdWlyZWQsIFNlYXJjaFRlcm1WYWxpZGF0b3IubWluQWxwaGFudW1lcmljQ2hhcnMoMyldKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNlYXJjaENvbnRyb2wudmFsdWVDaGFuZ2VzLmRlYm91bmNlVGltZSg0MDApLmRpc3RpbmN0VW50aWxDaGFuZ2VkKClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uU2VhcmNoVGVybUNoYW5nZSh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgdGhpcy5zZXR1cEZvY3VzRXZlbnRIYW5kbGVycygpO1xuXG4gICAgICAgIHRoaXMudHJhbnNsYXRlU2VydmljZS5hZGRUcmFuc2xhdGlvbkZvbGRlcignbmcyLWFsZnJlc2NvLXNlYXJjaCcsICdub2RlX21vZHVsZXMvbmcyLWFsZnJlc2NvLXNlYXJjaC9zcmMnKTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5mb2N1c1N1YmplY3QudW5zdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uU2VhcmNoVGVybUNoYW5nZSh2YWx1ZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2VhcmNoVmFsaWQgPSB0aGlzLnNlYXJjaENvbnRyb2wudmFsaWQ7XG4gICAgICAgIHRoaXMubGl2ZVNlYXJjaFRlcm0gPSB0aGlzLnNlYXJjaFZhbGlkID8gdmFsdWUgOiAnJztcbiAgICAgICAgdGhpcy5zZWFyY2hDb250cm9sLnNldFZhbHVlKHZhbHVlLCB0cnVlKTtcbiAgICAgICAgdGhpcy5zZWFyY2hDaGFuZ2UuZW1pdCh7XG4gICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICB2YWxpZDogdGhpcy5zZWFyY2hWYWxpZFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldHVwRm9jdXNFdmVudEhhbmRsZXJzKCkge1xuICAgICAgICBsZXQgZm9jdXNFdmVudHM6IE9ic2VydmFibGU8Rm9jdXNFdmVudD4gPSB0aGlzLmZvY3VzU3ViamVjdC5hc09ic2VydmFibGUoKS5kZWJvdW5jZVRpbWUoNTApO1xuICAgICAgICBmb2N1c0V2ZW50cy5maWx0ZXIoKCRldmVudDogRm9jdXNFdmVudCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICRldmVudC50eXBlID09PSAnZm9jdXNpbicgfHwgJGV2ZW50LnR5cGUgPT09ICdmb2N1cyc7XG4gICAgICAgIH0pLnN1YnNjcmliZSgoJGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLm9uU2VhcmNoRm9jdXMoJGV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGZvY3VzRXZlbnRzLmZpbHRlcigoJGV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAkZXZlbnQudHlwZSA9PT0gJ2ZvY3Vzb3V0JyB8fCAkZXZlbnQudHlwZSA9PT0gJ2JsdXInO1xuICAgICAgICB9KS5zdWJzY3JpYmUoKCRldmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vblNlYXJjaEJsdXIoJGV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0VGV4dEZpZWxkQ2xhc3NOYW1lKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiAnbWRsLXRleHRmaWVsZCBtZGwtanMtdGV4dGZpZWxkJyArICh0aGlzLmV4cGFuZGFibGUgPyAnIG1kbC10ZXh0ZmllbGQtLWV4cGFuZGFibGUnIDogJycpO1xuICAgIH1cblxuICAgIGdldFRleHRGaWVsZEhvbGRlckNsYXNzTmFtZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5leHBhbmRhYmxlID8gJ3NlYXJjaC1maWVsZCBtZGwtdGV4dGZpZWxkX19leHBhbmRhYmxlLWhvbGRlcicgOiAnc2VhcmNoLWZpZWxkJztcbiAgICB9XG5cbiAgICBnZXRBdXRvQ29tcGxldGUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXV0b2NvbXBsZXRlID8gJ29uJyA6ICdvZmYnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1ldGhvZCBjYWxsZWQgb24gZm9ybSBzdWJtaXQsIGkuZS4gd2hlbiB0aGUgdXNlciBoYXMgaGl0IGVudGVyXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXZlbnQgU3VibWl0IGV2ZW50IHRoYXQgd2FzIGZpcmVkXG4gICAgICovXG4gICAgb25TZWFyY2goZXZlbnQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZWFyY2hDb250cm9sLnNldFZhbHVlKHRoaXMuc2VhcmNoVGVybSwgdHJ1ZSk7XG4gICAgICAgIGlmICh0aGlzLnNlYXJjaENvbnRyb2wudmFsaWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoU3VibWl0LmVtaXQoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnNlYXJjaFRlcm1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hJbnB1dC5uYXRpdmVFbGVtZW50LmJsdXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzQXV0b0NvbXBsZXRlRGlzcGxheWVkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWFyY2hBY3RpdmU7XG4gICAgfVxuXG4gICAgc2V0QXV0b0NvbXBsZXRlRGlzcGxheWVkKGRpc3BsYXk6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZWFyY2hBY3RpdmUgPSBkaXNwbGF5O1xuICAgIH1cblxuICAgIG9uRmlsZUNsaWNrZWQoZXZlbnQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXRBdXRvQ29tcGxldGVEaXNwbGF5ZWQoZmFsc2UpO1xuICAgICAgICB0aGlzLmZpbGVTZWxlY3QuZW1pdChldmVudCk7XG4gICAgfVxuXG4gICAgb25TZWFyY2hGb2N1cygkZXZlbnQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXRBdXRvQ29tcGxldGVEaXNwbGF5ZWQodHJ1ZSk7XG4gICAgfVxuXG4gICAgb25TZWFyY2hCbHVyKCRldmVudCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNldEF1dG9Db21wbGV0ZURpc3BsYXllZChmYWxzZSk7XG4gICAgfVxuXG4gICAgb25Gb2N1cygkZXZlbnQpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuZXhwYW5kYWJsZSkge1xuICAgICAgICAgICAgdGhpcy5leHBhbmQuZW1pdCh7XG4gICAgICAgICAgICAgICAgZXhwYW5kZWQ6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZm9jdXNTdWJqZWN0Lm5leHQoJGV2ZW50KTtcbiAgICB9XG5cbiAgICBvbkJsdXIoJGV2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmV4cGFuZGFibGUgJiYgKHRoaXMuc2VhcmNoQ29udHJvbC52YWx1ZSA9PT0gJycgfHwgdGhpcy5zZWFyY2hDb250cm9sLnZhbHVlID09PSB1bmRlZmluZWQpKSB7XG4gICAgICAgICAgICB0aGlzLmV4cGFuZC5lbWl0KHtcbiAgICAgICAgICAgICAgICBleHBhbmRlZDogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZm9jdXNTdWJqZWN0Lm5leHQoJGV2ZW50KTtcbiAgICB9XG5cbiAgICBvbkVzY2FwZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXRBdXRvQ29tcGxldGVEaXNwbGF5ZWQoZmFsc2UpO1xuICAgIH1cblxuICAgIG9uQXJyb3dEb3duKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5pc0F1dG9Db21wbGV0ZURpc3BsYXllZCgpKSB7XG4gICAgICAgICAgICB0aGlzLmxpdmVTZWFyY2hDb21wb25lbnQuZm9jdXNSZXN1bHQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QXV0b0NvbXBsZXRlRGlzcGxheWVkKHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25BdXRvQ29tcGxldGVGb2N1cygkZXZlbnQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5mb2N1c1N1YmplY3QubmV4dCgkZXZlbnQpO1xuICAgIH1cblxuICAgIG9uQXV0b0NvbXBsZXRlUmV0dXJuKCRldmVudCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5zZWFyY2hJbnB1dCkge1xuICAgICAgICAgICAgKDxhbnk+IHRoaXMuc2VhcmNoSW5wdXQubmF0aXZlRWxlbWVudCkuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uQXV0b0NvbXBsZXRlQ2FuY2VsKCRldmVudCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5zZWFyY2hJbnB1dCkge1xuICAgICAgICAgICAgKDxhbnk+IHRoaXMuc2VhcmNoSW5wdXQubmF0aXZlRWxlbWVudCkuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldEF1dG9Db21wbGV0ZURpc3BsYXllZChmYWxzZSk7XG4gICAgfVxuXG59XG4iXX0=
