/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var alfresco_search_service_1 = require("./../services/alfresco-search.service");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var AlfrescoSearchComponent = AlfrescoSearchComponent_1 = (function () {
    function AlfrescoSearchComponent(searchService, translateService, route) {
        this.searchService = searchService;
        this.translateService = translateService;
        this.route = route;
        this.searchTerm = '';
        this.maxResults = 20;
        this.resultSort = null;
        this.rootNodeId = '-root-';
        this.resultType = null;
        this.navigationMode = AlfrescoSearchComponent_1.DOUBLE_CLICK_NAVIGATION;
        this.resultsLoad = new core_1.EventEmitter();
        this.preview = new core_1.EventEmitter();
        this.results = null;
        this.queryParamName = 'q';
        this.skipCount = 0;
        this.baseComponentPath = module.id.replace('/components/alfresco-search.component.js', '');
    }
    AlfrescoSearchComponent.prototype.ngOnInit = function () {
        var _this = this;
        if (this.translateService !== null) {
            this.translateService.addTranslationFolder('ng2-alfresco-search', 'node_modules/ng2-alfresco-search/src');
        }
        if (this.route) {
            this.route.params.forEach(function (params) {
                _this.searchTerm = params.hasOwnProperty(_this.queryParamName) ? params[_this.queryParamName] : null;
                _this.displaySearchResults(_this.searchTerm);
            });
        }
        else {
            this.displaySearchResults(this.searchTerm);
        }
    };
    AlfrescoSearchComponent.prototype.ngOnChanges = function (changes) {
        if (changes['searchTerm']) {
            this.searchTerm = changes['searchTerm'].currentValue;
            this.skipCount = 0;
            this.displaySearchResults(this.searchTerm);
        }
    };
    AlfrescoSearchComponent.prototype.onPreviewFile = function (event) {
        if (event.value) {
            this.preview.emit({
                value: event.value
            });
        }
    };
    AlfrescoSearchComponent.prototype.displaySearchResults = function (searchTerm) {
        var _this = this;
        if (searchTerm && this.searchService) {
            var searchOpts = {
                include: ['path'],
                skipCount: this.skipCount,
                rootNodeId: this.rootNodeId,
                nodeType: this.resultType,
                maxItems: this.maxResults,
                orderBy: this.resultSort
            };
            this.searchService
                .getNodeQueryResults(searchTerm, searchOpts)
                .subscribe(function (results) {
                _this.nodeResults = results;
                _this.results = results.list.entries;
                _this.pagination = results.list.pagination;
                _this.resultsLoad.emit(_this.results);
                _this.errorMessage = null;
            }, function (error) {
                if (error.status !== 400) {
                    _this.results = null;
                    _this.errorMessage = error;
                    _this.resultsLoad.error(error);
                }
            });
        }
    };
    AlfrescoSearchComponent.prototype.onChangePageSize = function (event) {
        this.maxResults = event.maxItems;
        this.displaySearchResults(this.searchTerm);
    };
    AlfrescoSearchComponent.prototype.onNextPage = function (event) {
        this.skipCount = event.skipCount;
        this.displaySearchResults(this.searchTerm);
    };
    AlfrescoSearchComponent.prototype.onPrevPage = function (event) {
        this.skipCount = event.skipCount;
        this.displaySearchResults(this.searchTerm);
    };
    return AlfrescoSearchComponent;
}());
AlfrescoSearchComponent.SINGLE_CLICK_NAVIGATION = 'click';
AlfrescoSearchComponent.DOUBLE_CLICK_NAVIGATION = 'dblclick';
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], AlfrescoSearchComponent.prototype, "searchTerm", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Number)
], AlfrescoSearchComponent.prototype, "maxResults", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], AlfrescoSearchComponent.prototype, "resultSort", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], AlfrescoSearchComponent.prototype, "rootNodeId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], AlfrescoSearchComponent.prototype, "resultType", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], AlfrescoSearchComponent.prototype, "navigationMode", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], AlfrescoSearchComponent.prototype, "resultsLoad", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], AlfrescoSearchComponent.prototype, "preview", void 0);
AlfrescoSearchComponent = AlfrescoSearchComponent_1 = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'alfresco-search',
        styles: [":host .mdl-data-table caption {     margin: 0 0 16px 0;     text-align: left; } :host .mdl-data-table td {     white-space: nowrap; } :host .mdl-data-table td.col-mimetype-icon {     width: 24px; } :host .col-display-name {     min-width: 250px;     overflow: hidden;     text-overflow: ellipsis; } .no-result-message {     height: 32px;     opacity: 0.26;     font-family: Muli, Helvetica, Arial, sans-serif;     font-size: 24px;     line-height: 1.33;     letter-spacing: -1px;     color: #000000; }  .no-result__empty_doc_lib {     width: 565px;     height: 161px;     object-fit: contain;     margin-top: 17px; }  .empty_template {     text-align: center;     margin-top: 20px;     margin-bottom: 20px; }"],
        template: "<div data-automation-id=\"search_result_table\"      class=\"mdl-data-table mdl-js-data-table mdl-shadow--2dp full-width\">     <p data-automation-id=\"search_error_message\" *ngIf=\"errorMessage\">{{ 'SEARCH.RESULTS.ERROR' | translate:{errorMessage: errorMessage} }}</p>     <div class=\"container\">         <alfresco-document-list             [node]=\"nodeResults\"             [contextMenuActions]=\"true\"             [creationMenuActions]=\"false\"             [contentActions]=\"true\"             [navigationMode]=\"navigationMode\"             [enablePagination]=\"false\"             (error)=\"onNavigationError($event)\"             (success)=\"resetError()\"             (preview)=\"onPreviewFile($event)\">             <empty-folder-content>                 <template>                     <div class=\"empty_template\">                         <div class=\"no-result-message\">{{ 'SEARCH.RESULTS.NONE' | translate:{searchTerm: searchTerm} }}</div>                         <img [src]=\"baseComponentPath + '/assets/images/empty_doc_lib.svg'\" class=\"no-result__empty_doc_lib\">                     </div>                 </template>                 <template>                 </template>             </empty-folder-content>              <content-columns>                 <content-column key=\"$thumbnail\" type=\"image\"></content-column>                 <content-column                     title=\"{{'SEARCH.DOCUMENT_LIST.COLUMNS.DISPLAY_NAME' | translate}}\"                     key=\"name\"                     sortable=\"true\"                     class=\"full-width ellipsis-cell\">                 </content-column>                 <content-column                     title=\"{{'SEARCH.DOCUMENT_LIST.COLUMNS.CREATED_BY' | translate}}\"                     key=\"createdByUser.displayName\"                     sortable=\"true\"                     class=\"desktop-only\">                 </content-column>                 <content-column                     title=\"{{'SEARCH.DOCUMENT_LIST.COLUMNS.CREATED_ON' | translate}}\"                     key=\"createdAt\"                     type=\"date\"                     format=\"medium\"                     sortable=\"true\"                     class=\"desktop-only\">                 </content-column>             </content-columns>              <content-actions>                 <!-- folder actions -->                 <content-action                     target=\"folder\"                     title=\"{{'SEARCH.DOCUMENT_LIST.ACTIONS.FOLDER.DELETE' | translate}}\"                     handler=\"delete\">                 </content-action>                 <!-- document actions -->                 <content-action                     target=\"document\"                     title=\"{{'SEARCH.DOCUMENT_LIST.ACTIONS.DOCUMENT.DOWNLOAD' | translate}}\"                     handler=\"download\">                 </content-action>                 <content-action                     target=\"document\"                     title=\"{{'SEARCH.DOCUMENT_LIST.ACTIONS.DOCUMENT.DELETE' | translate}}\"                     handler=\"delete\">                 </content-action>             </content-actions>         </alfresco-document-list>         <alfresco-pagination             (changePageSize)=\"onChangePageSize($event)\"             (nextPage)=\"onNextPage($event)\"             (prevPage)=\"onPrevPage($event)\"             [pagination]=\"pagination\"             [maxItems]=\"maxResults\"             [supportedPageSizes]=\"[5, 10, 15, 20]\">         </alfresco-pagination>     </div> </div>"
    }),
    __param(2, core_1.Optional()),
    __metadata("design:paramtypes", [alfresco_search_service_1.AlfrescoSearchService,
        ng2_alfresco_core_1.AlfrescoTranslationService,
        router_1.ActivatedRoute])
], AlfrescoSearchComponent);
exports.AlfrescoSearchComponent = AlfrescoSearchComponent;
var AlfrescoSearchComponent_1;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWxmcmVzY28tc2VhcmNoLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7Ozs7Ozs7Ozs7Ozs7O0FBRUgsc0NBQW1IO0FBQ25ILDBDQUF5RDtBQUN6RCxpRkFBNkY7QUFDN0YsdURBQStEO0FBUy9ELElBQWEsdUJBQXVCO0lBMkNoQyxpQ0FBb0IsYUFBb0MsRUFDcEMsZ0JBQTRDLEVBQ2hDLEtBQXFCO1FBRmpDLGtCQUFhLEdBQWIsYUFBYSxDQUF1QjtRQUNwQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQTRCO1FBQ2hDLFVBQUssR0FBTCxLQUFLLENBQWdCO1FBdkNyRCxlQUFVLEdBQVcsRUFBRSxDQUFDO1FBR3hCLGVBQVUsR0FBVyxFQUFFLENBQUM7UUFHeEIsZUFBVSxHQUFXLElBQUksQ0FBQztRQUcxQixlQUFVLEdBQVcsUUFBUSxDQUFDO1FBRzlCLGVBQVUsR0FBVyxJQUFJLENBQUM7UUFHMUIsbUJBQWMsR0FBVyx5QkFBdUIsQ0FBQyx1QkFBdUIsQ0FBQztRQUd6RSxnQkFBVyxHQUFHLElBQUksbUJBQVksRUFBRSxDQUFDO1FBR2pDLFlBQU8sR0FBc0IsSUFBSSxtQkFBWSxFQUFPLENBQUM7UUFFckQsWUFBTyxHQUFRLElBQUksQ0FBQztRQU1wQixtQkFBYyxHQUFHLEdBQUcsQ0FBQztRQUVyQixjQUFTLEdBQVcsQ0FBQyxDQUFDO1FBSXRCLHNCQUFpQixHQUFXLE1BQU0sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLDBDQUEwQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBSzlGLENBQUM7SUFFRCwwQ0FBUSxHQUFSO1FBQUEsaUJBYUM7UUFaRyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNqQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsb0JBQW9CLENBQUMscUJBQXFCLEVBQUUsc0NBQXNDLENBQUMsQ0FBQztR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QUE7cUNBRlksK0NBQXFCO1FBQ2xCLDhDQUEwQjtRQUN6Qix1QkFBYztHQTdDNUMsdUJBQXVCLENBZ0luQztBQWhJWSwwREFBdUIiLCJmaWxlIjoiY29tcG9uZW50cy9hbGZyZXNjby1zZWFyY2guY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIE9wdGlvbmFsLCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFBhcmFtcyB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBBbGZyZXNjb1NlYXJjaFNlcnZpY2UsIFNlYXJjaE9wdGlvbnMgfSBmcm9tICcuLy4uL3NlcnZpY2VzL2FsZnJlc2NvLXNlYXJjaC5zZXJ2aWNlJztcbmltcG9ydCB7IEFsZnJlc2NvVHJhbnNsYXRpb25TZXJ2aWNlIH0gZnJvbSAnbmcyLWFsZnJlc2NvLWNvcmUnO1xuaW1wb3J0IHsgTm9kZVBhZ2luZywgUGFnaW5hdGlvbiB9IGZyb20gJ2FsZnJlc2NvLWpzLWFwaSc7XG5cbkBDb21wb25lbnQoe1xuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc2VsZWN0b3I6ICdhbGZyZXNjby1zZWFyY2gnLFxuICAgIHN0eWxlczogW1wiOmhvc3QgLm1kbC1kYXRhLXRhYmxlIGNhcHRpb24geyAgICAgbWFyZ2luOiAwIDAgMTZweCAwOyAgICAgdGV4dC1hbGlnbjogbGVmdDsgfSA6aG9zdCAubWRsLWRhdGEtdGFibGUgdGQgeyAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsgfSA6aG9zdCAubWRsLWRhdGEtdGFibGUgdGQuY29sLW1pbWV0eXBlLWljb24geyAgICAgd2lkdGg6IDI0cHg7IH0gOmhvc3QgLmNvbC1kaXNwbGF5LW5hbWUgeyAgICAgbWluLXdpZHRoOiAyNTBweDsgICAgIG92ZXJmbG93OiBoaWRkZW47ICAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsgfSAubm8tcmVzdWx0LW1lc3NhZ2UgeyAgICAgaGVpZ2h0OiAzMnB4OyAgICAgb3BhY2l0eTogMC4yNjsgICAgIGZvbnQtZmFtaWx5OiBNdWxpLCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOyAgICAgZm9udC1zaXplOiAyNHB4OyAgICAgbGluZS1oZWlnaHQ6IDEuMzM7ICAgICBsZXR0ZXItc3BhY2luZzogLTFweDsgICAgIGNvbG9yOiAjMDAwMDAwOyB9ICAubm8tcmVzdWx0X19lbXB0eV9kb2NfbGliIHsgICAgIHdpZHRoOiA1NjVweDsgICAgIGhlaWdodDogMTYxcHg7ICAgICBvYmplY3QtZml0OiBjb250YWluOyAgICAgbWFyZ2luLXRvcDogMTdweDsgfSAgLmVtcHR5X3RlbXBsYXRlIHsgICAgIHRleHQtYWxpZ246IGNlbnRlcjsgICAgIG1hcmdpbi10b3A6IDIwcHg7ICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OyB9XCJdLFxuICAgIHRlbXBsYXRlOiBcIjxkaXYgZGF0YS1hdXRvbWF0aW9uLWlkPVxcXCJzZWFyY2hfcmVzdWx0X3RhYmxlXFxcIiAgICAgIGNsYXNzPVxcXCJtZGwtZGF0YS10YWJsZSBtZGwtanMtZGF0YS10YWJsZSBtZGwtc2hhZG93LS0yZHAgZnVsbC13aWR0aFxcXCI+ICAgICA8cCBkYXRhLWF1dG9tYXRpb24taWQ9XFxcInNlYXJjaF9lcnJvcl9tZXNzYWdlXFxcIiAqbmdJZj1cXFwiZXJyb3JNZXNzYWdlXFxcIj57eyAnU0VBUkNILlJFU1VMVFMuRVJST1InIHwgdHJhbnNsYXRlOntlcnJvck1lc3NhZ2U6IGVycm9yTWVzc2FnZX0gfX08L3A+ICAgICA8ZGl2IGNsYXNzPVxcXCJjb250YWluZXJcXFwiPiAgICAgICAgIDxhbGZyZXNjby1kb2N1bWVudC1saXN0ICAgICAgICAgICAgIFtub2RlXT1cXFwibm9kZVJlc3VsdHNcXFwiICAgICAgICAgICAgIFtjb250ZXh0TWVudUFjdGlvbnNdPVxcXCJ0cnVlXFxcIiAgICAgICAgICAgICBbY3JlYXRpb25NZW51QWN0aW9uc109XFxcImZhbHNlXFxcIiAgICAgICAgICAgICBbY29udGVudEFjdGlvbnNdPVxcXCJ0cnVlXFxcIiAgICAgICAgICAgICBbbmF2aWdhdGlvbk1vZGVdPVxcXCJuYXZpZ2F0aW9uTW9kZVxcXCIgICAgICAgICAgICAgW2VuYWJsZVBhZ2luYXRpb25dPVxcXCJmYWxzZVxcXCIgICAgICAgICAgICAgKGVycm9yKT1cXFwib25OYXZpZ2F0aW9uRXJyb3IoJGV2ZW50KVxcXCIgICAgICAgICAgICAgKHN1Y2Nlc3MpPVxcXCJyZXNldEVycm9yKClcXFwiICAgICAgICAgICAgIChwcmV2aWV3KT1cXFwib25QcmV2aWV3RmlsZSgkZXZlbnQpXFxcIj4gICAgICAgICAgICAgPGVtcHR5LWZvbGRlci1jb250ZW50PiAgICAgICAgICAgICAgICAgPHRlbXBsYXRlPiAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImVtcHR5X3RlbXBsYXRlXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwibm8tcmVzdWx0LW1lc3NhZ2VcXFwiPnt7ICdTRUFSQ0guUkVTVUxUUy5OT05FJyB8IHRyYW5zbGF0ZTp7c2VhcmNoVGVybTogc2VhcmNoVGVybX0gfX08L2Rpdj4gICAgICAgICAgICAgICAgICAgICAgICAgPGltZyBbc3JjXT1cXFwiYmFzZUNvbXBvbmVudFBhdGggKyAnL2Fzc2V0cy9pbWFnZXMvZW1wdHlfZG9jX2xpYi5zdmcnXFxcIiBjbGFzcz1cXFwibm8tcmVzdWx0X19lbXB0eV9kb2NfbGliXFxcIj4gICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgICAgIDwvdGVtcGxhdGU+ICAgICAgICAgICAgICAgICA8dGVtcGxhdGU+ICAgICAgICAgICAgICAgICA8L3RlbXBsYXRlPiAgICAgICAgICAgICA8L2VtcHR5LWZvbGRlci1jb250ZW50PiAgICAgICAgICAgICAgPGNvbnRlbnQtY29sdW1ucz4gICAgICAgICAgICAgICAgIDxjb250ZW50LWNvbHVtbiBrZXk9XFxcIiR0aHVtYm5haWxcXFwiIHR5cGU9XFxcImltYWdlXFxcIj48L2NvbnRlbnQtY29sdW1uPiAgICAgICAgICAgICAgICAgPGNvbnRlbnQtY29sdW1uICAgICAgICAgICAgICAgICAgICAgdGl0bGU9XFxcInt7J1NFQVJDSC5ET0NVTUVOVF9MSVNULkNPTFVNTlMuRElTUExBWV9OQU1FJyB8IHRyYW5zbGF0ZX19XFxcIiAgICAgICAgICAgICAgICAgICAgIGtleT1cXFwibmFtZVxcXCIgICAgICAgICAgICAgICAgICAgICBzb3J0YWJsZT1cXFwidHJ1ZVxcXCIgICAgICAgICAgICAgICAgICAgICBjbGFzcz1cXFwiZnVsbC13aWR0aCBlbGxpcHNpcy1jZWxsXFxcIj4gICAgICAgICAgICAgICAgIDwvY29udGVudC1jb2x1bW4+ICAgICAgICAgICAgICAgICA8Y29udGVudC1jb2x1bW4gICAgICAgICAgICAgICAgICAgICB0aXRsZT1cXFwie3snU0VBUkNILkRPQ1VNRU5UX0xJU1QuQ09MVU1OUy5DUkVBVEVEX0JZJyB8IHRyYW5zbGF0ZX19XFxcIiAgICAgICAgICAgICAgICAgICAgIGtleT1cXFwiY3JlYXRlZEJ5VXNlci5kaXNwbGF5TmFtZVxcXCIgICAgICAgICAgICAgICAgICAgICBzb3J0YWJsZT1cXFwidHJ1ZVxcXCIgICAgICAgICAgICAgICAgICAgICBjbGFzcz1cXFwiZGVza3RvcC1vbmx5XFxcIj4gICAgICAgICAgICAgICAgIDwvY29udGVudC1jb2x1bW4+ICAgICAgICAgICAgICAgICA8Y29udGVudC1jb2x1bW4gICAgICAgICAgICAgICAgICAgICB0aXRsZT1cXFwie3snU0VBUkNILkRPQ1VNRU5UX0xJU1QuQ09MVU1OUy5DUkVBVEVEX09OJyB8IHRyYW5zbGF0ZX19XFxcIiAgICAgICAgICAgICAgICAgICAgIGtleT1cXFwiY3JlYXRlZEF0XFxcIiAgICAgICAgICAgICAgICAgICAgIHR5cGU9XFxcImRhdGVcXFwiICAgICAgICAgICAgICAgICAgICAgZm9ybWF0PVxcXCJtZWRpdW1cXFwiICAgICAgICAgICAgICAgICAgICAgc29ydGFibGU9XFxcInRydWVcXFwiICAgICAgICAgICAgICAgICAgICAgY2xhc3M9XFxcImRlc2t0b3Atb25seVxcXCI+ICAgICAgICAgICAgICAgICA8L2NvbnRlbnQtY29sdW1uPiAgICAgICAgICAgICA8L2NvbnRlbnQtY29sdW1ucz4gICAgICAgICAgICAgIDxjb250ZW50LWFjdGlvbnM+ICAgICAgICAgICAgICAgICA8IS0tIGZvbGRlciBhY3Rpb25zIC0tPiAgICAgICAgICAgICAgICAgPGNvbnRlbnQtYWN0aW9uICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0PVxcXCJmb2xkZXJcXFwiICAgICAgICAgICAgICAgICAgICAgdGl0bGU9XFxcInt7J1NFQVJDSC5ET0NVTUVOVF9MSVNULkFDVElPTlMuRk9MREVSLkRFTEVURScgfCB0cmFuc2xhdGV9fVxcXCIgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyPVxcXCJkZWxldGVcXFwiPiAgICAgICAgICAgICAgICAgPC9jb250ZW50LWFjdGlvbj4gICAgICAgICAgICAgICAgIDwhLS0gZG9jdW1lbnQgYWN0aW9ucyAtLT4gICAgICAgICAgICAgICAgIDxjb250ZW50LWFjdGlvbiAgICAgICAgICAgICAgICAgICAgIHRhcmdldD1cXFwiZG9jdW1lbnRcXFwiICAgICAgICAgICAgICAgICAgICAgdGl0bGU9XFxcInt7J1NFQVJDSC5ET0NVTUVOVF9MSVNULkFDVElPTlMuRE9DVU1FTlQuRE9XTkxPQUQnIHwgdHJhbnNsYXRlfX1cXFwiICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcj1cXFwiZG93bmxvYWRcXFwiPiAgICAgICAgICAgICAgICAgPC9jb250ZW50LWFjdGlvbj4gICAgICAgICAgICAgICAgIDxjb250ZW50LWFjdGlvbiAgICAgICAgICAgICAgICAgICAgIHRhcmdldD1cXFwiZG9jdW1lbnRcXFwiICAgICAgICAgICAgICAgICAgICAgdGl0bGU9XFxcInt7J1NFQVJDSC5ET0NVTUVOVF9MSVNULkFDVElPTlMuRE9DVU1FTlQuREVMRVRFJyB8IHRyYW5zbGF0ZX19XFxcIiAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXI9XFxcImRlbGV0ZVxcXCI+ICAgICAgICAgICAgICAgICA8L2NvbnRlbnQtYWN0aW9uPiAgICAgICAgICAgICA8L2NvbnRlbnQtYWN0aW9ucz4gICAgICAgICA8L2FsZnJlc2NvLWRvY3VtZW50LWxpc3Q+ICAgICAgICAgPGFsZnJlc2NvLXBhZ2luYXRpb24gICAgICAgICAgICAgKGNoYW5nZVBhZ2VTaXplKT1cXFwib25DaGFuZ2VQYWdlU2l6ZSgkZXZlbnQpXFxcIiAgICAgICAgICAgICAobmV4dFBhZ2UpPVxcXCJvbk5leHRQYWdlKCRldmVudClcXFwiICAgICAgICAgICAgIChwcmV2UGFnZSk9XFxcIm9uUHJldlBhZ2UoJGV2ZW50KVxcXCIgICAgICAgICAgICAgW3BhZ2luYXRpb25dPVxcXCJwYWdpbmF0aW9uXFxcIiAgICAgICAgICAgICBbbWF4SXRlbXNdPVxcXCJtYXhSZXN1bHRzXFxcIiAgICAgICAgICAgICBbc3VwcG9ydGVkUGFnZVNpemVzXT1cXFwiWzUsIDEwLCAxNSwgMjBdXFxcIj4gICAgICAgICA8L2FsZnJlc2NvLXBhZ2luYXRpb24+ICAgICA8L2Rpdj4gPC9kaXY+XCJcbn0pXG5leHBvcnQgY2xhc3MgQWxmcmVzY29TZWFyY2hDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIE9uSW5pdCB7XG5cbiAgICBzdGF0aWMgU0lOR0xFX0NMSUNLX05BVklHQVRJT046IHN0cmluZyA9ICdjbGljayc7XG4gICAgc3RhdGljIERPVUJMRV9DTElDS19OQVZJR0FUSU9OOiBzdHJpbmcgPSAnZGJsY2xpY2snO1xuXG4gICAgQElucHV0KClcbiAgICBzZWFyY2hUZXJtOiBzdHJpbmcgPSAnJztcblxuICAgIEBJbnB1dCgpXG4gICAgbWF4UmVzdWx0czogbnVtYmVyID0gMjA7XG5cbiAgICBASW5wdXQoKVxuICAgIHJlc3VsdFNvcnQ6IHN0cmluZyA9IG51bGw7XG5cbiAgICBASW5wdXQoKVxuICAgIHJvb3ROb2RlSWQ6IHN0cmluZyA9ICctcm9vdC0nO1xuXG4gICAgQElucHV0KClcbiAgICByZXN1bHRUeXBlOiBzdHJpbmcgPSBudWxsO1xuXG4gICAgQElucHV0KClcbiAgICBuYXZpZ2F0aW9uTW9kZTogc3RyaW5nID0gQWxmcmVzY29TZWFyY2hDb21wb25lbnQuRE9VQkxFX0NMSUNLX05BVklHQVRJT047IC8vIGNsaWNrfGRibGNsaWNrXG5cbiAgICBAT3V0cHV0KClcbiAgICByZXN1bHRzTG9hZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIHByZXZpZXc6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICByZXN1bHRzOiBhbnkgPSBudWxsO1xuXG4gICAgcGFnaW5hdGlvbjogUGFnaW5hdGlvbjtcblxuICAgIGVycm9yTWVzc2FnZTtcblxuICAgIHF1ZXJ5UGFyYW1OYW1lID0gJ3EnO1xuXG4gICAgc2tpcENvdW50OiBudW1iZXIgPSAwO1xuXG4gICAgbm9kZVJlc3VsdHM6IE5vZGVQYWdpbmc7XG5cbiAgICBiYXNlQ29tcG9uZW50UGF0aDogc3RyaW5nID0gbW9kdWxlLmlkLnJlcGxhY2UoJy9jb21wb25lbnRzL2FsZnJlc2NvLXNlYXJjaC5jb21wb25lbnQuanMnLCAnJyk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNlYXJjaFNlcnZpY2U6IEFsZnJlc2NvU2VhcmNoU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHRyYW5zbGF0ZVNlcnZpY2U6IEFsZnJlc2NvVHJhbnNsYXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgIEBPcHRpb25hbCgpIHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlKSB7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIGlmICh0aGlzLnRyYW5zbGF0ZVNlcnZpY2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMudHJhbnNsYXRlU2VydmljZS5hZGRUcmFuc2xhdGlvbkZvbGRlcignbmcyLWFsZnJlc2NvLXNlYXJjaCcsICdub2RlX21vZHVsZXMvbmcyLWFsZnJlc2NvLXNlYXJjaC9zcmMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnJvdXRlKSB7XG4gICAgICAgICAgICB0aGlzLnJvdXRlLnBhcmFtcy5mb3JFYWNoKChwYXJhbXM6IFBhcmFtcykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoVGVybSA9IHBhcmFtcy5oYXNPd25Qcm9wZXJ0eSh0aGlzLnF1ZXJ5UGFyYW1OYW1lKSA/IHBhcmFtc1t0aGlzLnF1ZXJ5UGFyYW1OYW1lXSA6IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5U2VhcmNoUmVzdWx0cyh0aGlzLnNlYXJjaFRlcm0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlTZWFyY2hSZXN1bHRzKHRoaXMuc2VhcmNoVGVybSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGlmIChjaGFuZ2VzWydzZWFyY2hUZXJtJ10pIHtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoVGVybSA9IGNoYW5nZXNbJ3NlYXJjaFRlcm0nXS5jdXJyZW50VmFsdWU7XG4gICAgICAgICAgICB0aGlzLnNraXBDb3VudCA9IDA7XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlTZWFyY2hSZXN1bHRzKHRoaXMuc2VhcmNoVGVybSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvblByZXZpZXdGaWxlKGV2ZW50OiBhbnkpIHtcbiAgICAgICAgaWYgKGV2ZW50LnZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnByZXZpZXcuZW1pdCh7XG4gICAgICAgICAgICAgICAgdmFsdWU6IGV2ZW50LnZhbHVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvYWRzIGFuZCBkaXNwbGF5cyBzZWFyY2ggcmVzdWx0c1xuICAgICAqIEBwYXJhbSBzZWFyY2hUZXJtIFNlYXJjaCBxdWVyeSBlbnRlcmVkIGJ5IHVzZXJcbiAgICAgKi9cbiAgICBwcml2YXRlIGRpc3BsYXlTZWFyY2hSZXN1bHRzKHNlYXJjaFRlcm0pIHtcbiAgICAgICAgaWYgKHNlYXJjaFRlcm0gJiYgdGhpcy5zZWFyY2hTZXJ2aWNlKSB7XG4gICAgICAgICAgICBsZXQgc2VhcmNoT3B0czogU2VhcmNoT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlOiBbJ3BhdGgnXSxcbiAgICAgICAgICAgICAgICBza2lwQ291bnQ6IHRoaXMuc2tpcENvdW50LFxuICAgICAgICAgICAgICAgIHJvb3ROb2RlSWQ6IHRoaXMucm9vdE5vZGVJZCxcbiAgICAgICAgICAgICAgICBub2RlVHlwZTogdGhpcy5yZXN1bHRUeXBlLFxuICAgICAgICAgICAgICAgIG1heEl0ZW1zOiB0aGlzLm1heFJlc3VsdHMsXG4gICAgICAgICAgICAgICAgb3JkZXJCeTogdGhpcy5yZXN1bHRTb3J0XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hTZXJ2aWNlXG4gICAgICAgICAgICAgICAgLmdldE5vZGVRdWVyeVJlc3VsdHMoc2VhcmNoVGVybSwgc2VhcmNoT3B0cylcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZVJlc3VsdHMgPSByZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRzID0gcmVzdWx0cy5saXN0LmVudHJpZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2luYXRpb24gPSByZXN1bHRzLmxpc3QucGFnaW5hdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0c0xvYWQuZW1pdCh0aGlzLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3Iuc3RhdHVzICE9PSA0MDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdHMgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gPGFueT5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdHNMb2FkLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgb25DaGFuZ2VQYWdlU2l6ZShldmVudDogUGFnaW5hdGlvbik6IHZvaWQge1xuICAgICAgICB0aGlzLm1heFJlc3VsdHMgPSBldmVudC5tYXhJdGVtcztcbiAgICAgICAgdGhpcy5kaXNwbGF5U2VhcmNoUmVzdWx0cyh0aGlzLnNlYXJjaFRlcm0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbk5leHRQYWdlKGV2ZW50OiBQYWdpbmF0aW9uKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2tpcENvdW50ID0gZXZlbnQuc2tpcENvdW50O1xuICAgICAgICB0aGlzLmRpc3BsYXlTZWFyY2hSZXN1bHRzKHRoaXMuc2VhcmNoVGVybSk7XG4gICAgfVxuXG4gICAgcHVibGljIG9uUHJldlBhZ2UoZXZlbnQ6IFBhZ2luYXRpb24pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5za2lwQ291bnQgPSBldmVudC5za2lwQ291bnQ7XG4gICAgICAgIHRoaXMuZGlzcGxheVNlYXJjaFJlc3VsdHModGhpcy5zZWFyY2hUZXJtKTtcbiAgICB9XG59XG4iXX0=
