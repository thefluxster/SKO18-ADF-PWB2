/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var ecm_model_service_1 = require("./../services/ecm-model.service");
var form_service_1 = require("./../services/form.service");
var node_service_1 = require("./../services/node.service");
var index_1 = require("./widgets/core/index");
var index_2 = require("./../events/index");
var widget_visibility_service_1 = require("./../services/widget-visibility.service");
var ActivitiForm = ActivitiForm_1 = (function () {
    function ActivitiForm(formService, visibilityService, ecmModelService, nodeService, logService) {
        this.formService = formService;
        this.visibilityService = visibilityService;
        this.ecmModelService = ecmModelService;
        this.nodeService = nodeService;
        this.logService = logService;
        this.saveMetadata = false;
        this.showTitle = true;
        this.showCompleteButton = true;
        this.showSaveButton = true;
        this.showDebugButton = true;
        this.readOnly = false;
        this.showRefreshButton = true;
        this.showValidationIcon = true;
        this.formSaved = new core_1.EventEmitter();
        this.formCompleted = new core_1.EventEmitter();
        this.formLoaded = new core_1.EventEmitter();
        this.executeOutcome = new core_1.EventEmitter();
        this.onError = new core_1.EventEmitter();
        this.debugMode = false;
    }
    ActivitiForm.prototype.hasForm = function () {
        return this.form ? true : false;
    };
    ActivitiForm.prototype.isTitleEnabled = function () {
        if (this.showTitle) {
            if (this.form && this.form.taskName) {
                return true;
            }
        }
        return false;
    };
    ActivitiForm.prototype.isOutcomeButtonEnabled = function (outcome) {
        if (this.form.readOnly) {
            return false;
        }
        if (outcome) {
            if (outcome.name === index_1.FormOutcomeModel.SAVE_ACTION) {
                return true;
            }
            return this.form.isValid;
        }
        return false;
    };
    ActivitiForm.prototype.isOutcomeButtonVisible = function (outcome, isFormReadOnly) {
        if (outcome && outcome.name) {
            if (outcome.name === index_1.FormOutcomeModel.COMPLETE_ACTION) {
                return this.showCompleteButton;
            }
            if (isFormReadOnly) {
                return outcome.isSelected;
            }
            if (outcome.name === index_1.FormOutcomeModel.SAVE_ACTION) {
                return this.showSaveButton;
            }
            if (outcome.name === index_1.FormOutcomeModel.START_PROCESS_ACTION) {
                return false;
            }
            return true;
        }
        return false;
    };
    ActivitiForm.prototype.ngOnInit = function () {
        if (this.nodeId) {
            this.loadFormForEcmNode();
        }
        else {
            this.loadForm();
        }
    };
    ActivitiForm.prototype.ngAfterViewChecked = function () {
        this.setupMaterialComponents();
    };
    ActivitiForm.prototype.ngOnChanges = function (changes) {
        var taskId = changes['taskId'];
        if (taskId && taskId.currentValue) {
            this.getFormByTaskId(taskId.currentValue);
            return;
        }
        var formId = changes['formId'];
        if (formId && formId.currentValue) {
            this.getFormDefinitionByFormId(formId.currentValue);
            return;
        }
        var formName = changes['formName'];
        if (formName && formName.currentValue) {
            this.getFormDefinitionByFormName(formName.currentValue);
            return;
        }
    };
    ActivitiForm.prototype.onOutcomeClicked = function (outcome) {
        if (!this.readOnly && outcome && this.form) {
            var args = new index_1.FormOutcomeEvent(outcome);
            this.executeOutcome.emit(args);
            if (args.defaultPrevented) {
                return false;
            }
            if (outcome.isSystem) {
                if (outcome.id === ActivitiForm_1.SAVE_OUTCOME_ID) {
                    this.saveTaskForm();
                    return true;
                }
                if (outcome.id === ActivitiForm_1.COMPLETE_OUTCOME_ID) {
                    this.completeTaskForm();
                    return true;
                }
                if (outcome.id === ActivitiForm_1.START_PROCESS_OUTCOME_ID) {
                    this.completeTaskForm();
                    return true;
                }
                if (outcome.id === ActivitiForm_1.CUSTOM_OUTCOME_ID) {
                    this.onTaskSaved(this.form);
                    this.storeFormAsMetadata();
                    return true;
                }
            }
            else {
                if (outcome.name) {
                    this.onTaskSaved(this.form);
                    this.completeTaskForm(outcome.name);
                    return true;
                }
            }
        }
        return false;
    };
    ActivitiForm.prototype.onRefreshClicked = function () {
        this.loadForm();
    };
    ActivitiForm.prototype.loadForm = function () {
        if (this.taskId) {
            this.getFormByTaskId(this.taskId);
            return;
        }
        if (this.formId) {
            this.getFormDefinitionByFormId(this.formId);
            return;
        }
        if (this.formName) {
            this.getFormDefinitionByFormName(this.formName);
            return;
        }
    };
    ActivitiForm.prototype.loadFormPorcessVariable = function (taskId) {
        var _this = this;
        this.formService.getTask(taskId).subscribe(function (task) {
            if (_this.isAProcessTask(task)) {
                _this.visibilityService.getTaskProcessVariable(taskId).subscribe();
            }
        }, function (error) {
            _this.handleError(error);
        });
    };
    ActivitiForm.prototype.isAProcessTask = function (taskRepresentation) {
        return taskRepresentation.processDefinitionId && taskRepresentation.processDefinitionDeploymentId !== 'null';
    };
    ActivitiForm.prototype.setupMaterialComponents = function () {
        if (componentHandler) {
            componentHandler.upgradeAllRegistered();
            return true;
        }
        return false;
    };
    ActivitiForm.prototype.getFormByTaskId = function (taskId) {
        var _this = this;
        this.loadFormPorcessVariable(this.taskId);
        var data = this.data;
        this.formService
            .getTaskForm(taskId)
            .subscribe(function (form) {
            _this.form = new index_1.FormModel(form, data, _this.readOnly, _this.formService);
            _this.onFormLoaded(_this.form);
        }, function (error) {
            _this.handleError(error);
        });
    };
    ActivitiForm.prototype.getFormDefinitionByFormId = function (formId) {
        var _this = this;
        this.formService
            .getFormDefinitionById(formId)
            .subscribe(function (form) {
            _this.formName = form.name;
            _this.form = _this.parseForm(form);
            _this.onFormLoaded(_this.form);
        }, function (error) {
            _this.handleError(error);
        });
    };
    ActivitiForm.prototype.getFormDefinitionByFormName = function (formName) {
        var _this = this;
        this.formService
            .getFormDefinitionByName(formName)
            .subscribe(function (id) {
            _this.formService.getFormDefinitionById(id).subscribe(function (form) {
                _this.form = _this.parseForm(form);
                _this.onFormLoaded(_this.form);
            }, function (error) {
                _this.handleError(error);
            });
        }, function (error) {
            _this.handleError(error);
        });
    };
    ActivitiForm.prototype.saveTaskForm = function () {
        var _this = this;
        if (this.form && this.form.taskId) {
            this.formService
                .saveTaskForm(this.form.taskId, this.form.values)
                .subscribe(function () {
                _this.onTaskSaved(_this.form);
                _this.storeFormAsMetadata();
            }, function (error) { return _this.onTaskSavedError(_this.form, error); });
        }
    };
    ActivitiForm.prototype.completeTaskForm = function (outcome) {
        var _this = this;
        if (this.form && this.form.taskId) {
            this.formService
                .completeTaskForm(this.form.taskId, this.form.values, outcome)
                .subscribe(function () {
                _this.onTaskCompleted(_this.form);
                _this.storeFormAsMetadata();
            }, function (error) { return _this.onTaskCompletedError(_this.form, error); });
        }
    };
    ActivitiForm.prototype.handleError = function (err) {
        this.logService.error(err);
        this.onError.emit(err);
    };
    ActivitiForm.prototype.parseForm = function (json) {
        if (json) {
            var form = new index_1.FormModel(json, this.data, this.readOnly, this.formService);
            if (!json.fields) {
                form.outcomes = this.getFormDefinitionOutcomes(form);
            }
            return form;
        }
        return null;
    };
    ActivitiForm.prototype.getFormDefinitionOutcomes = function (form) {
        return [
            new index_1.FormOutcomeModel(form, { id: '$custom', name: index_1.FormOutcomeModel.SAVE_ACTION, isSystem: true })
        ];
    };
    ActivitiForm.prototype.checkVisibility = function (field) {
        if (field && field.form) {
            this.visibilityService.refreshVisibility(field.form);
        }
    };
    ActivitiForm.prototype.loadFormForEcmNode = function () {
        var _this = this;
        this.nodeService.getNodeMetadata(this.nodeId).subscribe(function (data) {
            _this.data = data.metadata;
            _this.loadFormFromActiviti(data.nodeType);
        }, this.handleError);
    };
    ActivitiForm.prototype.loadFormFromActiviti = function (nodeType) {
        var _this = this;
        this.formService.searchFrom(nodeType).subscribe(function (form) {
            if (!form) {
                _this.formService.createFormFromANode(nodeType).subscribe(function (formMetadata) {
                    _this.loadFormFromFormId(formMetadata.id);
                });
            }
            else {
                _this.loadFormFromFormId(form.id);
            }
        }, function (error) {
            _this.handleError(error);
        });
    };
    ActivitiForm.prototype.loadFormFromFormId = function (formId) {
        this.formId = formId;
        this.loadForm();
    };
    ActivitiForm.prototype.storeFormAsMetadata = function () {
        var _this = this;
        if (this.saveMetadata) {
            this.ecmModelService.createEcmTypeForActivitiForm(this.formName, this.form).subscribe(function (type) {
                _this.nodeService.createNodeMetadata(type.nodeType || type.entry.prefixedName, ecm_model_service_1.EcmModelService.MODEL_NAMESPACE, _this.form.values, _this.path, _this.nameNode);
            }, function (error) {
                _this.handleError(error);
            });
        }
    };
    ActivitiForm.prototype.onFormLoaded = function (form) {
        this.formLoaded.emit(form);
        this.formService.formLoaded.next(new index_2.FormEvent(form));
    };
    ActivitiForm.prototype.onTaskSaved = function (form) {
        this.formSaved.emit(form);
        this.formService.taskSaved.next(new index_2.FormEvent(form));
    };
    ActivitiForm.prototype.onTaskSavedError = function (form, error) {
        this.handleError(error);
        this.formService.taskSavedError.next(new index_2.FormErrorEvent(form, error));
    };
    ActivitiForm.prototype.onTaskCompleted = function (form) {
        this.formCompleted.emit(form);
        this.formService.taskCompleted.next(new index_2.FormEvent(form));
    };
    ActivitiForm.prototype.onTaskCompletedError = function (form, error) {
        this.handleError(error);
        this.formService.taskCompletedError.next(new index_2.FormErrorEvent(form, error));
    };
    return ActivitiForm;
}());
ActivitiForm.SAVE_OUTCOME_ID = '$save';
ActivitiForm.COMPLETE_OUTCOME_ID = '$complete';
ActivitiForm.START_PROCESS_OUTCOME_ID = '$startProcess';
ActivitiForm.CUSTOM_OUTCOME_ID = '$custom';
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiForm.prototype, "taskId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiForm.prototype, "nodeId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiForm.prototype, "formId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiForm.prototype, "formName", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiForm.prototype, "saveMetadata", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], ActivitiForm.prototype, "data", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiForm.prototype, "path", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiForm.prototype, "nameNode", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiForm.prototype, "showTitle", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiForm.prototype, "showCompleteButton", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiForm.prototype, "showSaveButton", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiForm.prototype, "showDebugButton", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiForm.prototype, "readOnly", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiForm.prototype, "showRefreshButton", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiForm.prototype, "showValidationIcon", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiForm.prototype, "formSaved", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiForm.prototype, "formCompleted", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiForm.prototype, "formLoaded", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiForm.prototype, "executeOutcome", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiForm.prototype, "onError", void 0);
ActivitiForm = ActivitiForm_1 = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'activiti-form',
        template: "<div>     <div *ngIf=\"!hasForm()\">         <h3 style=\"text-align: center\">Please select a Task</h3>     </div>     <div *ngIf=\"hasForm()\">         <div class=\"mdl-card mdl-shadow--2dp activiti-form-container\">             <div class=\"mdl-card__title\">                 <i *ngIf=\"showValidationIcon\" class=\"material-icons\">{{ form.isValid ? 'event_available' : 'event_busy' }}</i>                 <h2 *ngIf=\"isTitleEnabled()\" class=\"mdl-card__title-text\">{{form.taskName}}</h2>             </div>             <div class=\"mdl-card__media\">                 <div *ngIf=\"form.hasTabs()\">                     <tabs-widget [tabs]=\"form.tabs\" (formTabChanged)=\"checkVisibility($event);\"></tabs-widget>                 </div>                  <div *ngIf=\"!form.hasTabs() && form.hasFields()\">                     <div *ngFor=\"let field of form.fields\">                         <form-field [field]=\"field.field\"></form-field>                     </div>                 </div>             </div>             <div *ngIf=\"form.hasOutcomes()\" class=\"mdl-card__actions mdl-card--border\">                 <button *ngFor=\"let outcome of form.outcomes\"                         alfresco-mdl-button                         [disabled]=\"!isOutcomeButtonEnabled(outcome)\"                         [class.mdl-button--colored]=\"!outcome.isSystem\"                         [class.activiti-form-hide-button]=\"!isOutcomeButtonVisible(outcome, form.readOnly)\"                         (click)=\"onOutcomeClicked(outcome, $event)\">                     {{outcome.name}}                 </button>             </div>             <div  *ngIf=\"showRefreshButton\" class=\"mdl-card__menu\" >                 <button (click)=\"onRefreshClicked()\"                         class=\"mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect\">                     <i class=\"material-icons\">refresh</i>                 </button>             </div>         </div>     </div> </div> <!-- For debugging and data visualisation purposes, will be removed during future revisions --> <div  *ngIf=\"showDebugButton\" class=\"activiti-form-debug-container\">      <div style=\"float: right\">         <label class=\"mdl-switch mdl-js-switch mdl-js-ripple-effect\" for=\"switch-1\" [class.is-checked]=\"debugMode\">             <input type=\"checkbox\" id=\"switch-1\" class=\"mdl-switch__input\" [(ngModel)]=\"debugMode\">             <span class=\"mdl-switch__label\"></span>             <span class=\"debug-toggle-text\">Debug mode</span>         </label>     </div>      <div *ngIf=\"debugMode && hasForm()\">         <h4>Values</h4>         <pre>{{form.values | json}}</pre>          <h4>Form</h4>         <pre>{{form.json | json}}</pre>     </div> </div>",
        styles: [".activiti-form-container {     width: 100%;     min-height: 100px;     overflow: visible; }  .activiti-form-container > .mdl-card__media {     background-color: #fff; }  .activiti-form-debug-container {     padding: 10px; }  .activiti-form-debug-container .debug-toggle-text {     padding-left: 15px;     cursor: pointer; }  .activiti-form-debug-container .debug-toggle-text:hover {     font-weight: bold; }  .activiti-form-hide-button {     display: none; }"]
    }),
    __metadata("design:paramtypes", [form_service_1.FormService,
        widget_visibility_service_1.WidgetVisibilityService,
        ecm_model_service_1.EcmModelService,
        node_service_1.NodeService,
        ng2_alfresco_core_1.LogService])
], ActivitiForm);
exports.ActivitiForm = ActivitiForm;
var ActivitiForm_1;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktZm9ybS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQUEySDtBQUMzSCx1REFBK0M7QUFDL0MscUVBQWtFO0FBQ2xFLDJEQUF5RDtBQUN6RCwyREFBeUQ7QUFDekQsOENBQWlIO0FBQ2pILDJDQUE4RDtBQUU5RCxxRkFBbUY7QUFxRG5GLElBQWEsWUFBWTtJQXVFckIsc0JBQXNCLFdBQXdCLEVBQ3hCLGlCQUEwQyxFQUM1QyxlQUFnQyxFQUNoQyxXQUF3QixFQUN4QixVQUFzQjtRQUpwQixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN4QixzQkFBaUIsR0FBakIsaUJBQWlCLENBQXlCO1FBQzVDLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNoQyxnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN4QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBdkQxQyxpQkFBWSxHQUFZLEtBQUssQ0FBQztRQVk5QixjQUFTLEdBQVksSUFBSSxDQUFDO1FBRzFCLHVCQUFrQixHQUFZLElBQUksQ0FBQztRQUduQyxtQkFBYyxHQUFZLElBQUksQ0FBQztRQUcvQixvQkFBZSxHQUFZLElBQUksQ0FBQztRQUdoQyxhQUFRLEdBQVksS0FBSyxDQUFDO1FBRzFCLHNCQUFpQixHQUFZLElBQUksQ0FBQztRQUdsQyx1QkFBa0IsR0FBWSxJQUFJLENBQUM7UUFHbkMsY0FBUyxHQUE0QixJQUFJLG1CQUFZLEVBQWEsQ0FBQztRQUduRSxrQkFBYSxHQUE0QixJQUFJLG1CQUFZLEVBQWEsQ0FBQztRQUd2RSxlQUFVLEdBQTRCLElBQUksbUJBQVksRUFBYSxDQUFDO1FBR3BFLG1CQUFjLEdBQW1DLElBQUksbUJBQVksRUFBb0IsQ0FBQztRQUd0RixZQUFPLEdBQXNCLElBQUksbUJBQVksRUFBTyxDQUFDO1FBSXJELGNBQVMsR0FBWSxLQUFLLENBQUM7SUFPM0IsQ0FBQztJ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QTNFakMsWUFBWSxDQWlieEI7QUFqYlksb0NBQVkiLCJmaWxlIjoiY29tcG9uZW50cy9hY3Rpdml0aS1mb3JtLmNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBBZnRlclZpZXdDaGVja2VkLCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTG9nU2VydmljZSB9IGZyb20gJ25nMi1hbGZyZXNjby1jb3JlJztcbmltcG9ydCB7IEVjbU1vZGVsU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvZWNtLW1vZGVsLnNlcnZpY2UnO1xuaW1wb3J0IHsgRm9ybVNlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL2Zvcm0uc2VydmljZSc7XG5pbXBvcnQgeyBOb2RlU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvbm9kZS5zZXJ2aWNlJztcbmltcG9ydCB7IEZvcm1Nb2RlbCwgRm9ybU91dGNvbWVNb2RlbCwgRm9ybVZhbHVlcywgRm9ybUZpZWxkTW9kZWwsIEZvcm1PdXRjb21lRXZlbnQgfSBmcm9tICcuL3dpZGdldHMvY29yZS9pbmRleCc7XG5pbXBvcnQgeyBGb3JtRXZlbnQsIEZvcm1FcnJvckV2ZW50IH0gZnJvbSAnLi8uLi9ldmVudHMvaW5kZXgnO1xuXG5pbXBvcnQgeyBXaWRnZXRWaXNpYmlsaXR5U2VydmljZSB9ICBmcm9tICcuLy4uL3NlcnZpY2VzL3dpZGdldC12aXNpYmlsaXR5LnNlcnZpY2UnO1xuXG5kZWNsYXJlIGxldCBkaWFsb2dQb2x5ZmlsbDogYW55O1xuZGVjbGFyZSB2YXIgY29tcG9uZW50SGFuZGxlcjogYW55O1xuXG4vKipcbiAqIEBJbnB1dFxuICogQWN0aXZpdGlGb3JtIGNhbiBzaG93IDQgdHlwZXMgb2YgZm9ybXMgc2VhcmNoaW5nIGJ5IDQgdHlwZSBvZiBwYXJhbXM6XG4gKiAgIDEpIEZvcm0gYXR0YWNoZWQgdG8gYSB0YXNrIHBhc3NpbmcgdGhlIHt0YXNrSWR9LlxuICpcbiAqICAgMikgRm9ybSB0aGF0IGFyZSBvbmx5IGRlZmluZWQgd2l0aCB0aGUge2Zvcm1JZH0gKGluIHRoaXMgY2FzZSB5b3UgcmVjZWl2ZSBvbmx5IHRoZSBmb3JtIGRlZmluaXRpb24gYW5kIHRoZSBmb3JtIHdpbGwgbm90IGJlXG4gKiAgIGF0dGFjaGVkIHRvIGFueSBwcm9jZXNzLCB1c2VmdWwgaW4gY2FzZSB5b3Ugd2FudCB0byB1c2UgQWN0aXZpdGlGb3JtIGFzIGZvcm0gZGVzaWduZXIpLCBpbiB0aGlzIGNhc2UgeW91IGNhbiBwYXNzIGFsc28gb3RoZXIgMlxuICogICBwYXJhbWV0ZXJzOlxuICogICAgICAtIHtzYXZlT3B0aW9ufSBhcyBwYXJhbWV0ZXIgdG8gdGVsbCB3aGF0IGlzIHRoZSBmdW5jdGlvbiB0byBjYWxsIG9uIHRoZSBzYXZlIGFjdGlvbi5cbiAqICAgICAgLSB7ZGF0YX0gdG8gZmlsbCB0aGUgZm9ybSBmaWVsZCB3aXRoIHNvbWUgZGF0YSwgdGhlIGlkIG9mIHRoZSBmb3JtIG11c3QgdG8gbWF0Y2ggdGhlIG5hbWUgb2YgdGhlIGZpZWxkIG9mIHRoZSBwcm92aWRlZCBkYXRhIG9iamVjdC5cbiAqXG4gKiAgIDMpIEZvcm0gdGhhdCBhcmUgb25seSBkZWZpbmVkIHdpdGggdGhlIHtmb3JtTmFtZX0gKGluIHRoaXMgY2FzZSB5b3UgcmVjZWl2ZSBvbmx5IHRoZSBmb3JtIGRlZmluaXRpb24gYW5kIHRoZSBmb3JtIHdpbGwgbm90IGJlXG4gKiAgIGF0dGFjaGVkIHRvIGFueSBwcm9jZXNzLCB1c2VmdWwgaW4gY2FzZSB5b3Ugd2FudCB0byB1c2UgQWN0aXZpdGlGb3JtIGFzIGZvcm0gZGVzaWduZXIpLFxuICogICBpbiB0aGlzIGNhc2UgeW91IGNhbiBwYXNzIGFsc28gb3RoZXIgMiBwYXJhbWV0ZXJzOlxuICogICAgICAtIHtzYXZlT3B0aW9ufSBhcyBwYXJhbWV0ZXIgdG8gdGVsbCB3aGF0IGlzIHRoZSBmdW5jdGlvbiB0byBjYWxsIG9uIHRoZSBzYXZlIGFjdGlvbi5cbiAqICAgICAgLSB7ZGF0YX0gdG8gZmlsbCB0aGUgZm9ybSBmaWVsZCB3aXRoIHNvbWUgZGF0YSwgdGhlIGlkIG9mIHRoZSBmb3JtIG11c3QgdG8gbWF0Y2ggdGhlIG5hbWUgb2YgdGhlIGZpZWxkIG9mIHRoZSBwcm92aWRlZCBkYXRhIG9iamVjdC5cbiAqXG4gKiAgIDQpIEZvcm0gdGhhdCBzaG93IHRoZSBtZXRhZGF0YSBvZiBhIHtub2RlSWR9XG4gKlxuICogICB7c2hvd1RpdGxlfSBib29sZWFuIC0gdG8gaGlkZSB0aGUgdGl0bGUgb2YgdGhlIGZvcm0gcGFzcyBmYWxzZSwgZGVmYXVsdCB0cnVlO1xuICpcbiAqICAge3Nob3dSZWZyZXNoQnV0dG9ufSBib29sZWFuIC0gdG8gaGlkZSB0aGUgcmVmcmVzaCBidXR0b24gb2YgdGhlIGZvcm0gcGFzcyBmYWxzZSwgZGVmYXVsdCB0cnVlO1xuICpcbiAqICAge3Nob3dEZWJ1Z0J1dHRvbn0gYm9vbGVhbiAtIHRvIHNob3cgdGhlIGRlYnVnIG9wdGlvbnMsIGRlZmF1bHQgZmFsc2U7XG4gKlxuICogICB7c2hvd0NvbXBsZXRlQnV0dG9ufSBib29sZWFuIC0gdG8gaGlkZSB0aGUgY29tcGxldGUgYnV0dG9uIG9mIHRoZSBmb3JtIHBhc3MgZmFsc2UsIGRlZmF1bHQgdHJ1ZTtcbiAqXG4gKiAgIHtzaG93U2F2ZUJ1dHRvbn0gYm9vbGVhbiAtIHRvIGhpZGUgdGhlIHNhdmUgYnV0dG9uIG9mIHRoZSBmb3JtIHBhc3MgZmFsc2UsIGRlZmF1bHQgdHJ1ZTtcbiAqXG4gKiAgIHtzYXZlTWV0YWRhdGF9IGJvb2xlYW4gLSBzdG9yZSB0aGUgdmFsdWUgb2YgdGhlIGZvcm0gYXMgbWV0YWRhdGEsIGRlZmF1bHQgZmFsc2U7XG4gKlxuICogICB7cGF0aH0gc3RyaW5nIC0gcGF0aCBvZiB0aGUgZm9sZGVyIHdoZXJlIHRvIHN0b3JlIHRoZSBtZXRhZGF0YTtcbiAqXG4gKiAgIHtuYW1lTm9kZX0gc3RyaW5nIChvcHRpb25hbCkgLSBOYW1lIHRvIGFzc2lnbiB0byB0aGUgbmV3IG5vZGUgd2hlcmUgdGhlIG1ldGFkYXRhIGFyZSBzdG9yZWQ7XG4gKlxuICogICBAT3V0cHV0XG4gKiAgIHtmb3JtTG9hZGVkfSBFdmVudEVtaXR0ZXIgLSBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gdGhlIGZvcm0gaXMgbG9hZGVkLCBpdCBwYXNzIGFsbCB0aGUgdmFsdWUgaW4gdGhlIGZvcm0uXG4gKiAgIHtmb3JtU2F2ZWR9IEV2ZW50RW1pdHRlciAtIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiB0aGUgZm9ybSBpcyBzYXZlZCwgaXQgcGFzcyBhbGwgdGhlIHZhbHVlIGluIHRoZSBmb3JtLlxuICogICB7Zm9ybUNvbXBsZXRlZH0gRXZlbnRFbWl0dGVyIC0gVGhpcyBldmVudCBpcyBmaXJlZCB3aGVuIHRoZSBmb3JtIGlzIGNvbXBsZXRlZCwgaXQgcGFzcyBhbGwgdGhlIHZhbHVlIGluIHRoZSBmb3JtLlxuICpcbiAqIEByZXR1cm5zIHtBY3Rpdml0aUZvcm19IC5cbiAqL1xuQENvbXBvbmVudCh7XG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICBzZWxlY3RvcjogJ2FjdGl2aXRpLWZvcm0nLFxuICAgIHRlbXBsYXRlOiBcIjxkaXY+ICAgICA8ZGl2ICpuZ0lmPVxcXCIhaGFzRm9ybSgpXFxcIj4gICAgICAgICA8aDMgc3R5bGU9XFxcInRleHQtYWxpZ246IGNlbnRlclxcXCI+UGxlYXNlIHNlbGVjdCBhIFRhc2s8L2gzPiAgICAgPC9kaXY+ICAgICA8ZGl2ICpuZ0lmPVxcXCJoYXNGb3JtKClcXFwiPiAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1jYXJkIG1kbC1zaGFkb3ctLTJkcCBhY3Rpdml0aS1mb3JtLWNvbnRhaW5lclxcXCI+ICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1jYXJkX190aXRsZVxcXCI+ICAgICAgICAgICAgICAgICA8aSAqbmdJZj1cXFwic2hvd1ZhbGlkYXRpb25JY29uXFxcIiBjbGFzcz1cXFwibWF0ZXJpYWwtaWNvbnNcXFwiPnt7IGZvcm0uaXNWYWxpZCA/ICdldmVudF9hdmFpbGFibGUnIDogJ2V2ZW50X2J1c3knIH19PC9pPiAgICAgICAgICAgICAgICAgPGgyICpuZ0lmPVxcXCJpc1RpdGxlRW5hYmxlZCgpXFxcIiBjbGFzcz1cXFwibWRsLWNhcmRfX3RpdGxlLXRleHRcXFwiPnt7Zm9ybS50YXNrTmFtZX19PC9oMj4gICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1jYXJkX19tZWRpYVxcXCI+ICAgICAgICAgICAgICAgICA8ZGl2ICpuZ0lmPVxcXCJmb3JtLmhhc1RhYnMoKVxcXCI+ICAgICAgICAgICAgICAgICAgICAgPHRhYnMtd2lkZ2V0IFt0YWJzXT1cXFwiZm9ybS50YWJzXFxcIiAoZm9ybVRhYkNoYW5nZWQpPVxcXCJjaGVja1Zpc2liaWxpdHkoJGV2ZW50KTtcXFwiPjwvdGFicy13aWRnZXQ+ICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgICAgICA8ZGl2ICpuZ0lmPVxcXCIhZm9ybS5oYXNUYWJzKCkgJiYgZm9ybS5oYXNGaWVsZHMoKVxcXCI+ICAgICAgICAgICAgICAgICAgICAgPGRpdiAqbmdGb3I9XFxcImxldCBmaWVsZCBvZiBmb3JtLmZpZWxkc1xcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgIDxmb3JtLWZpZWxkIFtmaWVsZF09XFxcImZpZWxkLmZpZWxkXFxcIj48L2Zvcm0tZmllbGQ+ICAgICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgIDxkaXYgKm5nSWY9XFxcImZvcm0uaGFzT3V0Y29tZXMoKVxcXCIgY2xhc3M9XFxcIm1kbC1jYXJkX19hY3Rpb25zIG1kbC1jYXJkLS1ib3JkZXJcXFwiPiAgICAgICAgICAgICAgICAgPGJ1dHRvbiAqbmdGb3I9XFxcImxldCBvdXRjb21lIG9mIGZvcm0ub3V0Y29tZXNcXFwiICAgICAgICAgICAgICAgICAgICAgICAgIGFsZnJlc2NvLW1kbC1idXR0b24gICAgICAgICAgICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cXFwiIWlzT3V0Y29tZUJ1dHRvbkVuYWJsZWQob3V0Y29tZSlcXFwiICAgICAgICAgICAgICAgICAgICAgICAgIFtjbGFzcy5tZGwtYnV0dG9uLS1jb2xvcmVkXT1cXFwiIW91dGNvbWUuaXNTeXN0ZW1cXFwiICAgICAgICAgICAgICAgICAgICAgICAgIFtjbGFzcy5hY3Rpdml0aS1mb3JtLWhpZGUtYnV0dG9uXT1cXFwiIWlzT3V0Y29tZUJ1dHRvblZpc2libGUob3V0Y29tZSwgZm9ybS5yZWFkT25seSlcXFwiICAgICAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XFxcIm9uT3V0Y29tZUNsaWNrZWQob3V0Y29tZSwgJGV2ZW50KVxcXCI+ICAgICAgICAgICAgICAgICAgICAge3tvdXRjb21lLm5hbWV9fSAgICAgICAgICAgICAgICAgPC9idXR0b24+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICA8ZGl2ICAqbmdJZj1cXFwic2hvd1JlZnJlc2hCdXR0b25cXFwiIGNsYXNzPVxcXCJtZGwtY2FyZF9fbWVudVxcXCIgPiAgICAgICAgICAgICAgICAgPGJ1dHRvbiAoY2xpY2spPVxcXCJvblJlZnJlc2hDbGlja2VkKClcXFwiICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVxcXCJtZGwtYnV0dG9uIG1kbC1idXR0b24tLWljb24gbWRsLWpzLWJ1dHRvbiBtZGwtanMtcmlwcGxlLWVmZmVjdFxcXCI+ICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XFxcIm1hdGVyaWFsLWljb25zXFxcIj5yZWZyZXNoPC9pPiAgICAgICAgICAgICAgICAgPC9idXR0b24+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgIDwvZGl2PiAgICAgPC9kaXY+IDwvZGl2PiA8IS0tIEZvciBkZWJ1Z2dpbmcgYW5kIGRhdGEgdmlzdWFsaXNhdGlvbiBwdXJwb3Nlcywgd2lsbCBiZSByZW1vdmVkIGR1cmluZyBmdXR1cmUgcmV2aXNpb25zIC0tPiA8ZGl2ICAqbmdJZj1cXFwic2hvd0RlYnVnQnV0dG9uXFxcIiBjbGFzcz1cXFwiYWN0aXZpdGktZm9ybS1kZWJ1Zy1jb250YWluZXJcXFwiPiAgICAgIDxkaXYgc3R5bGU9XFxcImZsb2F0OiByaWdodFxcXCI+ICAgICAgICAgPGxhYmVsIGNsYXNzPVxcXCJtZGwtc3dpdGNoIG1kbC1qcy1zd2l0Y2ggbWRsLWpzLXJpcHBsZS1lZmZlY3RcXFwiIGZvcj1cXFwic3dpdGNoLTFcXFwiIFtjbGFzcy5pcy1jaGVja2VkXT1cXFwiZGVidWdNb2RlXFxcIj4gICAgICAgICAgICAgPGlucHV0IHR5cGU9XFxcImNoZWNrYm94XFxcIiBpZD1cXFwic3dpdGNoLTFcXFwiIGNsYXNzPVxcXCJtZGwtc3dpdGNoX19pbnB1dFxcXCIgWyhuZ01vZGVsKV09XFxcImRlYnVnTW9kZVxcXCI+ICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJtZGwtc3dpdGNoX19sYWJlbFxcXCI+PC9zcGFuPiAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwiZGVidWctdG9nZ2xlLXRleHRcXFwiPkRlYnVnIG1vZGU8L3NwYW4+ICAgICAgICAgPC9sYWJlbD4gICAgIDwvZGl2PiAgICAgIDxkaXYgKm5nSWY9XFxcImRlYnVnTW9kZSAmJiBoYXNGb3JtKClcXFwiPiAgICAgICAgIDxoND5WYWx1ZXM8L2g0PiAgICAgICAgIDxwcmU+e3tmb3JtLnZhbHVlcyB8IGpzb259fTwvcHJlPiAgICAgICAgICA8aDQ+Rm9ybTwvaDQ+ICAgICAgICAgPHByZT57e2Zvcm0uanNvbiB8IGpzb259fTwvcHJlPiAgICAgPC9kaXY+IDwvZGl2PlwiLFxuICAgIHN0eWxlczogW1wiLmFjdGl2aXRpLWZvcm0tY29udGFpbmVyIHsgICAgIHdpZHRoOiAxMDAlOyAgICAgbWluLWhlaWdodDogMTAwcHg7ICAgICBvdmVyZmxvdzogdmlzaWJsZTsgfSAgLmFjdGl2aXRpLWZvcm0tY29udGFpbmVyID4gLm1kbC1jYXJkX19tZWRpYSB7ICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOyB9ICAuYWN0aXZpdGktZm9ybS1kZWJ1Zy1jb250YWluZXIgeyAgICAgcGFkZGluZzogMTBweDsgfSAgLmFjdGl2aXRpLWZvcm0tZGVidWctY29udGFpbmVyIC5kZWJ1Zy10b2dnbGUtdGV4dCB7ICAgICBwYWRkaW5nLWxlZnQ6IDE1cHg7ICAgICBjdXJzb3I6IHBvaW50ZXI7IH0gIC5hY3Rpdml0aS1mb3JtLWRlYnVnLWNvbnRhaW5lciAuZGVidWctdG9nZ2xlLXRleHQ6aG92ZXIgeyAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7IH0gIC5hY3Rpdml0aS1mb3JtLWhpZGUtYnV0dG9uIHsgICAgIGRpc3BsYXk6IG5vbmU7IH1cIl1cbn0pXG5leHBvcnQgY2xhc3MgQWN0aXZpdGlGb3JtIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdDaGVja2VkLCBPbkNoYW5nZXMge1xuXG4gICAgc3RhdGljIFNBVkVfT1VUQ09NRV9JRDogc3RyaW5nID0gJyRzYXZlJztcbiAgICBzdGF0aWMgQ09NUExFVEVfT1VUQ09NRV9JRDogc3RyaW5nID0gJyRjb21wbGV0ZSc7XG4gICAgc3RhdGljIFNUQVJUX1BST0NFU1NfT1VUQ09NRV9JRDogc3RyaW5nID0gJyRzdGFydFByb2Nlc3MnO1xuICAgIHN0YXRpYyBDVVNUT01fT1VUQ09NRV9JRDogc3RyaW5nID0gJyRjdXN0b20nO1xuXG4gICAgQElucHV0KClcbiAgICB0YXNrSWQ6IHN0cmluZztcblxuICAgIEBJbnB1dCgpXG4gICAgbm9kZUlkOiBzdHJpbmc7XG5cbiAgICBASW5wdXQoKVxuICAgIGZvcm1JZDogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICBmb3JtTmFtZTogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICBzYXZlTWV0YWRhdGE6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBJbnB1dCgpXG4gICAgZGF0YTogRm9ybVZhbHVlcztcblxuICAgIEBJbnB1dCgpXG4gICAgcGF0aDogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICBuYW1lTm9kZTogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICBzaG93VGl0bGU6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgQElucHV0KClcbiAgICBzaG93Q29tcGxldGVCdXR0b246IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgQElucHV0KClcbiAgICBzaG93U2F2ZUJ1dHRvbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBASW5wdXQoKVxuICAgIHNob3dEZWJ1Z0J1dHRvbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBASW5wdXQoKVxuICAgIHJlYWRPbmx5OiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBASW5wdXQoKVxuICAgIHNob3dSZWZyZXNoQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIEBJbnB1dCgpXG4gICAgc2hvd1ZhbGlkYXRpb25JY29uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIEBPdXRwdXQoKVxuICAgIGZvcm1TYXZlZDogRXZlbnRFbWl0dGVyPEZvcm1Nb2RlbD4gPSBuZXcgRXZlbnRFbWl0dGVyPEZvcm1Nb2RlbD4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIGZvcm1Db21wbGV0ZWQ6IEV2ZW50RW1pdHRlcjxGb3JtTW9kZWw+ID0gbmV3IEV2ZW50RW1pdHRlcjxGb3JtTW9kZWw+KCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBmb3JtTG9hZGVkOiBFdmVudEVtaXR0ZXI8Rm9ybU1vZGVsPiA9IG5ldyBFdmVudEVtaXR0ZXI8Rm9ybU1vZGVsPigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgZXhlY3V0ZU91dGNvbWU6IEV2ZW50RW1pdHRlcjxGb3JtT3V0Y29tZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8Rm9ybU91dGNvbWVFdmVudD4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIG9uRXJyb3I6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICBmb3JtOiBGb3JtTW9kZWw7XG5cbiAgICBkZWJ1Z01vZGU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBmb3JtU2VydmljZTogRm9ybVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJvdGVjdGVkIHZpc2liaWxpdHlTZXJ2aWNlOiBXaWRnZXRWaXNpYmlsaXR5U2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGVjbU1vZGVsU2VydmljZTogRWNtTW9kZWxTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgbm9kZVNlcnZpY2U6IE5vZGVTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgbG9nU2VydmljZTogTG9nU2VydmljZSkge1xuICAgIH1cblxuICAgIGhhc0Zvcm0oKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmZvcm0gPyB0cnVlIDogZmFsc2U7XG4gICAgfVxuXG4gICAgaXNUaXRsZUVuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLnNob3dUaXRsZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZm9ybSAmJiB0aGlzLmZvcm0udGFza05hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaXNPdXRjb21lQnV0dG9uRW5hYmxlZChvdXRjb21lOiBGb3JtT3V0Y29tZU1vZGVsKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLmZvcm0ucmVhZE9ubHkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvdXRjb21lKSB7XG4gICAgICAgICAgICAvLyBNYWtlICdTYXZlJyBidXR0b24gYWx3YXlzIGF2YWlsYWJsZVxuICAgICAgICAgICAgaWYgKG91dGNvbWUubmFtZSA9PT0gRm9ybU91dGNvbWVNb2RlbC5TQVZFX0FDVElPTikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9ybS5pc1ZhbGlkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpc091dGNvbWVCdXR0b25WaXNpYmxlKG91dGNvbWU6IEZvcm1PdXRjb21lTW9kZWwsIGlzRm9ybVJlYWRPbmx5OiBib29sZWFuKTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChvdXRjb21lICYmIG91dGNvbWUubmFtZSkge1xuICAgICAgICAgICAgaWYgKG91dGNvbWUubmFtZSA9PT0gRm9ybU91dGNvbWVNb2RlbC5DT01QTEVURV9BQ1RJT04pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zaG93Q29tcGxldGVCdXR0b247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNGb3JtUmVhZE9ubHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3V0Y29tZS5pc1NlbGVjdGVkIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvdXRjb21lLm5hbWUgPT09IEZvcm1PdXRjb21lTW9kZWwuU0FWRV9BQ1RJT04pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zaG93U2F2ZUJ1dHRvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvdXRjb21lLm5hbWUgPT09IEZvcm1PdXRjb21lTW9kZWwuU1RBUlRfUFJPQ0VTU19BQ1RJT04pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIGlmICh0aGlzLm5vZGVJZCkge1xuICAgICAgICAgICAgdGhpcy5sb2FkRm9ybUZvckVjbU5vZGUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubG9hZEZvcm0oKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcbiAgICAgICAgdGhpcy5zZXR1cE1hdGVyaWFsQ29tcG9uZW50cygpO1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgbGV0IHRhc2tJZCA9IGNoYW5nZXNbJ3Rhc2tJZCddO1xuICAgICAgICBpZiAodGFza0lkICYmIHRhc2tJZC5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0Rm9ybUJ5VGFza0lkKHRhc2tJZC5jdXJyZW50VmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGZvcm1JZCA9IGNoYW5nZXNbJ2Zvcm1JZCddO1xuICAgICAgICBpZiAoZm9ybUlkICYmIGZvcm1JZC5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0Rm9ybURlZmluaXRpb25CeUZvcm1JZChmb3JtSWQuY3VycmVudFZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBmb3JtTmFtZSA9IGNoYW5nZXNbJ2Zvcm1OYW1lJ107XG4gICAgICAgIGlmIChmb3JtTmFtZSAmJiBmb3JtTmFtZS5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0Rm9ybURlZmluaXRpb25CeUZvcm1OYW1lKGZvcm1OYW1lLmN1cnJlbnRWYWx1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbnZva2VkIHdoZW4gdXNlciBjbGlja3Mgb3V0Y29tZSBidXR0b24uXG4gICAgICogQHBhcmFtIG91dGNvbWUgRm9ybSBvdXRjb21lIG1vZGVsXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgb3V0Y29tZSBhY3Rpb24gd2FzIGV4ZWN1dGVkLCBvdGhlcndpc2UgZmFsc2UuXG4gICAgICovXG4gICAgb25PdXRjb21lQ2xpY2tlZChvdXRjb21lOiBGb3JtT3V0Y29tZU1vZGVsKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICghdGhpcy5yZWFkT25seSAmJiBvdXRjb21lICYmIHRoaXMuZm9ybSkge1xuXG4gICAgICAgICAgICBsZXQgYXJncyA9IG5ldyBGb3JtT3V0Y29tZUV2ZW50KG91dGNvbWUpO1xuICAgICAgICAgICAgdGhpcy5leGVjdXRlT3V0Y29tZS5lbWl0KGFyZ3MpO1xuICAgICAgICAgICAgaWYgKGFyZ3MuZGVmYXVsdFByZXZlbnRlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG91dGNvbWUuaXNTeXN0ZW0pIHtcbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZS5pZCA9PT0gQWN0aXZpdGlGb3JtLlNBVkVfT1VUQ09NRV9JRCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVUYXNrRm9ybSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZS5pZCA9PT0gQWN0aXZpdGlGb3JtLkNPTVBMRVRFX09VVENPTUVfSUQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZVRhc2tGb3JtKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvdXRjb21lLmlkID09PSBBY3Rpdml0aUZvcm0uU1RBUlRfUFJPQ0VTU19PVVRDT01FX0lEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVUYXNrRm9ybSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZS5pZCA9PT0gQWN0aXZpdGlGb3JtLkNVU1RPTV9PVVRDT01FX0lEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25UYXNrU2F2ZWQodGhpcy5mb3JtKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9yZUZvcm1Bc01ldGFkYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gTm90ZTogQWN0aXZpdGkgaXMgdXNpbmcgTkFNRSBmaWVsZCByYXRoZXIgdGhhbiBJRCBmb3Igb3V0Y29tZXNcbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25UYXNrU2F2ZWQodGhpcy5mb3JtKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZVRhc2tGb3JtKG91dGNvbWUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbnZva2VkIHdoZW4gdXNlciBjbGlja3MgZm9ybSByZWZyZXNoIGJ1dHRvbi5cbiAgICAgKi9cbiAgICBvblJlZnJlc2hDbGlja2VkKCkge1xuICAgICAgICB0aGlzLmxvYWRGb3JtKCk7XG4gICAgfVxuXG4gICAgbG9hZEZvcm0oKSB7XG4gICAgICAgIGlmICh0aGlzLnRhc2tJZCkge1xuICAgICAgICAgICAgdGhpcy5nZXRGb3JtQnlUYXNrSWQodGhpcy50YXNrSWQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZm9ybUlkKSB7XG4gICAgICAgICAgICB0aGlzLmdldEZvcm1EZWZpbml0aW9uQnlGb3JtSWQodGhpcy5mb3JtSWQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZm9ybU5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0Rm9ybURlZmluaXRpb25CeUZvcm1OYW1lKHRoaXMuZm9ybU5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbG9hZEZvcm1Qb3JjZXNzVmFyaWFibGUodGFza0lkKSB7XG4gICAgICAgIHRoaXMuZm9ybVNlcnZpY2UuZ2V0VGFzayh0YXNrSWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgIHRhc2sgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQVByb2Nlc3NUYXNrKHRhc2spKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlzaWJpbGl0eVNlcnZpY2UuZ2V0VGFza1Byb2Nlc3NWYXJpYWJsZSh0YXNrSWQpLnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGlzQVByb2Nlc3NUYXNrKHRhc2tSZXByZXNlbnRhdGlvbikge1xuICAgICAgICByZXR1cm4gdGFza1JlcHJlc2VudGF0aW9uLnByb2Nlc3NEZWZpbml0aW9uSWQgJiYgdGFza1JlcHJlc2VudGF0aW9uLnByb2Nlc3NEZWZpbml0aW9uRGVwbG95bWVudElkICE9PSAnbnVsbCc7XG4gICAgfVxuXG4gICAgc2V0dXBNYXRlcmlhbENvbXBvbmVudHMoKTogYm9vbGVhbiB7XG4gICAgICAgIC8vIHdvcmthcm91bmQgZm9yIE1ETCBpc3N1ZXMgd2l0aCBkeW5hbWljIGNvbXBvbmVudHNcbiAgICAgICAgaWYgKGNvbXBvbmVudEhhbmRsZXIpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudEhhbmRsZXIudXBncmFkZUFsbFJlZ2lzdGVyZWQoKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBnZXRGb3JtQnlUYXNrSWQodGFza0lkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5sb2FkRm9ybVBvcmNlc3NWYXJpYWJsZSh0aGlzLnRhc2tJZCk7XG4gICAgICAgIGxldCBkYXRhID0gdGhpcy5kYXRhO1xuICAgICAgICB0aGlzLmZvcm1TZXJ2aWNlXG4gICAgICAgICAgICAuZ2V0VGFza0Zvcm0odGFza0lkKVxuICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICBmb3JtID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtID0gbmV3IEZvcm1Nb2RlbChmb3JtLCBkYXRhLCB0aGlzLnJlYWRPbmx5LCB0aGlzLmZvcm1TZXJ2aWNlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkZvcm1Mb2FkZWQodGhpcy5mb3JtKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIGdldEZvcm1EZWZpbml0aW9uQnlGb3JtSWQoZm9ybUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5mb3JtU2VydmljZVxuICAgICAgICAgICAgLmdldEZvcm1EZWZpbml0aW9uQnlJZChmb3JtSWQpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIGZvcm0gPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1OYW1lID0gZm9ybS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm0gPSB0aGlzLnBhcnNlRm9ybShmb3JtKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkZvcm1Mb2FkZWQodGhpcy5mb3JtKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIGdldEZvcm1EZWZpbml0aW9uQnlGb3JtTmFtZShmb3JtTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuZm9ybVNlcnZpY2VcbiAgICAgICAgICAgIC5nZXRGb3JtRGVmaW5pdGlvbkJ5TmFtZShmb3JtTmFtZSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgaWQgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1TZXJ2aWNlLmdldEZvcm1EZWZpbml0aW9uQnlJZChpZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtID0gdGhpcy5wYXJzZUZvcm0oZm9ybSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkZvcm1Mb2FkZWQodGhpcy5mb3JtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIHNhdmVUYXNrRm9ybSgpIHtcbiAgICAgICAgaWYgKHRoaXMuZm9ybSAmJiB0aGlzLmZvcm0udGFza0lkKSB7XG4gICAgICAgICAgICB0aGlzLmZvcm1TZXJ2aWNlXG4gICAgICAgICAgICAgICAgLnNhdmVUYXNrRm9ybSh0aGlzLmZvcm0udGFza0lkLCB0aGlzLmZvcm0udmFsdWVzKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25UYXNrU2F2ZWQodGhpcy5mb3JtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmVGb3JtQXNNZXRhZGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvciA9PiB0aGlzLm9uVGFza1NhdmVkRXJyb3IodGhpcy5mb3JtLCBlcnJvcilcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29tcGxldGVUYXNrRm9ybShvdXRjb21lPzogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0aGlzLmZvcm0gJiYgdGhpcy5mb3JtLnRhc2tJZCkge1xuICAgICAgICAgICAgdGhpcy5mb3JtU2VydmljZVxuICAgICAgICAgICAgICAgIC5jb21wbGV0ZVRhc2tGb3JtKHRoaXMuZm9ybS50YXNrSWQsIHRoaXMuZm9ybS52YWx1ZXMsIG91dGNvbWUpXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblRhc2tDb21wbGV0ZWQodGhpcy5mb3JtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmVGb3JtQXNNZXRhZGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvciA9PiB0aGlzLm9uVGFza0NvbXBsZXRlZEVycm9yKHRoaXMuZm9ybSwgZXJyb3IpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhbmRsZUVycm9yKGVycjogYW55KTogYW55IHtcbiAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGVycik7XG4gICAgICAgIHRoaXMub25FcnJvci5lbWl0KGVycik7XG4gICAgfVxuXG4gICAgcGFyc2VGb3JtKGpzb246IGFueSk6IEZvcm1Nb2RlbCB7XG4gICAgICAgIGlmIChqc29uKSB7XG4gICAgICAgICAgICBsZXQgZm9ybSA9IG5ldyBGb3JtTW9kZWwoanNvbiwgdGhpcy5kYXRhLCB0aGlzLnJlYWRPbmx5LCB0aGlzLmZvcm1TZXJ2aWNlKTtcbiAgICAgICAgICAgIGlmICghanNvbi5maWVsZHMpIHtcbiAgICAgICAgICAgICAgICBmb3JtLm91dGNvbWVzID0gdGhpcy5nZXRGb3JtRGVmaW5pdGlvbk91dGNvbWVzKGZvcm0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZvcm07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGN1c3RvbSBzZXQgb2Ygb3V0Y29tZXMgZm9yIGEgRm9ybSBEZWZpbml0aW9uLlxuICAgICAqIEBwYXJhbSBmb3JtIEZvcm0gZGVmaW5pdGlvbiBtb2RlbC5cbiAgICAgKiBAcmV0dXJucyB7Rm9ybU91dGNvbWVNb2RlbFtdfSBPdXRjb21lcyBmb3IgYSBnaXZlbiBmb3JtIGRlZmluaXRpb24uXG4gICAgICovXG4gICAgZ2V0Rm9ybURlZmluaXRpb25PdXRjb21lcyhmb3JtOiBGb3JtTW9kZWwpOiBGb3JtT3V0Y29tZU1vZGVsW10ge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgbmV3IEZvcm1PdXRjb21lTW9kZWwoZm9ybSwgeyBpZDogJyRjdXN0b20nLCBuYW1lOiBGb3JtT3V0Y29tZU1vZGVsLlNBVkVfQUNUSU9OLCBpc1N5c3RlbTogdHJ1ZSB9KVxuICAgICAgICBdO1xuICAgIH1cblxuICAgIGNoZWNrVmlzaWJpbGl0eShmaWVsZDogRm9ybUZpZWxkTW9kZWwpIHtcbiAgICAgICAgaWYgKGZpZWxkICYmIGZpZWxkLmZvcm0pIHtcbiAgICAgICAgICAgIHRoaXMudmlzaWJpbGl0eVNlcnZpY2UucmVmcmVzaFZpc2liaWxpdHkoZmllbGQuZm9ybSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGxvYWRGb3JtRm9yRWNtTm9kZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ub2RlU2VydmljZS5nZXROb2RlTWV0YWRhdGEodGhpcy5ub2RlSWQpLnN1YnNjcmliZShkYXRhID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhLm1ldGFkYXRhO1xuICAgICAgICAgICAgICAgIHRoaXMubG9hZEZvcm1Gcm9tQWN0aXZpdGkoZGF0YS5ub2RlVHlwZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcik7XG4gICAgfVxuXG4gICAgbG9hZEZvcm1Gcm9tQWN0aXZpdGkobm9kZVR5cGU6IHN0cmluZyk6IGFueSB7XG4gICAgICAgIHRoaXMuZm9ybVNlcnZpY2Uuc2VhcmNoRnJvbShub2RlVHlwZSkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgZm9ybSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFmb3JtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybVNlcnZpY2UuY3JlYXRlRm9ybUZyb21BTm9kZShub2RlVHlwZSkuc3Vic2NyaWJlKGZvcm1NZXRhZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRGb3JtRnJvbUZvcm1JZChmb3JtTWV0YWRhdGEuaWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRGb3JtRnJvbUZvcm1JZChmb3JtLmlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBsb2FkRm9ybUZyb21Gb3JtSWQoZm9ybUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5mb3JtSWQgPSBmb3JtSWQ7XG4gICAgICAgIHRoaXMubG9hZEZvcm0oKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0b3JlRm9ybUFzTWV0YWRhdGEoKSB7XG4gICAgICAgIGlmICh0aGlzLnNhdmVNZXRhZGF0YSkge1xuICAgICAgICAgICAgdGhpcy5lY21Nb2RlbFNlcnZpY2UuY3JlYXRlRWNtVHlwZUZvckFjdGl2aXRpRm9ybSh0aGlzLmZvcm1OYW1lLCB0aGlzLmZvcm0pLnN1YnNjcmliZSh0eXBlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub2RlU2VydmljZS5jcmVhdGVOb2RlTWV0YWRhdGEodHlwZS5ub2RlVHlwZSB8fCB0eXBlLmVudHJ5LnByZWZpeGVkTmFtZSwgRWNtTW9kZWxTZXJ2aWNlLk1PREVMX05BTUVTUEFDRSwgdGhpcy5mb3JtLnZhbHVlcywgdGhpcy5wYXRoLCB0aGlzLm5hbWVOb2RlKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG9uRm9ybUxvYWRlZChmb3JtOiBGb3JtTW9kZWwpIHtcbiAgICAgICAgdGhpcy5mb3JtTG9hZGVkLmVtaXQoZm9ybSk7XG4gICAgICAgIHRoaXMuZm9ybVNlcnZpY2UuZm9ybUxvYWRlZC5uZXh0KG5ldyBGb3JtRXZlbnQoZm9ybSkpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBvblRhc2tTYXZlZChmb3JtOiBGb3JtTW9kZWwpIHtcbiAgICAgICAgdGhpcy5mb3JtU2F2ZWQuZW1pdChmb3JtKTtcbiAgICAgICAgdGhpcy5mb3JtU2VydmljZS50YXNrU2F2ZWQubmV4dChuZXcgRm9ybUV2ZW50KGZvcm0pKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgb25UYXNrU2F2ZWRFcnJvcihmb3JtOiBGb3JtTW9kZWwsIGVycm9yOiBhbnkpIHtcbiAgICAgICAgdGhpcy5oYW5kbGVFcnJvcihlcnJvcik7XG4gICAgICAgIHRoaXMuZm9ybVNlcnZpY2UudGFza1NhdmVkRXJyb3IubmV4dChuZXcgRm9ybUVycm9yRXZlbnQoZm9ybSwgZXJyb3IpKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgb25UYXNrQ29tcGxldGVkKGZvcm06IEZvcm1Nb2RlbCkge1xuICAgICAgICB0aGlzLmZvcm1Db21wbGV0ZWQuZW1pdChmb3JtKTtcbiAgICAgICAgdGhpcy5mb3JtU2VydmljZS50YXNrQ29tcGxldGVkLm5leHQobmV3IEZvcm1FdmVudChmb3JtKSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG9uVGFza0NvbXBsZXRlZEVycm9yKGZvcm06IEZvcm1Nb2RlbCwgZXJyb3I6IGFueSkge1xuICAgICAgICB0aGlzLmhhbmRsZUVycm9yKGVycm9yKTtcbiAgICAgICAgdGhpcy5mb3JtU2VydmljZS50YXNrQ29tcGxldGVkRXJyb3IubmV4dChuZXcgRm9ybUVycm9yRXZlbnQoZm9ybSwgZXJyb3IpKTtcbiAgICB9XG59XG4iXX0=
