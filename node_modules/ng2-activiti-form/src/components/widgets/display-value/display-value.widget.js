/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var moment = require("moment");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var widget_component_1 = require("./../widget.component");
var form_field_types_1 = require("../core/form-field-types");
var form_service_1 = require("../../../services/form.service");
var widget_visibility_service_1 = require("../../../services/widget-visibility.service");
var DisplayValueWidget = (function (_super) {
    __extends(DisplayValueWidget, _super);
    function DisplayValueWidget(formService, visibilityService, logService) {
        var _this = _super.call(this) || this;
        _this.formService = formService;
        _this.visibilityService = visibilityService;
        _this.logService = logService;
        _this.rows = [];
        _this.columns = [];
        _this.visibleColumns = [];
        _this.hasFile = false;
        return _this;
    }
    DisplayValueWidget.prototype.ngOnInit = function () {
        if (this.field) {
            this.value = this.field.value;
            this.visibilityService.refreshEntityVisibility(this.field);
            if (this.field.params) {
                var originalField = this.field.params['field'];
                if (originalField && originalField.type) {
                    this.fieldType = originalField.type;
                    switch (originalField.type) {
                        case form_field_types_1.FormFieldTypes.BOOLEAN:
                            this.value = this.field.value === 'true' ? true : false;
                            break;
                        case form_field_types_1.FormFieldTypes.FUNCTIONAL_GROUP:
                            if (this.field.value) {
                                this.value = this.field.value.name;
                            }
                            else {
                                this.value = null;
                            }
                            break;
                        case form_field_types_1.FormFieldTypes.PEOPLE:
                            var model = this.field.value;
                            if (model) {
                                var displayName = model.firstName + " " + model.lastName;
                                this.value = displayName.trim();
                            }
                            break;
                        case form_field_types_1.FormFieldTypes.UPLOAD:
                            var files = this.field.value || [];
                            if (files.length > 0) {
                                this.value = decodeURI(files[0].name);
                                this.id = files[0].id;
                                this.hasFile = true;
                            }
                            else {
                                this.value = null;
                                this.hasFile = false;
                            }
                            break;
                        case form_field_types_1.FormFieldTypes.TYPEAHEAD:
                            this.loadRestFieldValue();
                            break;
                        case form_field_types_1.FormFieldTypes.DROPDOWN:
                            if (this.field.restUrl) {
                                this.loadRestFieldValue();
                            }
                            else {
                                this.value = this.field.value;
                            }
                            break;
                        case form_field_types_1.FormFieldTypes.RADIO_BUTTONS:
                            if (this.field.restUrl) {
                                this.loadRestFieldValue();
                            }
                            else {
                                this.loadRadioButtonValue();
                            }
                            break;
                        case form_field_types_1.FormFieldTypes.DATE:
                            if (this.value) {
                                var d = moment(this.value.split('T')[0], 'YYYY-M-D');
                                if (d.isValid()) {
                                    this.value = d.format('D-M-YYYY');
                                }
                            }
                            break;
                        case form_field_types_1.FormFieldTypes.AMOUNT:
                            if (this.value) {
                                var currency = this.field.currency || '$';
                                this.value = currency + " " + this.field.value;
                            }
                            break;
                        case form_field_types_1.FormFieldTypes.HYPERLINK:
                            this.linkUrl = this.getHyperlinkUrl(this.field);
                            this.linkText = this.getHyperlinkText(this.field);
                            break;
                        case form_field_types_1.FormFieldTypes.DYNAMIC_TABLE:
                            var json = this.field.json;
                            if (json.columnDefinitions) {
                                this.columns = json.columnDefinitions.map(function (obj) { return obj; });
                                this.visibleColumns = this.columns.filter(function (col) { return col.visible; });
                            }
                            if (json.value) {
                                this.rows = json.value.map(function (obj) { return ({ selected: false, value: obj }); });
                            }
                            break;
                        default:
                            this.value = this.field.value;
                            break;
                    }
                }
            }
            this.visibilityService.refreshVisibility(this.field.form);
        }
    };
    DisplayValueWidget.prototype.loadRadioButtonValue = function () {
        var _this = this;
        var options = this.field.options || [];
        var toSelect = options.find(function (item) { return item.id === _this.field.value; });
        if (toSelect) {
            this.value = toSelect.name;
        }
        else {
            this.value = this.field.value;
        }
    };
    DisplayValueWidget.prototype.loadRestFieldValue = function () {
        if (this.field.form.taskId) {
            this.getValuesByTaskId();
        }
        else {
            this.getValuesByProcessDefinitionId();
        }
    };
    DisplayValueWidget.prototype.getValuesByProcessDefinitionId = function () {
        var _this = this;
        this.formService
            .getRestFieldValuesByProcessId(this.field.form.processDefinitionId, this.field.id)
            .subscribe(function (result) {
            var options = result || [];
            var toSelect = options.find(function (item) { return item.id === _this.field.value; });
            _this.field.options = options;
            if (toSelect) {
                _this.value = toSelect.name;
            }
            else {
                _this.value = _this.field.value;
            }
            _this.visibilityService.refreshVisibility(_this.field.form);
        }, function (error) {
            _this.logService.error(error);
            _this.value = _this.field.value;
        });
    };
    DisplayValueWidget.prototype.getValuesByTaskId = function () {
        var _this = this;
        this.formService
            .getRestFieldValues(this.field.form.taskId, this.field.id)
            .subscribe(function (result) {
            var options = result || [];
            var toSelect = options.find(function (item) { return item.id === _this.field.value; });
            _this.field.options = options;
            if (toSelect) {
                _this.value = toSelect.name;
            }
            else {
                _this.value = _this.field.value;
            }
            _this.visibilityService.refreshVisibility(_this.field.form);
        }, function (error) {
            _this.logService.error(error);
            _this.value = _this.field.value;
        });
    };
    DisplayValueWidget.prototype.getCellValue = function (row, column) {
        var result = row.value[column.id];
        if (column.type === 'Dropdown') {
            if (result) {
                return result.name;
            }
        }
        if (column.type === 'Boolean') {
            return result ? true : false;
        }
        if (column.type === 'Date') {
            if (result) {
                return moment(result.split('T')[0], 'YYYY-MM-DD').format('D-M-YYYY');
            }
        }
        if (column.type === 'Amount') {
            return (column.amountCurrency || '$') + ' ' + (result || 0);
        }
        return result || '';
    };
    return DisplayValueWidget;
}(widget_component_1.WidgetComponent));
DisplayValueWidget = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'display-value-widget',
        template: "<div [ngSwitch]=\"fieldType\" class=\"display-value-widget\" *ngIf=\"field?.isVisible\">     <div *ngSwitchCase=\"'boolean'\">         <label class=\"mdl-checkbox mdl-js-checkbox\" [attr.for]=\"field.id\" >             <input type=\"checkbox\"                    [attr.id]=\"field.id\"                    [checked]=\"field.value\"                    [(ngModel)]=\"value\"                    class=\"mdl-checkbox__input\"                    disabled>             <span class=\"mdl-checkbox__label\">{{field.name}}</span>         </label>     </div>     <div *ngSwitchCase=\"'text'\"          class=\"mdl-textfield mdl-js-textfield text-widget\">         <label [attr.for]=\"field.id\">{{field.name}}</label>         <input             class=\"mdl-textfield__input\"             type=\"text\"             [attr.id]=\"field.id\"             [value]=\"value\"             disabled>     </div>     <div *ngSwitchCase=\"'multi-line-text'\"          class=\"mdl-textfield mdl-js-textfield multiline-text-widget\">         <textarea class=\"mdl-textfield__input\"                   type=\"text\"                   rows=\"3\"                   [value]=\"value\"                   [attr.id]=\"field.id\"                   disabled>         </textarea>         <label class=\"mdl-textfield__label\" [attr.for]=\"field.id\">{{field.name}}</label>     </div>     <div *ngSwitchCase=\"'hyperlink'\" class=\"hyperlink-widget\">         <div>             <div>                 <span>{{field.name}}</span>             </div>             <div>                 <a [href]=\"linkUrl\" target=\"_blank\" rel=\"nofollow\">{{linkText}}</a>             </div>         </div>     </div>     <div *ngSwitchCase=\"'dynamic-table'\">          <div class=\"display-value-widget__dynamic-table\">             <div>{{field.name}}</div>             <div class=\"display-value-dynamic-table-widget__table-container\">                 <table class=\"mdl-data-table mdl-js-data-table\">                     <thead>                     <tr>                         <th *ngFor=\"let column of visibleColumns\"                             class=\"mdl-data-table__cell--non-numeric is-disabled\">                             {{column.name}}                         </th>                     </tr>                     </thead>                     <tbody>                     <tr *ngFor=\"let row of rows\">                         <td *ngFor=\"let column of visibleColumns\"                             class=\"mdl-data-table__cell--non-numeric is-disabled\">                             {{ getCellValue(row, column) }}                         </td>                     </tr>                     </tbody>                 </table>             </div>         </div>     </div>     <div *ngSwitchCase=\"'upload'\">         <div class=\"upload-widget\">             <div>                 <label class=\"upload-widget__label\" [attr.for]=\"field.id\">{{field.name}}</label>             </div>             <div>                 <img *ngIf=\"hasFile\" class=\"img-upload-widget\" src=\"{{settingsService.bpmHost}}/activiti-app/app/rest/content/{{id}}/raw\">             </div>             <div>                 <i *ngIf=\"hasFile\" class=\"material-icons upload-widget__icon\">attachment</i>                 <span *ngIf=\"hasFile\" class=\"upload-widget__file\">{{value}}</span>             </div>         </div>     </div>     <div *ngSwitchDefault          class=\"mdl-textfield mdl-js-textfield text-widget is-disabled is-dirty is-upgraded\">         <label [attr.for]=\"field.id\">{{field.name}}</label>         <input             class=\"mdl-textfield__input\"             type=\"text\"             [attr.id]=\"field.id\"             [value]=\"value\"             disabled>     </div> </div>",
        styles: [".display-value-widget {     width: 100%; }  .display-value-widget__dynamic-table {     padding: 8px; }  .display-value-widget__dynamic-table .is-disabled {     background-color: transparent;     border-bottom: 1px dotted rgba(0, 0, 0, .12);     color: rgba(0, 0, 0, .26); }  .display-value-widget__dynamic-table table {     width: 100%; }  .display-value-dynamic-table-widget__table-container {     overflow-y: auto;     width: 100%; }   .upload-widget {     width: 100%;     word-break: break-all; }  .upload-widget__icon {     float: left;     color: rgba(0, 0, 0, .26); }  .upload-widget__file {     float: left;     margin-top: 4px;     color: rgba(0, 0, 0, .26); }  .upload-widget__label {     color: rgba(0, 0, 0, .26); }  .img-upload-widget {     width: 100px;     height: 100px;     padding: 2px;     border: 1px solid rgba(117, 117, 117, 0.57);     box-shadow: 1px 1px 2px #dddddd;     background-color: #ffffff; }"]
    }),
    __metadata("design:paramtypes", [form_service_1.FormService,
        widget_visibility_service_1.WidgetVisibilityService,
        ng2_alfresco_core_1.LogService])
], DisplayValueWidget);
exports.DisplayValueWidget = DisplayValueWidget;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvd2lkZ2V0cy9kaXNwbGF5LXZhbHVlL2Rpc3BsYXktdmFsdWUud2lkZ2V0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRzs7Ozs7Ozs7Ozs7Ozs7OztBQUVILHNDQUFrRDtBQUNsRCwrQkFBaUM7QUFDakMsdURBQStDO0FBQy9DLDBEQUF3RDtBQUN4RCw2REFBMEQ7QUFDMUQsK0RBQTZEO0FBRzdELHlGQUFzRjtBQVF0RixJQUFhLGtCQUFrQjtJQUFTLHNDQUFlO0lBa0JuRCw0QkFBb0IsV0FBd0IsRUFDeEIsaUJBQTBDLEVBQzFDLFVBQXNCO1FBRjFDLFlBR0ksaUJBQU8sU0FDVjtRQUptQixpQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN4Qix1QkFBaUIsR0FBakIsaUJBQWlCLENBQXlCO1FBQzFDLGdCQUFVLEdBQVYsVUFBVSxDQUFZO1FBVDFDLFVBQUksR0FBc0IsRUFBRSxDQUFDO1FBQzdCLGFBQU8sR0FBeUIsRUFBRSxDQUFDO1FBQ25DLG9CQUFjLEdBQXlCLEVBQUUsQ0FBQztRQUcxQyxhQUFPLEdBQVksS0FBSyxDQUFDOztJQU16QixDQUFDO0lBRUQscUNBQVEsR0FBUjtRQUNJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ2IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQztZQUM5QixJQUFJLENBQUMsaUJBQWlCLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzNELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDcEIsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQy9DLEVBQUUsQ0FBQyxDQUFDLGFBQWEsSUFBSSxhQUFhLENBQUMsSUFBSSxD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TUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2hFLENBQUM7UUFFRCxNQUFNLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQztJQUN4QixDQUFDO0lBQ0wseUJBQUM7QUFBRCxDQS9NQSxBQStNQyxDQS9NdUMsa0NBQWUsR0ErTXREO0FBL01ZLGtCQUFrQjtJQU45QixnQkFBUyxDQUFDO1FBQ1AsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1FBQ25CLFFBQVEsRUFBRSxzQkFBc0I7UUFDaEMsUUFBUSxFQUFFLHNxSEFBc3FIO1FBQ2hySCxNQUFNLEVBQUUsQ0FBQyw2NUJBQTY1QixDQUFDO0tBQzE2QixDQUFDO3FDQW1CbUMsMEJBQVc7UUFDTCxtREFBdUI7UUFDOUIsOEJBQVU7R0FwQmpDLGtCQUFrQixDQStNOUI7QUEvTVksZ0RBQWtCIiwiZmlsZSI6ImNvbXBvbmVudHMvd2lkZ2V0cy9kaXNwbGF5LXZhbHVlL2Rpc3BsYXktdmFsdWUud2lkZ2V0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCAqIGFzIG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHsgTG9nU2VydmljZSB9IGZyb20gJ25nMi1hbGZyZXNjby1jb3JlJztcbmltcG9ydCB7IFdpZGdldENvbXBvbmVudCB9IGZyb20gJy4vLi4vd2lkZ2V0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBGb3JtRmllbGRUeXBlcyB9IGZyb20gJy4uL2NvcmUvZm9ybS1maWVsZC10eXBlcyc7XG5pbXBvcnQgeyBGb3JtU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL2Zvcm0uc2VydmljZSc7XG5pbXBvcnQgeyBGb3JtRmllbGRPcHRpb24gfSBmcm9tICcuLy4uL2NvcmUvZm9ybS1maWVsZC1vcHRpb24nO1xuaW1wb3J0IHsgRHluYW1pY1RhYmxlQ29sdW1uLCBEeW5hbWljVGFibGVSb3cgfSBmcm9tICcuLy4uL2R5bmFtaWMtdGFibGUvZHluYW1pYy10YWJsZS53aWRnZXQubW9kZWwnO1xuaW1wb3J0IHsgV2lkZ2V0VmlzaWJpbGl0eVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy93aWRnZXQtdmlzaWJpbGl0eS5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICBzZWxlY3RvcjogJ2Rpc3BsYXktdmFsdWUtd2lkZ2V0JyxcbiAgICB0ZW1wbGF0ZTogXCI8ZGl2IFtuZ1N3aXRjaF09XFxcImZpZWxkVHlwZVxcXCIgY2xhc3M9XFxcImRpc3BsYXktdmFsdWUtd2lkZ2V0XFxcIiAqbmdJZj1cXFwiZmllbGQ/LmlzVmlzaWJsZVxcXCI+ICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidib29sZWFuJ1xcXCI+ICAgICAgICAgPGxhYmVsIGNsYXNzPVxcXCJtZGwtY2hlY2tib3ggbWRsLWpzLWNoZWNrYm94XFxcIiBbYXR0ci5mb3JdPVxcXCJmaWVsZC5pZFxcXCIgPiAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cXFwiY2hlY2tib3hcXFwiICAgICAgICAgICAgICAgICAgICBbYXR0ci5pZF09XFxcImZpZWxkLmlkXFxcIiAgICAgICAgICAgICAgICAgICAgW2NoZWNrZWRdPVxcXCJmaWVsZC52YWx1ZVxcXCIgICAgICAgICAgICAgICAgICAgIFsobmdNb2RlbCldPVxcXCJ2YWx1ZVxcXCIgICAgICAgICAgICAgICAgICAgIGNsYXNzPVxcXCJtZGwtY2hlY2tib3hfX2lucHV0XFxcIiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ+ICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJtZGwtY2hlY2tib3hfX2xhYmVsXFxcIj57e2ZpZWxkLm5hbWV9fTwvc3Bhbj4gICAgICAgICA8L2xhYmVsPiAgICAgPC9kaXY+ICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIid0ZXh0J1xcXCIgICAgICAgICAgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGQgbWRsLWpzLXRleHRmaWVsZCB0ZXh0LXdpZGdldFxcXCI+ICAgICAgICAgPGxhYmVsIFthdHRyLmZvcl09XFxcImZpZWxkLmlkXFxcIj57e2ZpZWxkLm5hbWV9fTwvbGFiZWw+ICAgICAgICAgPGlucHV0ICAgICAgICAgICAgIGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkX19pbnB1dFxcXCIgICAgICAgICAgICAgdHlwZT1cXFwidGV4dFxcXCIgICAgICAgICAgICAgW2F0dHIuaWRdPVxcXCJmaWVsZC5pZFxcXCIgICAgICAgICAgICAgW3ZhbHVlXT1cXFwidmFsdWVcXFwiICAgICAgICAgICAgIGRpc2FibGVkPiAgICAgPC9kaXY+ICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidtdWx0aS1saW5lLXRleHQnXFxcIiAgICAgICAgICBjbGFzcz1cXFwibWRsLXRleHRmaWVsZCBtZGwtanMtdGV4dGZpZWxkIG11bHRpbGluZS10ZXh0LXdpZGdldFxcXCI+ICAgICAgICAgPHRleHRhcmVhIGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkX19pbnB1dFxcXCIgICAgICAgICAgICAgICAgICAgdHlwZT1cXFwidGV4dFxcXCIgICAgICAgICAgICAgICAgICAgcm93cz1cXFwiM1xcXCIgICAgICAgICAgICAgICAgICAgW3ZhbHVlXT1cXFwidmFsdWVcXFwiICAgICAgICAgICAgICAgICAgIFthdHRyLmlkXT1cXFwiZmllbGQuaWRcXFwiICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPiAgICAgICAgIDwvdGV4dGFyZWE+ICAgICAgICAgPGxhYmVsIGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkX19sYWJlbFxcXCIgW2F0dHIuZm9yXT1cXFwiZmllbGQuaWRcXFwiPnt7ZmllbGQubmFtZX19PC9sYWJlbD4gICAgIDwvZGl2PiAgICAgPGRpdiAqbmdTd2l0Y2hDYXNlPVxcXCInaHlwZXJsaW5rJ1xcXCIgY2xhc3M9XFxcImh5cGVybGluay13aWRnZXRcXFwiPiAgICAgICAgIDxkaXY+ICAgICAgICAgICAgIDxkaXY+ICAgICAgICAgICAgICAgICA8c3Bhbj57e2ZpZWxkLm5hbWV9fTwvc3Bhbj4gICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgIDxkaXY+ICAgICAgICAgICAgICAgICA8YSBbaHJlZl09XFxcImxpbmtVcmxcXFwiIHRhcmdldD1cXFwiX2JsYW5rXFxcIiByZWw9XFxcIm5vZm9sbG93XFxcIj57e2xpbmtUZXh0fX08L2E+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgIDwvZGl2PiAgICAgPC9kaXY+ICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidkeW5hbWljLXRhYmxlJ1xcXCI+ICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImRpc3BsYXktdmFsdWUtd2lkZ2V0X19keW5hbWljLXRhYmxlXFxcIj4gICAgICAgICAgICAgPGRpdj57e2ZpZWxkLm5hbWV9fTwvZGl2PiAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJkaXNwbGF5LXZhbHVlLWR5bmFtaWMtdGFibGUtd2lkZ2V0X190YWJsZS1jb250YWluZXJcXFwiPiAgICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPVxcXCJtZGwtZGF0YS10YWJsZSBtZGwtanMtZGF0YS10YWJsZVxcXCI+ICAgICAgICAgICAgICAgICAgICAgPHRoZWFkPiAgICAgICAgICAgICAgICAgICAgIDx0cj4gICAgICAgICAgICAgICAgICAgICAgICAgPHRoICpuZ0Zvcj1cXFwibGV0IGNvbHVtbiBvZiB2aXNpYmxlQ29sdW1uc1xcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVxcXCJtZGwtZGF0YS10YWJsZV9fY2VsbC0tbm9uLW51bWVyaWMgaXMtZGlzYWJsZWRcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3tjb2x1bW4ubmFtZX19ICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGg+ICAgICAgICAgICAgICAgICAgICAgPC90cj4gICAgICAgICAgICAgICAgICAgICA8L3RoZWFkPiAgICAgICAgICAgICAgICAgICAgIDx0Ym9keT4gICAgICAgICAgICAgICAgICAgICA8dHIgKm5nRm9yPVxcXCJsZXQgcm93IG9mIHJvd3NcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgKm5nRm9yPVxcXCJsZXQgY29sdW1uIG9mIHZpc2libGVDb2x1bW5zXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9XFxcIm1kbC1kYXRhLXRhYmxlX19jZWxsLS1ub24tbnVtZXJpYyBpcy1kaXNhYmxlZFxcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBnZXRDZWxsVmFsdWUocm93LCBjb2x1bW4pIH19ICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+ICAgICAgICAgICAgICAgICAgICAgPC90cj4gICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PiAgICAgICAgICAgICAgICAgPC90YWJsZT4gICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgPC9kaXY+ICAgICA8L2Rpdj4gICAgIDxkaXYgKm5nU3dpdGNoQ2FzZT1cXFwiJ3VwbG9hZCdcXFwiPiAgICAgICAgIDxkaXYgY2xhc3M9XFxcInVwbG9hZC13aWRnZXRcXFwiPiAgICAgICAgICAgICA8ZGl2PiAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPVxcXCJ1cGxvYWQtd2lkZ2V0X19sYWJlbFxcXCIgW2F0dHIuZm9yXT1cXFwiZmllbGQuaWRcXFwiPnt7ZmllbGQubmFtZX19PC9sYWJlbD4gICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgIDxkaXY+ICAgICAgICAgICAgICAgICA8aW1nICpuZ0lmPVxcXCJoYXNGaWxlXFxcIiBjbGFzcz1cXFwiaW1nLXVwbG9hZC13aWRnZXRcXFwiIHNyYz1cXFwie3tzZXR0aW5nc1NlcnZpY2UuYnBtSG9zdH19L2FjdGl2aXRpLWFwcC9hcHAvcmVzdC9jb250ZW50L3t7aWR9fS9yYXdcXFwiPiAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgPGRpdj4gICAgICAgICAgICAgICAgIDxpICpuZ0lmPVxcXCJoYXNGaWxlXFxcIiBjbGFzcz1cXFwibWF0ZXJpYWwtaWNvbnMgdXBsb2FkLXdpZGdldF9faWNvblxcXCI+YXR0YWNobWVudDwvaT4gICAgICAgICAgICAgICAgIDxzcGFuICpuZ0lmPVxcXCJoYXNGaWxlXFxcIiBjbGFzcz1cXFwidXBsb2FkLXdpZGdldF9fZmlsZVxcXCI+e3t2YWx1ZX19PC9zcGFuPiAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICA8L2Rpdj4gICAgIDwvZGl2PiAgICAgPGRpdiAqbmdTd2l0Y2hEZWZhdWx0ICAgICAgICAgIGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkIG1kbC1qcy10ZXh0ZmllbGQgdGV4dC13aWRnZXQgaXMtZGlzYWJsZWQgaXMtZGlydHkgaXMtdXBncmFkZWRcXFwiPiAgICAgICAgIDxsYWJlbCBbYXR0ci5mb3JdPVxcXCJmaWVsZC5pZFxcXCI+e3tmaWVsZC5uYW1lfX08L2xhYmVsPiAgICAgICAgIDxpbnB1dCAgICAgICAgICAgICBjbGFzcz1cXFwibWRsLXRleHRmaWVsZF9faW5wdXRcXFwiICAgICAgICAgICAgIHR5cGU9XFxcInRleHRcXFwiICAgICAgICAgICAgIFthdHRyLmlkXT1cXFwiZmllbGQuaWRcXFwiICAgICAgICAgICAgIFt2YWx1ZV09XFxcInZhbHVlXFxcIiAgICAgICAgICAgICBkaXNhYmxlZD4gICAgIDwvZGl2PiA8L2Rpdj5cIixcbiAgICBzdHlsZXM6IFtcIi5kaXNwbGF5LXZhbHVlLXdpZGdldCB7ICAgICB3aWR0aDogMTAwJTsgfSAgLmRpc3BsYXktdmFsdWUtd2lkZ2V0X19keW5hbWljLXRhYmxlIHsgICAgIHBhZGRpbmc6IDhweDsgfSAgLmRpc3BsYXktdmFsdWUtd2lkZ2V0X19keW5hbWljLXRhYmxlIC5pcy1kaXNhYmxlZCB7ICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsgICAgIGJvcmRlci1ib3R0b206IDFweCBkb3R0ZWQgcmdiYSgwLCAwLCAwLCAuMTIpOyAgICAgY29sb3I6IHJnYmEoMCwgMCwgMCwgLjI2KTsgfSAgLmRpc3BsYXktdmFsdWUtd2lkZ2V0X19keW5hbWljLXRhYmxlIHRhYmxlIHsgICAgIHdpZHRoOiAxMDAlOyB9ICAuZGlzcGxheS12YWx1ZS1keW5hbWljLXRhYmxlLXdpZGdldF9fdGFibGUtY29udGFpbmVyIHsgICAgIG92ZXJmbG93LXk6IGF1dG87ICAgICB3aWR0aDogMTAwJTsgfSAgIC51cGxvYWQtd2lkZ2V0IHsgICAgIHdpZHRoOiAxMDAlOyAgICAgd29yZC1icmVhazogYnJlYWstYWxsOyB9ICAudXBsb2FkLXdpZGdldF9faWNvbiB7ICAgICBmbG9hdDogbGVmdDsgICAgIGNvbG9yOiByZ2JhKDAsIDAsIDAsIC4yNik7IH0gIC51cGxvYWQtd2lkZ2V0X19maWxlIHsgICAgIGZsb2F0OiBsZWZ0OyAgICAgbWFyZ2luLXRvcDogNHB4OyAgICAgY29sb3I6IHJnYmEoMCwgMCwgMCwgLjI2KTsgfSAgLnVwbG9hZC13aWRnZXRfX2xhYmVsIHsgICAgIGNvbG9yOiByZ2JhKDAsIDAsIDAsIC4yNik7IH0gIC5pbWctdXBsb2FkLXdpZGdldCB7ICAgICB3aWR0aDogMTAwcHg7ICAgICBoZWlnaHQ6IDEwMHB4OyAgICAgcGFkZGluZzogMnB4OyAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgxMTcsIDExNywgMTE3LCAwLjU3KTsgICAgIGJveC1zaGFkb3c6IDFweCAxcHggMnB4ICNkZGRkZGQ7ICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmZmZmOyB9XCJdXG59KVxuZXhwb3J0IGNsYXNzIERpc3BsYXlWYWx1ZVdpZGdldCBleHRlbmRzIFdpZGdldENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICB2YWx1ZTogYW55O1xuICAgIGZpZWxkVHlwZTogc3RyaW5nO1xuICAgIGlkOiBhbnk7XG5cbiAgICAvLyBoeXBlcmxpbmtcbiAgICBsaW5rVXJsOiBzdHJpbmc7XG4gICAgbGlua1RleHQ6IHN0cmluZztcblxuICAgIC8vIGR5bmFtaWMgdGFibGVcbiAgICByb3dzOiBEeW5hbWljVGFibGVSb3dbXSA9IFtdO1xuICAgIGNvbHVtbnM6IER5bmFtaWNUYWJsZUNvbHVtbltdID0gW107XG4gICAgdmlzaWJsZUNvbHVtbnM6IER5bmFtaWNUYWJsZUNvbHVtbltdID0gW107XG5cbiAgICAvLyB1cGxvYWQvYXR0YWNoXG4gICAgaGFzRmlsZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBmb3JtU2VydmljZTogRm9ybVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB2aXNpYmlsaXR5U2VydmljZTogV2lkZ2V0VmlzaWJpbGl0eVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIGlmICh0aGlzLmZpZWxkKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5maWVsZC52YWx1ZTtcbiAgICAgICAgICAgIHRoaXMudmlzaWJpbGl0eVNlcnZpY2UucmVmcmVzaEVudGl0eVZpc2liaWxpdHkodGhpcy5maWVsZCk7XG4gICAgICAgICAgICBpZiAodGhpcy5maWVsZC5wYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBsZXQgb3JpZ2luYWxGaWVsZCA9IHRoaXMuZmllbGQucGFyYW1zWydmaWVsZCddO1xuICAgICAgICAgICAgICAgIGlmIChvcmlnaW5hbEZpZWxkICYmIG9yaWdpbmFsRmllbGQudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkVHlwZSA9IG9yaWdpbmFsRmllbGQudHlwZTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChvcmlnaW5hbEZpZWxkLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRm9ybUZpZWxkVHlwZXMuQk9PTEVBTjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5maWVsZC52YWx1ZSA9PT0gJ3RydWUnID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBGb3JtRmllbGRUeXBlcy5GVU5DVElPTkFMX0dST1VQOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpZWxkLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLmZpZWxkLnZhbHVlLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBGb3JtRmllbGRUeXBlcy5QRU9QTEU6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1vZGVsID0gdGhpcy5maWVsZC52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRpc3BsYXlOYW1lID0gYCR7bW9kZWwuZmlyc3ROYW1lfSAke21vZGVsLmxhc3ROYW1lfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSBkaXNwbGF5TmFtZS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBGb3JtRmllbGRUeXBlcy5VUExPQUQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZpbGVzID0gdGhpcy5maWVsZC52YWx1ZSB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gZGVjb2RlVVJJKGZpbGVzWzBdLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlkID0gZmlsZXNbMF0uaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzRmlsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzRmlsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRm9ybUZpZWxkVHlwZXMuVFlQRUFIRUFEOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZFJlc3RGaWVsZFZhbHVlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEZvcm1GaWVsZFR5cGVzLkRST1BET1dOOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpZWxkLnJlc3RVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkUmVzdEZpZWxkVmFsdWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5maWVsZC52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEZvcm1GaWVsZFR5cGVzLlJBRElPX0JVVFRPTlM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmllbGQucmVzdFVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRSZXN0RmllbGRWYWx1ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZFJhZGlvQnV0dG9uVmFsdWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEZvcm1GaWVsZFR5cGVzLkRBVEU6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGQgPSBtb21lbnQodGhpcy52YWx1ZS5zcGxpdCgnVCcpWzBdLCAnWVlZWS1NLUQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gZC5mb3JtYXQoJ0QtTS1ZWVlZJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEZvcm1GaWVsZFR5cGVzLkFNT1VOVDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVuY3kgPSB0aGlzLmZpZWxkLmN1cnJlbmN5IHx8ICckJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IGAke2N1cnJlbmN5fSAke3RoaXMuZmllbGQudmFsdWV9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEZvcm1GaWVsZFR5cGVzLkhZUEVSTElOSzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxpbmtVcmwgPSB0aGlzLmdldEh5cGVybGlua1VybCh0aGlzLmZpZWxkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxpbmtUZXh0ID0gdGhpcy5nZXRIeXBlcmxpbmtUZXh0KHRoaXMuZmllbGQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBGb3JtRmllbGRUeXBlcy5EWU5BTUlDX1RBQkxFOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBqc29uID0gdGhpcy5maWVsZC5qc29uO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqc29uLmNvbHVtbkRlZmluaXRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sdW1ucyA9IGpzb24uY29sdW1uRGVmaW5pdGlvbnMubWFwKG9iaiA9PiA8RHluYW1pY1RhYmxlQ29sdW1uPiBvYmopO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpc2libGVDb2x1bW5zID0gdGhpcy5jb2x1bW5zLmZpbHRlcihjb2wgPT4gY29sLnZpc2libGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoanNvbi52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd3MgPSBqc29uLnZhbHVlLm1hcChvYmogPT4gPER5bmFtaWNUYWJsZVJvdz4ge3NlbGVjdGVkOiBmYWxzZSwgdmFsdWU6IG9ian0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuZmllbGQudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnZpc2liaWxpdHlTZXJ2aWNlLnJlZnJlc2hWaXNpYmlsaXR5KHRoaXMuZmllbGQuZm9ybSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkUmFkaW9CdXR0b25WYWx1ZSgpIHtcbiAgICAgICAgbGV0IG9wdGlvbnMgPSB0aGlzLmZpZWxkLm9wdGlvbnMgfHwgW107XG4gICAgICAgIGxldCB0b1NlbGVjdCA9IG9wdGlvbnMuZmluZChpdGVtID0+IGl0ZW0uaWQgPT09IHRoaXMuZmllbGQudmFsdWUpO1xuICAgICAgICBpZiAodG9TZWxlY3QpIHtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0b1NlbGVjdC5uYW1lO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuZmllbGQudmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkUmVzdEZpZWxkVmFsdWUoKSB7XG4gICAgICAgIGlmICh0aGlzLmZpZWxkLmZvcm0udGFza0lkKSB7XG4gICAgICAgICAgICB0aGlzLmdldFZhbHVlc0J5VGFza0lkKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmdldFZhbHVlc0J5UHJvY2Vzc0RlZmluaXRpb25JZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0VmFsdWVzQnlQcm9jZXNzRGVmaW5pdGlvbklkKCkge1xuICAgICAgICB0aGlzLmZvcm1TZXJ2aWNlXG4gICAgICAgICAgICAuZ2V0UmVzdEZpZWxkVmFsdWVzQnlQcm9jZXNzSWQoXG4gICAgICAgICAgICAgICAgdGhpcy5maWVsZC5mb3JtLnByb2Nlc3NEZWZpbml0aW9uSWQsXG4gICAgICAgICAgICAgICAgdGhpcy5maWVsZC5pZFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAocmVzdWx0OiBGb3JtRmllbGRPcHRpb25bXSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgb3B0aW9ucyA9IHJlc3VsdCB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHRvU2VsZWN0ID0gb3B0aW9ucy5maW5kKGl0ZW0gPT4gaXRlbS5pZCA9PT0gdGhpcy5maWVsZC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGQub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0b1NlbGVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRvU2VsZWN0Lm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5maWVsZC52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpc2liaWxpdHlTZXJ2aWNlLnJlZnJlc2hWaXNpYmlsaXR5KHRoaXMuZmllbGQuZm9ybSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLmZpZWxkLnZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgZ2V0VmFsdWVzQnlUYXNrSWQoKSB7XG4gICAgICAgIHRoaXMuZm9ybVNlcnZpY2VcbiAgICAgICAgICAgIC5nZXRSZXN0RmllbGRWYWx1ZXModGhpcy5maWVsZC5mb3JtLnRhc2tJZCwgdGhpcy5maWVsZC5pZClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHJlc3VsdDogRm9ybUZpZWxkT3B0aW9uW10pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG9wdGlvbnMgPSByZXN1bHQgfHwgW107XG4gICAgICAgICAgICAgICAgICAgIGxldCB0b1NlbGVjdCA9IG9wdGlvbnMuZmluZChpdGVtID0+IGl0ZW0uaWQgPT09IHRoaXMuZmllbGQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICAgICAgICAgICAgICBpZiAodG9TZWxlY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0b1NlbGVjdC5uYW1lO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuZmllbGQudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aXNpYmlsaXR5U2VydmljZS5yZWZyZXNoVmlzaWJpbGl0eSh0aGlzLmZpZWxkLmZvcm0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5maWVsZC52YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIGdldENlbGxWYWx1ZShyb3c6IER5bmFtaWNUYWJsZVJvdywgY29sdW1uOiBEeW5hbWljVGFibGVDb2x1bW4pOiBhbnkge1xuXG4gICAgICAgIGxldCByZXN1bHQgPSByb3cudmFsdWVbY29sdW1uLmlkXTtcblxuICAgICAgICBpZiAoY29sdW1uLnR5cGUgPT09ICdEcm9wZG93bicpIHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lm5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29sdW1uLnR5cGUgPT09ICdCb29sZWFuJykge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb2x1bW4udHlwZSA9PT0gJ0RhdGUnKSB7XG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudChyZXN1bHQuc3BsaXQoJ1QnKVswXSwgJ1lZWVktTU0tREQnKS5mb3JtYXQoJ0QtTS1ZWVlZJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29sdW1uLnR5cGUgPT09ICdBbW91bnQnKSB7XG4gICAgICAgICAgICByZXR1cm4gKGNvbHVtbi5hbW91bnRDdXJyZW5jeSB8fCAnJCcpICsgJyAnICsgKHJlc3VsdCB8fCAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQgfHwgJyc7XG4gICAgfVxufVxuIl19
