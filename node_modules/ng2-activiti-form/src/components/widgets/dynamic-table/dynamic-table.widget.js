/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var widget_component_1 = require("./../widget.component");
var dynamic_table_widget_model_1 = require("./dynamic-table.widget.model");
var widget_visibility_service_1 = require("../../../services/widget-visibility.service");
var DynamicTableWidget = (function (_super) {
    __extends(DynamicTableWidget, _super);
    function DynamicTableWidget(elementRef, visibilityService, logService) {
        var _this = _super.call(this) || this;
        _this.elementRef = elementRef;
        _this.visibilityService = visibilityService;
        _this.logService = logService;
        _this.ERROR_MODEL_NOT_FOUND = 'Table model not found';
        _this.editMode = false;
        _this.editRow = null;
        return _this;
    }
    DynamicTableWidget.prototype.ngOnInit = function () {
        if (this.field) {
            this.content = new dynamic_table_widget_model_1.DynamicTableModel(this.field.form, this.field.json);
            this.visibilityService.refreshVisibility(this.field.form);
        }
    };
    DynamicTableWidget.prototype.isValid = function () {
        var result = true;
        if (this.content && this.content.field) {
            result = this.content.field.isValid;
        }
        return result;
    };
    DynamicTableWidget.prototype.onRowClicked = function (row) {
        if (this.content) {
            this.content.selectedRow = row;
        }
    };
    DynamicTableWidget.prototype.hasSelection = function () {
        return !!(this.content && this.content.selectedRow);
    };
    DynamicTableWidget.prototype.moveSelectionUp = function () {
        if (this.content) {
            this.content.moveRow(this.content.selectedRow, -1);
            return true;
        }
        return false;
    };
    DynamicTableWidget.prototype.moveSelectionDown = function () {
        if (this.content) {
            this.content.moveRow(this.content.selectedRow, 1);
            return true;
        }
        return false;
    };
    DynamicTableWidget.prototype.deleteSelection = function () {
        if (this.content) {
            this.content.deleteRow(this.content.selectedRow);
            return true;
        }
        return false;
    };
    DynamicTableWidget.prototype.addNewRow = function () {
        if (this.content) {
            this.editRow = {
                isNew: true,
                selected: false,
                value: {}
            };
            this.editMode = true;
            return true;
        }
        return false;
    };
    DynamicTableWidget.prototype.editSelection = function () {
        if (this.content) {
            this.editRow = this.copyRow(this.content.selectedRow);
            this.editMode = true;
            return true;
        }
        return false;
    };
    DynamicTableWidget.prototype.getCellValue = function (row, column) {
        if (this.content) {
            var result = this.content.getCellValue(row, column);
            if (column.type === 'Amount') {
                return (column.amountCurrency || '$') + ' ' + (result || 0);
            }
            return result;
        }
        return null;
    };
    DynamicTableWidget.prototype.onSaveChanges = function () {
        if (this.content) {
            if (this.editRow.isNew) {
                var row = this.copyRow(this.editRow);
                this.content.selectedRow = null;
                this.content.addRow(row);
                this.editRow.isNew = false;
            }
            else {
                this.content.selectedRow.value = this.copyObject(this.editRow.value);
            }
            this.content.flushValue();
        }
        else {
            this.logService.error(this.ERROR_MODEL_NOT_FOUND);
        }
        this.editMode = false;
    };
    DynamicTableWidget.prototype.onCancelChanges = function () {
        this.editMode = false;
        this.editRow = null;
    };
    DynamicTableWidget.prototype.copyRow = function (row) {
        return {
            value: this.copyObject(row.value)
        };
    };
    DynamicTableWidget.prototype.copyObject = function (obj) {
        var _this = this;
        var result = obj;
        if (typeof obj === 'object' && obj !== null && obj !== undefined) {
            result = Object.assign({}, obj);
            Object.keys(obj).forEach(function (key) {
                if (typeof obj[key] === 'object') {
                    result[key] = _this.copyObject(obj[key]);
                }
            });
        }
        return result;
    };
    return DynamicTableWidget;
}(widget_component_1.WidgetComponent));
DynamicTableWidget = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'dynamic-table-widget',
        template: "<div class=\"dynamic-table-widget\"     [class.dynamic-table-widget__invalid]=\"!isValid()\" *ngIf=\"field?.isVisible\">      <div class=\"dynamic-table-widget__label\">{{content.name}}</div>       <div *ngIf=\"!editMode\">          <div class=\"dynamic-table-widget__table-container\">             <table class=\"mdl-data-table mdl-js-data-table dynamic-table-widget__table\">                 <thead>                     <tr>                         <th *ngFor=\"let column of content.visibleColumns\"                             class=\"mdl-data-table__cell--non-numeric\">                             {{column.name}}                         </th>                     </tr>                 </thead>                 <tbody>                     <tr *ngFor=\"let row of content.rows\"                         [class.dynamic-table-widget__row-selected]=\"row.selected\">                         <td *ngFor=\"let column of content.visibleColumns\"                             class=\"mdl-data-table__cell--non-numeric\"                             (click)=\"onRowClicked(row)\">                             {{ getCellValue(row, column) }}                         </td>                     </tr>                 </tbody>             </table>          </div>          <div class=\"dynamic-table-widget__buttons\">             <button class=\"mdl-button mdl-js-button mdl-button--icon\"                     [disabled]=\"!hasSelection()\"                     (click)=\"moveSelectionUp()\">                 <i class=\"material-icons\">arrow_upward</i>             </button>             <button class=\"mdl-button mdl-js-button mdl-button--icon\"                     [disabled]=\"!hasSelection()\"                     (click)=\"moveSelectionDown()\">                 <i class=\"material-icons\">arrow_downward</i>             </button>             <button class=\"mdl-button mdl-js-button mdl-button--icon\"                     (click)=\"addNewRow()\">                 <i class=\"material-icons\">add_circle_outline</i>             </button>             <button class=\"mdl-button mdl-js-button mdl-button--icon\"                     [disabled]=\"!hasSelection()\"                     (click)=\"deleteSelection()\">                 <i class=\"material-icons\">remove_circle_outline</i>             </button>             <button class=\"mdl-button mdl-js-button mdl-button--icon\"                     [disabled]=\"!hasSelection()\"                     (click)=\"editSelection()\">                 <i class=\"material-icons\">edit</i>             </button>         </div>      </div>       <row-editor *ngIf=\"editMode\"         [table]=\"content\"         [row]=\"editRow\"         [column]=\"column\"         (save)=\"onSaveChanges()\"         (cancel)=\"onCancelChanges()\">      </row-editor>       <div class=\"dynamic-table-widget__summary\">{{content?.field.validationSummary}}</div>  </div>",
        styles: [".dynamic-table-widget {     padding: 8px; }  .dynamic-table-widget__buttons {     margin-top: 10px; }  .dynamic-table-widget__row-selected, .dynamic-table-widget__row-selected:hover {     background-color: #eef !important; }  .dynamic-table-widget__table-container {     overflow-y: auto;     width: 100%; }  .dynamic-table-widget__table {     width: 100%; }  .dynamic-table-widget__invalid .dynamic-table-widget__label {     color: #d50000; }  .dynamic-table-widget__invalid .dynamic-table-widget__table-container {     border: 1px solid #d50000; }  .dynamic-table-widget__invalid .dynamic-table-widget__table {     border: none; }  .dynamic-table-widget__summary {     visibility: hidden;     color: #d50000; }  .dynamic-table-widget__invalid .dynamic-table-widget__summary {     visibility: visible !important; }"]
    }),
    __metadata("design:paramtypes", [core_1.ElementRef,
        widget_visibility_service_1.WidgetVisibilityService,
        ng2_alfresco_core_1.LogService])
], DynamicTableWidget);
exports.DynamicTableWidget = DynamicTableWidget;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvd2lkZ2V0cy9keW5hbWljLXRhYmxlL2R5bmFtaWMtdGFibGUud2lkZ2V0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRzs7Ozs7Ozs7Ozs7Ozs7OztBQUVILHNDQUE4RDtBQUM5RCx1REFBK0M7QUFDL0MsMERBQXdEO0FBQ3hELDJFQUFzRztBQUN0Ryx5RkFBc0Y7QUFRdEYsSUFBYSxrQkFBa0I7SUFBUyxzQ0FBZTtJQVNuRCw0QkFBb0IsVUFBc0IsRUFDdEIsaUJBQTBDLEVBQzFDLFVBQXNCO1FBRjFDLFlBR0ksaUJBQU8sU0FDVjtRQUptQixnQkFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0Qix1QkFBaUIsR0FBakIsaUJBQWlCLENBQXlCO1FBQzFDLGdCQUFVLEdBQVYsVUFBVSxDQUFZO1FBVDFDLDJCQUFxQixHQUFHLHVCQUF1QixDQUFDO1FBSWhELGNBQVEsR0FBWSxLQUFLLENBQUM7UUFDMUIsYUFBTyxHQUFvQixJQUFJLENBQUM7O0lBTWhDLENBQUM7SUFFRCxxQ0FBUSxHQUFSO1FBQ0ksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDYixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksOENBQWlCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN2RSxJQUFJLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5RCxDQUFDO0lBQ0wsQ0FBQztJQUVELG9DQUFPLEdBQVA7UUFDSSxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFFbEIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDckMsTUFBTSxHQUFHLElB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O0FBN0lZLGdEQUFrQiIsImZpbGUiOiJjb21wb25lbnRzL3dpZGdldHMvZHluYW1pYy10YWJsZS9keW5hbWljLXRhYmxlLndpZGdldC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBMb2dTZXJ2aWNlIH0gZnJvbSAnbmcyLWFsZnJlc2NvLWNvcmUnO1xuaW1wb3J0IHsgV2lkZ2V0Q29tcG9uZW50IH0gZnJvbSAnLi8uLi93aWRnZXQuY29tcG9uZW50JztcbmltcG9ydCB7IER5bmFtaWNUYWJsZU1vZGVsLCBEeW5hbWljVGFibGVSb3csIER5bmFtaWNUYWJsZUNvbHVtbiB9IGZyb20gJy4vZHluYW1pYy10YWJsZS53aWRnZXQubW9kZWwnO1xuaW1wb3J0IHsgV2lkZ2V0VmlzaWJpbGl0eVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy93aWRnZXQtdmlzaWJpbGl0eS5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICBzZWxlY3RvcjogJ2R5bmFtaWMtdGFibGUtd2lkZ2V0JyxcbiAgICB0ZW1wbGF0ZTogXCI8ZGl2IGNsYXNzPVxcXCJkeW5hbWljLXRhYmxlLXdpZGdldFxcXCIgICAgIFtjbGFzcy5keW5hbWljLXRhYmxlLXdpZGdldF9faW52YWxpZF09XFxcIiFpc1ZhbGlkKClcXFwiICpuZ0lmPVxcXCJmaWVsZD8uaXNWaXNpYmxlXFxcIj4gICAgICA8ZGl2IGNsYXNzPVxcXCJkeW5hbWljLXRhYmxlLXdpZGdldF9fbGFiZWxcXFwiPnt7Y29udGVudC5uYW1lfX08L2Rpdj4gICAgICAgPGRpdiAqbmdJZj1cXFwiIWVkaXRNb2RlXFxcIj4gICAgICAgICAgPGRpdiBjbGFzcz1cXFwiZHluYW1pYy10YWJsZS13aWRnZXRfX3RhYmxlLWNvbnRhaW5lclxcXCI+ICAgICAgICAgICAgIDx0YWJsZSBjbGFzcz1cXFwibWRsLWRhdGEtdGFibGUgbWRsLWpzLWRhdGEtdGFibGUgZHluYW1pYy10YWJsZS13aWRnZXRfX3RhYmxlXFxcIj4gICAgICAgICAgICAgICAgIDx0aGVhZD4gICAgICAgICAgICAgICAgICAgICA8dHI+ICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCAqbmdGb3I9XFxcImxldCBjb2x1bW4gb2YgY29udGVudC52aXNpYmxlQ29sdW1uc1xcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVxcXCJtZGwtZGF0YS10YWJsZV9fY2VsbC0tbm9uLW51bWVyaWNcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3tjb2x1bW4ubmFtZX19ICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGg+ICAgICAgICAgICAgICAgICAgICAgPC90cj4gICAgICAgICAgICAgICAgIDwvdGhlYWQ+ICAgICAgICAgICAgICAgICA8dGJvZHk+ICAgICAgICAgICAgICAgICAgICAgPHRyICpuZ0Zvcj1cXFwibGV0IHJvdyBvZiBjb250ZW50LnJvd3NcXFwiICAgICAgICAgICAgICAgICAgICAgICAgIFtjbGFzcy5keW5hbWljLXRhYmxlLXdpZGdldF9fcm93LXNlbGVjdGVkXT1cXFwicm93LnNlbGVjdGVkXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgPHRkICpuZ0Zvcj1cXFwibGV0IGNvbHVtbiBvZiBjb250ZW50LnZpc2libGVDb2x1bW5zXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9XFxcIm1kbC1kYXRhLXRhYmxlX19jZWxsLS1ub24tbnVtZXJpY1xcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XFxcIm9uUm93Q2xpY2tlZChyb3cpXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGdldENlbGxWYWx1ZShyb3csIGNvbHVtbikgfX0gICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4gICAgICAgICAgICAgICAgICAgICA8L3RyPiAgICAgICAgICAgICAgICAgPC90Ym9keT4gICAgICAgICAgICAgPC90YWJsZT4gICAgICAgICAgPC9kaXY+ICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImR5bmFtaWMtdGFibGUtd2lkZ2V0X19idXR0b25zXFxcIj4gICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwibWRsLWJ1dHRvbiBtZGwtanMtYnV0dG9uIG1kbC1idXR0b24tLWljb25cXFwiICAgICAgICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cXFwiIWhhc1NlbGVjdGlvbigpXFxcIiAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XFxcIm1vdmVTZWxlY3Rpb25VcCgpXFxcIj4gICAgICAgICAgICAgICAgIDxpIGNsYXNzPVxcXCJtYXRlcmlhbC1pY29uc1xcXCI+YXJyb3dfdXB3YXJkPC9pPiAgICAgICAgICAgICA8L2J1dHRvbj4gICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwibWRsLWJ1dHRvbiBtZGwtanMtYnV0dG9uIG1kbC1idXR0b24tLWljb25cXFwiICAgICAgICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cXFwiIWhhc1NlbGVjdGlvbigpXFxcIiAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XFxcIm1vdmVTZWxlY3Rpb25Eb3duKClcXFwiPiAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XFxcIm1hdGVyaWFsLWljb25zXFxcIj5hcnJvd19kb3dud2FyZDwvaT4gICAgICAgICAgICAgPC9idXR0b24+ICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XFxcIm1kbC1idXR0b24gbWRsLWpzLWJ1dHRvbiBtZGwtYnV0dG9uLS1pY29uXFxcIiAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XFxcImFkZE5ld1JvdygpXFxcIj4gICAgICAgICAgICAgICAgIDxpIGNsYXNzPVxcXCJtYXRlcmlhbC1pY29uc1xcXCI+YWRkX2NpcmNsZV9vdXRsaW5lPC9pPiAgICAgICAgICAgICA8L2J1dHRvbj4gICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwibWRsLWJ1dHRvbiBtZGwtanMtYnV0dG9uIG1kbC1idXR0b24tLWljb25cXFwiICAgICAgICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cXFwiIWhhc1NlbGVjdGlvbigpXFxcIiAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XFxcImRlbGV0ZVNlbGVjdGlvbigpXFxcIj4gICAgICAgICAgICAgICAgIDxpIGNsYXNzPVxcXCJtYXRlcmlhbC1pY29uc1xcXCI+cmVtb3ZlX2NpcmNsZV9vdXRsaW5lPC9pPiAgICAgICAgICAgICA8L2J1dHRvbj4gICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwibWRsLWJ1dHRvbiBtZGwtanMtYnV0dG9uIG1kbC1idXR0b24tLWljb25cXFwiICAgICAgICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cXFwiIWhhc1NlbGVjdGlvbigpXFxcIiAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XFxcImVkaXRTZWxlY3Rpb24oKVxcXCI+ICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cXFwibWF0ZXJpYWwtaWNvbnNcXFwiPmVkaXQ8L2k+ICAgICAgICAgICAgIDwvYnV0dG9uPiAgICAgICAgIDwvZGl2PiAgICAgIDwvZGl2PiAgICAgICA8cm93LWVkaXRvciAqbmdJZj1cXFwiZWRpdE1vZGVcXFwiICAgICAgICAgW3RhYmxlXT1cXFwiY29udGVudFxcXCIgICAgICAgICBbcm93XT1cXFwiZWRpdFJvd1xcXCIgICAgICAgICBbY29sdW1uXT1cXFwiY29sdW1uXFxcIiAgICAgICAgIChzYXZlKT1cXFwib25TYXZlQ2hhbmdlcygpXFxcIiAgICAgICAgIChjYW5jZWwpPVxcXCJvbkNhbmNlbENoYW5nZXMoKVxcXCI+ICAgICAgPC9yb3ctZWRpdG9yPiAgICAgICA8ZGl2IGNsYXNzPVxcXCJkeW5hbWljLXRhYmxlLXdpZGdldF9fc3VtbWFyeVxcXCI+e3tjb250ZW50Py5maWVsZC52YWxpZGF0aW9uU3VtbWFyeX19PC9kaXY+ICA8L2Rpdj5cIixcbiAgICBzdHlsZXM6IFtcIi5keW5hbWljLXRhYmxlLXdpZGdldCB7ICAgICBwYWRkaW5nOiA4cHg7IH0gIC5keW5hbWljLXRhYmxlLXdpZGdldF9fYnV0dG9ucyB7ICAgICBtYXJnaW4tdG9wOiAxMHB4OyB9ICAuZHluYW1pYy10YWJsZS13aWRnZXRfX3Jvdy1zZWxlY3RlZCwgLmR5bmFtaWMtdGFibGUtd2lkZ2V0X19yb3ctc2VsZWN0ZWQ6aG92ZXIgeyAgICAgYmFja2dyb3VuZC1jb2xvcjogI2VlZiAhaW1wb3J0YW50OyB9ICAuZHluYW1pYy10YWJsZS13aWRnZXRfX3RhYmxlLWNvbnRhaW5lciB7ICAgICBvdmVyZmxvdy15OiBhdXRvOyAgICAgd2lkdGg6IDEwMCU7IH0gIC5keW5hbWljLXRhYmxlLXdpZGdldF9fdGFibGUgeyAgICAgd2lkdGg6IDEwMCU7IH0gIC5keW5hbWljLXRhYmxlLXdpZGdldF9faW52YWxpZCAuZHluYW1pYy10YWJsZS13aWRnZXRfX2xhYmVsIHsgICAgIGNvbG9yOiAjZDUwMDAwOyB9ICAuZHluYW1pYy10YWJsZS13aWRnZXRfX2ludmFsaWQgLmR5bmFtaWMtdGFibGUtd2lkZ2V0X190YWJsZS1jb250YWluZXIgeyAgICAgYm9yZGVyOiAxcHggc29saWQgI2Q1MDAwMDsgfSAgLmR5bmFtaWMtdGFibGUtd2lkZ2V0X19pbnZhbGlkIC5keW5hbWljLXRhYmxlLXdpZGdldF9fdGFibGUgeyAgICAgYm9yZGVyOiBub25lOyB9ICAuZHluYW1pYy10YWJsZS13aWRnZXRfX3N1bW1hcnkgeyAgICAgdmlzaWJpbGl0eTogaGlkZGVuOyAgICAgY29sb3I6ICNkNTAwMDA7IH0gIC5keW5hbWljLXRhYmxlLXdpZGdldF9faW52YWxpZCAuZHluYW1pYy10YWJsZS13aWRnZXRfX3N1bW1hcnkgeyAgICAgdmlzaWJpbGl0eTogdmlzaWJsZSAhaW1wb3J0YW50OyB9XCJdXG59KVxuZXhwb3J0IGNsYXNzIER5bmFtaWNUYWJsZVdpZGdldCBleHRlbmRzIFdpZGdldENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBFUlJPUl9NT0RFTF9OT1RfRk9VTkQgPSAnVGFibGUgbW9kZWwgbm90IGZvdW5kJztcblxuICAgIGNvbnRlbnQ6IER5bmFtaWNUYWJsZU1vZGVsO1xuXG4gICAgZWRpdE1vZGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBlZGl0Um93OiBEeW5hbWljVGFibGVSb3cgPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgdmlzaWJpbGl0eVNlcnZpY2U6IFdpZGdldFZpc2liaWxpdHlTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgbG9nU2VydmljZTogTG9nU2VydmljZSkge1xuICAgICAgICBzdXBlcigpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICBpZiAodGhpcy5maWVsZCkge1xuICAgICAgICAgICAgdGhpcy5jb250ZW50ID0gbmV3IER5bmFtaWNUYWJsZU1vZGVsKHRoaXMuZmllbGQuZm9ybSwgdGhpcy5maWVsZC5qc29uKTtcbiAgICAgICAgICAgIHRoaXMudmlzaWJpbGl0eVNlcnZpY2UucmVmcmVzaFZpc2liaWxpdHkodGhpcy5maWVsZC5mb3JtKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzVmFsaWQoKSB7XG4gICAgICAgIGxldCByZXN1bHQgPSB0cnVlO1xuXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnQgJiYgdGhpcy5jb250ZW50LmZpZWxkKSB7XG4gICAgICAgICAgICByZXN1bHQgPSB0aGlzLmNvbnRlbnQuZmllbGQuaXNWYWxpZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgb25Sb3dDbGlja2VkKHJvdzogRHluYW1pY1RhYmxlUm93KSB7XG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGVudC5zZWxlY3RlZFJvdyA9IHJvdztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhc1NlbGVjdGlvbigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICEhKHRoaXMuY29udGVudCAmJiB0aGlzLmNvbnRlbnQuc2VsZWN0ZWRSb3cpO1xuICAgIH1cblxuICAgIG1vdmVTZWxlY3Rpb25VcCgpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuY29udGVudCkge1xuICAgICAgICAgICAgdGhpcy5jb250ZW50Lm1vdmVSb3codGhpcy5jb250ZW50LnNlbGVjdGVkUm93LCAtMSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgbW92ZVNlbGVjdGlvbkRvd24oKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGVudC5tb3ZlUm93KHRoaXMuY29udGVudC5zZWxlY3RlZFJvdywgMSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgZGVsZXRlU2VsZWN0aW9uKCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodGhpcy5jb250ZW50KSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQuZGVsZXRlUm93KHRoaXMuY29udGVudC5zZWxlY3RlZFJvdyk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgYWRkTmV3Um93KCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodGhpcy5jb250ZW50KSB7XG4gICAgICAgICAgICB0aGlzLmVkaXRSb3cgPSA8RHluYW1pY1RhYmxlUm93PiB7XG4gICAgICAgICAgICAgICAgaXNOZXc6IHRydWUsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHZhbHVlOiB7fVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuZWRpdE1vZGUgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGVkaXRTZWxlY3Rpb24oKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuZWRpdFJvdyA9IHRoaXMuY29weVJvdyh0aGlzLmNvbnRlbnQuc2VsZWN0ZWRSb3cpO1xuICAgICAgICAgICAgdGhpcy5lZGl0TW9kZSA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgZ2V0Q2VsbFZhbHVlKHJvdzogRHluYW1pY1RhYmxlUm93LCBjb2x1bW46IER5bmFtaWNUYWJsZUNvbHVtbik6IGFueSB7XG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnQpIHtcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSB0aGlzLmNvbnRlbnQuZ2V0Q2VsbFZhbHVlKHJvdywgY29sdW1uKTtcbiAgICAgICAgICAgIGlmIChjb2x1bW4udHlwZSA9PT0gJ0Ftb3VudCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKGNvbHVtbi5hbW91bnRDdXJyZW5jeSB8fCAnJCcpICsgJyAnICsgKHJlc3VsdCB8fCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgb25TYXZlQ2hhbmdlcygpIHtcbiAgICAgICAgaWYgKHRoaXMuY29udGVudCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZWRpdFJvdy5pc05ldykge1xuICAgICAgICAgICAgICAgIGxldCByb3cgPSB0aGlzLmNvcHlSb3codGhpcy5lZGl0Um93KTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQuc2VsZWN0ZWRSb3cgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudC5hZGRSb3cocm93KTtcbiAgICAgICAgICAgICAgICB0aGlzLmVkaXRSb3cuaXNOZXcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZW50LnNlbGVjdGVkUm93LnZhbHVlID0gdGhpcy5jb3B5T2JqZWN0KHRoaXMuZWRpdFJvdy52YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQuZmx1c2hWYWx1ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKHRoaXMuRVJST1JfTU9ERUxfTk9UX0ZPVU5EKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVkaXRNb2RlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgb25DYW5jZWxDaGFuZ2VzKCkge1xuICAgICAgICB0aGlzLmVkaXRNb2RlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZWRpdFJvdyA9IG51bGw7XG4gICAgfVxuXG4gICAgY29weVJvdyhyb3c6IER5bmFtaWNUYWJsZVJvdyk6IER5bmFtaWNUYWJsZVJvdyB7XG4gICAgICAgIHJldHVybiA8RHluYW1pY1RhYmxlUm93PiB7XG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5jb3B5T2JqZWN0KHJvdy52YWx1ZSlcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNvcHlPYmplY3Qob2JqOiBhbnkpOiBhbnkge1xuICAgICAgICBsZXQgcmVzdWx0ID0gb2JqO1xuXG4gICAgICAgIGlmICh0eXBlb2Ygb2JqID09PSAnb2JqZWN0JyAmJiBvYmogIT09IG51bGwgJiYgb2JqICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IE9iamVjdC5hc3NpZ24oe30sIG9iaik7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhvYmopLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9ialtrZXldID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IHRoaXMuY29weU9iamVjdChvYmpba2V5XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbn1cbiJdfQ==
