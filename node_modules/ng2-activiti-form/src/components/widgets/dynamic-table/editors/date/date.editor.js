/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var dynamic_table_widget_model_1 = require("./../../dynamic-table.widget.model");
var moment = require("moment");
var DateEditorComponent = (function () {
    function DateEditorComponent(elementRef) {
        this.elementRef = elementRef;
        this.DATE_FORMAT = 'DD-MM-YYYY';
    }
    DateEditorComponent.prototype.ngOnInit = function () {
        this.settings = {
            type: 'date',
            past: moment().subtract(100, 'years'),
            future: moment().add(100, 'years')
        };
        this.value = this.table.getCellValue(this.row, this.column);
        if (this.value) {
            this.settings.init = moment(this.value, this.DATE_FORMAT);
        }
        this.datePicker = new mdDateTimePicker.default(this.settings);
        if (this.elementRef) {
            this.datePicker.trigger = this.elementRef.nativeElement.querySelector('#dateInput');
        }
    };
    DateEditorComponent.prototype.onDateChanged = function (event) {
        var newValue = event.target.value;
        var dateValue = moment(newValue, this.DATE_FORMAT);
        this.datePicker.time = dateValue;
        this.row.value[this.column.id] = dateValue.format('YYYY-MM-DD') + "T00:00:00.000Z";
        this.table.flushValue();
    };
    ;
    DateEditorComponent.prototype.onDateSelected = function (event) {
        this.value = this.datePicker.time.format('DD-MM-YYYY');
        var newValue = this.datePicker.time.format('YYYY-MM-DD');
        this.row.value[this.column.id] = newValue + "T00:00:00.000Z";
        this.table.flushValue();
        if (this.elementRef) {
            this.updateMaterialTextField(this.elementRef, newValue);
        }
    };
    DateEditorComponent.prototype.updateMaterialTextField = function (elementRef, value) {
        if (elementRef) {
            var el = elementRef.nativeElement;
            if (el) {
                var container = el.querySelector('.mdl-textfield');
                if (container) {
                    container.MaterialTextfield.change(value);
                    return true;
                }
            }
        }
        return false;
    };
    return DateEditorComponent;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", dynamic_table_widget_model_1.DynamicTableModel)
], DateEditorComponent.prototype, "table", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], DateEditorComponent.prototype, "row", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], DateEditorComponent.prototype, "column", void 0);
DateEditorComponent = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'alf-date-editor',
        template: "<div class=\"mdl-grid\">     <div class=\"mdl-cell mdl-cell--11-col\">         <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label date-editor\">             <input id=\"dateInput\"                 class=\"mdl-textfield__input\"                 type=\"text\"                 [value]=\"value\"                 [attr.id]=\"column.id\"                 [required]=\"column.required\"                 [disabled]=\"!column.editable\"                 (keyup)=\"onDateChanged($event)\"                 (onOk)=\"onDateSelected($event)\">             <label class=\"mdl-textfield__label\" [attr.for]=\"column.id\">{{column.name}} (d-M-yyyy)</label>         </div>     </div>     <div *ngIf=\"column.editable\" class=\"mdl-cell mdl-cell--1-col\">         <button             class=\"mdl-button mdl-js-button mdl-button--icon date-editor--button\"             (click)=\"datePicker.toggle()\">             <i class=\"material-icons\">date_range</i>         </button>     </div> </div>",
        styles: [".date-editor {     width: 100%; }  .date-editor--button {     margin-top: 15px; }"]
    }),
    __metadata("design:paramtypes", [core_1.ElementRef])
], DateEditorComponent);
exports.DateEditorComponent = DateEditorComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvd2lkZ2V0cy9keW5hbWljLXRhYmxlL2VkaXRvcnMvZGF0ZS9kYXRlLmVkaXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7Ozs7Ozs7Ozs7O0FBRUgsc0NBQXFFO0FBQ3JFLGlGQUE0RztBQUM1RywrQkFBaUM7QUFVakMsSUFBYSxtQkFBbUI7SUFpQjVCLDZCQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBZjFDLGdCQUFXLEdBQVcsWUFBWSxDQUFDO0lBZVUsQ0FBQztJQUU5QyxzQ0FBUSxHQUFSO1FBQ0ksSUFBSSxDQUFDLFFBQVEsR0FBRztZQUNaLElBQUksRUFBRSxNQUFNO1lBQ1osSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDO1lBQ3JDLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQztTQUNyQyxDQUFDO1FBRUYsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM1RCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNiLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUM5RCxDQUFDO1FBRUQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDOUQsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFDbEIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3hGLENBQUM7SUFDTCxDQUFDO0lBRUQsMkNBQWEsR0FBYixVQUFjLEtBQVU7UUFDcEIsSUFBSSxRQUFRLEdBQXVCLEtBQUssQ0FBQyxNQUFPLENBQUMsS0FBSyxDQUFDO1FBQ3ZELElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQztRQUNqQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxHQUFNLFNBQVMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLG1CQUFnQixDQUFDO1FBQ25GLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUFBLENBQUM7SUFFRiw0Q0FBYyxHQUFkLFVBQWUsS0FBa0I7UUFDN0IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDdkQsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3pELElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQU0sUUFBUSxtQkFBZ0IsQ0FBQztRQUM3RCxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBRXhCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ2xCLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzVELENBQUM7SUFDTCxDQUFDO0lBRUQscURBQXVCLEdBQXZCLFVBQXdCLFVBQXNCLEVBQUUsS0FBYTtRQUN6RCxFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ2IsSUFBSSxFQUFFLEdBQUcsVUFBVSxDQUFDLGFBQWEsQ0FBQztZQUNsQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUNMLElBQUksU0FBUyxHQUFHLEVBQUUsQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztnQkFDbkQsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztvQkFDWixTQUFTLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUMxQyxNQUFNLENBQUMsSUFBSSxDQUFDO2dCQUNoQixDQUFDO1lBQ0wsQ0FBQztRQUNMLENBQUM7UUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFDTCwwQkFBQztBQUFELENBckVBLEFBcUVDLElBQUE7QUE1REc7SUFEQyxZQUFLLEVBQUU7OEJBQ0QsOENBQWlCO2tEQUFDO0FBR3pCO0lBREMsWUFBSyxFQUFFOztnREFDYTtBQUdyQjtJQURDLFlBQUssRUFBRTs7bURBQ21CO0FBZmxCLG1CQUFtQjtJQU4vQixnQkFBUyxDQUFDO1FBQ1AsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1FBQ25CLFFBQVEsRUFBRSxpQkFBaUI7UUFDM0IsUUFBUSxFQUFFLG0rQkFBbStCO1FBQzcrQixNQUFNLEVBQUUsQ0FBQyxtRkFBbUYsQ0FBQztLQUNoRyxDQUFDO3FDQWtCa0MsaUJBQVU7R0FqQmpDLG1CQUFtQixDQXFFL0I7QUFyRVksa0RBQW1CIiwiZmlsZSI6ImNvbXBvbmVudHMvd2lkZ2V0cy9keW5hbWljLXRhYmxlL2VkaXRvcnMvZGF0ZS9kYXRlLmVkaXRvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRHluYW1pY1RhYmxlTW9kZWwsIER5bmFtaWNUYWJsZVJvdywgRHluYW1pY1RhYmxlQ29sdW1uIH0gZnJvbSAnLi8uLi8uLi9keW5hbWljLXRhYmxlLndpZGdldC5tb2RlbCc7XG5pbXBvcnQgKiBhcyBtb21lbnQgZnJvbSAnbW9tZW50JztcblxuZGVjbGFyZSBsZXQgbWREYXRlVGltZVBpY2tlcjogYW55O1xuXG5AQ29tcG9uZW50KHtcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHNlbGVjdG9yOiAnYWxmLWRhdGUtZWRpdG9yJyxcbiAgICB0ZW1wbGF0ZTogXCI8ZGl2IGNsYXNzPVxcXCJtZGwtZ3JpZFxcXCI+ICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtY2VsbCBtZGwtY2VsbC0tMTEtY29sXFxcIj4gICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkIG1kbC1qcy10ZXh0ZmllbGQgbWRsLXRleHRmaWVsZC0tZmxvYXRpbmctbGFiZWwgZGF0ZS1lZGl0b3JcXFwiPiAgICAgICAgICAgICA8aW5wdXQgaWQ9XFxcImRhdGVJbnB1dFxcXCIgICAgICAgICAgICAgICAgIGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkX19pbnB1dFxcXCIgICAgICAgICAgICAgICAgIHR5cGU9XFxcInRleHRcXFwiICAgICAgICAgICAgICAgICBbdmFsdWVdPVxcXCJ2YWx1ZVxcXCIgICAgICAgICAgICAgICAgIFthdHRyLmlkXT1cXFwiY29sdW1uLmlkXFxcIiAgICAgICAgICAgICAgICAgW3JlcXVpcmVkXT1cXFwiY29sdW1uLnJlcXVpcmVkXFxcIiAgICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cXFwiIWNvbHVtbi5lZGl0YWJsZVxcXCIgICAgICAgICAgICAgICAgIChrZXl1cCk9XFxcIm9uRGF0ZUNoYW5nZWQoJGV2ZW50KVxcXCIgICAgICAgICAgICAgICAgIChvbk9rKT1cXFwib25EYXRlU2VsZWN0ZWQoJGV2ZW50KVxcXCI+ICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz1cXFwibWRsLXRleHRmaWVsZF9fbGFiZWxcXFwiIFthdHRyLmZvcl09XFxcImNvbHVtbi5pZFxcXCI+e3tjb2x1bW4ubmFtZX19IChkLU0teXl5eSk8L2xhYmVsPiAgICAgICAgIDwvZGl2PiAgICAgPC9kaXY+ICAgICA8ZGl2ICpuZ0lmPVxcXCJjb2x1bW4uZWRpdGFibGVcXFwiIGNsYXNzPVxcXCJtZGwtY2VsbCBtZGwtY2VsbC0tMS1jb2xcXFwiPiAgICAgICAgIDxidXR0b24gICAgICAgICAgICAgY2xhc3M9XFxcIm1kbC1idXR0b24gbWRsLWpzLWJ1dHRvbiBtZGwtYnV0dG9uLS1pY29uIGRhdGUtZWRpdG9yLS1idXR0b25cXFwiICAgICAgICAgICAgIChjbGljayk9XFxcImRhdGVQaWNrZXIudG9nZ2xlKClcXFwiPiAgICAgICAgICAgICA8aSBjbGFzcz1cXFwibWF0ZXJpYWwtaWNvbnNcXFwiPmRhdGVfcmFuZ2U8L2k+ICAgICAgICAgPC9idXR0b24+ICAgICA8L2Rpdj4gPC9kaXY+XCIsXG4gICAgc3R5bGVzOiBbXCIuZGF0ZS1lZGl0b3IgeyAgICAgd2lkdGg6IDEwMCU7IH0gIC5kYXRlLWVkaXRvci0tYnV0dG9uIHsgICAgIG1hcmdpbi10b3A6IDE1cHg7IH1cIl1cbn0pXG5leHBvcnQgY2xhc3MgRGF0ZUVkaXRvckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBEQVRFX0ZPUk1BVDogc3RyaW5nID0gJ0RELU1NLVlZWVknO1xuXG4gICAgZGF0ZVBpY2tlcjogYW55O1xuICAgIHNldHRpbmdzOiBhbnk7XG4gICAgdmFsdWU6IGFueTtcblxuICAgIEBJbnB1dCgpXG4gICAgdGFibGU6IER5bmFtaWNUYWJsZU1vZGVsO1xuXG4gICAgQElucHV0KClcbiAgICByb3c6IER5bmFtaWNUYWJsZVJvdztcblxuICAgIEBJbnB1dCgpXG4gICAgY29sdW1uOiBEeW5hbWljVGFibGVDb2x1bW47XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpIHt9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdkYXRlJyxcbiAgICAgICAgICAgIHBhc3Q6IG1vbWVudCgpLnN1YnRyYWN0KDEwMCwgJ3llYXJzJyksXG4gICAgICAgICAgICBmdXR1cmU6IG1vbWVudCgpLmFkZCgxMDAsICd5ZWFycycpXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMudGFibGUuZ2V0Q2VsbFZhbHVlKHRoaXMucm93LCB0aGlzLmNvbHVtbik7XG4gICAgICAgIGlmICh0aGlzLnZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnNldHRpbmdzLmluaXQgPSBtb21lbnQodGhpcy52YWx1ZSwgdGhpcy5EQVRFX0ZPUk1BVCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmRhdGVQaWNrZXIgPSBuZXcgbWREYXRlVGltZVBpY2tlci5kZWZhdWx0KHRoaXMuc2V0dGluZ3MpO1xuICAgICAgICBpZiAodGhpcy5lbGVtZW50UmVmKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGVQaWNrZXIudHJpZ2dlciA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkYXRlSW5wdXQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uRGF0ZUNoYW5nZWQoZXZlbnQ6IGFueSkge1xuICAgICAgICBsZXQgbmV3VmFsdWUgPSAoPEhUTUxJbnB1dEVsZW1lbnQ+IGV2ZW50LnRhcmdldCkudmFsdWU7XG4gICAgICAgIGxldCBkYXRlVmFsdWUgPSBtb21lbnQobmV3VmFsdWUsIHRoaXMuREFURV9GT1JNQVQpO1xuICAgICAgICB0aGlzLmRhdGVQaWNrZXIudGltZSA9IGRhdGVWYWx1ZTtcbiAgICAgICAgdGhpcy5yb3cudmFsdWVbdGhpcy5jb2x1bW4uaWRdID0gYCR7ZGF0ZVZhbHVlLmZvcm1hdCgnWVlZWS1NTS1ERCcpfVQwMDowMDowMC4wMDBaYDtcbiAgICAgICAgdGhpcy50YWJsZS5mbHVzaFZhbHVlKCk7XG4gICAgfTtcblxuICAgIG9uRGF0ZVNlbGVjdGVkKGV2ZW50OiBDdXN0b21FdmVudCkge1xuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5kYXRlUGlja2VyLnRpbWUuZm9ybWF0KCdERC1NTS1ZWVlZJyk7XG4gICAgICAgIGxldCBuZXdWYWx1ZSA9IHRoaXMuZGF0ZVBpY2tlci50aW1lLmZvcm1hdCgnWVlZWS1NTS1ERCcpO1xuICAgICAgICB0aGlzLnJvdy52YWx1ZVt0aGlzLmNvbHVtbi5pZF0gPSBgJHtuZXdWYWx1ZX1UMDA6MDA6MDAuMDAwWmA7XG4gICAgICAgIHRoaXMudGFibGUuZmx1c2hWYWx1ZSgpO1xuXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnRSZWYpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlTWF0ZXJpYWxUZXh0RmllbGQodGhpcy5lbGVtZW50UmVmLCBuZXdWYWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB1cGRhdGVNYXRlcmlhbFRleHRGaWVsZChlbGVtZW50UmVmOiBFbGVtZW50UmVmLCB2YWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChlbGVtZW50UmVmKSB7XG4gICAgICAgICAgICBsZXQgZWwgPSBlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgICAgICBpZiAoZWwpIHtcbiAgICAgICAgICAgICAgICBsZXQgY29udGFpbmVyID0gZWwucXVlcnlTZWxlY3RvcignLm1kbC10ZXh0ZmllbGQnKTtcbiAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5NYXRlcmlhbFRleHRmaWVsZC5jaGFuZ2UodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbiJdfQ==
