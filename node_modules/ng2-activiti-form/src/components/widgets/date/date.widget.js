/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var widget_component_1 = require("./../widget.component");
var moment = require("moment");
var DateWidget = (function (_super) {
    __extends(DateWidget, _super);
    function DateWidget(elementRef) {
        var _this = _super.call(this) || this;
        _this.elementRef = elementRef;
        _this.DATE_FORMAT = 'D-M-YYYY';
        return _this;
    }
    DateWidget.prototype.ngOnInit = function () {
        var settings = {
            type: 'date',
            past: moment().subtract(100, 'years'),
            future: moment().add(100, 'years')
        };
        if (this.field) {
            if (this.field.minValue) {
                settings.past = moment(this.field.minValue, this.DATE_FORMAT);
            }
            if (this.field.maxValue) {
                settings.future = moment(this.field.maxValue, this.DATE_FORMAT);
            }
            if (this.field.value) {
                settings.init = moment(this.field.value, this.DATE_FORMAT);
            }
        }
        this.datePicker = new mdDateTimePicker.default(settings);
    };
    DateWidget.prototype.ngAfterViewChecked = function () {
        if (this.elementRef) {
            var dataLocator = '#' + this.field.id;
            this.datePicker.trigger = this.elementRef.nativeElement.querySelector(dataLocator);
        }
    };
    DateWidget.prototype.onDateChanged = function () {
        if (this.field.value) {
            var value = moment(this.field.value, this.DATE_FORMAT);
            if (!value.isValid()) {
                value = moment();
            }
            this.datePicker.time = value;
        }
        this.checkVisibility(this.field);
    };
    DateWidget.prototype.onDateSelected = function () {
        var newValue = this.datePicker.time.format(this.DATE_FORMAT);
        this.field.value = newValue;
        this.checkVisibility(this.field);
        if (this.elementRef) {
            this.setupMaterialTextField(this.elementRef, componentHandler, newValue);
        }
    };
    return DateWidget;
}(widget_component_1.WidgetComponent));
DateWidget = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'date-widget',
        template: "<div class=\"mdl-grid mdl-grid__date-widget\" *ngIf=\"field?.isVisible\" id=\"data-widget\">     <div class=\"mdl-cell mdl-cell--11-col\">         <div class=\"mdl-textfield mdl-js-textfield date-widget\"              [class.date-widget__invalid]=\"!field.isValid\">             <label [attr.for]=\"field.id\">{{field.name}}</label>             <input class=\"mdl-textfield__input mdl-date__input\"                    type=\"text\"                    [attr.id]=\"field.id\"                    [attr.required]=\"isRequired()\"                    [(ngModel)]=\"field.value\"                    (ngModelChange)=\"onDateChanged()\"                    (onOk)=\"onDateSelected()\"                    [disabled]=\"field.readOnly\"                    placeholder=\"{{field.placeholder}}\">             <span *ngIf=\"field.validationSummary\" class=\"mdl-textfield__error\">{{field.validationSummary}}</span>         </div>     </div>     <div class=\"mdl-cell mdl-cell--1-col\">         <button             class=\"mdl-button mdl-js-button mdl-button--icon\"             (click)=\"datePicker.toggle()\">             <i class=\"material-icons\">date_range</i>         </button>     </div> </div>",
        styles: [".date-widget {     width: 100%;     padding-top: 10px;     padding-bottom: 10px; }  .date-widget--button {     margin-top: 10px; }  .mdl-date__input{     padding-top: 5px;     padding-bottom: 5px; }  .mdl-grid__date-widget{     align-items:center;     padding: 0px; }  .date-widget__invalid .mdl-textfield__input {     border-color: #d50000; }  .date-widget__invalid .mdl-textfield__label {     color: #d50000; }  .date-widget__invalid .mdl-textfield__label:after {     background-color: #d50000; }  .date-widget__invalid .mdl-textfield__error {     visibility: visible !important; }  .date-widget-button__cell{     margin-top: 0px;     margin-bottom: 0px; }"]
    }),
    __metadata("design:paramtypes", [core_1.ElementRef])
], DateWidget);
exports.DateWidget = DateWidget;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvd2lkZ2V0cy9kYXRlL2RhdGUud2lkZ2V0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRzs7Ozs7Ozs7Ozs7Ozs7OztBQUVILHNDQUFnRjtBQUNoRiwwREFBd0Q7QUFDeEQsK0JBQWlDO0FBV2pDLElBQWEsVUFBVTtJQUFTLDhCQUFlO0lBTTNDLG9CQUFvQixVQUFzQjtRQUExQyxZQUNJLGlCQUFPLFNBQ1Y7UUFGbUIsZ0JBQVUsR0FBVixVQUFVLENBQVk7UUFKMUMsaUJBQVcsR0FBVyxVQUFVLENBQUM7O0lBTWpDLENBQUM7SUFFRCw2QkFBUSxHQUFSO1FBRUksSUFBSSxRQUFRLEdBQVE7WUFDaEIsSUFBSSxFQUFFLE1BQU07WUFDWixJQUFJLEVBQUUsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUM7WUFDckMsTUFBTSxFQUFFLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDO1NBQ3JDLENBQUM7UUFFRixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUViLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDdEIsUUFBUSxDQUFDLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ2xFLENBQUM7WUFFRCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RCLFFBQVEsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUNwRSxDQUFDO1lBRUQsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNuQixRQUFRLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDL0QsQ0FBQztRQUNMLENBQUM7UUFFRCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksZ0JBQWdCLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFFRCx1Q0FBa0IsR0FBbEI7UUFDSSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNsQixJQUFJLFdBQVcsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDdEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3ZGLENBQUM7SUFDTCxDQUFDO0lBRUQsa0NBQWEsR0FBYjtRQUNJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNuQixJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3ZELEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDbkIsS0FBSyxHQUFHLE1BQU0sRUFBRSxDQUFDO1lBQ3JCLENBQUM7WUFDRCxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7UUFDakMsQ0FBQztRQUNELElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRCxtQ0FBYyxHQUFkO1FBQ0ksSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUM3RCxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUM7UUFDNUIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFakMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFDbEIsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsZ0JBQWdCLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDN0UsQ0FBQztJQUNMLENBQUM7SUFFTCxpQkFBQztBQUFELENBaEVBLEFBZ0VDLENBaEUrQixrQ0FBZSxHQWdFOUM7QUFoRVksVUFBVTtJQU50QixnQkFBUyxDQUFDO1FBQ1AsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1FBQ25CLFFBQVEsRUFBRSxhQUFhO1FBQ3ZCLFFBQVEsRUFBRSxvcUNBQW9xQztRQUM5cUMsTUFBTSxFQUFFLENBQUMsb3BCQUFvcEIsQ0FBQztLQUNqcUIsQ0FBQztxQ0FPa0MsaUJBQVU7R0FOakMsVUFBVSxDQWdFdEI7QUFoRVksZ0NBQVUiLCJmaWxlIjoiY29tcG9uZW50cy93aWRnZXRzL2RhdGUvZGF0ZS53aWRnZXQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNiBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIE9uSW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgV2lkZ2V0Q29tcG9uZW50IH0gZnJvbSAnLi8uLi93aWRnZXQuY29tcG9uZW50JztcbmltcG9ydCAqIGFzIG1vbWVudCBmcm9tICdtb21lbnQnO1xuXG5kZWNsYXJlIGxldCBtZERhdGVUaW1lUGlja2VyOiBhbnk7XG5kZWNsYXJlIHZhciBjb21wb25lbnRIYW5kbGVyOiBhbnk7XG5cbkBDb21wb25lbnQoe1xuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc2VsZWN0b3I6ICdkYXRlLXdpZGdldCcsXG4gICAgdGVtcGxhdGU6IFwiPGRpdiBjbGFzcz1cXFwibWRsLWdyaWQgbWRsLWdyaWRfX2RhdGUtd2lkZ2V0XFxcIiAqbmdJZj1cXFwiZmllbGQ/LmlzVmlzaWJsZVxcXCIgaWQ9XFxcImRhdGEtd2lkZ2V0XFxcIj4gICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1jZWxsIG1kbC1jZWxsLS0xMS1jb2xcXFwiPiAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGQgbWRsLWpzLXRleHRmaWVsZCBkYXRlLXdpZGdldFxcXCIgICAgICAgICAgICAgIFtjbGFzcy5kYXRlLXdpZGdldF9faW52YWxpZF09XFxcIiFmaWVsZC5pc1ZhbGlkXFxcIj4gICAgICAgICAgICAgPGxhYmVsIFthdHRyLmZvcl09XFxcImZpZWxkLmlkXFxcIj57e2ZpZWxkLm5hbWV9fTwvbGFiZWw+ICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz1cXFwibWRsLXRleHRmaWVsZF9faW5wdXQgbWRsLWRhdGVfX2lucHV0XFxcIiAgICAgICAgICAgICAgICAgICAgdHlwZT1cXFwidGV4dFxcXCIgICAgICAgICAgICAgICAgICAgIFthdHRyLmlkXT1cXFwiZmllbGQuaWRcXFwiICAgICAgICAgICAgICAgICAgICBbYXR0ci5yZXF1aXJlZF09XFxcImlzUmVxdWlyZWQoKVxcXCIgICAgICAgICAgICAgICAgICAgIFsobmdNb2RlbCldPVxcXCJmaWVsZC52YWx1ZVxcXCIgICAgICAgICAgICAgICAgICAgIChuZ01vZGVsQ2hhbmdlKT1cXFwib25EYXRlQ2hhbmdlZCgpXFxcIiAgICAgICAgICAgICAgICAgICAgKG9uT2spPVxcXCJvbkRhdGVTZWxlY3RlZCgpXFxcIiAgICAgICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cXFwiZmllbGQucmVhZE9ubHlcXFwiICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cXFwie3tmaWVsZC5wbGFjZWhvbGRlcn19XFxcIj4gICAgICAgICAgICAgPHNwYW4gKm5nSWY9XFxcImZpZWxkLnZhbGlkYXRpb25TdW1tYXJ5XFxcIiBjbGFzcz1cXFwibWRsLXRleHRmaWVsZF9fZXJyb3JcXFwiPnt7ZmllbGQudmFsaWRhdGlvblN1bW1hcnl9fTwvc3Bhbj4gICAgICAgICA8L2Rpdj4gICAgIDwvZGl2PiAgICAgPGRpdiBjbGFzcz1cXFwibWRsLWNlbGwgbWRsLWNlbGwtLTEtY29sXFxcIj4gICAgICAgICA8YnV0dG9uICAgICAgICAgICAgIGNsYXNzPVxcXCJtZGwtYnV0dG9uIG1kbC1qcy1idXR0b24gbWRsLWJ1dHRvbi0taWNvblxcXCIgICAgICAgICAgICAgKGNsaWNrKT1cXFwiZGF0ZVBpY2tlci50b2dnbGUoKVxcXCI+ICAgICAgICAgICAgIDxpIGNsYXNzPVxcXCJtYXRlcmlhbC1pY29uc1xcXCI+ZGF0ZV9yYW5nZTwvaT4gICAgICAgICA8L2J1dHRvbj4gICAgIDwvZGl2PiA8L2Rpdj5cIixcbiAgICBzdHlsZXM6IFtcIi5kYXRlLXdpZGdldCB7ICAgICB3aWR0aDogMTAwJTsgICAgIHBhZGRpbmctdG9wOiAxMHB4OyAgICAgcGFkZGluZy1ib3R0b206IDEwcHg7IH0gIC5kYXRlLXdpZGdldC0tYnV0dG9uIHsgICAgIG1hcmdpbi10b3A6IDEwcHg7IH0gIC5tZGwtZGF0ZV9faW5wdXR7ICAgICBwYWRkaW5nLXRvcDogNXB4OyAgICAgcGFkZGluZy1ib3R0b206IDVweDsgfSAgLm1kbC1ncmlkX19kYXRlLXdpZGdldHsgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsgICAgIHBhZGRpbmc6IDBweDsgfSAgLmRhdGUtd2lkZ2V0X19pbnZhbGlkIC5tZGwtdGV4dGZpZWxkX19pbnB1dCB7ICAgICBib3JkZXItY29sb3I6ICNkNTAwMDA7IH0gIC5kYXRlLXdpZGdldF9faW52YWxpZCAubWRsLXRleHRmaWVsZF9fbGFiZWwgeyAgICAgY29sb3I6ICNkNTAwMDA7IH0gIC5kYXRlLXdpZGdldF9faW52YWxpZCAubWRsLXRleHRmaWVsZF9fbGFiZWw6YWZ0ZXIgeyAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Q1MDAwMDsgfSAgLmRhdGUtd2lkZ2V0X19pbnZhbGlkIC5tZGwtdGV4dGZpZWxkX19lcnJvciB7ICAgICB2aXNpYmlsaXR5OiB2aXNpYmxlICFpbXBvcnRhbnQ7IH0gIC5kYXRlLXdpZGdldC1idXR0b25fX2NlbGx7ICAgICBtYXJnaW4tdG9wOiAwcHg7ICAgICBtYXJnaW4tYm90dG9tOiAwcHg7IH1cIl1cbn0pXG5leHBvcnQgY2xhc3MgRGF0ZVdpZGdldCBleHRlbmRzIFdpZGdldENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCB7XG5cbiAgICBEQVRFX0ZPUk1BVDogc3RyaW5nID0gJ0QtTS1ZWVlZJztcblxuICAgIGRhdGVQaWNrZXI6IGFueTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZikge1xuICAgICAgICBzdXBlcigpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuXG4gICAgICAgIGxldCBzZXR0aW5nczogYW55ID0ge1xuICAgICAgICAgICAgdHlwZTogJ2RhdGUnLFxuICAgICAgICAgICAgcGFzdDogbW9tZW50KCkuc3VidHJhY3QoMTAwLCAneWVhcnMnKSxcbiAgICAgICAgICAgIGZ1dHVyZTogbW9tZW50KCkuYWRkKDEwMCwgJ3llYXJzJylcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAodGhpcy5maWVsZCkge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5maWVsZC5taW5WYWx1ZSkge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLnBhc3QgPSBtb21lbnQodGhpcy5maWVsZC5taW5WYWx1ZSwgdGhpcy5EQVRFX0ZPUk1BVCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmZpZWxkLm1heFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuZnV0dXJlID0gbW9tZW50KHRoaXMuZmllbGQubWF4VmFsdWUsIHRoaXMuREFURV9GT1JNQVQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5maWVsZC52YWx1ZSkge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLmluaXQgPSBtb21lbnQodGhpcy5maWVsZC52YWx1ZSwgdGhpcy5EQVRFX0ZPUk1BVCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmRhdGVQaWNrZXIgPSBuZXcgbWREYXRlVGltZVBpY2tlci5kZWZhdWx0KHNldHRpbmdzKTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnRSZWYpIHtcbiAgICAgICAgICAgIGxldCBkYXRhTG9jYXRvciA9ICcjJyArIHRoaXMuZmllbGQuaWQ7XG4gICAgICAgICAgICB0aGlzLmRhdGVQaWNrZXIudHJpZ2dlciA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoZGF0YUxvY2F0b3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25EYXRlQ2hhbmdlZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZmllbGQudmFsdWUpIHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IG1vbWVudCh0aGlzLmZpZWxkLnZhbHVlLCB0aGlzLkRBVEVfRk9STUFUKTtcbiAgICAgICAgICAgIGlmICghdmFsdWUuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBtb21lbnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZGF0ZVBpY2tlci50aW1lID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jaGVja1Zpc2liaWxpdHkodGhpcy5maWVsZCk7XG4gICAgfVxuXG4gICAgb25EYXRlU2VsZWN0ZWQoKSB7XG4gICAgICAgIGxldCBuZXdWYWx1ZSA9IHRoaXMuZGF0ZVBpY2tlci50aW1lLmZvcm1hdCh0aGlzLkRBVEVfRk9STUFUKTtcbiAgICAgICAgdGhpcy5maWVsZC52YWx1ZSA9IG5ld1ZhbHVlO1xuICAgICAgICB0aGlzLmNoZWNrVmlzaWJpbGl0eSh0aGlzLmZpZWxkKTtcblxuICAgICAgICBpZiAodGhpcy5lbGVtZW50UmVmKSB7XG4gICAgICAgICAgICB0aGlzLnNldHVwTWF0ZXJpYWxUZXh0RmllbGQodGhpcy5lbGVtZW50UmVmLCBjb21wb25lbnRIYW5kbGVyLCBuZXdWYWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbn1cbiJdfQ==
