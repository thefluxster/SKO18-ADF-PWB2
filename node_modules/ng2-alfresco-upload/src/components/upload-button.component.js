/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
require("rxjs/Rx");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var upload_service_1 = require("../services/upload.service");
var ERROR_FOLDER_ALREADY_EXIST = 409;
var UploadButtonComponent = UploadButtonComponent_1 = (function () {
    function UploadButtonComponent(el, uploadService, translateService, logService, notificationService) {
        this.el = el;
        this.uploadService = uploadService;
        this.translateService = translateService;
        this.logService = logService;
        this.notificationService = notificationService;
        this.showNotificationBar = true;
        this.uploadFolders = false;
        this.multipleFiles = false;
        this.versioning = false;
        this.acceptedFilesType = '*';
        this.currentFolderPath = '/';
        this.rootFolderId = UploadButtonComponent_1.DEFAULT_ROOT_ID;
        this.onSuccess = new core_1.EventEmitter();
        this.onError = new core_1.EventEmitter();
        this.createFolder = new core_1.EventEmitter();
        if (translateService) {
            translateService.addTranslationFolder('ng2-alfresco-upload', 'node_modules/ng2-alfresco-upload/src');
        }
    }
    UploadButtonComponent.prototype.ngOnChanges = function (changes) {
        var formFields = this.createFormFields();
        this.uploadService.setOptions(formFields, this.versioning);
    };
    UploadButtonComponent.prototype.onFilesAdded = function ($event) {
        var files = $event.currentTarget.files;
        this.uploadFiles(this.currentFolderPath, files);
        $event.target.value = '';
    };
    UploadButtonComponent.prototype.onDirectoryAdded = function ($event) {
        var _this = this;
        var files = $event.currentTarget.files;
        var hashMapDir = this.convertIntoHashMap(files);
        hashMapDir.forEach(function (filesDir, directoryPath) {
            var directoryName = _this.getDirectoryName(directoryPath);
            var absolutePath = _this.currentFolderPath + _this.getDirectoryPath(directoryPath);
            _this.uploadService.createFolder(absolutePath, directoryName)
                .subscribe(function (res) {
                var relativeDir = _this.currentFolderPath + '/' + directoryPath;
                _this.uploadFiles(relativeDir, filesDir);
            }, function (error) {
                var errorMessagePlaceholder = _this.getErrorMessage(error.response);
                if (errorMessagePlaceholder) {
                    _this.onError.emit({ value: errorMessagePlaceholder });
                    var errorMessage = _this.formatString(errorMessagePlaceholder, [directoryName]);
                    if (errorMessage) {
                        _this._showErrorNotificationBar(errorMessage);
                    }
                }
                _this.logService.error(error);
            });
        });
        $event.target.value = '';
    };
    UploadButtonComponent.prototype.uploadFiles = function (path, files) {
        if (files.length) {
            var latestFilesAdded = this.uploadService.addToQueue(files);
            this.uploadService.uploadFilesInTheQueue(this.rootFolderId, path, this.onSuccess);
            if (this.showNotificationBar) {
                this._showUndoNotificationBar(latestFilesAdded);
            }
        }
    };
    UploadButtonComponent.prototype.convertIntoHashMap = function (files) {
        var directoryMap = new Map();
        for (var _i = 0, files_1 = files; _i < files_1.length; _i++) {
            var file = files_1[_i];
            var directory = this.getDirectoryPath(file.webkitRelativePath);
            var filesSomeDir = directoryMap.get(directory) || [];
            filesSomeDir.push(file);
            directoryMap.set(directory, filesSomeDir);
        }
        return directoryMap;
    };
    UploadButtonComponent.prototype.getDirectoryPath = function (directory) {
        var relativeDirPath = '';
        var dirPath = directory.split('/');
        if (dirPath.length > 1) {
            dirPath.pop();
            relativeDirPath = '/' + dirPath.join('/');
        }
        return relativeDirPath;
    };
    UploadButtonComponent.prototype.getDirectoryName = function (directory) {
        var dirPath = directory.split('/');
        if (dirPath.length > 1) {
            return dirPath.pop();
        }
        else {
            return dirPath[0];
        }
    };
    UploadButtonComponent.prototype._showUndoNotificationBar = function (latestFilesAdded) {
        var messageTranslate, actionTranslate;
        messageTranslate = this.translateService.get('FILE_UPLOAD.MESSAGES.PROGRESS');
        actionTranslate = this.translateService.get('FILE_UPLOAD.ACTION.UNDO');
        this.notificationService.openSnackMessageAction(messageTranslate.value, actionTranslate.value, 3000).afterDismissed().subscribe(function () {
            latestFilesAdded.forEach(function (uploadingFileModel) {
                uploadingFileModel.emitAbort();
            });
        });
    };
    UploadButtonComponent.prototype.getErrorMessage = function (response) {
        if (response.body && response.body.error.statusCode === ERROR_FOLDER_ALREADY_EXIST) {
            var errorMessage = void 0;
            errorMessage = this.translateService.get('FILE_UPLOAD.MESSAGES.FOLDER_ALREADY_EXIST');
            return errorMessage.value;
        }
    };
    UploadButtonComponent.prototype._showErrorNotificationBar = function (errorMessage) {
        this.notificationService.openSnackMessage(errorMessage, 3000);
    };
    UploadButtonComponent.prototype.formatString = function (message, keys) {
        var i = keys.length;
        while (i--) {
            message = message.replace(new RegExp('\\{' + i + '\\}', 'gm'), keys[i]);
        }
        return message;
    };
    UploadButtonComponent.prototype.createFormFields = function () {
        return {
            formFields: {
                overwrite: true
            }
        };
    };
    return UploadButtonComponent;
}());
UploadButtonComponent.DEFAULT_ROOT_ID = '-root-';
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], UploadButtonComponent.prototype, "showNotificationBar", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], UploadButtonComponent.prototype, "uploadFolders", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], UploadButtonComponent.prototype, "multipleFiles", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], UploadButtonComponent.prototype, "versioning", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], UploadButtonComponent.prototype, "acceptedFilesType", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], UploadButtonComponent.prototype, "staticTitle", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], UploadButtonComponent.prototype, "currentFolderPath", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], UploadButtonComponent.prototype, "rootFolderId", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], UploadButtonComponent.prototype, "onSuccess", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], UploadButtonComponent.prototype, "onError", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], UploadButtonComponent.prototype, "createFolder", void 0);
UploadButtonComponent = UploadButtonComponent_1 = __decorate([
    core_1.Component({
        selector: 'alfresco-upload-button',
        moduleId: module.id,
        template: "<form>     <!--Files Upload-->     <div *ngIf=\"!uploadFolders\" class=\"mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-button--file\">         <i class=\"material-icons\">file_upload</i>          <!--Multiple Files Upload-->         <span *ngIf=\"multipleFiles\">             <label *ngIf=\"!staticTitle\" for=\"upload-multiple-files\">{{'FILE_UPLOAD.BUTTON.UPLOAD_FILE' | translate}}</label>             <label *ngIf=\"staticTitle\" for=\"upload-multiple-files\">{{staticTitle}}</label>             <input id=\"upload-multiple-files\" data-automation-id=\"upload-multiple-files\" type=\"file\" name=\"uploadFiles\"                    (change)=\"onFilesAdded($event)\"                    multiple=\"multiple\"                    accept=\"{{acceptedFilesType}}\"                    #uploadFiles>         </span>          <!--Single Files Upload-->         <span *ngIf=\"!multipleFiles\">             <label *ngIf=\"!staticTitle\" for=\"upload-single-file\">{{'FILE_UPLOAD.BUTTON.UPLOAD_FILE' | translate}}</label>             <label *ngIf=\"staticTitle\" for=\"upload-single-file\">{{staticTitle}}</label>             <input id=\"upload-single-file\" data-automation-id=\"upload-single-file\" type=\"file\" name=\"uploadFiles\"                    (change)=\"onFilesAdded($event)\"                    accept=\"{{acceptedFilesType}}\"                    #uploadFiles>         </span>     </div>      <!--Folders Upload-->     <div *ngIf=\"uploadFolders\" class=\"mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-button--file\">         <i class=\"material-icons\">file_upload</i>         <label *ngIf=\"!staticTitle\" for=\"uploadFolder\">{{'FILE_UPLOAD.BUTTON.UPLOAD_FOLDER' | translate}}</label>         <label *ngIf=\"staticTitle\" for=\"uploadFolder\">{{staticTitle}}</label>         <input id=\"uploadFolder\" data-automation-id=\"uploadFolder\" type=\"file\" name=\"uploadFiles\"                (change)=\"onDirectoryAdded($event)\"                multiple=\"multiple\"                accept=\"{{acceptedFilesType}}\"                webkitdirectory directory                multiple #uploadFolders>     </div> </form>",
        styles: [".mdl-button--file input {     cursor: pointer;     height: 100%;     right: 0;     opacity: 0;     position: absolute;     top: 0;     width: 300px;     z-index: 4; }  .mdl-textfield--file .mdl-textfield__input {     box-sizing: border-box;     width: calc(100% - 32px); }  .mdl-textfield--file .mdl-button--file {     right: 0; }"]
    }),
    __metadata("design:paramtypes", [core_1.ElementRef,
        upload_service_1.UploadService,
        ng2_alfresco_core_1.AlfrescoTranslationService,
        ng2_alfresco_core_1.LogService,
        ng2_alfresco_core_1.NotificationService])
], UploadButtonComponent);
exports.UploadButtonComponent = UploadButtonComponent;
var UploadButtonComponent_1;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvdXBsb2FkLWJ1dHRvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQUFtRjtBQUNuRixtQkFBaUI7QUFDakIsdURBQWdHO0FBQ2hHLDZEQUEyRDtBQUszRCxJQUFNLDBCQUEwQixHQUFHLEdBQUcsQ0FBQztBQTRCdkMsSUFBYSxxQkFBcUI7SUFxQzlCLCtCQUFvQixFQUFjLEVBQ2QsYUFBNEIsRUFDNUIsZ0JBQTRDLEVBQzVDLFVBQXNCLEVBQ3RCLG1CQUF3QztRQUp4QyxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ2Qsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUE0QjtRQUM1QyxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBcUI7UUFwQzVELHdCQUFtQixHQUFZLElBQUksQ0FBQztRQUdwQyxrQkFBYSxHQUFZLEtBQUssQ0FBQztRQUcvQixrQkFBYSxHQUFZLEtBQUssQ0FBQztRQUcvQixlQUFVLEdBQVksS0FBSyxDQUFDO1FBRzVCLHNCQUFpQixHQUFXLEdBQUcsQ0FBQztRQU1oQyxzQkFBaUIsR0FBVyxHQUFHLENBQUM7UUFHaEMsaUJBQVksR0FBVyx1QkFBcUIsQ0FBQyxlQUFlLENBQUM7UUFHN0QsY0FBUyxHQUFHLElBQUksbUJBQVksRUFBRSxDQUFDO1FBRy9CLFlBQU8sR0FBRyxJQUFJLG1CQUFZLEVBQUUsQ0FBQztRQUc3QixpQkFBWSxHQUFHLElBQUksbUJBQVksRUFBRSxDQUFDO1FBTzlCLEVBQUUsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztZQUNuQixnQkFBZ0IsQ0FBQyxvQkFBb0IsQ0FBQyxxQkFBcUIsRUFBRSxzQ0FBc0MsQ0FBQyxDQUFDO1FBQ3pHLENBQUM7SUFDTCxDQUFDO0lBRUQsMkNBQVcsR0FBWCxVQUFZLE9BQU87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TUFBTSxFQUFFLENBQUMsNFVBQTRVLENBQUM7S0FDelYsQ0FBQztxQ0FzQzBCLGlCQUFVO1FBQ0MsOEJBQWE7UUFDViw4Q0FBMEI7UUFDaEMsOEJBQVU7UUFDRCx1Q0FBbUI7R0F6Q25ELHFCQUFxQixDQTZOakM7QUE3Tlksc0RBQXFCIiwiZmlsZSI6ImNvbXBvbmVudHMvdXBsb2FkLWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNiBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICdyeGpzL1J4JztcbmltcG9ydCB7IEFsZnJlc2NvVHJhbnNsYXRpb25TZXJ2aWNlLCBMb2dTZXJ2aWNlLCBOb3RpZmljYXRpb25TZXJ2aWNlIH0gZnJvbSAnbmcyLWFsZnJlc2NvLWNvcmUnO1xuaW1wb3J0IHsgVXBsb2FkU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3VwbG9hZC5zZXJ2aWNlJztcbmltcG9ydCB7IEZpbGVNb2RlbCB9IGZyb20gJy4uL21vZGVscy9maWxlLm1vZGVsJztcblxuZGVjbGFyZSBsZXQgY29tcG9uZW50SGFuZGxlcjogYW55O1xuXG5jb25zdCBFUlJPUl9GT0xERVJfQUxSRUFEWV9FWElTVCA9IDQwOTtcblxuLyoqXG4gKiA8YWxmcmVzY28tdXBsb2FkLWJ1dHRvbiBbc2hvd05vdGlmaWNhdGlvbkJhcl09XCJib29sZWFuXCJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIFt1cGxvYWRGb2xkZXJzXT1cImJvb2xlYW5cIlxuICogICAgICAgICAgICAgICAgICAgICAgICAgW211bHRpcGxlRmlsZXNdPVwiYm9vbGVhblwiXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICBbYWNjZXB0ZWRGaWxlc1R5cGVdPVwic3RyaW5nXCJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIChvblN1Y2Nlc3MpPVwiY3VzdG9tTWV0aG9kKCRldmVudClcIj5cbiAqIDwvYWxmcmVzY28tdXBsb2FkLWJ1dHRvbj5cbiAqXG4gKiBUaGlzIGNvbXBvbmVudCwgcHJvdmlkZSBhIHNldCBvZiBidXR0b25zIHRvIHVwbG9hZCBmaWxlcyB0byBhbGZyZXNjby5cbiAqXG4gKiBASW5wdXRQYXJhbSB7Ym9vbGVhbn0gW3RydWVdIHNob3dOb3RpZmljYXRpb25CYXIgLSBoaWRlL3Nob3cgbm90aWZpY2F0aW9uIGJhci5cbiAqIEBJbnB1dFBhcmFtIHtib29sZWFufSBbZmFsc2VdIHZlcnNpb25pbmcgLSB0cnVlIHRvIGluZGljYXRlIHRoYXQgYSBtYWpvciB2ZXJzaW9uIHNob3VsZCBiZSBjcmVhdGVkXG4gKiBASW5wdXRQYXJhbSB7Ym9vbGVhbn0gW2ZhbHNlXSB1cGxvYWRGb2xkZXJzIC0gYWxsb3cvZGlzYWxsb3cgdXBsb2FkIGZvbGRlcnMgKG9ubHkgZm9yIGNocm9tZSkuXG4gKiBASW5wdXRQYXJhbSB7Ym9vbGVhbn0gW2ZhbHNlXSBtdWx0aXBsZUZpbGVzIC0gYWxsb3cvZGlzYWxsb3cgbXVsdGlwbGUgZmlsZXMuXG4gKiBASW5wdXRQYXJhbSB7c3RyaW5nfSBbKl0gYWNjZXB0ZWRGaWxlc1R5cGUgLSBhcnJheSBvZiBhbGxvd2VkIGZpbGUgZXh0ZW5zaW9ucy5cbiAqIEBJbnB1dFBhcmFtIHtib29sZWFufSBbZmFsc2VdIHZlcnNpb25pbmcgLSB0cnVlIHRvIGluZGljYXRlIHRoYXQgYSBtYWpvciB2ZXJzaW9uIHNob3VsZCBiZSBjcmVhdGVkXG4gKiBAT3V0cHV0IC0gb25TdWNjZXNzIC0gVGhlIGV2ZW50IGlzIGVtaXR0ZWQgd2hlbiB0aGUgZmlsZSBpcyB1cGxvYWRlZFxuICpcbiAqIEByZXR1cm5zIHtVcGxvYWRCdXR0b25Db21wb25lbnR9IC5cbiAqL1xuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhbGZyZXNjby11cGxvYWQtYnV0dG9uJyxcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHRlbXBsYXRlOiBcIjxmb3JtPiAgICAgPCEtLUZpbGVzIFVwbG9hZC0tPiAgICAgPGRpdiAqbmdJZj1cXFwiIXVwbG9hZEZvbGRlcnNcXFwiIGNsYXNzPVxcXCJtZGwtYnV0dG9uIG1kbC1qcy1idXR0b24gbWRsLWJ1dHRvbi0tcmFpc2VkIG1kbC1idXR0b24tLWNvbG9yZWQgbWRsLWJ1dHRvbi0tZmlsZVxcXCI+ICAgICAgICAgPGkgY2xhc3M9XFxcIm1hdGVyaWFsLWljb25zXFxcIj5maWxlX3VwbG9hZDwvaT4gICAgICAgICAgPCEtLU11bHRpcGxlIEZpbGVzIFVwbG9hZC0tPiAgICAgICAgIDxzcGFuICpuZ0lmPVxcXCJtdWx0aXBsZUZpbGVzXFxcIj4gICAgICAgICAgICAgPGxhYmVsICpuZ0lmPVxcXCIhc3RhdGljVGl0bGVcXFwiIGZvcj1cXFwidXBsb2FkLW11bHRpcGxlLWZpbGVzXFxcIj57eydGSUxFX1VQTE9BRC5CVVRUT04uVVBMT0FEX0ZJTEUnIHwgdHJhbnNsYXRlfX08L2xhYmVsPiAgICAgICAgICAgICA8bGFiZWwgKm5nSWY9XFxcInN0YXRpY1RpdGxlXFxcIiBmb3I9XFxcInVwbG9hZC1tdWx0aXBsZS1maWxlc1xcXCI+e3tzdGF0aWNUaXRsZX19PC9sYWJlbD4gICAgICAgICAgICAgPGlucHV0IGlkPVxcXCJ1cGxvYWQtbXVsdGlwbGUtZmlsZXNcXFwiIGRhdGEtYXV0b21hdGlvbi1pZD1cXFwidXBsb2FkLW11bHRpcGxlLWZpbGVzXFxcIiB0eXBlPVxcXCJmaWxlXFxcIiBuYW1lPVxcXCJ1cGxvYWRGaWxlc1xcXCIgICAgICAgICAgICAgICAgICAgIChjaGFuZ2UpPVxcXCJvbkZpbGVzQWRkZWQoJGV2ZW50KVxcXCIgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlPVxcXCJtdWx0aXBsZVxcXCIgICAgICAgICAgICAgICAgICAgIGFjY2VwdD1cXFwie3thY2NlcHRlZEZpbGVzVHlwZX19XFxcIiAgICAgICAgICAgICAgICAgICAgI3VwbG9hZEZpbGVzPiAgICAgICAgIDwvc3Bhbj4gICAgICAgICAgPCEtLVNpbmdsZSBGaWxlcyBVcGxvYWQtLT4gICAgICAgICA8c3BhbiAqbmdJZj1cXFwiIW11bHRpcGxlRmlsZXNcXFwiPiAgICAgICAgICAgICA8bGFiZWwgKm5nSWY9XFxcIiFzdGF0aWNUaXRsZVxcXCIgZm9yPVxcXCJ1cGxvYWQtc2luZ2xlLWZpbGVcXFwiPnt7J0ZJTEVfVVBMT0FELkJVVFRPTi5VUExPQURfRklMRScgfCB0cmFuc2xhdGV9fTwvbGFiZWw+ICAgICAgICAgICAgIDxsYWJlbCAqbmdJZj1cXFwic3RhdGljVGl0bGVcXFwiIGZvcj1cXFwidXBsb2FkLXNpbmdsZS1maWxlXFxcIj57e3N0YXRpY1RpdGxlfX08L2xhYmVsPiAgICAgICAgICAgICA8aW5wdXQgaWQ9XFxcInVwbG9hZC1zaW5nbGUtZmlsZVxcXCIgZGF0YS1hdXRvbWF0aW9uLWlkPVxcXCJ1cGxvYWQtc2luZ2xlLWZpbGVcXFwiIHR5cGU9XFxcImZpbGVcXFwiIG5hbWU9XFxcInVwbG9hZEZpbGVzXFxcIiAgICAgICAgICAgICAgICAgICAgKGNoYW5nZSk9XFxcIm9uRmlsZXNBZGRlZCgkZXZlbnQpXFxcIiAgICAgICAgICAgICAgICAgICAgYWNjZXB0PVxcXCJ7e2FjY2VwdGVkRmlsZXNUeXBlfX1cXFwiICAgICAgICAgICAgICAgICAgICAjdXBsb2FkRmlsZXM+ICAgICAgICAgPC9zcGFuPiAgICAgPC9kaXY+ICAgICAgPCEtLUZvbGRlcnMgVXBsb2FkLS0+ICAgICA8ZGl2ICpuZ0lmPVxcXCJ1cGxvYWRGb2xkZXJzXFxcIiBjbGFzcz1cXFwibWRsLWJ1dHRvbiBtZGwtanMtYnV0dG9uIG1kbC1idXR0b24tLXJhaXNlZCBtZGwtYnV0dG9uLS1jb2xvcmVkIG1kbC1idXR0b24tLWZpbGVcXFwiPiAgICAgICAgIDxpIGNsYXNzPVxcXCJtYXRlcmlhbC1pY29uc1xcXCI+ZmlsZV91cGxvYWQ8L2k+ICAgICAgICAgPGxhYmVsICpuZ0lmPVxcXCIhc3RhdGljVGl0bGVcXFwiIGZvcj1cXFwidXBsb2FkRm9sZGVyXFxcIj57eydGSUxFX1VQTE9BRC5CVVRUT04uVVBMT0FEX0ZPTERFUicgfCB0cmFuc2xhdGV9fTwvbGFiZWw+ICAgICAgICAgPGxhYmVsICpuZ0lmPVxcXCJzdGF0aWNUaXRsZVxcXCIgZm9yPVxcXCJ1cGxvYWRGb2xkZXJcXFwiPnt7c3RhdGljVGl0bGV9fTwvbGFiZWw+ICAgICAgICAgPGlucHV0IGlkPVxcXCJ1cGxvYWRGb2xkZXJcXFwiIGRhdGEtYXV0b21hdGlvbi1pZD1cXFwidXBsb2FkRm9sZGVyXFxcIiB0eXBlPVxcXCJmaWxlXFxcIiBuYW1lPVxcXCJ1cGxvYWRGaWxlc1xcXCIgICAgICAgICAgICAgICAgKGNoYW5nZSk9XFxcIm9uRGlyZWN0b3J5QWRkZWQoJGV2ZW50KVxcXCIgICAgICAgICAgICAgICAgbXVsdGlwbGU9XFxcIm11bHRpcGxlXFxcIiAgICAgICAgICAgICAgICBhY2NlcHQ9XFxcInt7YWNjZXB0ZWRGaWxlc1R5cGV9fVxcXCIgICAgICAgICAgICAgICAgd2Via2l0ZGlyZWN0b3J5IGRpcmVjdG9yeSAgICAgICAgICAgICAgICBtdWx0aXBsZSAjdXBsb2FkRm9sZGVycz4gICAgIDwvZGl2PiA8L2Zvcm0+XCIsXG4gICAgc3R5bGVzOiBbXCIubWRsLWJ1dHRvbi0tZmlsZSBpbnB1dCB7ICAgICBjdXJzb3I6IHBvaW50ZXI7ICAgICBoZWlnaHQ6IDEwMCU7ICAgICByaWdodDogMDsgICAgIG9wYWNpdHk6IDA7ICAgICBwb3NpdGlvbjogYWJzb2x1dGU7ICAgICB0b3A6IDA7ICAgICB3aWR0aDogMzAwcHg7ICAgICB6LWluZGV4OiA0OyB9ICAubWRsLXRleHRmaWVsZC0tZmlsZSAubWRsLXRleHRmaWVsZF9faW5wdXQgeyAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsgICAgIHdpZHRoOiBjYWxjKDEwMCUgLSAzMnB4KTsgfSAgLm1kbC10ZXh0ZmllbGQtLWZpbGUgLm1kbC1idXR0b24tLWZpbGUgeyAgICAgcmlnaHQ6IDA7IH1cIl1cbn0pXG5leHBvcnQgY2xhc3MgVXBsb2FkQnV0dG9uQ29tcG9uZW50IHtcblxuICAgIHByaXZhdGUgc3RhdGljIERFRkFVTFRfUk9PVF9JRDogc3RyaW5nID0gJy1yb290LSc7XG5cbiAgICBASW5wdXQoKVxuICAgIHNob3dOb3RpZmljYXRpb25CYXI6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgQElucHV0KClcbiAgICB1cGxvYWRGb2xkZXJzOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBASW5wdXQoKVxuICAgIG11bHRpcGxlRmlsZXM6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBJbnB1dCgpXG4gICAgdmVyc2lvbmluZzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgQElucHV0KClcbiAgICBhY2NlcHRlZEZpbGVzVHlwZTogc3RyaW5nID0gJyonO1xuXG4gICAgQElucHV0KClcbiAgICBzdGF0aWNUaXRsZTogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICBjdXJyZW50Rm9sZGVyUGF0aDogc3RyaW5nID0gJy8nO1xuXG4gICAgQElucHV0KClcbiAgICByb290Rm9sZGVySWQ6IHN0cmluZyA9IFVwbG9hZEJ1dHRvbkNvbXBvbmVudC5ERUZBVUxUX1JPT1RfSUQ7XG5cbiAgICBAT3V0cHV0KClcbiAgICBvblN1Y2Nlc3MgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBvbkVycm9yID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgY3JlYXRlRm9sZGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBlbDogRWxlbWVudFJlZixcbiAgICAgICAgICAgICAgICBwcml2YXRlIHVwbG9hZFNlcnZpY2U6IFVwbG9hZFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB0cmFuc2xhdGVTZXJ2aWNlOiBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBub3RpZmljYXRpb25TZXJ2aWNlOiBOb3RpZmljYXRpb25TZXJ2aWNlKSB7XG4gICAgICAgIGlmICh0cmFuc2xhdGVTZXJ2aWNlKSB7XG4gICAgICAgICAgICB0cmFuc2xhdGVTZXJ2aWNlLmFkZFRyYW5zbGF0aW9uRm9sZGVyKCduZzItYWxmcmVzY28tdXBsb2FkJywgJ25vZGVfbW9kdWxlcy9uZzItYWxmcmVzY28tdXBsb2FkL3NyYycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlcykge1xuICAgICAgICBsZXQgZm9ybUZpZWxkcyA9IHRoaXMuY3JlYXRlRm9ybUZpZWxkcygpO1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2Uuc2V0T3B0aW9ucyhmb3JtRmllbGRzLCB0aGlzLnZlcnNpb25pbmcpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1ldGhvZCBjYWxsZWQgd2hlbiBmaWxlcyBhcmUgZHJvcHBlZCBpbiB0aGUgZHJhZyBhcmVhLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtGaWxlW119IGZpbGVzIC0gZmlsZXMgZHJvcHBlZCBpbiB0aGUgZHJhZyBhcmVhLlxuICAgICAqL1xuICAgIG9uRmlsZXNBZGRlZCgkZXZlbnQ6IGFueSk6IHZvaWQge1xuICAgICAgICBsZXQgZmlsZXMgPSAkZXZlbnQuY3VycmVudFRhcmdldC5maWxlcztcbiAgICAgICAgdGhpcy51cGxvYWRGaWxlcyh0aGlzLmN1cnJlbnRGb2xkZXJQYXRoLCBmaWxlcyk7XG4gICAgICAgIC8vIHJlc2V0IHRoZSB2YWx1ZSBvZiB0aGUgaW5wdXQgZmlsZVxuICAgICAgICAkZXZlbnQudGFyZ2V0LnZhbHVlID0gJyc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWV0aG9kIGNhbGxlZCB3aGVuIGEgZm9sZGVyIGlzIGRyb3BwZWQgaW4gdGhlIGRyYWcgYXJlYS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RmlsZVtdfSBmaWxlcyAtIGZpbGVzIG9mIGEgZm9sZGVyIGRyb3BwZWQgaW4gdGhlIGRyYWcgYXJlYS5cbiAgICAgKi9cbiAgICBvbkRpcmVjdG9yeUFkZGVkKCRldmVudDogYW55KTogdm9pZCB7XG4gICAgICAgIGxldCBmaWxlcyA9ICRldmVudC5jdXJyZW50VGFyZ2V0LmZpbGVzO1xuICAgICAgICBsZXQgaGFzaE1hcERpciA9IHRoaXMuY29udmVydEludG9IYXNoTWFwKGZpbGVzKTtcblxuICAgICAgICBoYXNoTWFwRGlyLmZvckVhY2goKGZpbGVzRGlyLCBkaXJlY3RvcnlQYXRoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZGlyZWN0b3J5TmFtZSA9IHRoaXMuZ2V0RGlyZWN0b3J5TmFtZShkaXJlY3RvcnlQYXRoKTtcbiAgICAgICAgICAgIGxldCBhYnNvbHV0ZVBhdGggPSB0aGlzLmN1cnJlbnRGb2xkZXJQYXRoICsgdGhpcy5nZXREaXJlY3RvcnlQYXRoKGRpcmVjdG9yeVBhdGgpO1xuXG4gICAgICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuY3JlYXRlRm9sZGVyKGFic29sdXRlUGF0aCwgZGlyZWN0b3J5TmFtZSlcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgICAgICByZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlbGF0aXZlRGlyID0gdGhpcy5jdXJyZW50Rm9sZGVyUGF0aCArICcvJyArIGRpcmVjdG9yeVBhdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZEZpbGVzKHJlbGF0aXZlRGlyLCBmaWxlc0Rpcik7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBlcnJvck1lc3NhZ2VQbGFjZWhvbGRlciA9IHRoaXMuZ2V0RXJyb3JNZXNzYWdlKGVycm9yLnJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvck1lc3NhZ2VQbGFjZWhvbGRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25FcnJvci5lbWl0KHt2YWx1ZTogZXJyb3JNZXNzYWdlUGxhY2Vob2xkZXJ9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID0gdGhpcy5mb3JtYXRTdHJpbmcoZXJyb3JNZXNzYWdlUGxhY2Vob2xkZXIsIFtkaXJlY3RvcnlOYW1lXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yTWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaG93RXJyb3JOb3RpZmljYXRpb25CYXIoZXJyb3JNZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIHJlc2V0IHRoZSB2YWx1ZSBvZiB0aGUgaW5wdXQgZmlsZVxuICAgICAgICAkZXZlbnQudGFyZ2V0LnZhbHVlID0gJyc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBsb2FkIGEgbGlzdCBvZiBmaWxlIGluIHRoZSBzcGVjaWZpZWQgcGF0aFxuICAgICAqIEBwYXJhbSBwYXRoXG4gICAgICogQHBhcmFtIGZpbGVzXG4gICAgICovXG4gICAgcHJpdmF0ZSB1cGxvYWRGaWxlcyhwYXRoOiBzdHJpbmcsIGZpbGVzOiBhbnlbXSkge1xuICAgICAgICBpZiAoZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBsZXQgbGF0ZXN0RmlsZXNBZGRlZCA9IHRoaXMudXBsb2FkU2VydmljZS5hZGRUb1F1ZXVlKGZpbGVzKTtcbiAgICAgICAgICAgIHRoaXMudXBsb2FkU2VydmljZS51cGxvYWRGaWxlc0luVGhlUXVldWUodGhpcy5yb290Rm9sZGVySWQsIHBhdGgsIHRoaXMub25TdWNjZXNzKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnNob3dOb3RpZmljYXRpb25CYXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zaG93VW5kb05vdGlmaWNhdGlvbkJhcihsYXRlc3RGaWxlc0FkZGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEl0IGNvbnZlcnRzIHRoZSBhcnJheSBnaXZlbiBhcyBpbnB1dCBpbnRvIGEgbWFwLiBUaGUgbWFwIGlzIGEga2V5IHZhbHVlcyBwYWlycywgd2hlcmUgdGhlIGtleSBpcyB0aGUgZGlyZWN0b3J5IG5hbWUgYW5kIHRoZSB2YWx1ZSBhcmVcbiAgICAgKiBhbGwgdGhlIGZpbGVzIHRoYXQgdGhlIGRpcmVjdG9yeSBjb250YWlucy5cbiAgICAgKiBAcGFyYW0gZmlsZXMgLSBhcnJheSBvZiBmaWxlc1xuICAgICAqIEByZXR1cm5zIHtNYXB9XG4gICAgICovXG4gICAgcHJpdmF0ZSBjb252ZXJ0SW50b0hhc2hNYXAoZmlsZXM6IGFueVtdKSB7XG4gICAgICAgIGxldCBkaXJlY3RvcnlNYXAgPSBuZXcgTWFwPHN0cmluZywgT2JqZWN0W10+KCk7XG4gICAgICAgIGZvciAobGV0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgICAgIGxldCBkaXJlY3RvcnkgPSB0aGlzLmdldERpcmVjdG9yeVBhdGgoZmlsZS53ZWJraXRSZWxhdGl2ZVBhdGgpO1xuICAgICAgICAgICAgbGV0IGZpbGVzU29tZURpciA9IGRpcmVjdG9yeU1hcC5nZXQoZGlyZWN0b3J5KSB8fCBbXTtcbiAgICAgICAgICAgIGZpbGVzU29tZURpci5wdXNoKGZpbGUpO1xuICAgICAgICAgICAgZGlyZWN0b3J5TWFwLnNldChkaXJlY3RvcnksIGZpbGVzU29tZURpcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRpcmVjdG9yeU1hcDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTcGxpdCB0aGUgZGlyZWN0b3J5IHBhdGggZ2l2ZW4gYXMgaW5wdXQgYW5kIGN1dCB0aGUgbGFzdCBkaXJlY3RvcnkgbmFtZVxuICAgICAqIEBwYXJhbSBkaXJlY3RvcnlcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0RGlyZWN0b3J5UGF0aChkaXJlY3Rvcnk6IHN0cmluZykge1xuICAgICAgICBsZXQgcmVsYXRpdmVEaXJQYXRoID0gJyc7XG4gICAgICAgIGxldCBkaXJQYXRoID0gZGlyZWN0b3J5LnNwbGl0KCcvJyk7XG4gICAgICAgIGlmIChkaXJQYXRoLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIGRpclBhdGgucG9wKCk7XG4gICAgICAgICAgICByZWxhdGl2ZURpclBhdGggPSAnLycgKyBkaXJQYXRoLmpvaW4oJy8nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVsYXRpdmVEaXJQYXRoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNwbGl0IGEgZGlyZWN0b3J5IHBhdGggcGFzc2VkIGluIGlucHV0IGFuZCByZXR1cm4gdGhlIGZpcnN0IGRpcmVjdG9yeSBuYW1lXG4gICAgICogQHBhcmFtIGRpcmVjdG9yeVxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgcHJpdmF0ZSBnZXREaXJlY3RvcnlOYW1lKGRpcmVjdG9yeTogc3RyaW5nKSB7XG4gICAgICAgIGxldCBkaXJQYXRoID0gZGlyZWN0b3J5LnNwbGl0KCcvJyk7XG4gICAgICAgIGlmIChkaXJQYXRoLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHJldHVybiBkaXJQYXRoLnBvcCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGRpclBhdGhbMF07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaG93IHVuZG8gbm90aWZpY2F0aW9uIGJhci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RmlsZU1vZGVsW119IGxhdGVzdEZpbGVzQWRkZWQgLSBmaWxlcyBpbiB0aGUgdXBsb2FkIHF1ZXVlIGVucmljaGVkIHdpdGggc3RhdHVzIGZsYWcgYW5kIHhociBvYmplY3QuXG4gICAgICovXG4gICAgcHJpdmF0ZSBfc2hvd1VuZG9Ob3RpZmljYXRpb25CYXIobGF0ZXN0RmlsZXNBZGRlZDogRmlsZU1vZGVsW10pIHtcbiAgICAgICAgbGV0IG1lc3NhZ2VUcmFuc2xhdGU6IGFueSwgYWN0aW9uVHJhbnNsYXRlOiBhbnk7XG4gICAgICAgIG1lc3NhZ2VUcmFuc2xhdGUgPSB0aGlzLnRyYW5zbGF0ZVNlcnZpY2UuZ2V0KCdGSUxFX1VQTE9BRC5NRVNTQUdFUy5QUk9HUkVTUycpO1xuICAgICAgICBhY3Rpb25UcmFuc2xhdGUgPSB0aGlzLnRyYW5zbGF0ZVNlcnZpY2UuZ2V0KCdGSUxFX1VQTE9BRC5BQ1RJT04uVU5ETycpO1xuXG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9uU2VydmljZS5vcGVuU25hY2tNZXNzYWdlQWN0aW9uKG1lc3NhZ2VUcmFuc2xhdGUudmFsdWUsIGFjdGlvblRyYW5zbGF0ZS52YWx1ZSwgMzAwMCkuYWZ0ZXJEaXNtaXNzZWQoKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgbGF0ZXN0RmlsZXNBZGRlZC5mb3JFYWNoKCh1cGxvYWRpbmdGaWxlTW9kZWw6IEZpbGVNb2RlbCkgPT4ge1xuICAgICAgICAgICAgICAgIHVwbG9hZGluZ0ZpbGVNb2RlbC5lbWl0QWJvcnQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaXZlIHRoZSBlcnJvciBtZXNzYWdlIHVzaW5nIHRoZSBlcnJvciBzdGF0dXMgY29kZVxuICAgICAqIEBwYXJhbSByZXNwb25zZSAtIG9iamVjdCB0aGF0IGNvbnRhaW4gdGhlIEhUVFAgcmVzcG9uc2VcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0RXJyb3JNZXNzYWdlKHJlc3BvbnNlOiBhbnkpOiBzdHJpbmcge1xuICAgICAgICBpZiAocmVzcG9uc2UuYm9keSAmJiByZXNwb25zZS5ib2R5LmVycm9yLnN0YXR1c0NvZGUgPT09IEVSUk9SX0ZPTERFUl9BTFJFQURZX0VYSVNUKSB7XG4gICAgICAgICAgICBsZXQgZXJyb3JNZXNzYWdlOiBhbnk7XG4gICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSB0aGlzLnRyYW5zbGF0ZVNlcnZpY2UuZ2V0KCdGSUxFX1VQTE9BRC5NRVNTQUdFUy5GT0xERVJfQUxSRUFEWV9FWElTVCcpO1xuICAgICAgICAgICAgcmV0dXJuIGVycm9yTWVzc2FnZS52YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3cgdGhlIGVycm9yIGluc2lkZSBOb3RpZmljYXRpb24gYmFyXG4gICAgICogQHBhcmFtIEVycm9yIG1lc3NhZ2VcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgX3Nob3dFcnJvck5vdGlmaWNhdGlvbkJhcihlcnJvck1lc3NhZ2U6IHN0cmluZykge1xuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvblNlcnZpY2Uub3BlblNuYWNrTWVzc2FnZShlcnJvck1lc3NhZ2UsIDMwMDApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlcGxhY2UgYSBwbGFjZWhvbGRlciB7MH0gaW4gYSBtZXNzYWdlIHdpdGggdGhlIGlucHV0IGtleXNcbiAgICAgKiBAcGFyYW0gbWVzc2FnZSAtIHRoZSBtZXNzYWdlIHRoYXQgY29uYWlucyB0aGUgcGxhY2Vob2xkZXJcbiAgICAgKiBAcGFyYW0ga2V5cyAtIGFycmF5IG9mIHZhbHVlXG4gICAgICogQHJldHVybnMge3N0cmluZ30gLSBUaGUgbWVzc2FnZSB3aXRob3V0IHBsYWNlaG9sZGVyXG4gICAgICovXG4gICAgcHJpdmF0ZSBmb3JtYXRTdHJpbmcobWVzc2FnZTogc3RyaW5nLCBrZXlzOiBhbnkgW10pIHtcbiAgICAgICAgbGV0IGkgPSBrZXlzLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UucmVwbGFjZShuZXcgUmVnRXhwKCdcXFxceycgKyBpICsgJ1xcXFx9JywgJ2dtJyksIGtleXNbaV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgIH1cblxuICAgIHByaXZhdGUgY3JlYXRlRm9ybUZpZWxkcygpOiBhbnkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZm9ybUZpZWxkczoge1xuICAgICAgICAgICAgICAgIG92ZXJ3cml0ZTogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbn1cbiJdfQ==
