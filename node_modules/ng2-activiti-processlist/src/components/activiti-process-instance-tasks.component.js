/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var common_1 = require("@angular/common");
var Rx_1 = require("rxjs/Rx");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var activiti_process_service_1 = require("./../services/activiti-process.service");
var ng2_activiti_tasklist_1 = require("ng2-activiti-tasklist");
var process_instance_model_1 = require("../models/process-instance.model");
var ActivitiProcessInstanceTasks = (function () {
    function ActivitiProcessInstanceTasks(translate, activitiProcess, logService) {
        var _this = this;
        this.translate = translate;
        this.activitiProcess = activitiProcess;
        this.logService = logService;
        this.showRefreshButton = true;
        this.activeTasks = [];
        this.completedTasks = [];
        this.taskClick = new core_1.EventEmitter();
        if (translate) {
            translate.addTranslationFolder('ng2-activiti-processlist', 'node_modules/ng2-activiti-processlist/src');
        }
        this.task$ = new Rx_1.Observable(function (observer) { return _this.taskObserver = observer; }).share();
        this.completedTask$ = new Rx_1.Observable(function (observer) { return _this.completedTaskObserver = observer; }).share();
    }
    ActivitiProcessInstanceTasks.prototype.ngOnInit = function () {
        var _this = this;
        this.task$.subscribe(function (task) {
            _this.activeTasks.push(task);
        });
        this.completedTask$.subscribe(function (task) {
            _this.completedTasks.push(task);
        });
    };
    ActivitiProcessInstanceTasks.prototype.ngOnChanges = function (changes) {
        var processInstanceDetails = changes['processInstanceDetails'];
        if (processInstanceDetails && processInstanceDetails.currentValue) {
            this.load(processInstanceDetails.currentValue.id);
        }
    };
    ActivitiProcessInstanceTasks.prototype.load = function (processId) {
        this.loadActive(processId);
        this.loadCompleted(processId);
    };
    ActivitiProcessInstanceTasks.prototype.loadActive = function (processId) {
        var _this = this;
        this.activeTasks = [];
        if (processId) {
            this.activitiProcess.getProcessTasks(processId, null).subscribe(function (res) {
                res.forEach(function (task) {
                    _this.taskObserver.next(task);
                });
            }, function (err) {
                _this.logService.error(err);
            });
        }
        else {
            this.activeTasks = [];
        }
    };
    ActivitiProcessInstanceTasks.prototype.loadCompleted = function (processId) {
        var _this = this;
        this.completedTasks = [];
        if (processId) {
            this.activitiProcess.getProcessTasks(processId, 'completed').subscribe(function (res) {
                res.forEach(function (task) {
                    _this.completedTaskObserver.next(task);
                });
            }, function (err) {
                _this.logService.error(err);
            });
        }
        else {
            this.completedTasks = [];
        }
    };
    ActivitiProcessInstanceTasks.prototype.hasStartFormDefined = function () {
        return this.processInstanceDetails && this.processInstanceDetails.startFormDefined === true;
    };
    ActivitiProcessInstanceTasks.prototype.getUserFullName = function (user) {
        if (user) {
            return (user.firstName && user.firstName !== 'null'
                ? user.firstName + ' ' : '') +
                user.lastName;
        }
        return 'Nobody';
    };
    ActivitiProcessInstanceTasks.prototype.getFormatDate = function (value, format) {
        var datePipe = new common_1.DatePipe('en-US');
        try {
            return datePipe.transform(value, format);
        }
        catch (err) {
            this.logService.error("ProcessListInstanceTask: error parsing date " + value + " to format " + format);
        }
    };
    ActivitiProcessInstanceTasks.prototype.clickTask = function ($event, task) {
        var args = new ng2_activiti_tasklist_1.TaskDetailsEvent(task);
        this.taskClick.emit(args);
    };
    ActivitiProcessInstanceTasks.prototype.clickStartTask = function () {
        this.processId = this.processInstanceDetails.id;
        this.showStartDialog();
    };
    ActivitiProcessInstanceTasks.prototype.showStartDialog = function () {
        if (!this.startDialog.nativeElement.showModal) {
            dialogPolyfill.registerDialog(this.startDialog.nativeElement);
        }
        if (this.startDialog) {
            this.startDialog.nativeElement.showModal();
        }
    };
    ActivitiProcessInstanceTasks.prototype.closeSartDialog = function () {
        if (this.startDialog) {
            this.startDialog.nativeElement.close();
        }
    };
    ActivitiProcessInstanceTasks.prototype.onRefreshClicked = function () {
        this.load(this.processInstanceDetails.id);
    };
    return ActivitiProcessInstanceTasks;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", process_instance_model_1.ProcessInstance)
], ActivitiProcessInstanceTasks.prototype, "processInstanceDetails", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiProcessInstanceTasks.prototype, "showRefreshButton", void 0);
__decorate([
    core_1.ViewChild('dialog'),
    __metadata("design:type", Object)
], ActivitiProcessInstanceTasks.prototype, "dialog", void 0);
__decorate([
    core_1.ViewChild('startDialog'),
    __metadata("design:type", Object)
], ActivitiProcessInstanceTasks.prototype, "startDialog", void 0);
__decorate([
    core_1.ViewChild('taskdetails'),
    __metadata("design:type", Object)
], ActivitiProcessInstanceTasks.prototype, "taskdetails", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiProcessInstanceTasks.prototype, "taskClick", void 0);
ActivitiProcessInstanceTasks = __decorate([
    core_1.Component({
        selector: 'activiti-process-instance-tasks',
        moduleId: module.id,
        template: "<div  *ngIf=\"showRefreshButton\" class=\"process-tasks-refresh\" >     <button (click)=\"onRefreshClicked()\" class=\"mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect\">         <i class=\"material-icons\">refresh</i>     </button> </div>  <!-- ACTIVE FORM -->  <span class=\"activiti-label mdl-badge\"       [attr.data-badge]=\"activeTasks?.length\">{{ 'DETAILS.LABELS.TASKS_ACTIVE'|translate }}</span>  <div class=\"menu-container\" *ngIf=\"activeTasks?.length > 0\" data-automation-id=\"active-tasks\">     <ul class='mdl-list'>         <li class=\"mdl-list__item mdl-list__item--two-line process-tasks__task-item\" *ngFor=\"let task of activeTasks\">             <span class=\"mdl-list__item-primary-content\" (click)=\"clickTask($event, task)\">                 <i class=\"material-icons mdl-list__item-icon\">assignment</i>                 <span>{{task.name || 'Nameless task'}}</span>                 <span class=\"mdl-list__item-sub-title\">                     {{ 'DETAILS.LABELS.TASK_SUBTITLE' | translate:{user: getUserFullName(task.assignee), created: getFormatDate(task.created, 'mediumDate') } }}                 </span>             </span>         </li>     </ul> </div>  <!-- START FORM -->  <div *ngIf=\"activeTasks?.length === 0\" data-automation-id=\"active-tasks-none\" class=\"no-results\">     {{ 'DETAILS.TASKS.NO_ACTIVE' | translate }} </div>  <div *ngIf=\"hasStartFormDefined()\">     <span class=\"activiti-label\">{{ 'DETAILS.LABELS.START_FORM'|translate }}</span>      <!--IF START TASK COMPLETED -->     <div class=\"menu-container\">         <ul class='mdl-list'>             <li class=\"mdl-list__item mdl-list__item--two-line process-tasks__task-item\">                 <span class=\"mdl-list__item-primary-content\" (click)=\"clickStartTask($event)\">                     <i class=\"material-icons mdl-list__item-icon\">assignment</i>                     <span>{{ 'DETAILS.LABELS.START_FORM'|translate }}</span>                     <span class=\"mdl-list__item-sub-title\">                         {{ 'DETAILS.LABELS.TASK_SUBTITLE' | translate:{user:getUserFullName(processInstanceDetails.startedBy), created: getFormatDate(processInstanceDetails.started, 'mediumDate') } }}                     </span>                 </span>             </li>         </ul>     </div>  </div>  <!-- COMPLETED FORM --> <span class=\"activiti-label mdl-badge\"       [attr.data-badge]=\"completedTasks?.length\">{{ 'DETAILS.LABELS.TASKS_COMPLETED'|translate }}</span>  <div class=\"menu-container\" *ngIf=\"completedTasks?.length > 0\" data-automation-id=\"completed-tasks\">     <ul class='mdl-list'>         <li class=\"mdl-list__item mdl-list__item--two-line process-tasks__task-item\" *ngFor=\"let task of completedTasks\">             <span class=\"mdl-list__item-primary-content\" (click)=\"clickTask($event, task)\">                 <i class=\"material-icons mdl-list__item-icon\">assignment</i>                 <span>{{task.name || 'Nameless task'}}</span>                 <span class=\"mdl-list__item-sub-title\">                     {{ 'DETAILS.LABELS.TASK_SUBTITLE' | translate:{user:getUserFullName(task.assignee), created: getFormatDate(task.created, 'mediumDate') } }}                 </span>             </span>         </li>     </ul> </div>  <div *ngIf=\"completedTasks?.length === 0\" data-automation-id=\"completed-tasks-none\" class=\"no-results\">     {{ 'DETAILS.TASKS.NO_COMPLETED' | translate }} </div>  <dialog *ngIf=\"hasStartFormDefined()\" class=\"mdl-dialog task-details-dialog\" #startDialog>     <h4 class=\"mdl-dialog__title\">{{ 'DETAILS.LABELS.START_FORM'|translate }}</h4>     <div class=\"mdl-dialog__content form__size\">         <activiti-start-form [processId]=\"processId\" [processDefinitionId]=\"processInstanceDetails?.processDefinitionId\"                              [showRefreshButton]=\"false\" [readOnlyForm]=\"true\" >         </activiti-start-form>     </div>     <div class=\"mdl-dialog__actions\">         <button type=\"button\" (click)=\"closeSartDialog()\" class=\"mdl-button close\">{{ 'DETAILS.TASKS.TASK_CLOSE' | translate }}</button>     </div> </dialog>",
        styles: [":host {     width: 100%; }  .activiti-label {     font-weight: bolder;     vertical-align: top; }  .activiti-label.mdl-badge[data-badge]:after {     right: -27px;     top: -2px; }  .activiti-label + .icon {     position: relative;     top: -2px; }  .material-icons:hover {     color: rgb(255, 152, 0); }  .task-details-dialog {     position: fixed;     top: 50%;     transform: translate(0, -50%);     width: 40%; }  .process-tasks-refresh {     float: right; }  .mdl-dialog__content.form__size {     height: 400px;     overflow-y: auto; }  .no-results {     margin-left: 9px;     font-size: 14px;     font-weight: 400;     letter-spacing: 0;     line-height: 18px;     color: rgba(0, 0, 0, .54);     display: block;     padding: 12px; }  .process-tasks__task-item {     cursor: pointer; }"]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        activiti_process_service_1.ActivitiProcessService,
        ng2_alfresco_core_1.LogService])
], ActivitiProcessInstanceTasks);
exports.ActivitiProcessInstanceTasks = ActivitiProcessInstanceTasks;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktcHJvY2Vzcy1pbnN0YW5jZS10YXNrcy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQUFvSDtBQUNwSCwwQ0FBMkM7QUFDM0MsOEJBQStDO0FBQy9DLHVEQUEyRTtBQUMzRSxtRkFBZ0Y7QUFDaEYsK0RBQTJFO0FBQzNFLDJFQUFtRTtBQVduRSxJQUFhLDRCQUE0QjtJQWdDckMsc0NBQW9CLFNBQXFDLEVBQ3JDLGVBQXVDLEVBQ3ZDLFVBQXNCO1FBRjFDLGlCQVNDO1FBVG1CLGNBQVMsR0FBVCxTQUFTLENBQTRCO1FBQ3JDLG9CQUFlLEdBQWYsZUFBZSxDQUF3QjtRQUN2QyxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBNUIxQyxzQkFBaUIsR0FBWSxJQUFJLENBQUM7UUFFbEMsZ0JBQVcsR0FBdUIsRUFBRSxDQUFDO1FBQ3JDLG1CQUFjLEdBQXVCLEVBQUUsQ0FBQztRQXFCeEMsY0FBUyxHQUFtQyxJQUFJLG1CQUFZLEVBQW9CLENBQUM7UUFLN0UsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNaLFNBQVMsQ0FBQyxvQkFBb0IsQ0FBQywwQkFBMEIsRUFBRSwyQ0FBMkMsQ0FBQyxDQUFDO1FBQzVHLENBQUM7UUFFRCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksZUFBVSxDQUFtQixVQUFBLFFBQVEsSUFBSSxPQUFBLEtBQUksQ0FBQyxZQUFZLEdBQUcsUUFBUSxFQUE1QixDQUE0QixDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDaEcsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLGVBQVUsQ0FBbUIsVUFBQSxRQUFRLElBQUksT0FBQSxLQUFJLENBQUMscUJBQXFCLEdBQUcsUUFBUSxFQUFyQyxDQUFxQyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDdEgsQ0FBQztJQUVELCtDQUFRLEdBQVI7UUFBQSxp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QUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNuQixJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUMvQyxDQUFDO0lBQ0wsQ0FBQztJQUVELHNEQUFlLEdBQWY7UUFDSSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNuQixJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUMzQyxDQUFDO0lBQ0wsQ0FBQztJQUVELHVEQUFnQixHQUFoQjtRQUNJLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFDTCxtQ0FBQztBQUFELENBdkpBLEFBdUpDLElBQUE7QUFwSkc7SUFEQyxZQUFLLEVBQUU7OEJBQ2dCLHdDQUFlOzRFQUFDO0FBR3hDO0lBREMsWUFBSyxFQUFFOzt1RUFDMEI7QUFlbEM7SUFEQyxnQkFBUyxDQUFDLFFBQVEsQ0FBQzs7NERBQ1I7QUFHWjtJQURDLGdCQUFTLENBQUMsYUFBYSxDQUFDOztpRUFDUjtBQUdqQjtJQURDLGdCQUFTLENBQUMsYUFBYSxDQUFDOztpRUFDUjtBQUdqQjtJQURDLGFBQU0sRUFBRTs4QkFDRSxtQkFBWTsrREFBMEQ7QUE5QnhFLDRCQUE0QjtJQU54QyxnQkFBUyxDQUFDO1FBQ1AsUUFBUSxFQUFFLGlDQUFpQztRQUMzQyxRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7UUFDbkIsUUFBUSxFQUFFLG1qSUFBbWpJO1FBQzdqSSxNQUFNLEVBQUUsQ0FBQyx1eEJBQXV4QixDQUFDO0tBQ3B5QixDQUFDO3FDQWlDaUMsOENBQTBCO1FBQ3BCLGlEQUFzQjtRQUMzQiw4QkFBVTtHQWxDakMsNEJBQTRCLENBdUp4QztBQXZKWSxvRUFBNEIiLCJmaWxlIjoiY29tcG9uZW50cy9hY3Rpdml0aS1wcm9jZXNzLWluc3RhbmNlLXRhc2tzLmNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgVmlld0NoaWxkLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBEYXRlUGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBPYnNlcnZlciB9IGZyb20gJ3J4anMvUngnO1xuaW1wb3J0IHsgQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UsIExvZ1NlcnZpY2UgfSBmcm9tICduZzItYWxmcmVzY28tY29yZSc7XG5pbXBvcnQgeyBBY3Rpdml0aVByb2Nlc3NTZXJ2aWNlIH0gZnJvbSAnLi8uLi9zZXJ2aWNlcy9hY3Rpdml0aS1wcm9jZXNzLnNlcnZpY2UnO1xuaW1wb3J0IHsgVGFza0RldGFpbHNNb2RlbCwgVGFza0RldGFpbHNFdmVudCB9IGZyb20gJ25nMi1hY3Rpdml0aS10YXNrbGlzdCc7XG5pbXBvcnQgeyBQcm9jZXNzSW5zdGFuY2UgfSBmcm9tICcuLi9tb2RlbHMvcHJvY2Vzcy1pbnN0YW5jZS5tb2RlbCc7XG5cbmRlY2xhcmUgbGV0IGNvbXBvbmVudEhhbmRsZXI6IGFueTtcbmRlY2xhcmUgbGV0IGRpYWxvZ1BvbHlmaWxsOiBhbnk7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWN0aXZpdGktcHJvY2Vzcy1pbnN0YW5jZS10YXNrcycsXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICB0ZW1wbGF0ZTogXCI8ZGl2ICAqbmdJZj1cXFwic2hvd1JlZnJlc2hCdXR0b25cXFwiIGNsYXNzPVxcXCJwcm9jZXNzLXRhc2tzLXJlZnJlc2hcXFwiID4gICAgIDxidXR0b24gKGNsaWNrKT1cXFwib25SZWZyZXNoQ2xpY2tlZCgpXFxcIiBjbGFzcz1cXFwibWRsLWJ1dHRvbiBtZGwtYnV0dG9uLS1pY29uIG1kbC1qcy1idXR0b24gbWRsLWpzLXJpcHBsZS1lZmZlY3RcXFwiPiAgICAgICAgIDxpIGNsYXNzPVxcXCJtYXRlcmlhbC1pY29uc1xcXCI+cmVmcmVzaDwvaT4gICAgIDwvYnV0dG9uPiA8L2Rpdj4gIDwhLS0gQUNUSVZFIEZPUk0gLS0+ICA8c3BhbiBjbGFzcz1cXFwiYWN0aXZpdGktbGFiZWwgbWRsLWJhZGdlXFxcIiAgICAgICBbYXR0ci5kYXRhLWJhZGdlXT1cXFwiYWN0aXZlVGFza3M/Lmxlbmd0aFxcXCI+e3sgJ0RFVEFJTFMuTEFCRUxTLlRBU0tTX0FDVElWRSd8dHJhbnNsYXRlIH19PC9zcGFuPiAgPGRpdiBjbGFzcz1cXFwibWVudS1jb250YWluZXJcXFwiICpuZ0lmPVxcXCJhY3RpdmVUYXNrcz8ubGVuZ3RoID4gMFxcXCIgZGF0YS1hdXRvbWF0aW9uLWlkPVxcXCJhY3RpdmUtdGFza3NcXFwiPiAgICAgPHVsIGNsYXNzPSdtZGwtbGlzdCc+ICAgICAgICAgPGxpIGNsYXNzPVxcXCJtZGwtbGlzdF9faXRlbSBtZGwtbGlzdF9faXRlbS0tdHdvLWxpbmUgcHJvY2Vzcy10YXNrc19fdGFzay1pdGVtXFxcIiAqbmdGb3I9XFxcImxldCB0YXNrIG9mIGFjdGl2ZVRhc2tzXFxcIj4gICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcIm1kbC1saXN0X19pdGVtLXByaW1hcnktY29udGVudFxcXCIgKGNsaWNrKT1cXFwiY2xpY2tUYXNrKCRldmVudCwgdGFzaylcXFwiPiAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XFxcIm1hdGVyaWFsLWljb25zIG1kbC1saXN0X19pdGVtLWljb25cXFwiPmFzc2lnbm1lbnQ8L2k+ICAgICAgICAgICAgICAgICA8c3Bhbj57e3Rhc2submFtZSB8fCAnTmFtZWxlc3MgdGFzayd9fTwvc3Bhbj4gICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJtZGwtbGlzdF9faXRlbS1zdWItdGl0bGVcXFwiPiAgICAgICAgICAgICAgICAgICAgIHt7ICdERVRBSUxTLkxBQkVMUy5UQVNLX1NVQlRJVExFJyB8IHRyYW5zbGF0ZTp7dXNlcjogZ2V0VXNlckZ1bGxOYW1lKHRhc2suYXNzaWduZWUpLCBjcmVhdGVkOiBnZXRGb3JtYXREYXRlKHRhc2suY3JlYXRlZCwgJ21lZGl1bURhdGUnKSB9IH19ICAgICAgICAgICAgICAgICA8L3NwYW4+ICAgICAgICAgICAgIDwvc3Bhbj4gICAgICAgICA8L2xpPiAgICAgPC91bD4gPC9kaXY+ICA8IS0tIFNUQVJUIEZPUk0gLS0+ICA8ZGl2ICpuZ0lmPVxcXCJhY3RpdmVUYXNrcz8ubGVuZ3RoID09PSAwXFxcIiBkYXRhLWF1dG9tYXRpb24taWQ9XFxcImFjdGl2ZS10YXNrcy1ub25lXFxcIiBjbGFzcz1cXFwibm8tcmVzdWx0c1xcXCI+ICAgICB7eyAnREVUQUlMUy5UQVNLUy5OT19BQ1RJVkUnIHwgdHJhbnNsYXRlIH19IDwvZGl2PiAgPGRpdiAqbmdJZj1cXFwiaGFzU3RhcnRGb3JtRGVmaW5lZCgpXFxcIj4gICAgIDxzcGFuIGNsYXNzPVxcXCJhY3Rpdml0aS1sYWJlbFxcXCI+e3sgJ0RFVEFJTFMuTEFCRUxTLlNUQVJUX0ZPUk0nfHRyYW5zbGF0ZSB9fTwvc3Bhbj4gICAgICA8IS0tSUYgU1RBUlQgVEFTSyBDT01QTEVURUQgLS0+ICAgICA8ZGl2IGNsYXNzPVxcXCJtZW51LWNvbnRhaW5lclxcXCI+ICAgICAgICAgPHVsIGNsYXNzPSdtZGwtbGlzdCc+ICAgICAgICAgICAgIDxsaSBjbGFzcz1cXFwibWRsLWxpc3RfX2l0ZW0gbWRsLWxpc3RfX2l0ZW0tLXR3by1saW5lIHByb2Nlc3MtdGFza3NfX3Rhc2staXRlbVxcXCI+ICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwibWRsLWxpc3RfX2l0ZW0tcHJpbWFyeS1jb250ZW50XFxcIiAoY2xpY2spPVxcXCJjbGlja1N0YXJ0VGFzaygkZXZlbnQpXFxcIj4gICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cXFwibWF0ZXJpYWwtaWNvbnMgbWRsLWxpc3RfX2l0ZW0taWNvblxcXCI+YXNzaWdubWVudDwvaT4gICAgICAgICAgICAgICAgICAgICA8c3Bhbj57eyAnREVUQUlMUy5MQUJFTFMuU1RBUlRfRk9STSd8dHJhbnNsYXRlIH19PC9zcGFuPiAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJtZGwtbGlzdF9faXRlbS1zdWItdGl0bGVcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICB7eyAnREVUQUlMUy5MQUJFTFMuVEFTS19TVUJUSVRMRScgfCB0cmFuc2xhdGU6e3VzZXI6Z2V0VXNlckZ1bGxOYW1lKHByb2Nlc3NJbnN0YW5jZURldGFpbHMuc3RhcnRlZEJ5KSwgY3JlYXRlZDogZ2V0Rm9ybWF0RGF0ZShwcm9jZXNzSW5zdGFuY2VEZXRhaWxzLnN0YXJ0ZWQsICdtZWRpdW1EYXRlJykgfSB9fSAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4gICAgICAgICAgICAgICAgIDwvc3Bhbj4gICAgICAgICAgICAgPC9saT4gICAgICAgICA8L3VsPiAgICAgPC9kaXY+ICA8L2Rpdj4gIDwhLS0gQ09NUExFVEVEIEZPUk0gLS0+IDxzcGFuIGNsYXNzPVxcXCJhY3Rpdml0aS1sYWJlbCBtZGwtYmFkZ2VcXFwiICAgICAgIFthdHRyLmRhdGEtYmFkZ2VdPVxcXCJjb21wbGV0ZWRUYXNrcz8ubGVuZ3RoXFxcIj57eyAnREVUQUlMUy5MQUJFTFMuVEFTS1NfQ09NUExFVEVEJ3x0cmFuc2xhdGUgfX08L3NwYW4+ICA8ZGl2IGNsYXNzPVxcXCJtZW51LWNvbnRhaW5lclxcXCIgKm5nSWY9XFxcImNvbXBsZXRlZFRhc2tzPy5sZW5ndGggPiAwXFxcIiBkYXRhLWF1dG9tYXRpb24taWQ9XFxcImNvbXBsZXRlZC10YXNrc1xcXCI+ICAgICA8dWwgY2xhc3M9J21kbC1saXN0Jz4gICAgICAgICA8bGkgY2xhc3M9XFxcIm1kbC1saXN0X19pdGVtIG1kbC1saXN0X19pdGVtLS10d28tbGluZSBwcm9jZXNzLXRhc2tzX190YXNrLWl0ZW1cXFwiICpuZ0Zvcj1cXFwibGV0IHRhc2sgb2YgY29tcGxldGVkVGFza3NcXFwiPiAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwibWRsLWxpc3RfX2l0ZW0tcHJpbWFyeS1jb250ZW50XFxcIiAoY2xpY2spPVxcXCJjbGlja1Rhc2soJGV2ZW50LCB0YXNrKVxcXCI+ICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cXFwibWF0ZXJpYWwtaWNvbnMgbWRsLWxpc3RfX2l0ZW0taWNvblxcXCI+YXNzaWdubWVudDwvaT4gICAgICAgICAgICAgICAgIDxzcGFuPnt7dGFzay5uYW1lIHx8ICdOYW1lbGVzcyB0YXNrJ319PC9zcGFuPiAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcIm1kbC1saXN0X19pdGVtLXN1Yi10aXRsZVxcXCI+ICAgICAgICAgICAgICAgICAgICAge3sgJ0RFVEFJTFMuTEFCRUxTLlRBU0tfU1VCVElUTEUnIHwgdHJhbnNsYXRlOnt1c2VyOmdldFVzZXJGdWxsTmFtZSh0YXNrLmFzc2lnbmVlKSwgY3JlYXRlZDogZ2V0Rm9ybWF0RGF0ZSh0YXNrLmNyZWF0ZWQsICdtZWRpdW1EYXRlJykgfSB9fSAgICAgICAgICAgICAgICAgPC9zcGFuPiAgICAgICAgICAgICA8L3NwYW4+ICAgICAgICAgPC9saT4gICAgIDwvdWw+IDwvZGl2PiAgPGRpdiAqbmdJZj1cXFwiY29tcGxldGVkVGFza3M/Lmxlbmd0aCA9PT0gMFxcXCIgZGF0YS1hdXRvbWF0aW9uLWlkPVxcXCJjb21wbGV0ZWQtdGFza3Mtbm9uZVxcXCIgY2xhc3M9XFxcIm5vLXJlc3VsdHNcXFwiPiAgICAge3sgJ0RFVEFJTFMuVEFTS1MuTk9fQ09NUExFVEVEJyB8IHRyYW5zbGF0ZSB9fSA8L2Rpdj4gIDxkaWFsb2cgKm5nSWY9XFxcImhhc1N0YXJ0Rm9ybURlZmluZWQoKVxcXCIgY2xhc3M9XFxcIm1kbC1kaWFsb2cgdGFzay1kZXRhaWxzLWRpYWxvZ1xcXCIgI3N0YXJ0RGlhbG9nPiAgICAgPGg0IGNsYXNzPVxcXCJtZGwtZGlhbG9nX190aXRsZVxcXCI+e3sgJ0RFVEFJTFMuTEFCRUxTLlNUQVJUX0ZPUk0nfHRyYW5zbGF0ZSB9fTwvaDQ+ICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtZGlhbG9nX19jb250ZW50IGZvcm1fX3NpemVcXFwiPiAgICAgICAgIDxhY3Rpdml0aS1zdGFydC1mb3JtIFtwcm9jZXNzSWRdPVxcXCJwcm9jZXNzSWRcXFwiIFtwcm9jZXNzRGVmaW5pdGlvbklkXT1cXFwicHJvY2Vzc0luc3RhbmNlRGV0YWlscz8ucHJvY2Vzc0RlZmluaXRpb25JZFxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbc2hvd1JlZnJlc2hCdXR0b25dPVxcXCJmYWxzZVxcXCIgW3JlYWRPbmx5Rm9ybV09XFxcInRydWVcXFwiID4gICAgICAgICA8L2FjdGl2aXRpLXN0YXJ0LWZvcm0+ICAgICA8L2Rpdj4gICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1kaWFsb2dfX2FjdGlvbnNcXFwiPiAgICAgICAgIDxidXR0b24gdHlwZT1cXFwiYnV0dG9uXFxcIiAoY2xpY2spPVxcXCJjbG9zZVNhcnREaWFsb2coKVxcXCIgY2xhc3M9XFxcIm1kbC1idXR0b24gY2xvc2VcXFwiPnt7ICdERVRBSUxTLlRBU0tTLlRBU0tfQ0xPU0UnIHwgdHJhbnNsYXRlIH19PC9idXR0b24+ICAgICA8L2Rpdj4gPC9kaWFsb2c+XCIsXG4gICAgc3R5bGVzOiBbXCI6aG9zdCB7ICAgICB3aWR0aDogMTAwJTsgfSAgLmFjdGl2aXRpLWxhYmVsIHsgICAgIGZvbnQtd2VpZ2h0OiBib2xkZXI7ICAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOyB9ICAuYWN0aXZpdGktbGFiZWwubWRsLWJhZGdlW2RhdGEtYmFkZ2VdOmFmdGVyIHsgICAgIHJpZ2h0OiAtMjdweDsgICAgIHRvcDogLTJweDsgfSAgLmFjdGl2aXRpLWxhYmVsICsgLmljb24geyAgICAgcG9zaXRpb246IHJlbGF0aXZlOyAgICAgdG9wOiAtMnB4OyB9ICAubWF0ZXJpYWwtaWNvbnM6aG92ZXIgeyAgICAgY29sb3I6IHJnYigyNTUsIDE1MiwgMCk7IH0gIC50YXNrLWRldGFpbHMtZGlhbG9nIHsgICAgIHBvc2l0aW9uOiBmaXhlZDsgICAgIHRvcDogNTAlOyAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgLTUwJSk7ICAgICB3aWR0aDogNDAlOyB9ICAucHJvY2Vzcy10YXNrcy1yZWZyZXNoIHsgICAgIGZsb2F0OiByaWdodDsgfSAgLm1kbC1kaWFsb2dfX2NvbnRlbnQuZm9ybV9fc2l6ZSB7ICAgICBoZWlnaHQ6IDQwMHB4OyAgICAgb3ZlcmZsb3cteTogYXV0bzsgfSAgLm5vLXJlc3VsdHMgeyAgICAgbWFyZ2luLWxlZnQ6IDlweDsgICAgIGZvbnQtc2l6ZTogMTRweDsgICAgIGZvbnQtd2VpZ2h0OiA0MDA7ICAgICBsZXR0ZXItc3BhY2luZzogMDsgICAgIGxpbmUtaGVpZ2h0OiAxOHB4OyAgICAgY29sb3I6IHJnYmEoMCwgMCwgMCwgLjU0KTsgICAgIGRpc3BsYXk6IGJsb2NrOyAgICAgcGFkZGluZzogMTJweDsgfSAgLnByb2Nlc3MtdGFza3NfX3Rhc2staXRlbSB7ICAgICBjdXJzb3I6IHBvaW50ZXI7IH1cIl1cbn0pXG5leHBvcnQgY2xhc3MgQWN0aXZpdGlQcm9jZXNzSW5zdGFuY2VUYXNrcyBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcblxuICAgIEBJbnB1dCgpXG4gICAgcHJvY2Vzc0luc3RhbmNlRGV0YWlsczogUHJvY2Vzc0luc3RhbmNlO1xuXG4gICAgQElucHV0KClcbiAgICBzaG93UmVmcmVzaEJ1dHRvbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBhY3RpdmVUYXNrczogVGFza0RldGFpbHNNb2RlbFtdID0gW107XG4gICAgY29tcGxldGVkVGFza3M6IFRhc2tEZXRhaWxzTW9kZWxbXSA9IFtdO1xuXG4gICAgcHJpdmF0ZSB0YXNrT2JzZXJ2ZXI6IE9ic2VydmVyPFRhc2tEZXRhaWxzTW9kZWw+O1xuICAgIHByaXZhdGUgY29tcGxldGVkVGFza09ic2VydmVyOiBPYnNlcnZlcjxUYXNrRGV0YWlsc01vZGVsPjtcblxuICAgIHRhc2skOiBPYnNlcnZhYmxlPFRhc2tEZXRhaWxzTW9kZWw+O1xuICAgIGNvbXBsZXRlZFRhc2skOiBPYnNlcnZhYmxlPFRhc2tEZXRhaWxzTW9kZWw+O1xuXG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIHByb2Nlc3NJZDogc3RyaW5nO1xuXG4gICAgQFZpZXdDaGlsZCgnZGlhbG9nJylcbiAgICBkaWFsb2c6IGFueTtcblxuICAgIEBWaWV3Q2hpbGQoJ3N0YXJ0RGlhbG9nJylcbiAgICBzdGFydERpYWxvZzogYW55O1xuXG4gICAgQFZpZXdDaGlsZCgndGFza2RldGFpbHMnKVxuICAgIHRhc2tkZXRhaWxzOiBhbnk7XG5cbiAgICBAT3V0cHV0KClcbiAgICB0YXNrQ2xpY2s6IEV2ZW50RW1pdHRlcjxUYXNrRGV0YWlsc0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8VGFza0RldGFpbHNFdmVudD4oKTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlOiBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFjdGl2aXRpUHJvY2VzczogQWN0aXZpdGlQcm9jZXNzU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UpIHtcbiAgICAgICAgaWYgKHRyYW5zbGF0ZSkge1xuICAgICAgICAgICAgdHJhbnNsYXRlLmFkZFRyYW5zbGF0aW9uRm9sZGVyKCduZzItYWN0aXZpdGktcHJvY2Vzc2xpc3QnLCAnbm9kZV9tb2R1bGVzL25nMi1hY3Rpdml0aS1wcm9jZXNzbGlzdC9zcmMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGFzayQgPSBuZXcgT2JzZXJ2YWJsZTxUYXNrRGV0YWlsc01vZGVsPihvYnNlcnZlciA9PiB0aGlzLnRhc2tPYnNlcnZlciA9IG9ic2VydmVyKS5zaGFyZSgpO1xuICAgICAgICB0aGlzLmNvbXBsZXRlZFRhc2skID0gbmV3IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD4ob2JzZXJ2ZXIgPT4gdGhpcy5jb21wbGV0ZWRUYXNrT2JzZXJ2ZXIgPSBvYnNlcnZlcikuc2hhcmUoKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy50YXNrJC5zdWJzY3JpYmUoKHRhc2s6IFRhc2tEZXRhaWxzTW9kZWwpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlVGFza3MucHVzaCh0YXNrKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29tcGxldGVkVGFzayQuc3Vic2NyaWJlKCh0YXNrOiBUYXNrRGV0YWlsc01vZGVsKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlZFRhc2tzLnB1c2godGFzayk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgbGV0IHByb2Nlc3NJbnN0YW5jZURldGFpbHMgPSBjaGFuZ2VzWydwcm9jZXNzSW5zdGFuY2VEZXRhaWxzJ107XG4gICAgICAgIGlmIChwcm9jZXNzSW5zdGFuY2VEZXRhaWxzICYmIHByb2Nlc3NJbnN0YW5jZURldGFpbHMuY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWQocHJvY2Vzc0luc3RhbmNlRGV0YWlscy5jdXJyZW50VmFsdWUuaWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbG9hZChwcm9jZXNzSWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLmxvYWRBY3RpdmUocHJvY2Vzc0lkKTtcbiAgICAgICAgdGhpcy5sb2FkQ29tcGxldGVkKHByb2Nlc3NJZCk7XG4gICAgfVxuXG4gICAgbG9hZEFjdGl2ZShwcm9jZXNzSWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLmFjdGl2ZVRhc2tzID0gW107XG4gICAgICAgIGlmIChwcm9jZXNzSWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLmdldFByb2Nlc3NUYXNrcyhwcm9jZXNzSWQsIG51bGwpLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAocmVzOiBUYXNrRGV0YWlsc01vZGVsW10pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmZvckVhY2goKHRhc2spID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGFza09ic2VydmVyLm5leHQodGFzayk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVUYXNrcyA9IFtdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbG9hZENvbXBsZXRlZChwcm9jZXNzSWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLmNvbXBsZXRlZFRhc2tzID0gW107XG4gICAgICAgIGlmIChwcm9jZXNzSWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLmdldFByb2Nlc3NUYXNrcyhwcm9jZXNzSWQsICdjb21wbGV0ZWQnKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHJlczogVGFza0RldGFpbHNNb2RlbFtdKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcy5mb3JFYWNoKCh0YXNrKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlZFRhc2tPYnNlcnZlci5uZXh0KHRhc2spO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY29tcGxldGVkVGFza3MgPSBbXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhc1N0YXJ0Rm9ybURlZmluZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMgJiYgdGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzLnN0YXJ0Rm9ybURlZmluZWQgPT09IHRydWU7XG4gICAgfVxuXG4gICAgZ2V0VXNlckZ1bGxOYW1lKHVzZXI6IGFueSkge1xuICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICAgcmV0dXJuICh1c2VyLmZpcnN0TmFtZSAmJiB1c2VyLmZpcnN0TmFtZSAhPT0gJ251bGwnXG4gICAgICAgICAgICAgICAgICAgID8gdXNlci5maXJzdE5hbWUgKyAnICcgOiAnJykgK1xuICAgICAgICAgICAgICAgIHVzZXIubGFzdE5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICdOb2JvZHknO1xuICAgIH1cblxuICAgIGdldEZvcm1hdERhdGUodmFsdWUsIGZvcm1hdDogc3RyaW5nKSB7XG4gICAgICAgIGxldCBkYXRlUGlwZSA9IG5ldyBEYXRlUGlwZSgnZW4tVVMnKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBkYXRlUGlwZS50cmFuc2Zvcm0odmFsdWUsIGZvcm1hdCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGBQcm9jZXNzTGlzdEluc3RhbmNlVGFzazogZXJyb3IgcGFyc2luZyBkYXRlICR7dmFsdWV9IHRvIGZvcm1hdCAke2Zvcm1hdH1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNsaWNrVGFzaygkZXZlbnQ6IGFueSwgdGFzazogVGFza0RldGFpbHNNb2RlbCkge1xuICAgICAgICBsZXQgYXJncyA9IG5ldyBUYXNrRGV0YWlsc0V2ZW50KHRhc2spO1xuICAgICAgICB0aGlzLnRhc2tDbGljay5lbWl0KGFyZ3MpO1xuICAgIH1cblxuICAgIGNsaWNrU3RhcnRUYXNrKCkge1xuICAgICAgICB0aGlzLnByb2Nlc3NJZCA9IHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscy5pZDtcbiAgICAgICAgdGhpcy5zaG93U3RhcnREaWFsb2coKTtcbiAgICB9XG5cbiAgICBzaG93U3RhcnREaWFsb2coKSB7XG4gICAgICAgIGlmICghdGhpcy5zdGFydERpYWxvZy5uYXRpdmVFbGVtZW50LnNob3dNb2RhbCkge1xuICAgICAgICAgICAgZGlhbG9nUG9seWZpbGwucmVnaXN0ZXJEaWFsb2codGhpcy5zdGFydERpYWxvZy5uYXRpdmVFbGVtZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnN0YXJ0RGlhbG9nKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0RGlhbG9nLm5hdGl2ZUVsZW1lbnQuc2hvd01vZGFsKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjbG9zZVNhcnREaWFsb2coKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXJ0RGlhbG9nKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0RGlhbG9nLm5hdGl2ZUVsZW1lbnQuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uUmVmcmVzaENsaWNrZWQoKSB7XG4gICAgICAgIHRoaXMubG9hZCh0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMuaWQpO1xuICAgIH1cbn1cbiJdfQ==
