/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var activiti_process_service_1 = require("./../services/activiti-process.service");
var Observable_1 = require("rxjs/Observable");
var ActivitiProcessComments = (function () {
    function ActivitiProcessComments(translate, activitiProcess) {
        var _this = this;
        this.translate = translate;
        this.activitiProcess = activitiProcess;
        this.error = new core_1.EventEmitter();
        this.comments = [];
        if (translate) {
            translate.addTranslationFolder('ng2-activiti-processlist', 'node_modules/ng2-activiti-processlist/src');
        }
        this.comment$ = new Observable_1.Observable(function (observer) { return _this.commentObserver = observer; }).share();
        this.comment$.subscribe(function (comment) {
            _this.comments.push(comment);
        });
    }
    ActivitiProcessComments.prototype.ngOnChanges = function (changes) {
        var processInstanceId = changes['processInstanceId'];
        if (processInstanceId) {
            if (processInstanceId.currentValue) {
                this.getProcessComments(processInstanceId.currentValue);
            }
            else {
                this.resetComments();
            }
        }
    };
    ActivitiProcessComments.prototype.getProcessComments = function (processInstanceId) {
        var _this = this;
        this.comments = [];
        if (processInstanceId) {
            this.activitiProcess.getProcessInstanceComments(processInstanceId).subscribe(function (res) {
                res.forEach(function (comment) {
                    _this.commentObserver.next(comment);
                });
            }, function (err) {
                _this.error.emit(err);
            });
        }
        else {
            this.resetComments();
        }
    };
    ActivitiProcessComments.prototype.resetComments = function () {
        this.comments = [];
    };
    ActivitiProcessComments.prototype.showDialog = function () {
        if (!this.dialog.nativeElement.showModal) {
            dialogPolyfill.registerDialog(this.dialog.nativeElement);
        }
        if (this.dialog) {
            this.dialog.nativeElement.showModal();
        }
    };
    ActivitiProcessComments.prototype.add = function () {
        var _this = this;
        this.activitiProcess.addProcessInstanceComment(this.processInstanceId, this.message).subscribe(function (res) {
            _this.comments.push(res);
            _this.message = '';
        }, function (err) {
            _this.error.emit(err);
        });
        this.cancel();
    };
    ActivitiProcessComments.prototype.cancel = function () {
        if (this.dialog) {
            this.dialog.nativeElement.close();
        }
    };
    return ActivitiProcessComments;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiProcessComments.prototype, "processInstanceId", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiProcessComments.prototype, "error", void 0);
__decorate([
    core_1.ViewChild('dialog'),
    __metadata("design:type", Object)
], ActivitiProcessComments.prototype, "dialog", void 0);
ActivitiProcessComments = __decorate([
    core_1.Component({
        selector: 'activiti-process-instance-comments',
        moduleId: module.id,
        template: "<span class=\"activiti-label mdl-badge\"       [attr.data-badge]=\"comments?.length\">{{ 'DETAILS.LABELS.COMMENTS' |translate }}</span> <div id=\"addComment\" (click)=\"showDialog()\" class=\"icon material-icons\">add</div> <div class=\"mdl-tooltip\" for=\"addComment\">     {{ 'DETAILS.COMMENTS.BUTTON.ADD' |translate }} </div>  <div class=\"menu-container\" *ngIf=\"comments?.length > 0\">     <ul class='mdl-list'>         <li class=\"mdl-list__item list-wrap\" *ngFor=\"let comment of comments\">             <span class=\"mdl-list__item-primary-content hide-long-names\">             <i class=\"material-icons mdl-list__item-icon\">comment</i>             {{comment.message}}             </span>         </li>     </ul> </div> <div *ngIf=\"comments?.length === 0\" data-automation-id=\"comments-none\">     {{ 'DETAILS.COMMENTS.NONE' | translate }} </div>   <dialog class=\"mdl-dialog\" #dialog> <h4 class=\"mdl-dialog__title\">{{ 'DETAILS.COMMENTS.ADD_DIALOG.TITLE' |translate }}</h4>     <div class=\"mdl-dialog__content\">         <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">             <textarea class=\"mdl-textfield__input\" type=\"text\" [(ngModel)]=\"message\" rows=\"1\" id=\"commentText\"></textarea>             <label class=\"mdl-textfield__label\" for=\"commentText\">{{ 'DETAILS.COMMENTS.ADD_DIALOG.LABEL.MESSAGE' |translate }}</label>         </div>     </div>     <div class=\"mdl-dialog__actions\">         <button type=\"button\" (click)=\"add()\" class=\"mdl-button\">{{ 'DETAILS.COMMENTS.ADD_DIALOG.BUTTON.ADD' |translate }}</button>         <button type=\"button\" (click)=\"cancel()\" class=\"mdl-button close\">{{ 'DETAILS.COMMENTS.ADD_DIALOG.BUTTON.CANCEL' |translate }}</button>     </div> </dialog>",
        styles: [":host {     width: 100%; }  .activiti-label {     font-weight: bolder;     vertical-align: top; }  .activiti-label.mdl-badge[data-badge]:after {     right: -27px;     top: -2px; }  .activiti-label + .icon {     position: relative;     top: -2px; }  .material-icons {     cursor: pointer; }  .list-wrap {     word-wrap: break-word;     word-break: break-all;     -moz-hyphens:auto;     -webkit-hyphens:auto;     -o-hyphens:auto;     hyphens:auto; }  .hide-long-names {     overflow: auto; }"],
        providers: [activiti_process_service_1.ActivitiProcessService]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        activiti_process_service_1.ActivitiProcessService])
], ActivitiProcessComments);
exports.ActivitiProcessComments = ActivitiProcessComments;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktcHJvY2Vzcy1jb21tZW50cy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQUE0RztBQUM1Ryx1REFBK0Q7QUFDL0QsbUZBQWdGO0FBR2hGLDhDQUE2QztBQVk3QyxJQUFhLHVCQUF1QjtJQXdCaEMsaUNBQW9CLFNBQXFDLEVBQ3JDLGVBQXVDO1FBRDNELGlCQVdDO1FBWG1CLGNBQVMsR0FBVCxTQUFTLENBQTRCO1FBQ3JDLG9CQUFlLEdBQWYsZUFBZSxDQUF3QjtRQW5CM0QsVUFBSyxHQUFzQixJQUFJLG1CQUFZLEVBQU8sQ0FBQztRQUtuRCxhQUFRLEdBQWUsRUFBRSxDQUFDO1FBZ0J0QixFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ1osU0FBUyxDQUFDLG9CQUFvQixDQUFDLDBCQUEwQixFQUFFLDJDQUEyQyxDQUFDLENBQUM7UUFDNUcsQ0FBQztRQUVELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSx1QkFBVSxDQUFVLFVBQUEsUUFBUSxJQUFJLE9BQUEsS0FBSSxDQUFDLGVBQWUsR0FBRyxRQUFRLEVBQS9CLENBQStCLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUM3RixJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxVQUFDLE9BQWdCO1lBQ3JDLEtBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELDZDQUFXLEdBQVgsVUFBWSxPQUFzQjtRQUM5QixJQUFJLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ3JELEVBQUUsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztZQUNwQixFQUFFLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFD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QUM7cUNBeUJpQyw4Q0FBMEI7UUFDcEIsaURBQXNCO0dBekJsRCx1QkFBdUIsQ0FpR25DO0FBakdZLDBEQUF1QiIsImZpbGUiOiJjb21wb25lbnRzL2FjdGl2aXRpLXByb2Nlc3MtY29tbWVudHMuY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFZpZXdDaGlsZCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSB9IGZyb20gJ25nMi1hbGZyZXNjby1jb3JlJztcbmltcG9ydCB7IEFjdGl2aXRpUHJvY2Vzc1NlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL2FjdGl2aXRpLXByb2Nlc3Muc2VydmljZSc7XG5pbXBvcnQgeyBDb21tZW50IH0gZnJvbSAnbmcyLWFjdGl2aXRpLXRhc2tsaXN0JztcbmltcG9ydCB7IE9ic2VydmVyIH0gZnJvbSAncnhqcy9PYnNlcnZlcic7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcy9PYnNlcnZhYmxlJztcblxuZGVjbGFyZSBsZXQgY29tcG9uZW50SGFuZGxlcjogYW55O1xuZGVjbGFyZSBsZXQgZGlhbG9nUG9seWZpbGw6IGFueTtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhY3Rpdml0aS1wcm9jZXNzLWluc3RhbmNlLWNvbW1lbnRzJyxcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHRlbXBsYXRlOiBcIjxzcGFuIGNsYXNzPVxcXCJhY3Rpdml0aS1sYWJlbCBtZGwtYmFkZ2VcXFwiICAgICAgIFthdHRyLmRhdGEtYmFkZ2VdPVxcXCJjb21tZW50cz8ubGVuZ3RoXFxcIj57eyAnREVUQUlMUy5MQUJFTFMuQ09NTUVOVFMnIHx0cmFuc2xhdGUgfX08L3NwYW4+IDxkaXYgaWQ9XFxcImFkZENvbW1lbnRcXFwiIChjbGljayk9XFxcInNob3dEaWFsb2coKVxcXCIgY2xhc3M9XFxcImljb24gbWF0ZXJpYWwtaWNvbnNcXFwiPmFkZDwvZGl2PiA8ZGl2IGNsYXNzPVxcXCJtZGwtdG9vbHRpcFxcXCIgZm9yPVxcXCJhZGRDb21tZW50XFxcIj4gICAgIHt7ICdERVRBSUxTLkNPTU1FTlRTLkJVVFRPTi5BREQnIHx0cmFuc2xhdGUgfX0gPC9kaXY+ICA8ZGl2IGNsYXNzPVxcXCJtZW51LWNvbnRhaW5lclxcXCIgKm5nSWY9XFxcImNvbW1lbnRzPy5sZW5ndGggPiAwXFxcIj4gICAgIDx1bCBjbGFzcz0nbWRsLWxpc3QnPiAgICAgICAgIDxsaSBjbGFzcz1cXFwibWRsLWxpc3RfX2l0ZW0gbGlzdC13cmFwXFxcIiAqbmdGb3I9XFxcImxldCBjb21tZW50IG9mIGNvbW1lbnRzXFxcIj4gICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcIm1kbC1saXN0X19pdGVtLXByaW1hcnktY29udGVudCBoaWRlLWxvbmctbmFtZXNcXFwiPiAgICAgICAgICAgICA8aSBjbGFzcz1cXFwibWF0ZXJpYWwtaWNvbnMgbWRsLWxpc3RfX2l0ZW0taWNvblxcXCI+Y29tbWVudDwvaT4gICAgICAgICAgICAge3tjb21tZW50Lm1lc3NhZ2V9fSAgICAgICAgICAgICA8L3NwYW4+ICAgICAgICAgPC9saT4gICAgIDwvdWw+IDwvZGl2PiA8ZGl2ICpuZ0lmPVxcXCJjb21tZW50cz8ubGVuZ3RoID09PSAwXFxcIiBkYXRhLWF1dG9tYXRpb24taWQ9XFxcImNvbW1lbnRzLW5vbmVcXFwiPiAgICAge3sgJ0RFVEFJTFMuQ09NTUVOVFMuTk9ORScgfCB0cmFuc2xhdGUgfX0gPC9kaXY+ICAgPGRpYWxvZyBjbGFzcz1cXFwibWRsLWRpYWxvZ1xcXCIgI2RpYWxvZz4gPGg0IGNsYXNzPVxcXCJtZGwtZGlhbG9nX190aXRsZVxcXCI+e3sgJ0RFVEFJTFMuQ09NTUVOVFMuQUREX0RJQUxPRy5USVRMRScgfHRyYW5zbGF0ZSB9fTwvaDQ+ICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtZGlhbG9nX19jb250ZW50XFxcIj4gICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkIG1kbC1qcy10ZXh0ZmllbGQgbWRsLXRleHRmaWVsZC0tZmxvYXRpbmctbGFiZWxcXFwiPiAgICAgICAgICAgICA8dGV4dGFyZWEgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGRfX2lucHV0XFxcIiB0eXBlPVxcXCJ0ZXh0XFxcIiBbKG5nTW9kZWwpXT1cXFwibWVzc2FnZVxcXCIgcm93cz1cXFwiMVxcXCIgaWQ9XFxcImNvbW1lbnRUZXh0XFxcIj48L3RleHRhcmVhPiAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGRfX2xhYmVsXFxcIiBmb3I9XFxcImNvbW1lbnRUZXh0XFxcIj57eyAnREVUQUlMUy5DT01NRU5UUy5BRERfRElBTE9HLkxBQkVMLk1FU1NBR0UnIHx0cmFuc2xhdGUgfX08L2xhYmVsPiAgICAgICAgIDwvZGl2PiAgICAgPC9kaXY+ICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtZGlhbG9nX19hY3Rpb25zXFxcIj4gICAgICAgICA8YnV0dG9uIHR5cGU9XFxcImJ1dHRvblxcXCIgKGNsaWNrKT1cXFwiYWRkKClcXFwiIGNsYXNzPVxcXCJtZGwtYnV0dG9uXFxcIj57eyAnREVUQUlMUy5DT01NRU5UUy5BRERfRElBTE9HLkJVVFRPTi5BREQnIHx0cmFuc2xhdGUgfX08L2J1dHRvbj4gICAgICAgICA8YnV0dG9uIHR5cGU9XFxcImJ1dHRvblxcXCIgKGNsaWNrKT1cXFwiY2FuY2VsKClcXFwiIGNsYXNzPVxcXCJtZGwtYnV0dG9uIGNsb3NlXFxcIj57eyAnREVUQUlMUy5DT01NRU5UUy5BRERfRElBTE9HLkJVVFRPTi5DQU5DRUwnIHx0cmFuc2xhdGUgfX08L2J1dHRvbj4gICAgIDwvZGl2PiA8L2RpYWxvZz5cIixcbiAgICBzdHlsZXM6IFtcIjpob3N0IHsgICAgIHdpZHRoOiAxMDAlOyB9ICAuYWN0aXZpdGktbGFiZWwgeyAgICAgZm9udC13ZWlnaHQ6IGJvbGRlcjsgICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7IH0gIC5hY3Rpdml0aS1sYWJlbC5tZGwtYmFkZ2VbZGF0YS1iYWRnZV06YWZ0ZXIgeyAgICAgcmlnaHQ6IC0yN3B4OyAgICAgdG9wOiAtMnB4OyB9ICAuYWN0aXZpdGktbGFiZWwgKyAuaWNvbiB7ICAgICBwb3NpdGlvbjogcmVsYXRpdmU7ICAgICB0b3A6IC0ycHg7IH0gIC5tYXRlcmlhbC1pY29ucyB7ICAgICBjdXJzb3I6IHBvaW50ZXI7IH0gIC5saXN0LXdyYXAgeyAgICAgd29yZC13cmFwOiBicmVhay13b3JkOyAgICAgd29yZC1icmVhazogYnJlYWstYWxsOyAgICAgLW1vei1oeXBoZW5zOmF1dG87ICAgICAtd2Via2l0LWh5cGhlbnM6YXV0bzsgICAgIC1vLWh5cGhlbnM6YXV0bzsgICAgIGh5cGhlbnM6YXV0bzsgfSAgLmhpZGUtbG9uZy1uYW1lcyB7ICAgICBvdmVyZmxvdzogYXV0bzsgfVwiXSxcbiAgICBwcm92aWRlcnM6IFtBY3Rpdml0aVByb2Nlc3NTZXJ2aWNlXVxufSlcbmV4cG9ydCBjbGFzcyBBY3Rpdml0aVByb2Nlc3NDb21tZW50cyBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG5cbiAgICBASW5wdXQoKVxuICAgIHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmc7XG5cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIEBWaWV3Q2hpbGQoJ2RpYWxvZycpXG4gICAgZGlhbG9nOiBhbnk7XG5cbiAgICBjb21tZW50czogQ29tbWVudCBbXSA9IFtdO1xuXG4gICAgY29tbWVudE9ic2VydmVyOiBPYnNlcnZlcjxDb21tZW50PjtcblxuICAgIGNvbW1lbnQkOiBPYnNlcnZhYmxlPENvbW1lbnQ+O1xuXG4gICAgbWVzc2FnZTogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0gdHJhbnNsYXRlIFRyYW5zbGF0aW9uIHNlcnZpY2VcbiAgICAgKiBAcGFyYW0gYWN0aXZpdGlQcm9jZXNzIFByb2Nlc3Mgc2VydmljZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlOiBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFjdGl2aXRpUHJvY2VzczogQWN0aXZpdGlQcm9jZXNzU2VydmljZSkge1xuXG4gICAgICAgIGlmICh0cmFuc2xhdGUpIHtcbiAgICAgICAgICAgIHRyYW5zbGF0ZS5hZGRUcmFuc2xhdGlvbkZvbGRlcignbmcyLWFjdGl2aXRpLXByb2Nlc3NsaXN0JywgJ25vZGVfbW9kdWxlcy9uZzItYWN0aXZpdGktcHJvY2Vzc2xpc3Qvc3JjJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNvbW1lbnQkID0gbmV3IE9ic2VydmFibGU8Q29tbWVudD4ob2JzZXJ2ZXIgPT4gdGhpcy5jb21tZW50T2JzZXJ2ZXIgPSBvYnNlcnZlcikuc2hhcmUoKTtcbiAgICAgICAgdGhpcy5jb21tZW50JC5zdWJzY3JpYmUoKGNvbW1lbnQ6IENvbW1lbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY29tbWVudHMucHVzaChjb21tZW50KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgICAgICBsZXQgcHJvY2Vzc0luc3RhbmNlSWQgPSBjaGFuZ2VzWydwcm9jZXNzSW5zdGFuY2VJZCddO1xuICAgICAgICBpZiAocHJvY2Vzc0luc3RhbmNlSWQpIHtcbiAgICAgICAgICAgIGlmIChwcm9jZXNzSW5zdGFuY2VJZC5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdldFByb2Nlc3NDb21tZW50cyhwcm9jZXNzSW5zdGFuY2VJZC5jdXJyZW50VmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0Q29tbWVudHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UHJvY2Vzc0NvbW1lbnRzKHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5jb21tZW50cyA9IFtdO1xuICAgICAgICBpZiAocHJvY2Vzc0luc3RhbmNlSWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLmdldFByb2Nlc3NJbnN0YW5jZUNvbW1lbnRzKHByb2Nlc3NJbnN0YW5jZUlkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHJlczogQ29tbWVudFtdKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcy5mb3JFYWNoKChjb21tZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbW1lbnRPYnNlcnZlci5uZXh0KGNvbW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVzZXRDb21tZW50cygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZXNldENvbW1lbnRzKCkge1xuICAgICAgICB0aGlzLmNvbW1lbnRzID0gW107XG4gICAgfVxuXG4gICAgcHVibGljIHNob3dEaWFsb2coKSB7XG4gICAgICAgIGlmICghdGhpcy5kaWFsb2cubmF0aXZlRWxlbWVudC5zaG93TW9kYWwpIHtcbiAgICAgICAgICAgIGRpYWxvZ1BvbHlmaWxsLnJlZ2lzdGVyRGlhbG9nKHRoaXMuZGlhbG9nLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmRpYWxvZykge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2cubmF0aXZlRWxlbWVudC5zaG93TW9kYWwoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBhZGQoKSB7XG4gICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLmFkZFByb2Nlc3NJbnN0YW5jZUNvbW1lbnQodGhpcy5wcm9jZXNzSW5zdGFuY2VJZCwgdGhpcy5tZXNzYWdlKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAocmVzOiBDb21tZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb21tZW50cy5wdXNoKHJlcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gJyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IuZW1pdChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICB0aGlzLmNhbmNlbCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjYW5jZWwoKSB7XG4gICAgICAgIGlmICh0aGlzLmRpYWxvZykge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2cubmF0aXZlRWxlbWVudC5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19
