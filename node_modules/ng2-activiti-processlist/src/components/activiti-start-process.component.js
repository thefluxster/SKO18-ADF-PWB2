/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var ng2_activiti_form_1 = require("ng2-activiti-form");
var process_definition_model_1 = require("./../models/process-definition.model");
var activiti_process_service_1 = require("./../services/activiti-process.service");
var ActivitiStartProcessInstance = (function () {
    function ActivitiStartProcessInstance(translate, activitiProcess) {
        this.translate = translate;
        this.activitiProcess = activitiProcess;
        this.showStartButton = true;
        this.start = new core_1.EventEmitter();
        this.processDefinitions = [];
        this.currentProcessDef = new process_definition_model_1.ProcessDefinitionRepresentation();
        this.errorMessageId = '';
        if (translate) {
            translate.addTranslationFolder('ng2-activiti-processlist', 'node_modules/ng2-activiti-processlist/src');
        }
    }
    ActivitiStartProcessInstance.prototype.ngOnChanges = function (changes) {
        var appId = changes['appId'];
        if (appId && (appId.currentValue || appId.currentValue === null)) {
            this.load(appId.currentValue);
            return;
        }
    };
    ActivitiStartProcessInstance.prototype.load = function (appId) {
        var _this = this;
        this.resetSelectedProcessDefinition();
        this.resetErrorMessage();
        this.activitiProcess.getProcessDefinitions(appId).subscribe(function (res) {
            _this.processDefinitions = res;
        }, function () {
            _this.errorMessageId = 'START_PROCESS.ERROR.LOAD_PROCESS_DEFS';
        });
    };
    ActivitiStartProcessInstance.prototype.startProcess = function (outcome) {
        var _this = this;
        if (this.currentProcessDef.id && this.name) {
            this.resetErrorMessage();
            var formValues = this.startForm ? this.startForm.form.values : undefined;
            this.activitiProcess.startProcess(this.currentProcessDef.id, this.name, outcome, formValues).subscribe(function (res) {
                _this.name = '';
                _this.start.emit(res);
            }, function (err) {
                _this.errorMessageId = 'START_PROCESS.ERROR.START';
                _this.start.error(err);
            });
        }
    };
    ActivitiStartProcessInstance.prototype.onProcessDefChange = function (processDefinitionId) {
        var processDef = this.processDefinitions.find(function (processDefinition) {
            return processDefinition.id === processDefinitionId;
        });
        if (processDef) {
            this.currentProcessDef = JSON.parse(JSON.stringify(processDef));
        }
        else {
            this.resetSelectedProcessDefinition();
        }
    };
    ActivitiStartProcessInstance.prototype.hasStartForm = function () {
        return this.currentProcessDef && this.currentProcessDef.hasStartForm;
    };
    ActivitiStartProcessInstance.prototype.isStartFormMissingOrValid = function () {
        if (this.startForm) {
            return this.startForm.form && this.startForm.form.isValid;
        }
        else {
            return true;
        }
    };
    ActivitiStartProcessInstance.prototype.validateForm = function () {
        return this.currentProcessDef.id && this.name && this.isStartFormMissingOrValid();
    };
    ActivitiStartProcessInstance.prototype.resetSelectedProcessDefinition = function () {
        this.currentProcessDef = new process_definition_model_1.ProcessDefinitionRepresentation();
    };
    ActivitiStartProcessInstance.prototype.resetErrorMessage = function () {
        this.errorMessageId = '';
    };
    ActivitiStartProcessInstance.prototype.onOutcomeClick = function (outcome) {
        this.startProcess(outcome);
    };
    ActivitiStartProcessInstance.prototype.reset = function () {
        this.resetSelectedProcessDefinition();
        this.name = '';
        if (this.startForm) {
            this.startForm.data = {};
        }
        this.resetErrorMessage();
    };
    return ActivitiStartProcessInstance;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiStartProcessInstance.prototype, "appId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiStartProcessInstance.prototype, "showStartButton", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiStartProcessInstance.prototype, "start", void 0);
__decorate([
    core_1.ViewChild(ng2_activiti_form_1.ActivitiStartForm),
    __metadata("design:type", ng2_activiti_form_1.ActivitiStartForm)
], ActivitiStartProcessInstance.prototype, "startForm", void 0);
ActivitiStartProcessInstance = __decorate([
    core_1.Component({
        selector: 'activiti-start-process',
        moduleId: module.id,
        template: "<div *ngIf=\"processDefinitions.length > 0 || errorMessageId\" class=\"mdl-card mdl-shadow--2dp\">     <div class=\"mdl-card__supporting-text\">         <div class=\"mdl-card mdl-shadow--2dp error-message\" *ngIf=\"errorMessageId\">             <div class=\"mdl-card__supporting-text\">{{errorMessageId|translate}}</div>         </div>         <div class=\"mdl-textfield mdl-js-textfield alf-mdl-selectfield\">             <select name=\"processDefinition\" [(ngModel)]=\"currentProcessDef.id\" (ngModelChange)=\"onProcessDefChange($event)\" id=\"processDefinition\" required>                 <option value=\"null\">{{'START_PROCESS.DIALOG.TYPE_PLACEHOLDER'|translate}}</option>                 <option *ngFor=\"let processDef of processDefinitions\" [value]=\"processDef.id\">                     {{processDef.name}}                 </option>             </select>             <label class=\"mdl-textfield__label\" for=\"processDefinition\">{{'START_PROCESS.DIALOG.LABEL.TYPE'|translate}}</label>         </div>         <br>         <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\" alfresco-mdl-textfield>             <input class=\"mdl-textfield__input\" type=\"text\" [(ngModel)]=\"name\" id=\"processName\" required />             <label class=\"mdl-textfield__label\" for=\"processName\">{{'START_PROCESS.DIALOG.LABEL.NAME'|translate}}</label>         </div>         <activiti-start-form *ngIf=\"hasStartForm()\" [processDefinitionId]=\"currentProcessDef.id\"                              (outcomeClick)=\"onOutcomeClick($event)\">         </activiti-start-form>     </div>     <div class=\"mdl-card__actions mdl-card--border\" *ngIf=\"!hasStartForm()\">         <button type=\"button\" [disabled]=\"!validateForm()\" (click)=\"startProcess()\" class=\"mdl-button\" data-automation-id=\"btn-start\">{{'START_PROCESS.DIALOG.ACTION.START'|translate}}</button>     </div> </div> <div *ngIf=\"processDefinitions.length === 0 && !errorMessageId\" class=\"mdl-card mdl-shadow--2dp\">     <div class=\"mdl-card__supporting-text\">         <div class=\"mdl-textfield mdl-js-textfield alf-mdl-selectfield\">             <span id=\"no-process-message\">{{'START_PROCESS.NO_PROCESS_DEFINITIONS' | translate}}</span>         </div>     </div> </div>",
        styles: [":host {     width: 100%; }  .activiti-label {     font-weight: bolder; }  .material-icons:hover {     color: rgb(255, 152, 0); }  .mdl-textfield.alf-mdl-selectfield label {     color: rgba(0,0,0,.54);     font-size: 12px;     top: 4px; }  .mdl-card {     width: 100%;     min-height: initial;     margin-bottom: 20px; }  .mdl-card .mdl-card__supporting-text {     width: 100%;     padding: 20px;     box-sizing: inherit; }  .mdl-dialog {     width: -moz-fit-content;     width: -webkit-fit-content;     width: -ms-fit-content;     width: -o-fit-content;     width: fit-content; }"]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        activiti_process_service_1.ActivitiProcessService])
], ActivitiStartProcessInstance);
exports.ActivitiStartProcessInstance = ActivitiStartProcessInstance;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktc3RhcnQtcHJvY2Vzcy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQUE0RztBQUM1Ryx1REFBK0Q7QUFDL0QsdURBQXNEO0FBRXRELGlGQUF1RjtBQUN2RixtRkFBZ0Y7QUFXaEYsSUFBYSw0QkFBNEI7SUFzQnJDLHNDQUFvQixTQUFxQyxFQUNyQyxlQUF1QztRQUR2QyxjQUFTLEdBQVQsU0FBUyxDQUE0QjtRQUNyQyxvQkFBZSxHQUFmLGVBQWUsQ0FBd0I7UUFqQjNELG9CQUFlLEdBQVksSUFBSSxDQUFDO1FBR2hDLFVBQUssR0FBa0MsSUFBSSxtQkFBWSxFQUFtQixDQUFDO1FBSzNFLHVCQUFrQixHQUFzQyxFQUFFLENBQUM7UUFJM0Qsc0JBQWlCLEdBQW9DLElBQUksMERBQStCLEVBQUUsQ0FBQztRQUUzRixtQkFBYyxHQUFXLEVBQUUsQ0FBQztRQUt4QixFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ1osU0FBUyxDQUFDLG9CQUFvQixDQUFDLDBCQUEwQixFQUFFLDJDQUEyQyxDQUFDLENBQUM7UUFDNUcsQ0FBQztJQUNMLENBQUM7SUFFRCxrREFBVyxHQUFYLFVBQVksT0FBc0I7UUFDOUIsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzdCLEVBQUUsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLElBQUksS0FBSyxDQUFDLFlBQVksS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0QsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDOUIsTUFBTSxDQUFDO1FBQ1gsQ0FBQztJQUNMLENBQUM7SUFFTSwyQ0FBSSxHQUFYLFVBQVksS0FBYTtRQUF6QixpQkFXQztRQVZHLElBQUksQ0FBQyw4QkFBOEIsRUFBRSxDQUFDO1FBQ3RDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxlQUFlLENBQUMscUJBQXFCLENBQUMsS0FBSyxDQUFDLENBQUMsU0FBUyxDQUN2RCxVQUFDLEdBQUc7WUFDQSxLQUFJLENBQUMsa0JBQWtCLEdBQUcsR0FBRyxDQUFDO1FBQ2xDLENBQUMsRUFDRDtZQUNJLEtBQUksQ0FBQyxjQUFjLEdBQUcsdUNBQXVDLENBQUM7UUFDbEUsQ0FBQyxDQUNKLENBQUM7SUFDTixDQUFDO0lBRU0sbURBQVksR0FBbkIsVUFBb0IsT0FBZ0I7UUFBcEMsaUJBZUM7UUFkRyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ3pDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3pCLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztZQUN6RSxJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFDLFNBQVMsQ0FDbEcsVUFBQyxHQUFHO2dCQUNBLEtBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO2dCQUNmLEtBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3pCLENBQUMsRUFDRCxVQUFDLEdBQUc7Z0JBQ0EsS0FBSSxDQUFDLGNBQWMsR0FBRywyQkFBMkIsQ0FBQztnQkFDbEQsS0FBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDMUIsQ0FBQyxDQUNKLENBQUM7UUFDTixDQUFDO0lBQ0wsQ0FBQztJQUVELHlEQUFrQixHQUFsQixVQUFtQixtQkFBbUI7UUFDbEMsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxVQUFDLGlCQUFpQjtZQUM1RCxNQUFNLENBQUMsaUJBQWlCLENBQUMsRUFBRSxLQUFLLG1CQUFtQixDQUFDO1FBQ3hELENBQUMsQ0FBQyxDQUFDO1FBQ0gsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNiLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUNwRSxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixJQUFJLENBQUMsOEJBQThCLEVBQUUsQ0FBQztRQUMxQyxDQUFDO0lBQ0wsQ0FBQztJQUVELG1EQUFZLEdBQVo7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLGlCQUFpQixJQUFJLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUM7SUFDekUsQ0FBQztJQUVELGdFQUF5QixHQUF6QjtRQUNJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDOUQsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ0osTUFBTSxDQUFDLElBQUksQ0FBQztRQUNoQixDQUFDO0lBQ0wsQ0FBQztJQUVELG1EQUFZLEdBQVo7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxDQUFDO0lBQ3RGLENBQUM7SUFFTyxxRUFBOEIsR0FBdEM7UUFDSSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSwwREFBK0IsRUFBRSxDQUFDO0lBQ25FLENBQUM7SUFFTyx3REFBaUIsR0FBekI7UUFDSSxJQUFJLENBQUMsY0FBYyxHQUFHLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBRU0scURBQWMsR0FBckIsVUFBc0IsT0FBZTtRQUNqQyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFFTSw0Q0FBSyxHQUFaO1FBQ0ksSUFBSSxDQUFDLDhCQUE4QixFQUFFLENBQUM7UUFDdEMsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7UUFDZixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNqQixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7UUFDN0IsQ0FBQztRQUNELElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFDTCxtQ0FBQztBQUFELENBbkhBLEFBbUhDLElBQUE7QUFoSEc7SUFEQyxZQUFLLEVBQUU7OzJEQUNNO0FBR2Q7SUFEQyxZQUFLLEVBQUU7O3FFQUN3QjtBQUdoQztJQURDLGFBQU0sRUFBRTs4QkFDRixtQkFBWTsyREFBd0Q7QUFHM0U7SUFEQyxnQkFBUyxDQUFDLHFDQUFpQixDQUFDOzhCQUNsQixxQ0FBaUI7K0RBQUM7QUFacEIsNEJBQTRCO0lBTnhDLGdCQUFTLENBQUM7UUFDUCxRQUFRLEVBQUUsd0JBQXdCO1FBQ2xDLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtRQUNuQixRQUFRLEVBQUUsK3RFQUErdEU7UUFDenVFLE1BQU0sRUFBRSxDQUFDLHFrQkFBcWtCLENBQUM7S0FDbGxCLENBQUM7cUNBdUJpQyw4Q0FBMEI7UUFDcEIsaURBQXNCO0dBdkJsRCw0QkFBNEIsQ0FtSHhDO0FBbkhZLG9FQUE0QiIsImZpbGUiOiJjb21wb25lbnRzL2FjdGl2aXRpLXN0YXJ0LXByb2Nlc3MuY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFZpZXdDaGlsZCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSB9IGZyb20gJ25nMi1hbGZyZXNjby1jb3JlJztcbmltcG9ydCB7IEFjdGl2aXRpU3RhcnRGb3JtIH0gZnJvbSAnbmcyLWFjdGl2aXRpLWZvcm0nO1xuaW1wb3J0IHsgUHJvY2Vzc0luc3RhbmNlIH0gZnJvbSAnLi8uLi9tb2RlbHMvcHJvY2Vzcy1pbnN0YW5jZS5tb2RlbCc7XG5pbXBvcnQgeyBQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uIH0gZnJvbSAnLi8uLi9tb2RlbHMvcHJvY2Vzcy1kZWZpbml0aW9uLm1vZGVsJztcbmltcG9ydCB7IEFjdGl2aXRpUHJvY2Vzc1NlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL2FjdGl2aXRpLXByb2Nlc3Muc2VydmljZSc7XG5cbmRlY2xhcmUgbGV0IGNvbXBvbmVudEhhbmRsZXI6IGFueTtcbmRlY2xhcmUgbGV0IGRpYWxvZ1BvbHlmaWxsOiBhbnk7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWN0aXZpdGktc3RhcnQtcHJvY2VzcycsXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICB0ZW1wbGF0ZTogXCI8ZGl2ICpuZ0lmPVxcXCJwcm9jZXNzRGVmaW5pdGlvbnMubGVuZ3RoID4gMCB8fCBlcnJvck1lc3NhZ2VJZFxcXCIgY2xhc3M9XFxcIm1kbC1jYXJkIG1kbC1zaGFkb3ctLTJkcFxcXCI+ICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtY2FyZF9fc3VwcG9ydGluZy10ZXh0XFxcIj4gICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtY2FyZCBtZGwtc2hhZG93LS0yZHAgZXJyb3ItbWVzc2FnZVxcXCIgKm5nSWY9XFxcImVycm9yTWVzc2FnZUlkXFxcIj4gICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwibWRsLWNhcmRfX3N1cHBvcnRpbmctdGV4dFxcXCI+e3tlcnJvck1lc3NhZ2VJZHx0cmFuc2xhdGV9fTwvZGl2PiAgICAgICAgIDwvZGl2PiAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGQgbWRsLWpzLXRleHRmaWVsZCBhbGYtbWRsLXNlbGVjdGZpZWxkXFxcIj4gICAgICAgICAgICAgPHNlbGVjdCBuYW1lPVxcXCJwcm9jZXNzRGVmaW5pdGlvblxcXCIgWyhuZ01vZGVsKV09XFxcImN1cnJlbnRQcm9jZXNzRGVmLmlkXFxcIiAobmdNb2RlbENoYW5nZSk9XFxcIm9uUHJvY2Vzc0RlZkNoYW5nZSgkZXZlbnQpXFxcIiBpZD1cXFwicHJvY2Vzc0RlZmluaXRpb25cXFwiIHJlcXVpcmVkPiAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cXFwibnVsbFxcXCI+e3snU1RBUlRfUFJPQ0VTUy5ESUFMT0cuVFlQRV9QTEFDRUhPTERFUid8dHJhbnNsYXRlfX08L29wdGlvbj4gICAgICAgICAgICAgICAgIDxvcHRpb24gKm5nRm9yPVxcXCJsZXQgcHJvY2Vzc0RlZiBvZiBwcm9jZXNzRGVmaW5pdGlvbnNcXFwiIFt2YWx1ZV09XFxcInByb2Nlc3NEZWYuaWRcXFwiPiAgICAgICAgICAgICAgICAgICAgIHt7cHJvY2Vzc0RlZi5uYW1lfX0gICAgICAgICAgICAgICAgIDwvb3B0aW9uPiAgICAgICAgICAgICA8L3NlbGVjdD4gICAgICAgICAgICAgPGxhYmVsIGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkX19sYWJlbFxcXCIgZm9yPVxcXCJwcm9jZXNzRGVmaW5pdGlvblxcXCI+e3snU1RBUlRfUFJPQ0VTUy5ESUFMT0cuTEFCRUwuVFlQRSd8dHJhbnNsYXRlfX08L2xhYmVsPiAgICAgICAgIDwvZGl2PiAgICAgICAgIDxicj4gICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkIG1kbC1qcy10ZXh0ZmllbGQgbWRsLXRleHRmaWVsZC0tZmxvYXRpbmctbGFiZWxcXFwiIGFsZnJlc2NvLW1kbC10ZXh0ZmllbGQ+ICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz1cXFwibWRsLXRleHRmaWVsZF9faW5wdXRcXFwiIHR5cGU9XFxcInRleHRcXFwiIFsobmdNb2RlbCldPVxcXCJuYW1lXFxcIiBpZD1cXFwicHJvY2Vzc05hbWVcXFwiIHJlcXVpcmVkIC8+ICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz1cXFwibWRsLXRleHRmaWVsZF9fbGFiZWxcXFwiIGZvcj1cXFwicHJvY2Vzc05hbWVcXFwiPnt7J1NUQVJUX1BST0NFU1MuRElBTE9HLkxBQkVMLk5BTUUnfHRyYW5zbGF0ZX19PC9sYWJlbD4gICAgICAgICA8L2Rpdj4gICAgICAgICA8YWN0aXZpdGktc3RhcnQtZm9ybSAqbmdJZj1cXFwiaGFzU3RhcnRGb3JtKClcXFwiIFtwcm9jZXNzRGVmaW5pdGlvbklkXT1cXFwiY3VycmVudFByb2Nlc3NEZWYuaWRcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG91dGNvbWVDbGljayk9XFxcIm9uT3V0Y29tZUNsaWNrKCRldmVudClcXFwiPiAgICAgICAgIDwvYWN0aXZpdGktc3RhcnQtZm9ybT4gICAgIDwvZGl2PiAgICAgPGRpdiBjbGFzcz1cXFwibWRsLWNhcmRfX2FjdGlvbnMgbWRsLWNhcmQtLWJvcmRlclxcXCIgKm5nSWY9XFxcIiFoYXNTdGFydEZvcm0oKVxcXCI+ICAgICAgICAgPGJ1dHRvbiB0eXBlPVxcXCJidXR0b25cXFwiIFtkaXNhYmxlZF09XFxcIiF2YWxpZGF0ZUZvcm0oKVxcXCIgKGNsaWNrKT1cXFwic3RhcnRQcm9jZXNzKClcXFwiIGNsYXNzPVxcXCJtZGwtYnV0dG9uXFxcIiBkYXRhLWF1dG9tYXRpb24taWQ9XFxcImJ0bi1zdGFydFxcXCI+e3snU1RBUlRfUFJPQ0VTUy5ESUFMT0cuQUNUSU9OLlNUQVJUJ3x0cmFuc2xhdGV9fTwvYnV0dG9uPiAgICAgPC9kaXY+IDwvZGl2PiA8ZGl2ICpuZ0lmPVxcXCJwcm9jZXNzRGVmaW5pdGlvbnMubGVuZ3RoID09PSAwICYmICFlcnJvck1lc3NhZ2VJZFxcXCIgY2xhc3M9XFxcIm1kbC1jYXJkIG1kbC1zaGFkb3ctLTJkcFxcXCI+ICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtY2FyZF9fc3VwcG9ydGluZy10ZXh0XFxcIj4gICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkIG1kbC1qcy10ZXh0ZmllbGQgYWxmLW1kbC1zZWxlY3RmaWVsZFxcXCI+ICAgICAgICAgICAgIDxzcGFuIGlkPVxcXCJuby1wcm9jZXNzLW1lc3NhZ2VcXFwiPnt7J1NUQVJUX1BST0NFU1MuTk9fUFJPQ0VTU19ERUZJTklUSU9OUycgfCB0cmFuc2xhdGV9fTwvc3Bhbj4gICAgICAgICA8L2Rpdj4gICAgIDwvZGl2PiA8L2Rpdj5cIixcbiAgICBzdHlsZXM6IFtcIjpob3N0IHsgICAgIHdpZHRoOiAxMDAlOyB9ICAuYWN0aXZpdGktbGFiZWwgeyAgICAgZm9udC13ZWlnaHQ6IGJvbGRlcjsgfSAgLm1hdGVyaWFsLWljb25zOmhvdmVyIHsgICAgIGNvbG9yOiByZ2IoMjU1LCAxNTIsIDApOyB9ICAubWRsLXRleHRmaWVsZC5hbGYtbWRsLXNlbGVjdGZpZWxkIGxhYmVsIHsgICAgIGNvbG9yOiByZ2JhKDAsMCwwLC41NCk7ICAgICBmb250LXNpemU6IDEycHg7ICAgICB0b3A6IDRweDsgfSAgLm1kbC1jYXJkIHsgICAgIHdpZHRoOiAxMDAlOyAgICAgbWluLWhlaWdodDogaW5pdGlhbDsgICAgIG1hcmdpbi1ib3R0b206IDIwcHg7IH0gIC5tZGwtY2FyZCAubWRsLWNhcmRfX3N1cHBvcnRpbmctdGV4dCB7ICAgICB3aWR0aDogMTAwJTsgICAgIHBhZGRpbmc6IDIwcHg7ICAgICBib3gtc2l6aW5nOiBpbmhlcml0OyB9ICAubWRsLWRpYWxvZyB7ICAgICB3aWR0aDogLW1vei1maXQtY29udGVudDsgICAgIHdpZHRoOiAtd2Via2l0LWZpdC1jb250ZW50OyAgICAgd2lkdGg6IC1tcy1maXQtY29udGVudDsgICAgIHdpZHRoOiAtby1maXQtY29udGVudDsgICAgIHdpZHRoOiBmaXQtY29udGVudDsgfVwiXVxufSlcbmV4cG9ydCBjbGFzcyBBY3Rpdml0aVN0YXJ0UHJvY2Vzc0luc3RhbmNlIGltcGxlbWVudHMgT25DaGFuZ2VzIHtcblxuICAgIEBJbnB1dCgpXG4gICAgYXBwSWQ6IHN0cmluZztcblxuICAgIEBJbnB1dCgpXG4gICAgc2hvd1N0YXJ0QnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIEBPdXRwdXQoKVxuICAgIHN0YXJ0OiBFdmVudEVtaXR0ZXI8UHJvY2Vzc0luc3RhbmNlPiA9IG5ldyBFdmVudEVtaXR0ZXI8UHJvY2Vzc0luc3RhbmNlPigpO1xuXG4gICAgQFZpZXdDaGlsZChBY3Rpdml0aVN0YXJ0Rm9ybSlcbiAgICBzdGFydEZvcm06IEFjdGl2aXRpU3RhcnRGb3JtO1xuXG4gICAgcHJvY2Vzc0RlZmluaXRpb25zOiBQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uW10gPSBbXTtcblxuICAgIG5hbWU6IHN0cmluZztcblxuICAgIGN1cnJlbnRQcm9jZXNzRGVmOiBQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uID0gbmV3IFByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb24oKTtcblxuICAgIGVycm9yTWVzc2FnZUlkOiBzdHJpbmcgPSAnJztcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlOiBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFjdGl2aXRpUHJvY2VzczogQWN0aXZpdGlQcm9jZXNzU2VydmljZSkge1xuXG4gICAgICAgIGlmICh0cmFuc2xhdGUpIHtcbiAgICAgICAgICAgIHRyYW5zbGF0ZS5hZGRUcmFuc2xhdGlvbkZvbGRlcignbmcyLWFjdGl2aXRpLXByb2Nlc3NsaXN0JywgJ25vZGVfbW9kdWxlcy9uZzItYWN0aXZpdGktcHJvY2Vzc2xpc3Qvc3JjJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGxldCBhcHBJZCA9IGNoYW5nZXNbJ2FwcElkJ107XG4gICAgICAgIGlmIChhcHBJZCAmJiAoYXBwSWQuY3VycmVudFZhbHVlIHx8IGFwcElkLmN1cnJlbnRWYWx1ZSA9PT0gbnVsbCkpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZChhcHBJZC5jdXJyZW50VmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGxvYWQoYXBwSWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLnJlc2V0U2VsZWN0ZWRQcm9jZXNzRGVmaW5pdGlvbigpO1xuICAgICAgICB0aGlzLnJlc2V0RXJyb3JNZXNzYWdlKCk7XG4gICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLmdldFByb2Nlc3NEZWZpbml0aW9ucyhhcHBJZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc0RlZmluaXRpb25zID0gcmVzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yTWVzc2FnZUlkID0gJ1NUQVJUX1BST0NFU1MuRVJST1IuTE9BRF9QUk9DRVNTX0RFRlMnO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGFydFByb2Nlc3Mob3V0Y29tZT86IHN0cmluZykge1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50UHJvY2Vzc0RlZi5pZCAmJiB0aGlzLm5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMucmVzZXRFcnJvck1lc3NhZ2UoKTtcbiAgICAgICAgICAgIGxldCBmb3JtVmFsdWVzID0gdGhpcy5zdGFydEZvcm0gPyB0aGlzLnN0YXJ0Rm9ybS5mb3JtLnZhbHVlcyA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLnN0YXJ0UHJvY2Vzcyh0aGlzLmN1cnJlbnRQcm9jZXNzRGVmLmlkLCB0aGlzLm5hbWUsIG91dGNvbWUsIGZvcm1WYWx1ZXMpLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmFtZSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0LmVtaXQocmVzKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2VJZCA9ICdTVEFSVF9QUk9DRVNTLkVSUk9SLlNUQVJUJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydC5lcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvblByb2Nlc3NEZWZDaGFuZ2UocHJvY2Vzc0RlZmluaXRpb25JZCkge1xuICAgICAgICBsZXQgcHJvY2Vzc0RlZiA9IHRoaXMucHJvY2Vzc0RlZmluaXRpb25zLmZpbmQoKHByb2Nlc3NEZWZpbml0aW9uKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcHJvY2Vzc0RlZmluaXRpb24uaWQgPT09IHByb2Nlc3NEZWZpbml0aW9uSWQ7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAocHJvY2Vzc0RlZikge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50UHJvY2Vzc0RlZiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocHJvY2Vzc0RlZikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZXNldFNlbGVjdGVkUHJvY2Vzc0RlZmluaXRpb24oKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhc1N0YXJ0Rm9ybSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFByb2Nlc3NEZWYgJiYgdGhpcy5jdXJyZW50UHJvY2Vzc0RlZi5oYXNTdGFydEZvcm07XG4gICAgfVxuXG4gICAgaXNTdGFydEZvcm1NaXNzaW5nT3JWYWxpZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhcnRGb3JtKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdGFydEZvcm0uZm9ybSAmJiB0aGlzLnN0YXJ0Rm9ybS5mb3JtLmlzVmFsaWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhbGlkYXRlRm9ybSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFByb2Nlc3NEZWYuaWQgJiYgdGhpcy5uYW1lICYmIHRoaXMuaXNTdGFydEZvcm1NaXNzaW5nT3JWYWxpZCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVzZXRTZWxlY3RlZFByb2Nlc3NEZWZpbml0aW9uKCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRQcm9jZXNzRGVmID0gbmV3IFByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb24oKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlc2V0RXJyb3JNZXNzYWdlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVycm9yTWVzc2FnZUlkID0gJyc7XG4gICAgfVxuXG4gICAgcHVibGljIG9uT3V0Y29tZUNsaWNrKG91dGNvbWU6IHN0cmluZykge1xuICAgICAgICB0aGlzLnN0YXJ0UHJvY2VzcyhvdXRjb21lKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMucmVzZXRTZWxlY3RlZFByb2Nlc3NEZWZpbml0aW9uKCk7XG4gICAgICAgIHRoaXMubmFtZSA9ICcnO1xuICAgICAgICBpZiAodGhpcy5zdGFydEZvcm0pIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRGb3JtLmRhdGEgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlc2V0RXJyb3JNZXNzYWdlKCk7XG4gICAgfVxufVxuIl19
