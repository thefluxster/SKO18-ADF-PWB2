/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var common_1 = require("@angular/common");
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var activiti_process_service_1 = require("./../services/activiti-process.service");
var activiti_process_instance_header_component_1 = require("./activiti-process-instance-header.component");
var activiti_process_instance_tasks_component_1 = require("./activiti-process-instance-tasks.component");
var ActivitiProcessInstanceDetails = (function () {
    function ActivitiProcessInstanceDetails(translate, activitiProcess, logService) {
        this.translate = translate;
        this.activitiProcess = activitiProcess;
        this.logService = logService;
        this.showTitle = true;
        this.showRefreshButton = true;
        this.processCancelled = new core_1.EventEmitter();
        this.taskClick = new core_1.EventEmitter();
        if (translate) {
            translate.addTranslationFolder('ng2-activiti-processlist', 'node_modules/ng2-activiti-processlist/src');
        }
    }
    ActivitiProcessInstanceDetails.prototype.ngOnChanges = function (changes) {
        var processInstanceId = changes['processInstanceId'];
        if (processInstanceId && !processInstanceId.currentValue) {
            this.reset();
            return;
        }
        if (processInstanceId && processInstanceId.currentValue) {
            this.load(processInstanceId.currentValue);
            return;
        }
    };
    ActivitiProcessInstanceDetails.prototype.reset = function () {
        this.processInstanceDetails = null;
    };
    ActivitiProcessInstanceDetails.prototype.load = function (processId) {
        var _this = this;
        if (processId) {
            this.activitiProcess.getProcess(processId).subscribe(function (res) {
                _this.processInstanceDetails = res;
            });
        }
    };
    ActivitiProcessInstanceDetails.prototype.isRunning = function () {
        return this.processInstanceDetails && !this.processInstanceDetails.ended;
    };
    ActivitiProcessInstanceDetails.prototype.cancelProcess = function () {
        var _this = this;
        this.activitiProcess.cancelProcess(this.processInstanceId).subscribe(function (data) {
            _this.processCancelled.emit(data);
        }, function (err) {
            _this.logService.error(err);
        });
    };
    ActivitiProcessInstanceDetails.prototype.onTaskClicked = function (event) {
        this.taskClick.emit(event);
    };
    ActivitiProcessInstanceDetails.prototype.getProcessNameOrDescription = function (dateFormat) {
        var name = '';
        if (this.processInstanceDetails) {
            name = this.processInstanceDetails.name ||
                this.processInstanceDetails.processDefinitionName + ' - ' + this.getFormatDate(this.processInstanceDetails.started, dateFormat);
        }
        return name;
    };
    ActivitiProcessInstanceDetails.prototype.getFormatDate = function (value, format) {
        var datePipe = new common_1.DatePipe('en-US');
        try {
            return datePipe.transform(value, format);
        }
        catch (err) {
            this.logService.error("ProcessListInstanceHeader: error parsing date " + value + " to format " + format);
        }
    };
    return ActivitiProcessInstanceDetails;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiProcessInstanceDetails.prototype, "processInstanceId", void 0);
__decorate([
    core_1.ViewChild(activiti_process_instance_header_component_1.ActivitiProcessInstanceHeader),
    __metadata("design:type", activiti_process_instance_header_component_1.ActivitiProcessInstanceHeader)
], ActivitiProcessInstanceDetails.prototype, "processInstanceHeader", void 0);
__decorate([
    core_1.ViewChild(activiti_process_instance_tasks_component_1.ActivitiProcessInstanceTasks),
    __metadata("design:type", activiti_process_instance_tasks_component_1.ActivitiProcessInstanceTasks)
], ActivitiProcessInstanceDetails.prototype, "tasksList", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiProcessInstanceDetails.prototype, "showTitle", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiProcessInstanceDetails.prototype, "showRefreshButton", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiProcessInstanceDetails.prototype, "processCancelled", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiProcessInstanceDetails.prototype, "taskClick", void 0);
ActivitiProcessInstanceDetails = __decorate([
    core_1.Component({
        selector: 'activiti-process-instance-details',
        moduleId: module.id,
        template: "<div *ngIf=\"!processInstanceDetails\">{{ 'DETAILS.MESSAGES.NONE'|translate }}</div> <div *ngIf=\"processInstanceDetails\">     <h2 class=\"mdl-card__title-text\">{{ getProcessNameOrDescription('medium') }}</h2>     <activiti-process-instance-header [processInstance]=\"processInstanceDetails\"></activiti-process-instance-header>     <div class=\"mdl-card mdl-shadow--2dp activiti-process-container\">         <div class=\"mdl-cell mdl-cell--12-col\">             <activiti-process-instance-tasks                 [processInstanceDetails]=\"processInstanceDetails\"                 (taskClick)=\"onTaskClicked($event)\">             </activiti-process-instance-tasks>         </div>     </div>     <div class=\"mdl-cell mdl-cell--4-col\" data-automation-id=\"header-status\" *ngIf=\"isRunning()\">         <button type=\"button\" (click)=\"cancelProcess()\" class=\"mdl-button\">{{ 'DETAILS.BUTTON.CANCEL' | translate }}</button>     </div> </div>",
        styles: [":host {     width: 100%; }  .activiti-process-container {     width: 100%;     min-height: 100px;     overflow: visible;     padding: 10px; }"]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        activiti_process_service_1.ActivitiProcessService,
        ng2_alfresco_core_1.LogService])
], ActivitiProcessInstanceDetails);
exports.ActivitiProcessInstanceDetails = ActivitiProcessInstanceDetails;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktcHJvY2Vzcy1pbnN0YW5jZS1kZXRhaWxzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7Ozs7Ozs7Ozs7O0FBRUgsMENBQTJDO0FBQzNDLHNDQUE0RztBQUM1Ryx1REFBMkU7QUFHM0UsbUZBQWdGO0FBQ2hGLDJHQUE2RjtBQUM3Rix5R0FBMkY7QUFTM0YsSUFBYSw4QkFBOEI7SUE4QnZDLHdDQUFvQixTQUFxQyxFQUNyQyxlQUF1QyxFQUN2QyxVQUFzQjtRQUZ0QixjQUFTLEdBQVQsU0FBUyxDQUE0QjtRQUNyQyxvQkFBZSxHQUFmLGVBQWUsQ0FBd0I7UUFDdkMsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQXBCMUMsY0FBUyxHQUFZLElBQUksQ0FBQztRQUcxQixzQkFBaUIsR0FBWSxJQUFJLENBQUM7UUFHbEMscUJBQWdCLEdBQXNCLElBQUksbUJBQVksRUFBTyxDQUFDO1FBRzlELGNBQVMsR0FBbUMsSUFBSSxtQkFBWSxFQUFvQixDQUFDO1FBYTdFLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDWixTQUFTLENBQUMsb0JBQW9CLENBQUMsMEJBQTBCLEVBQUUsMkNBQTJDLENBQUMsQ0FBQztRQUM1RyxDQUFDO0lBQ0wsQ0FBQztJQUVELG9EQUFXLEdBQVgsVUFBWSxPQUFzQjtRQUM5QixJQUFJLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ3JELEVBQUUsQ0FBQyxDQUFDLGlCQUFpQixJQUFJLENBQUMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUN2RCxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDYixNQUFNLENBQUM7UUFDWCxDQUFDO1FBQ0QsRUFBRSxDQUFDLENBQUMsaUJBQWlCLElBQUksaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUN0RCxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQzFDLE1BQU0sQ0FBQztRQUNYLENBQUM7SUFDTCxDQUFDO0lBS0QsOENBQUssR0FBTDtRQUNJLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxJQUFJLENBQUM7SUFDdkMsQ0FBQztJQUVELDZDQUFJLEdBQUosVUFBSyxTQUFpQjtRQUF0QixpQkFRQztRQVBHLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDWixJQUFJLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQ2hELFVBQUMsR0FBb0I7Z0JBQ2pCLEtBQUksQ0FBQyxzQkFBc0IsR0FBRyxHQUFHLENBQUM7WUFDdEMsQ0FBQyxDQUNKLENBQUM7UUFDTixDQUFDO0lBQ0wsQ0FBQztJQUVELGtEQUFTLEdBQVQ7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLHNCQUFzQixJQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLEtBQUssQ0FBQztJQUM3RSxDQUFDO0lBRUQsc0RBQWEsR0FBYjtRQUFBLGlCQU9DO1FBTkcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsU0FBUyxDQUNoRSxVQUFDLElBQUk7WUFDRCxLQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JDLENBQUMsRUFBRSxVQUFDLEdBQUc7WUFDSCxLQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7SUFHRCxzREFBYSxHQUFiLFVBQWMsS0FBdUI7UUFDakMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVELG9FQUEyQixHQUEzQixVQUE0QixVQUFVO1FBQ2xDLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNkLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUM7WUFDOUIsSUFBSSxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJO2dCQUNuQyxJQUFJLENBQUMsc0JBQXNCLENBQUMscUJBQXFCLEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sRUFBRSxVQUFVLENBQUMsQ0FBQztRQUN4SSxDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRUQsc0RBQWEsR0FBYixVQUFjLEtBQUssRUFBRSxNQUFjO1FBQy9CLElBQUksUUFBUSxHQUFHLElBQUksaUJBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUM7WUFDRCxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDN0MsQ0FBQztRQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDWCxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxtREFBaUQsS0FBSyxtQkFBYyxNQUFRLENBQUMsQ0FBQztRQUN4RyxDQUFDO0lBQ0wsQ0FBQztJQUNMLHFDQUFDO0FBQUQsQ0F2R0EsQUF1R0MsSUFBQTtBQXBHRztJQURDLFlBQUssRUFBRTs7eUVBQ2tCO0FBRzFCO0lBREMsZ0JBQVMsQ0FBQywwRUFBNkIsQ0FBQzs4QkFDbEIsMEVBQTZCOzZFQUFDO0FBR3JEO0lBREMsZ0JBQVMsQ0FBQyx3RUFBNEIsQ0FBQzs4QkFDN0Isd0VBQTRCO2lFQUFDO0FBR3hDO0lBREMsWUFBSyxFQUFFOztpRUFDa0I7QUFHMUI7SUFEQyxZQUFLLEVBQUU7O3lFQUMwQjtBQUdsQztJQURDLGFBQU0sRUFBRTs4QkFDUyxtQkFBWTt3RUFBZ0M7QUFHOUQ7SUFEQyxhQUFNLEVBQUU7OEJBQ0UsbUJBQVk7aUVBQTBEO0FBckJ4RSw4QkFBOEI7SUFOMUMsZ0JBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSxtQ0FBbUM7UUFDN0MsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1FBQ25CLFFBQVEsRUFBRSxxN0JBQXE3QjtRQUMvN0IsTUFBTSxFQUFFLENBQUMsK0lBQStJLENBQUM7S0FDNUosQ0FBQztxQ0ErQmlDLDhDQUEwQjtRQUNwQixpREFBc0I7UUFDM0IsOEJBQVU7R0FoQ2pDLDhCQUE4QixDQXVHMUM7QUF2R1ksd0VBQThCIiwiZmlsZSI6ImNvbXBvbmVudHMvYWN0aXZpdGktcHJvY2Vzcy1pbnN0YW5jZS1kZXRhaWxzLmNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IERhdGVQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIFZpZXdDaGlsZCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UsIExvZ1NlcnZpY2UgfSBmcm9tICduZzItYWxmcmVzY28tY29yZSc7XG5pbXBvcnQgeyBUYXNrRGV0YWlsc0V2ZW50IH0gZnJvbSAnbmcyLWFjdGl2aXRpLXRhc2tsaXN0JztcblxuaW1wb3J0IHsgQWN0aXZpdGlQcm9jZXNzU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvYWN0aXZpdGktcHJvY2Vzcy5zZXJ2aWNlJztcbmltcG9ydCB7IEFjdGl2aXRpUHJvY2Vzc0luc3RhbmNlSGVhZGVyIH0gZnJvbSAnLi9hY3Rpdml0aS1wcm9jZXNzLWluc3RhbmNlLWhlYWRlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgQWN0aXZpdGlQcm9jZXNzSW5zdGFuY2VUYXNrcyB9IGZyb20gJy4vYWN0aXZpdGktcHJvY2Vzcy1pbnN0YW5jZS10YXNrcy5jb21wb25lbnQnO1xuaW1wb3J0IHsgUHJvY2Vzc0luc3RhbmNlIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2Nlc3MtaW5zdGFuY2UubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FjdGl2aXRpLXByb2Nlc3MtaW5zdGFuY2UtZGV0YWlscycsXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICB0ZW1wbGF0ZTogXCI8ZGl2ICpuZ0lmPVxcXCIhcHJvY2Vzc0luc3RhbmNlRGV0YWlsc1xcXCI+e3sgJ0RFVEFJTFMuTUVTU0FHRVMuTk9ORSd8dHJhbnNsYXRlIH19PC9kaXY+IDxkaXYgKm5nSWY9XFxcInByb2Nlc3NJbnN0YW5jZURldGFpbHNcXFwiPiAgICAgPGgyIGNsYXNzPVxcXCJtZGwtY2FyZF9fdGl0bGUtdGV4dFxcXCI+e3sgZ2V0UHJvY2Vzc05hbWVPckRlc2NyaXB0aW9uKCdtZWRpdW0nKSB9fTwvaDI+ICAgICA8YWN0aXZpdGktcHJvY2Vzcy1pbnN0YW5jZS1oZWFkZXIgW3Byb2Nlc3NJbnN0YW5jZV09XFxcInByb2Nlc3NJbnN0YW5jZURldGFpbHNcXFwiPjwvYWN0aXZpdGktcHJvY2Vzcy1pbnN0YW5jZS1oZWFkZXI+ICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtY2FyZCBtZGwtc2hhZG93LS0yZHAgYWN0aXZpdGktcHJvY2Vzcy1jb250YWluZXJcXFwiPiAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1jZWxsIG1kbC1jZWxsLS0xMi1jb2xcXFwiPiAgICAgICAgICAgICA8YWN0aXZpdGktcHJvY2Vzcy1pbnN0YW5jZS10YXNrcyAgICAgICAgICAgICAgICAgW3Byb2Nlc3NJbnN0YW5jZURldGFpbHNdPVxcXCJwcm9jZXNzSW5zdGFuY2VEZXRhaWxzXFxcIiAgICAgICAgICAgICAgICAgKHRhc2tDbGljayk9XFxcIm9uVGFza0NsaWNrZWQoJGV2ZW50KVxcXCI+ICAgICAgICAgICAgIDwvYWN0aXZpdGktcHJvY2Vzcy1pbnN0YW5jZS10YXNrcz4gICAgICAgICA8L2Rpdj4gICAgIDwvZGl2PiAgICAgPGRpdiBjbGFzcz1cXFwibWRsLWNlbGwgbWRsLWNlbGwtLTQtY29sXFxcIiBkYXRhLWF1dG9tYXRpb24taWQ9XFxcImhlYWRlci1zdGF0dXNcXFwiICpuZ0lmPVxcXCJpc1J1bm5pbmcoKVxcXCI+ICAgICAgICAgPGJ1dHRvbiB0eXBlPVxcXCJidXR0b25cXFwiIChjbGljayk9XFxcImNhbmNlbFByb2Nlc3MoKVxcXCIgY2xhc3M9XFxcIm1kbC1idXR0b25cXFwiPnt7ICdERVRBSUxTLkJVVFRPTi5DQU5DRUwnIHwgdHJhbnNsYXRlIH19PC9idXR0b24+ICAgICA8L2Rpdj4gPC9kaXY+XCIsXG4gICAgc3R5bGVzOiBbXCI6aG9zdCB7ICAgICB3aWR0aDogMTAwJTsgfSAgLmFjdGl2aXRpLXByb2Nlc3MtY29udGFpbmVyIHsgICAgIHdpZHRoOiAxMDAlOyAgICAgbWluLWhlaWdodDogMTAwcHg7ICAgICBvdmVyZmxvdzogdmlzaWJsZTsgICAgIHBhZGRpbmc6IDEwcHg7IH1cIl1cbn0pXG5leHBvcnQgY2xhc3MgQWN0aXZpdGlQcm9jZXNzSW5zdGFuY2VEZXRhaWxzIGltcGxlbWVudHMgT25DaGFuZ2VzIHtcblxuICAgIEBJbnB1dCgpXG4gICAgcHJvY2Vzc0luc3RhbmNlSWQ6IHN0cmluZztcblxuICAgIEBWaWV3Q2hpbGQoQWN0aXZpdGlQcm9jZXNzSW5zdGFuY2VIZWFkZXIpXG4gICAgcHJvY2Vzc0luc3RhbmNlSGVhZGVyOiBBY3Rpdml0aVByb2Nlc3NJbnN0YW5jZUhlYWRlcjtcblxuICAgIEBWaWV3Q2hpbGQoQWN0aXZpdGlQcm9jZXNzSW5zdGFuY2VUYXNrcylcbiAgICB0YXNrc0xpc3Q6IEFjdGl2aXRpUHJvY2Vzc0luc3RhbmNlVGFza3M7XG5cbiAgICBASW5wdXQoKVxuICAgIHNob3dUaXRsZTogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBASW5wdXQoKVxuICAgIHNob3dSZWZyZXNoQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIEBPdXRwdXQoKVxuICAgIHByb2Nlc3NDYW5jZWxsZWQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICB0YXNrQ2xpY2s6IEV2ZW50RW1pdHRlcjxUYXNrRGV0YWlsc0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8VGFza0RldGFpbHNFdmVudD4oKTtcblxuICAgIHByb2Nlc3NJbnN0YW5jZURldGFpbHM6IFByb2Nlc3NJbnN0YW5jZTtcblxuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHRyYW5zbGF0ZSBUcmFuc2xhdGlvbiBzZXJ2aWNlXG4gICAgICogQHBhcmFtIGFjdGl2aXRpUHJvY2VzcyAgIFByb2Nlc3Mgc2VydmljZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlOiBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFjdGl2aXRpUHJvY2VzczogQWN0aXZpdGlQcm9jZXNzU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UpIHtcblxuICAgICAgICBpZiAodHJhbnNsYXRlKSB7XG4gICAgICAgICAgICB0cmFuc2xhdGUuYWRkVHJhbnNsYXRpb25Gb2xkZXIoJ25nMi1hY3Rpdml0aS1wcm9jZXNzbGlzdCcsICdub2RlX21vZHVsZXMvbmcyLWFjdGl2aXRpLXByb2Nlc3NsaXN0L3NyYycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgICAgICBsZXQgcHJvY2Vzc0luc3RhbmNlSWQgPSBjaGFuZ2VzWydwcm9jZXNzSW5zdGFuY2VJZCddO1xuICAgICAgICBpZiAocHJvY2Vzc0luc3RhbmNlSWQgJiYgIXByb2Nlc3NJbnN0YW5jZUlkLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcm9jZXNzSW5zdGFuY2VJZCAmJiBwcm9jZXNzSW5zdGFuY2VJZC5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZChwcm9jZXNzSW5zdGFuY2VJZC5jdXJyZW50VmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzZXQgdGhlIHRhc2sgZGV0YWlsIHRvIHVuZGVmaW5lZFxuICAgICAqL1xuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMgPSBudWxsO1xuICAgIH1cblxuICAgIGxvYWQocHJvY2Vzc0lkOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKHByb2Nlc3NJZCkge1xuICAgICAgICAgICAgdGhpcy5hY3Rpdml0aVByb2Nlc3MuZ2V0UHJvY2Vzcyhwcm9jZXNzSWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAocmVzOiBQcm9jZXNzSW5zdGFuY2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzID0gcmVzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpc1J1bm5pbmcoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMgJiYgIXRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscy5lbmRlZDtcbiAgICB9XG5cbiAgICBjYW5jZWxQcm9jZXNzKCkge1xuICAgICAgICB0aGlzLmFjdGl2aXRpUHJvY2Vzcy5jYW5jZWxQcm9jZXNzKHRoaXMucHJvY2Vzc0luc3RhbmNlSWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzQ2FuY2VsbGVkLmVtaXQoZGF0YSk7XG4gICAgICAgICAgICB9LCAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBidWJibGVzICh0YXNrQ2xpY2spIGV2ZW50XG4gICAgb25UYXNrQ2xpY2tlZChldmVudDogVGFza0RldGFpbHNFdmVudCkge1xuICAgICAgICB0aGlzLnRhc2tDbGljay5lbWl0KGV2ZW50KTtcbiAgICB9XG5cbiAgICBnZXRQcm9jZXNzTmFtZU9yRGVzY3JpcHRpb24oZGF0ZUZvcm1hdCk6IHN0cmluZyB7XG4gICAgICAgIGxldCBuYW1lID0gJyc7XG4gICAgICAgIGlmICh0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMpIHtcbiAgICAgICAgICAgIG5hbWUgPSB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMubmFtZSB8fFxuICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscy5wcm9jZXNzRGVmaW5pdGlvbk5hbWUgKyAnIC0gJyArIHRoaXMuZ2V0Rm9ybWF0RGF0ZSh0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMuc3RhcnRlZCwgZGF0ZUZvcm1hdCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgfVxuXG4gICAgZ2V0Rm9ybWF0RGF0ZSh2YWx1ZSwgZm9ybWF0OiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IGRhdGVQaXBlID0gbmV3IERhdGVQaXBlKCdlbi1VUycpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGRhdGVQaXBlLnRyYW5zZm9ybSh2YWx1ZSwgZm9ybWF0KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoYFByb2Nlc3NMaXN0SW5zdGFuY2VIZWFkZXI6IGVycm9yIHBhcnNpbmcgZGF0ZSAke3ZhbHVlfSB0byBmb3JtYXQgJHtmb3JtYXR9YCk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=
