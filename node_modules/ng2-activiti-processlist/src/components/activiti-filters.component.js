/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var Rx_1 = require("rxjs/Rx");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var activiti_process_service_1 = require("./../services/activiti-process.service");
var ActivitiProcessFilters = (function () {
    function ActivitiProcessFilters(translate, activiti, logService) {
        var _this = this;
        this.translate = translate;
        this.activiti = activiti;
        this.logService = logService;
        this.filterClick = new core_1.EventEmitter();
        this.onSuccess = new core_1.EventEmitter();
        this.onError = new core_1.EventEmitter();
        this.filters = [];
        this.filter$ = new Rx_1.Observable(function (observer) { return _this.filterObserver = observer; }).share();
        if (translate) {
            translate.addTranslationFolder('ng2-activiti-processlist', 'node_modules/ng2-activiti-processlist/src');
        }
    }
    ActivitiProcessFilters.prototype.ngOnInit = function () {
        var _this = this;
        this.filter$.subscribe(function (filter) {
            _this.filters.push(filter);
        });
        this.getFilters(this.appId, this.appName);
    };
    ActivitiProcessFilters.prototype.ngOnChanges = function (changes) {
        var appId = changes['appId'];
        if (appId && (appId.currentValue || appId.currentValue === null)) {
            this.getFiltersByAppId(appId.currentValue);
            return;
        }
        var appName = changes['appName'];
        if (appName && appName.currentValue) {
            this.getFiltersByAppName(appName.currentValue);
            return;
        }
    };
    ActivitiProcessFilters.prototype.getFilters = function (appId, appName) {
        if (appName) {
            this.getFiltersByAppName(appName);
        }
        else {
            this.getFiltersByAppId(appId);
        }
    };
    ActivitiProcessFilters.prototype.getFiltersByAppId = function (appId) {
        var _this = this;
        this.activiti.getProcessFilters(appId).subscribe(function (res) {
            _this.resetFilter();
            res.forEach(function (filter) {
                _this.filterObserver.next(filter);
            });
            _this.selectFirstFilter();
            _this.onSuccess.emit(res);
        }, function (err) {
            _this.logService.error(err);
            _this.onError.emit(err);
        });
    };
    ActivitiProcessFilters.prototype.getFiltersByAppName = function (appName) {
        var _this = this;
        this.activiti.getDeployedApplications(appName).subscribe(function (application) {
            _this.getFiltersByAppId(application.id);
            _this.selectFirstFilter();
        }, function (err) {
            _this.logService.error(err);
            _this.onError.emit(err);
        });
    };
    ActivitiProcessFilters.prototype.selectFilter = function (filter) {
        this.currentFilter = filter;
        this.filterClick.emit(filter);
    };
    ActivitiProcessFilters.prototype.selectFirstFilter = function () {
        if (!this.isFilterListEmpty()) {
            this.currentFilter = this.filters[0];
        }
        else {
            this.currentFilter = null;
        }
    };
    ActivitiProcessFilters.prototype.getCurrentFilter = function () {
        return this.currentFilter;
    };
    ActivitiProcessFilters.prototype.isFilterListEmpty = function () {
        return this.filters === undefined || (this.filters && this.filters.length === 0);
    };
    ActivitiProcessFilters.prototype.resetFilter = function () {
        this.filters = [];
        this.currentFilter = null;
    };
    return ActivitiProcessFilters;
}());
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiProcessFilters.prototype, "filterClick", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiProcessFilters.prototype, "onSuccess", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiProcessFilters.prototype, "onError", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Number)
], ActivitiProcessFilters.prototype, "appId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiProcessFilters.prototype, "appName", void 0);
ActivitiProcessFilters = __decorate([
    core_1.Component({
        selector: 'activiti-process-instance-filters',
        moduleId: module.id,
        template: "<div class=\"menu-container\">     <ul class='mdl-list'>         <li class=\"mdl-list__item activiti-filters__entry\" (click)=\"selectFilter(filter)\" *ngFor=\"let filter of filters\"             [class.active]=\"currentFilter === filter\">             <span class=\"mdl-list__item-primary-content\">             <i class=\"material-icons mdl-list__item-icon activiti-filters__entry-icon\" [attr.data-automation-id]=\"filter.name + '_filter'\" >assignment</i>             {{filter.name}}             </span>         </li>     </ul> </div>",
        styles: [".mdl-list__item {     cursor: pointer; }  .activiti-filters__entry {     cursor: pointer; }  .activiti-filters__entry-icon {     margin-right: 12px !important; }  .activiti-filters__entry.active {     color: rgb(68,138,255); }  .activiti-filters__entry.active .activiti-filters__entry-icon {     color: rgb(68,138,255); }"]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        activiti_process_service_1.ActivitiProcessService,
        ng2_alfresco_core_1.LogService])
], ActivitiProcessFilters);
exports.ActivitiProcessFilters = ActivitiProcessFilters;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktZmlsdGVycy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQUF5RztBQUN6Ryw4QkFBK0M7QUFDL0MsdURBQTJFO0FBRTNFLG1GQUFnRjtBQVVoRixJQUFhLHNCQUFzQjtJQXdCL0IsZ0NBQW9CLFNBQXFDLEVBQ3JDLFFBQWdDLEVBQ2hDLFVBQXNCO1FBRjFDLGlCQVFDO1FBUm1CLGNBQVMsR0FBVCxTQUFTLENBQTRCO1FBQ3JDLGFBQVEsR0FBUixRQUFRLENBQXdCO1FBQ2hDLGVBQVUsR0FBVixVQUFVLENBQVk7UUF2QjFDLGdCQUFXLEdBQW1ELElBQUksbUJBQVksRUFBb0MsQ0FBQztRQUduSCxjQUFTLEdBQXFELElBQUksbUJBQVksRUFBc0MsQ0FBQztRQUdySCxZQUFPLEdBQXNCLElBQUksbUJBQVksRUFBTyxDQUFDO1FBYXJELFlBQU8sR0FBd0MsRUFBRSxDQUFDO1FBSzlDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxlQUFVLENBQW1DLFVBQUEsUUFBUSxJQUFJLE9BQUEsS0FBSSxDQUFDLGNBQWMsR0FBRyxRQUFRLEVBQTlCLENBQThCLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUVwSCxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ1osU0FBUyxDQUFDLG9CQUFvQixDQUFDLDBCQUEwQixFQUFFLDJDQUEyQyxDQUFDLENBQUM7UUFDNUcsQ0FBQztJQUNMLENBQUM7SUFFRCx5Q0FBUSxHQUFSO1FBQUEsaUJBTUM7UUFMRyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxVQUFDLE1BQXdDO1lBQzVELEtBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzlCLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FB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anMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNiBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBPbkluaXQsIElucHV0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIE9ic2VydmVyIH0gZnJvbSAncnhqcy9SeCc7XG5pbXBvcnQgeyBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSwgTG9nU2VydmljZSB9IGZyb20gJ25nMi1hbGZyZXNjby1jb3JlJztcbmltcG9ydCB7IEZpbHRlclByb2Nlc3NSZXByZXNlbnRhdGlvbk1vZGVsIH0gZnJvbSAnLi8uLi9tb2RlbHMvZmlsdGVyLXByb2Nlc3MubW9kZWwnO1xuaW1wb3J0IHsgQWN0aXZpdGlQcm9jZXNzU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvYWN0aXZpdGktcHJvY2Vzcy5zZXJ2aWNlJztcblxuZGVjbGFyZSBsZXQgY29tcG9uZW50SGFuZGxlcjogYW55O1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FjdGl2aXRpLXByb2Nlc3MtaW5zdGFuY2UtZmlsdGVycycsXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICB0ZW1wbGF0ZTogXCI8ZGl2IGNsYXNzPVxcXCJtZW51LWNvbnRhaW5lclxcXCI+ICAgICA8dWwgY2xhc3M9J21kbC1saXN0Jz4gICAgICAgICA8bGkgY2xhc3M9XFxcIm1kbC1saXN0X19pdGVtIGFjdGl2aXRpLWZpbHRlcnNfX2VudHJ5XFxcIiAoY2xpY2spPVxcXCJzZWxlY3RGaWx0ZXIoZmlsdGVyKVxcXCIgKm5nRm9yPVxcXCJsZXQgZmlsdGVyIG9mIGZpbHRlcnNcXFwiICAgICAgICAgICAgIFtjbGFzcy5hY3RpdmVdPVxcXCJjdXJyZW50RmlsdGVyID09PSBmaWx0ZXJcXFwiPiAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwibWRsLWxpc3RfX2l0ZW0tcHJpbWFyeS1jb250ZW50XFxcIj4gICAgICAgICAgICAgPGkgY2xhc3M9XFxcIm1hdGVyaWFsLWljb25zIG1kbC1saXN0X19pdGVtLWljb24gYWN0aXZpdGktZmlsdGVyc19fZW50cnktaWNvblxcXCIgW2F0dHIuZGF0YS1hdXRvbWF0aW9uLWlkXT1cXFwiZmlsdGVyLm5hbWUgKyAnX2ZpbHRlcidcXFwiID5hc3NpZ25tZW50PC9pPiAgICAgICAgICAgICB7e2ZpbHRlci5uYW1lfX0gICAgICAgICAgICAgPC9zcGFuPiAgICAgICAgIDwvbGk+ICAgICA8L3VsPiA8L2Rpdj5cIixcbiAgICBzdHlsZXM6IFtcIi5tZGwtbGlzdF9faXRlbSB7ICAgICBjdXJzb3I6IHBvaW50ZXI7IH0gIC5hY3Rpdml0aS1maWx0ZXJzX19lbnRyeSB7ICAgICBjdXJzb3I6IHBvaW50ZXI7IH0gIC5hY3Rpdml0aS1maWx0ZXJzX19lbnRyeS1pY29uIHsgICAgIG1hcmdpbi1yaWdodDogMTJweCAhaW1wb3J0YW50OyB9ICAuYWN0aXZpdGktZmlsdGVyc19fZW50cnkuYWN0aXZlIHsgICAgIGNvbG9yOiByZ2IoNjgsMTM4LDI1NSk7IH0gIC5hY3Rpdml0aS1maWx0ZXJzX19lbnRyeS5hY3RpdmUgLmFjdGl2aXRpLWZpbHRlcnNfX2VudHJ5LWljb24geyAgICAgY29sb3I6IHJnYig2OCwxMzgsMjU1KTsgfVwiXVxufSlcbmV4cG9ydCBjbGFzcyBBY3Rpdml0aVByb2Nlc3NGaWx0ZXJzIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuXG4gICAgQE91dHB1dCgpXG4gICAgZmlsdGVyQ2xpY2s6IEV2ZW50RW1pdHRlcjxGaWx0ZXJQcm9jZXNzUmVwcmVzZW50YXRpb25Nb2RlbD4gPSBuZXcgRXZlbnRFbWl0dGVyPEZpbHRlclByb2Nlc3NSZXByZXNlbnRhdGlvbk1vZGVsPigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgb25TdWNjZXNzOiBFdmVudEVtaXR0ZXI8RmlsdGVyUHJvY2Vzc1JlcHJlc2VudGF0aW9uTW9kZWxbXT4gPSBuZXcgRXZlbnRFbWl0dGVyPEZpbHRlclByb2Nlc3NSZXByZXNlbnRhdGlvbk1vZGVsW10+KCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBvbkVycm9yOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgQElucHV0KClcbiAgICBhcHBJZDogbnVtYmVyO1xuXG4gICAgQElucHV0KClcbiAgICBhcHBOYW1lOiBzdHJpbmc7XG5cbiAgICBwcml2YXRlIGZpbHRlck9ic2VydmVyOiBPYnNlcnZlcjxGaWx0ZXJQcm9jZXNzUmVwcmVzZW50YXRpb25Nb2RlbD47XG4gICAgZmlsdGVyJDogT2JzZXJ2YWJsZTxGaWx0ZXJQcm9jZXNzUmVwcmVzZW50YXRpb25Nb2RlbD47XG5cbiAgICBjdXJyZW50RmlsdGVyOiBGaWx0ZXJQcm9jZXNzUmVwcmVzZW50YXRpb25Nb2RlbDtcblxuICAgIGZpbHRlcnM6IEZpbHRlclByb2Nlc3NSZXByZXNlbnRhdGlvbk1vZGVsIFtdID0gW107XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHRyYW5zbGF0ZTogQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhY3Rpdml0aTogQWN0aXZpdGlQcm9jZXNzU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5maWx0ZXIkID0gbmV3IE9ic2VydmFibGU8RmlsdGVyUHJvY2Vzc1JlcHJlc2VudGF0aW9uTW9kZWw+KG9ic2VydmVyID0+IHRoaXMuZmlsdGVyT2JzZXJ2ZXIgPSBvYnNlcnZlcikuc2hhcmUoKTtcblxuICAgICAgICBpZiAodHJhbnNsYXRlKSB7XG4gICAgICAgICAgICB0cmFuc2xhdGUuYWRkVHJhbnNsYXRpb25Gb2xkZXIoJ25nMi1hY3Rpdml0aS1wcm9jZXNzbGlzdCcsICdub2RlX21vZHVsZXMvbmcyLWFjdGl2aXRpLXByb2Nlc3NsaXN0L3NyYycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuZmlsdGVyJC5zdWJzY3JpYmUoKGZpbHRlcjogRmlsdGVyUHJvY2Vzc1JlcHJlc2VudGF0aW9uTW9kZWwpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVycy5wdXNoKGZpbHRlcik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuZ2V0RmlsdGVycyh0aGlzLmFwcElkLCB0aGlzLmFwcE5hbWUpO1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgbGV0IGFwcElkID0gY2hhbmdlc1snYXBwSWQnXTtcbiAgICAgICAgaWYgKGFwcElkICYmIChhcHBJZC5jdXJyZW50VmFsdWUgfHwgYXBwSWQuY3VycmVudFZhbHVlID09PSBudWxsKSkge1xuICAgICAgICAgICAgdGhpcy5nZXRGaWx0ZXJzQnlBcHBJZChhcHBJZC5jdXJyZW50VmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCBhcHBOYW1lID0gY2hhbmdlc1snYXBwTmFtZSddO1xuICAgICAgICBpZiAoYXBwTmFtZSAmJiBhcHBOYW1lLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5nZXRGaWx0ZXJzQnlBcHBOYW1lKGFwcE5hbWUuY3VycmVudFZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgdGFzayBsaXN0IGZpbHRlcmVkIGJ5IGFwcElkIG9yIGJ5IGFwcE5hbWVcbiAgICAgKiBAcGFyYW0gYXBwSWRcbiAgICAgKiBAcGFyYW0gYXBwTmFtZVxuICAgICAqL1xuICAgIGdldEZpbHRlcnMoYXBwSWQ/OiBudW1iZXIsIGFwcE5hbWU/OiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKGFwcE5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0RmlsdGVyc0J5QXBwTmFtZShhcHBOYW1lKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0RmlsdGVyc0J5QXBwSWQoYXBwSWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBmaWx0ZXIgbGlzdCBmaWx0ZXJlZCBieSBhcHBJZFxuICAgICAqIEBwYXJhbSBhcHBJZCAtIG9wdGlvbmFsXG4gICAgICovXG4gICAgZ2V0RmlsdGVyc0J5QXBwSWQoYXBwSWQ/OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5hY3Rpdml0aS5nZXRQcm9jZXNzRmlsdGVycyhhcHBJZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKHJlczogRmlsdGVyUHJvY2Vzc1JlcHJlc2VudGF0aW9uTW9kZWxbXSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRGaWx0ZXIoKTtcbiAgICAgICAgICAgICAgICByZXMuZm9yRWFjaCgoZmlsdGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyT2JzZXJ2ZXIubmV4dChmaWx0ZXIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Rmlyc3RGaWx0ZXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uU3VjY2Vzcy5lbWl0KHJlcyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGVycjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdGhlIGZpbHRlciBsaXN0IGZpbHRlcmVkIGJ5IGFwcE5hbWVcbiAgICAgKiBAcGFyYW0gYXBwTmFtZVxuICAgICAqL1xuICAgIGdldEZpbHRlcnNCeUFwcE5hbWUoYXBwTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuYWN0aXZpdGkuZ2V0RGVwbG95ZWRBcHBsaWNhdGlvbnMoYXBwTmFtZSkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgYXBwbGljYXRpb24gPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0RmlsdGVyc0J5QXBwSWQoYXBwbGljYXRpb24uaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Rmlyc3RGaWx0ZXIoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFBhc3MgdGhlIHNlbGVjdGVkIGZpbHRlciBhcyBuZXh0XG4gICAgICogQHBhcmFtIGZpbHRlclxuICAgICAqL1xuICAgIHB1YmxpYyBzZWxlY3RGaWx0ZXIoZmlsdGVyOiBGaWx0ZXJQcm9jZXNzUmVwcmVzZW50YXRpb25Nb2RlbCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRGaWx0ZXIgPSBmaWx0ZXI7XG4gICAgICAgIHRoaXMuZmlsdGVyQ2xpY2suZW1pdChmaWx0ZXIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlbGVjdCB0aGUgZmlyc3QgZmlsdGVyIG9mIGEgbGlzdCBpZiBwcmVzZW50XG4gICAgICovXG4gICAgcHVibGljIHNlbGVjdEZpcnN0RmlsdGVyKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNGaWx0ZXJMaXN0RW1wdHkoKSkge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50RmlsdGVyID0gdGhpcy5maWx0ZXJzWzBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50RmlsdGVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgY3VycmVudCB0YXNrXG4gICAgICogQHJldHVybnMge0ZpbHRlclJlcHJlc2VudGF0aW9uTW9kZWx9XG4gICAgICovXG4gICAgZ2V0Q3VycmVudEZpbHRlcigpOiBGaWx0ZXJQcm9jZXNzUmVwcmVzZW50YXRpb25Nb2RlbCB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRGaWx0ZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgdGhlIGZpbHRlciBsaXN0IGlzIGVtcHR5XG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgaXNGaWx0ZXJMaXN0RW1wdHkoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbHRlcnMgPT09IHVuZGVmaW5lZCB8fCAodGhpcy5maWx0ZXJzICYmIHRoaXMuZmlsdGVycy5sZW5ndGggPT09IDApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc2V0IHRoZSBmaWx0ZXJzIHByb3BlcnRpZXNcbiAgICAgKi9cbiAgICBwcml2YXRlIHJlc2V0RmlsdGVyKCkge1xuICAgICAgICB0aGlzLmZpbHRlcnMgPSBbXTtcbiAgICAgICAgdGhpcy5jdXJyZW50RmlsdGVyID0gbnVsbDtcbiAgICB9XG59XG4iXX0=
