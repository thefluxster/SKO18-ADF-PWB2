/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var diagrams_service_1 = require("../services/diagrams.service");
var diagram_color_service_1 = require("../services/diagram-color.service");
var raphael_service_1 = require("./raphael/raphael.service");
var diagram_model_1 = require("../models/diagram.model");
var DiagramComponent = (function () {
    function DiagramComponent(elementRef, translateService, diagramColorService, raphaelService, diagramsService, logService) {
        this.elementRef = elementRef;
        this.translateService = translateService;
        this.diagramColorService = diagramColorService;
        this.raphaelService = raphaelService;
        this.diagramsService = diagramsService;
        this.logService = logService;
        this.metricType = '';
        this.width = 1000;
        this.height = 500;
        this.onSuccess = new core_1.EventEmitter();
        this.onError = new core_1.EventEmitter();
        this.PADDING_WIDTH = 60;
        this.PADDING_HEIGHT = 60;
        if (translateService) {
            translateService.addTranslationFolder('ng2-activiti-diagrams', 'node_modules/ng2-activiti-diagrams/src');
        }
    }
    DiagramComponent.prototype.ngOnChanges = function (changes) {
        this.reset();
        this.diagramColorService.setTotalColors(this.metricColor);
        this.getProcessDefinitionModel(this.processDefinitionId);
    };
    DiagramComponent.prototype.getProcessDefinitionModel = function (processDefinitionId) {
        var _this = this;
        this.diagramsService.getProcessDefinitionModel(processDefinitionId).subscribe(function (res) {
            _this.diagram = new diagram_model_1.DiagramModel(res);
            _this.raphaelService.setting(_this.diagram.diagramWidth + _this.PADDING_WIDTH, _this.diagram.diagramHeight + _this.PADDING_HEIGHT);
            _this.setMetricValueToDiagramElement(_this.diagram, _this.metricPercentages, _this.metricType);
            _this.onSuccess.emit(res);
        }, function (err) {
            _this.onError.emit(err);
            _this.logService.error(err);
        });
    };
    DiagramComponent.prototype.setMetricValueToDiagramElement = function (diagram, metrics, metricType) {
        var _loop_1 = function (key) {
            if (metrics.hasOwnProperty(key)) {
                var foundElement = diagram.elements.find(function (element) { return element.id === key; });
                if (foundElement) {
                    foundElement.value = metrics[key];
                    foundElement.dataType = metricType;
                }
            }
        };
        for (var key in metrics) {
            _loop_1(key);
        }
    };
    DiagramComponent.prototype.reset = function () {
        this.raphaelService.reset();
    };
    return DiagramComponent;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], DiagramComponent.prototype, "processDefinitionId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], DiagramComponent.prototype, "metricPercentages", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], DiagramComponent.prototype, "metricColor", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], DiagramComponent.prototype, "metricType", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Number)
], DiagramComponent.prototype, "width", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Number)
], DiagramComponent.prototype, "height", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], DiagramComponent.prototype, "onSuccess", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], DiagramComponent.prototype, "onError", void 0);
DiagramComponent = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'activiti-diagram',
        styles: [".diagram {     border: 1px solid lightgray; overflow:auto }"],
        template: "<div *ngIf=\"diagram\" class=\"diagram\">     <div *ngFor=\"let element of diagram.elements\">         <div [ngSwitch]=\"element.type\">             <div *ngSwitchCase=\"'StartEvent'\">                 <diagram-start-event [data]=\"element\"></diagram-start-event>             </div>             <div *ngSwitchCase=\"'ExclusiveGateway'\">                 <diagram-exclusive-gateway [data]=\"element\"></diagram-exclusive-gateway>             </div>             <div *ngSwitchCase=\"'InclusiveGateway'\">                 <diagram-inclusive-gateway [data]=\"element\"></diagram-inclusive-gateway>             </div>             <div *ngSwitchCase=\"'EventGateway'\">                 <diagram-event-gateway [data]=\"element\"></diagram-event-gateway>             </div>             <div *ngSwitchCase=\"'ParallelGateway'\">                 <diagram-parallel-gateway [data]=\"element\"></diagram-parallel-gateway>             </div>             <div *ngSwitchCase=\"'EndEvent'\">                 <diagram-end-event [data]=\"element\"></diagram-end-event>             </div>             <div *ngSwitchCase=\"'UserTask'\">                 <diagram-user-task [data]=\"element\"></diagram-user-task>             </div>             <div *ngSwitchCase=\"'ManualTask'\">                 <diagram-manual-task [data]=\"element\"></diagram-manual-task>             </div>             <div *ngSwitchCase=\"'ServiceTask'\">                 <diagram-container-service-task [data]=\"element\"></diagram-container-service-task>             </div>             <div *ngSwitchCase=\"'ReceiveTask'\">                 <diagram-receive-task [data]=\"element\"></diagram-receive-task>             </div>             <div *ngSwitchCase=\"'ScriptTask'\">                 <diagram-script-task [data]=\"element\"></diagram-script-task>             </div>             <div *ngSwitchCase=\"'BusinessRuleTask'\">                 <diagram-business-rule-task [data]=\"element\"></diagram-business-rule-task>             </div>             <div *ngSwitchCase=\"'BoundaryEvent'\">                 <diagram-boundary-event [data]=\"element\"></diagram-boundary-event>             </div>             <div *ngSwitchCase=\"'ThrowEvent'\">                 <diagram-throw-event [data]=\"element\"></diagram-throw-event>             </div>             <div *ngSwitchCase=\"'IntermediateCatchEvent'\">                 <diagram-intermediate-catching-event [data]=\"element\"></diagram-intermediate-catching-event>             </div>             <div *ngSwitchCase=\"'SubProcess'\">                 <diagram-subprocess [data]=\"element\"></diagram-subprocess>             </div>             <div *ngSwitchCase=\"'EventSubProcess'\">                 <diagram-event-subprocess [data]=\"element\"></diagram-event-subprocess>             </div>         </div>     </div>     <div *ngFor=\"let flow of diagram.flows\">         <div [ngSwitch]=\"flow.type\">             <div *ngSwitchCase=\"'sequenceFlow'\">                 <diagram-sequence-flow [flow]=\"flow\"></diagram-sequence-flow>             </div>         </div>     </div>     <div *ngIf=\"diagram.pools\">         <diagram-pools [pools]=\"diagram.pools\"></diagram-pools>     </div> </div>"
    }),
    __metadata("design:paramtypes", [core_1.ElementRef,
        ng2_alfresco_core_1.AlfrescoTranslationService,
        diagram_color_service_1.DiagramColorService,
        raphael_service_1.RaphaelService,
        diagrams_service_1.DiagramsService,
        ng2_alfresco_core_1.LogService])
], DiagramComponent);
exports.DiagramComponent = DiagramComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvZGlhZ3JhbS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQUFrRztBQUNsRyx1REFBMkU7QUFDM0UsaUVBQStEO0FBQy9ELDJFQUF3RTtBQUN4RSw2REFBMkQ7QUFDM0QseURBQTRFO0FBUTVFLElBQWEsZ0JBQWdCO0lBOEJ6QiwwQkFBb0IsVUFBc0IsRUFDdEIsZ0JBQTRDLEVBQzVDLG1CQUF3QyxFQUN4QyxjQUE4QixFQUM5QixlQUFnQyxFQUNoQyxVQUFzQjtRQUx0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBNEI7UUFDNUMsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtRQUN4QyxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ2hDLGVBQVUsR0FBVixVQUFVLENBQVk7UUF4QjFDLGVBQVUsR0FBVyxFQUFFLENBQUM7UUFHeEIsVUFBSyxHQUFXLElBQUksQ0FBQztRQUdyQixXQUFNLEdBQVcsR0FBRyxDQUFDO1FBR3JCLGNBQVMsR0FBRyxJQUFJLG1CQUFZLEVBQUUsQ0FBQztRQUcvQixZQUFPLEdBQUcsSUFBSSxtQkFBWSxFQUFFLENBQUM7UUFFN0Isa0JBQWEsR0FBVyxFQUFFLENBQUM7UUFDM0IsbUJBQWMsR0FBVyxFQUFFLENBQUM7UUFVeEIsRUFBRSxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1lBQ25CLGdCQUFnQixDQUFDLG9CQUFvQixDQUFDLHVCQUF1QixFQUFFLHdDQUF3QyxDQUFDLENBQUM7UUFDN0csQ0FBQztJQUNMLENBQUM7SUFFRCxzQ0FBVyxHQUFYLFVBQVksT0FBc0I7UUFDOUIsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2IsSUFBSSxDQUFDLG1CQUFtQixDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMs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LmNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSwgTG9nU2VydmljZSB9IGZyb20gJ25nMi1hbGZyZXNjby1jb3JlJztcbmltcG9ydCB7IERpYWdyYW1zU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2RpYWdyYW1zLnNlcnZpY2UnO1xuaW1wb3J0IHsgRGlhZ3JhbUNvbG9yU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2RpYWdyYW0tY29sb3Iuc2VydmljZSc7XG5pbXBvcnQgeyBSYXBoYWVsU2VydmljZSB9IGZyb20gJy4vcmFwaGFlbC9yYXBoYWVsLnNlcnZpY2UnO1xuaW1wb3J0IHsgRGlhZ3JhbU1vZGVsLCBEaWFncmFtRWxlbWVudE1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL2RpYWdyYW0ubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHNlbGVjdG9yOiAnYWN0aXZpdGktZGlhZ3JhbScsXG4gICAgc3R5bGVzOiBbXCIuZGlhZ3JhbSB7ICAgICBib3JkZXI6IDFweCBzb2xpZCBsaWdodGdyYXk7IG92ZXJmbG93OmF1dG8gfVwiXSxcbiAgICB0ZW1wbGF0ZTogXCI8ZGl2ICpuZ0lmPVxcXCJkaWFncmFtXFxcIiBjbGFzcz1cXFwiZGlhZ3JhbVxcXCI+ICAgICA8ZGl2ICpuZ0Zvcj1cXFwibGV0IGVsZW1lbnQgb2YgZGlhZ3JhbS5lbGVtZW50c1xcXCI+ICAgICAgICAgPGRpdiBbbmdTd2l0Y2hdPVxcXCJlbGVtZW50LnR5cGVcXFwiPiAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidTdGFydEV2ZW50J1xcXCI+ICAgICAgICAgICAgICAgICA8ZGlhZ3JhbS1zdGFydC1ldmVudCBbZGF0YV09XFxcImVsZW1lbnRcXFwiPjwvZGlhZ3JhbS1zdGFydC1ldmVudD4gICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgIDxkaXYgKm5nU3dpdGNoQ2FzZT1cXFwiJ0V4Y2x1c2l2ZUdhdGV3YXknXFxcIj4gICAgICAgICAgICAgICAgIDxkaWFncmFtLWV4Y2x1c2l2ZS1nYXRld2F5IFtkYXRhXT1cXFwiZWxlbWVudFxcXCI+PC9kaWFncmFtLWV4Y2x1c2l2ZS1nYXRld2F5PiAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgPGRpdiAqbmdTd2l0Y2hDYXNlPVxcXCInSW5jbHVzaXZlR2F0ZXdheSdcXFwiPiAgICAgICAgICAgICAgICAgPGRpYWdyYW0taW5jbHVzaXZlLWdhdGV3YXkgW2RhdGFdPVxcXCJlbGVtZW50XFxcIj48L2RpYWdyYW0taW5jbHVzaXZlLWdhdGV3YXk+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidFdmVudEdhdGV3YXknXFxcIj4gICAgICAgICAgICAgICAgIDxkaWFncmFtLWV2ZW50LWdhdGV3YXkgW2RhdGFdPVxcXCJlbGVtZW50XFxcIj48L2RpYWdyYW0tZXZlbnQtZ2F0ZXdheT4gICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgIDxkaXYgKm5nU3dpdGNoQ2FzZT1cXFwiJ1BhcmFsbGVsR2F0ZXdheSdcXFwiPiAgICAgICAgICAgICAgICAgPGRpYWdyYW0tcGFyYWxsZWwtZ2F0ZXdheSBbZGF0YV09XFxcImVsZW1lbnRcXFwiPjwvZGlhZ3JhbS1wYXJhbGxlbC1nYXRld2F5PiAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgPGRpdiAqbmdTd2l0Y2hDYXNlPVxcXCInRW5kRXZlbnQnXFxcIj4gICAgICAgICAgICAgICAgIDxkaWFncmFtLWVuZC1ldmVudCBbZGF0YV09XFxcImVsZW1lbnRcXFwiPjwvZGlhZ3JhbS1lbmQtZXZlbnQ+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidVc2VyVGFzaydcXFwiPiAgICAgICAgICAgICAgICAgPGRpYWdyYW0tdXNlci10YXNrIFtkYXRhXT1cXFwiZWxlbWVudFxcXCI+PC9kaWFncmFtLXVzZXItdGFzaz4gICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgIDxkaXYgKm5nU3dpdGNoQ2FzZT1cXFwiJ01hbnVhbFRhc2snXFxcIj4gICAgICAgICAgICAgICAgIDxkaWFncmFtLW1hbnVhbC10YXNrIFtkYXRhXT1cXFwiZWxlbWVudFxcXCI+PC9kaWFncmFtLW1hbnVhbC10YXNrPiAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgPGRpdiAqbmdTd2l0Y2hDYXNlPVxcXCInU2VydmljZVRhc2snXFxcIj4gICAgICAgICAgICAgICAgIDxkaWFncmFtLWNvbnRhaW5lci1zZXJ2aWNlLXRhc2sgW2RhdGFdPVxcXCJlbGVtZW50XFxcIj48L2RpYWdyYW0tY29udGFpbmVyLXNlcnZpY2UtdGFzaz4gICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgIDxkaXYgKm5nU3dpdGNoQ2FzZT1cXFwiJ1JlY2VpdmVUYXNrJ1xcXCI+ICAgICAgICAgICAgICAgICA8ZGlhZ3JhbS1yZWNlaXZlLXRhc2sgW2RhdGFdPVxcXCJlbGVtZW50XFxcIj48L2RpYWdyYW0tcmVjZWl2ZS10YXNrPiAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgPGRpdiAqbmdTd2l0Y2hDYXNlPVxcXCInU2NyaXB0VGFzaydcXFwiPiAgICAgICAgICAgICAgICAgPGRpYWdyYW0tc2NyaXB0LXRhc2sgW2RhdGFdPVxcXCJlbGVtZW50XFxcIj48L2RpYWdyYW0tc2NyaXB0LXRhc2s+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidCdXNpbmVzc1J1bGVUYXNrJ1xcXCI+ICAgICAgICAgICAgICAgICA8ZGlhZ3JhbS1idXNpbmVzcy1ydWxlLXRhc2sgW2RhdGFdPVxcXCJlbGVtZW50XFxcIj48L2RpYWdyYW0tYnVzaW5lc3MtcnVsZS10YXNrPiAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgPGRpdiAqbmdTd2l0Y2hDYXNlPVxcXCInQm91bmRhcnlFdmVudCdcXFwiPiAgICAgICAgICAgICAgICAgPGRpYWdyYW0tYm91bmRhcnktZXZlbnQgW2RhdGFdPVxcXCJlbGVtZW50XFxcIj48L2RpYWdyYW0tYm91bmRhcnktZXZlbnQ+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidUaHJvd0V2ZW50J1xcXCI+ICAgICAgICAgICAgICAgICA8ZGlhZ3JhbS10aHJvdy1ldmVudCBbZGF0YV09XFxcImVsZW1lbnRcXFwiPjwvZGlhZ3JhbS10aHJvdy1ldmVudD4gICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgIDxkaXYgKm5nU3dpdGNoQ2FzZT1cXFwiJ0ludGVybWVkaWF0ZUNhdGNoRXZlbnQnXFxcIj4gICAgICAgICAgICAgICAgIDxkaWFncmFtLWludGVybWVkaWF0ZS1jYXRjaGluZy1ldmVudCBbZGF0YV09XFxcImVsZW1lbnRcXFwiPjwvZGlhZ3JhbS1pbnRlcm1lZGlhdGUtY2F0Y2hpbmctZXZlbnQ+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidTdWJQcm9jZXNzJ1xcXCI+ICAgICAgICAgICAgICAgICA8ZGlhZ3JhbS1zdWJwcm9jZXNzIFtkYXRhXT1cXFwiZWxlbWVudFxcXCI+PC9kaWFncmFtLXN1YnByb2Nlc3M+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcIidFdmVudFN1YlByb2Nlc3MnXFxcIj4gICAgICAgICAgICAgICAgIDxkaWFncmFtLWV2ZW50LXN1YnByb2Nlc3MgW2RhdGFdPVxcXCJlbGVtZW50XFxcIj48L2RpYWdyYW0tZXZlbnQtc3VicHJvY2Vzcz4gICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgPC9kaXY+ICAgICA8L2Rpdj4gICAgIDxkaXYgKm5nRm9yPVxcXCJsZXQgZmxvdyBvZiBkaWFncmFtLmZsb3dzXFxcIj4gICAgICAgICA8ZGl2IFtuZ1N3aXRjaF09XFxcImZsb3cudHlwZVxcXCI+ICAgICAgICAgICAgIDxkaXYgKm5nU3dpdGNoQ2FzZT1cXFwiJ3NlcXVlbmNlRmxvdydcXFwiPiAgICAgICAgICAgICAgICAgPGRpYWdyYW0tc2VxdWVuY2UtZmxvdyBbZmxvd109XFxcImZsb3dcXFwiPjwvZGlhZ3JhbS1zZXF1ZW5jZS1mbG93PiAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICA8L2Rpdj4gICAgIDwvZGl2PiAgICAgPGRpdiAqbmdJZj1cXFwiZGlhZ3JhbS5wb29sc1xcXCI+ICAgICAgICAgPGRpYWdyYW0tcG9vbHMgW3Bvb2xzXT1cXFwiZGlhZ3JhbS5wb29sc1xcXCI+PC9kaWFncmFtLXBvb2xzPiAgICAgPC9kaXY+IDwvZGl2PlwiXG59KVxuZXhwb3J0IGNsYXNzIERpYWdyYW1Db21wb25lbnQge1xuICAgIEBJbnB1dCgpXG4gICAgcHJvY2Vzc0RlZmluaXRpb25JZDogYW55O1xuXG4gICAgQElucHV0KClcbiAgICBtZXRyaWNQZXJjZW50YWdlczogYW55O1xuXG4gICAgQElucHV0KClcbiAgICBtZXRyaWNDb2xvcjogYW55O1xuXG4gICAgQElucHV0KClcbiAgICBtZXRyaWNUeXBlOiBzdHJpbmcgPSAnJztcblxuICAgIEBJbnB1dCgpXG4gICAgd2lkdGg6IG51bWJlciA9IDEwMDA7XG5cbiAgICBASW5wdXQoKVxuICAgIGhlaWdodDogbnVtYmVyID0gNTAwO1xuXG4gICAgQE91dHB1dCgpXG4gICAgb25TdWNjZXNzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgb25FcnJvciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIFBBRERJTkdfV0lEVEg6IG51bWJlciA9IDYwO1xuICAgIFBBRERJTkdfSEVJR0hUOiBudW1iZXIgPSA2MDtcblxuICAgIHByaXZhdGUgZGlhZ3JhbTogRGlhZ3JhbU1vZGVsO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBkaWFncmFtQ29sb3JTZXJ2aWNlOiBEaWFncmFtQ29sb3JTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcmFwaGFlbFNlcnZpY2U6IFJhcGhhZWxTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgZGlhZ3JhbXNTZXJ2aWNlOiBEaWFncmFtc1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlKSB7XG4gICAgICAgIGlmICh0cmFuc2xhdGVTZXJ2aWNlKSB7XG4gICAgICAgICAgICB0cmFuc2xhdGVTZXJ2aWNlLmFkZFRyYW5zbGF0aW9uRm9sZGVyKCduZzItYWN0aXZpdGktZGlhZ3JhbXMnLCAnbm9kZV9tb2R1bGVzL25nMi1hY3Rpdml0aS1kaWFncmFtcy9zcmMnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICB0aGlzLmRpYWdyYW1Db2xvclNlcnZpY2Uuc2V0VG90YWxDb2xvcnModGhpcy5tZXRyaWNDb2xvcik7XG4gICAgICAgIHRoaXMuZ2V0UHJvY2Vzc0RlZmluaXRpb25Nb2RlbCh0aGlzLnByb2Nlc3NEZWZpbml0aW9uSWQpO1xuICAgIH1cblxuICAgIGdldFByb2Nlc3NEZWZpbml0aW9uTW9kZWwocHJvY2Vzc0RlZmluaXRpb25JZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuZGlhZ3JhbXNTZXJ2aWNlLmdldFByb2Nlc3NEZWZpbml0aW9uTW9kZWwocHJvY2Vzc0RlZmluaXRpb25JZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKHJlczogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaWFncmFtID0gbmV3IERpYWdyYW1Nb2RlbChyZXMpO1xuICAgICAgICAgICAgICAgIHRoaXMucmFwaGFlbFNlcnZpY2Uuc2V0dGluZyh0aGlzLmRpYWdyYW0uZGlhZ3JhbVdpZHRoICsgdGhpcy5QQURESU5HX1dJRFRILCB0aGlzLmRpYWdyYW0uZGlhZ3JhbUhlaWdodCArIHRoaXMuUEFERElOR19IRUlHSFQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0TWV0cmljVmFsdWVUb0RpYWdyYW1FbGVtZW50KHRoaXMuZGlhZ3JhbSwgdGhpcy5tZXRyaWNQZXJjZW50YWdlcywgdGhpcy5tZXRyaWNUeXBlKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uU3VjY2Vzcy5lbWl0KHJlcyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGVycjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBzZXRNZXRyaWNWYWx1ZVRvRGlhZ3JhbUVsZW1lbnQoZGlhZ3JhbTogRGlhZ3JhbU1vZGVsLCBtZXRyaWNzOiBhbnksIG1ldHJpY1R5cGU6IHN0cmluZykge1xuICAgICAgICBmb3IgKGxldCBrZXkgaW4gbWV0cmljcykge1xuICAgICAgICAgICAgaWYgKG1ldHJpY3MuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIGxldCBmb3VuZEVsZW1lbnQ6IERpYWdyYW1FbGVtZW50TW9kZWwgPSBkaWFncmFtLmVsZW1lbnRzLmZpbmQoXG4gICAgICAgICAgICAgICAgICAgIChlbGVtZW50OiBEaWFncmFtRWxlbWVudE1vZGVsKSA9PiBlbGVtZW50LmlkID09PSBrZXkpO1xuICAgICAgICAgICAgICAgIGlmIChmb3VuZEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgZm91bmRFbGVtZW50LnZhbHVlID0gbWV0cmljc1trZXldO1xuICAgICAgICAgICAgICAgICAgICBmb3VuZEVsZW1lbnQuZGF0YVR5cGUgPSBtZXRyaWNUeXBlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLnJhcGhhZWxTZXJ2aWNlLnJlc2V0KCk7XG4gICAgfVxufVxuIl19
