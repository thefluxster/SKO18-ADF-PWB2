/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var ng2_alfresco_datatable_1 = require("ng2-alfresco-datatable");
var WebscriptComponent = (function () {
    function WebscriptComponent(apiService, logService) {
        this.apiService = apiService;
        this.logService = logService;
        this.showData = true;
        this.contextRoot = 'alfresco';
        this.servicePath = 'service';
        this.contentType = 'TEXT';
        this.onSuccess = new core_1.EventEmitter();
        this.data = undefined;
        this.showError = false;
    }
    WebscriptComponent.prototype.ngOnChanges = function (changes) {
        var _this = this;
        if (this.showData) {
            this.clean();
        }
        return new Promise(function (resolve, reject) {
            _this.apiService.getInstance().webScript.executeWebScript('GET', _this.scriptPath, _this.scriptArgs, _this.contextRoot, _this.servicePath).then(function (webScriptdata) {
                _this.data = webScriptdata;
                if (_this.showData) {
                    if (_this.contentType === 'DATATABLE') {
                        _this.data = _this.showDataAsDataTable(webScriptdata);
                    }
                }
                _this.onSuccess.emit(_this.data);
                resolve();
            }, function (error) {
                _this.logService.log('Error' + error);
                reject();
            });
        });
    };
    WebscriptComponent.prototype.showDataAsDataTable = function (data) {
        var datatableData = null;
        try {
            if (!data.schema) {
                data.schema = ng2_alfresco_datatable_1.ObjectDataTableAdapter.generateSchema(data.data);
            }
            if (data.schema && data.schema.length > 0) {
                this.data = new ng2_alfresco_datatable_1.ObjectDataTableAdapter(data.data, data.schema);
            }
        }
        catch (e) {
            this.logService.error('error during the cast as datatable');
        }
        return datatableData;
    };
    WebscriptComponent.prototype.clean = function () {
        this.data = undefined;
    };
    WebscriptComponent.prototype.isDataTableContent = function () {
        return this.contentType === 'DATATABLE';
    };
    return WebscriptComponent;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], WebscriptComponent.prototype, "scriptPath", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], WebscriptComponent.prototype, "scriptArgs", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], WebscriptComponent.prototype, "showData", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], WebscriptComponent.prototype, "contextRoot", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], WebscriptComponent.prototype, "servicePath", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], WebscriptComponent.prototype, "contentType", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], WebscriptComponent.prototype, "onSuccess", void 0);
WebscriptComponent = __decorate([
    core_1.Component({
        selector: 'alfresco-webscript-get',
        template: "\n        <div *ngIf=\"showData\">\n            <div *ngIf=\"contentType === 'JSON'\" id=\"webscript-data-JSON\">{{data | json}}</div>\n            <div *ngIf=\"contentType === 'HTML'\" id=\"webscript-data-HTML\" [innerHTML]=\"data\"></div>\n            <div *ngIf=\"contentType === 'TEXT'\" id=\"webscript-data-TEXT\" >{{data}}</div>\n            <div *ngIf=\"isDataTableContent()\"><alfresco-datatable id=\"webscript-datatable-wrapper\" [data]=\"data\"></alfresco-datatable><div>\n            <div *ngIf=\"showError\" id=\"error\">Error during the deserialization of {{data}} as {{contentType}}</div>\n        </div>\n    "
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoApiService,
        ng2_alfresco_core_1.LogService])
], WebscriptComponent);
exports.WebscriptComponent = WebscriptComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnNjcmlwdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQUF1RTtBQUN2RSx1REFBbUU7QUFDbkUsaUVBQWdFO0FBbUNoRSxJQUFhLGtCQUFrQjtJQTBCM0IsNEJBQW9CLFVBQThCLEVBQzlCLFVBQXNCO1FBRHRCLGVBQVUsR0FBVixVQUFVLENBQW9CO1FBQzlCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFsQjFDLGFBQVEsR0FBWSxJQUFJLENBQUM7UUFHekIsZ0JBQVcsR0FBVyxVQUFVLENBQUM7UUFHakMsZ0JBQVcsR0FBVyxTQUFTLENBQUM7UUFHaEMsZ0JBQVcsR0FBVyxNQUFNLENBQUM7UUFHN0IsY0FBUyxHQUFHLElBQUksbUJBQVksRUFBRSxDQUFDO1FBRS9CLFNBQUksR0FBUSxTQUFTLENBQUM7UUFDdEIsY0FBUyxHQUFZLEtBQUssQ0FBQztJQUkzQixDQUFDO0lBRUQsd0NBQVcsR0FBWCxVQUFZLE9BQU87UUFBbkIsaUJBd0JDO1FBdkJHLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQ2hCLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNqQixDQUFDO1FBRUQsTUFBTSxDQUFDLElBQUksT0FBTyxDQUFDLFVBQUMsT0FBTyxFQUFFLE1BQU07WUFDL0IsS0FBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLEtBQUksQ0FBQyxVQUFVLEVBQUUsS0FBSSxDQUFDLFVBQVUsRUFBRSxLQUFJLENBQUMsV0FBVyxFQUFFLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxhQUFhO2dCQUVySixLQUFJLENBQUMsSUFBSSxHQUFHLGFBQWEsQ0FBQztnQkFFMUIsRUFBRSxDQUFDLENBQUMsS0FBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7b0JBQ2hCLEVBQUUsQ0FBQyxDQUFDLEtBQUksQ0FBQyxXQUFXLEtBQUssV0FBVyxDQUFDLENBQUMsQ0FBQzt3QkFDbkMsS0FBSSxDQUFDLElBQUksR0FBRyxLQUFJLENBQUMsbUJBQW1CLENBQUMsYUFBYSxDQUFDLENBQUM7b0JBQ3hELENBQUM7Z0JBQ0wsQ0FBQztnQkFFRCxLQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBRS9CLE9BQU8sRUFBRSxDQUFDO1lBQ2QsQ0FBQyxFQUFFLFVBQUMsS0FBSztnQkFDTCxLQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDLENBQUM7Z0JBQ3JDLE1BQU0sRUFBRSxDQUFDO1lBQ2IsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFTRCxnREFBbUIsR0FBbkIsVUFBb0IsSUFBUztRQUN6QixJQUFJLGFBQWEsR0FBUSxJQUFJLENBQUM7UUFDOUIsSUFBSSxDQUFDO1lBRUQsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDZixJQUFJLENBQUMsTUFBTSxHQUFHLCtDQUFzQixDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbkUsQ0FBQztZQUVELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDeEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLCtDQUFzQixDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ25FLENBQUM7UUFFTCxDQUFDO1FBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNULElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7UUFDaEUsQ0FBQztRQUVELE1BQU0sQ0FBQyxhQUFhLENBQUM7SUFDekIsQ0FBQztJQUVELGtDQUFLLEdBQUw7UUFDSSxJQUFJLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQztJQUMxQixDQUFDO0lBRUQsK0NBQWtCLEdBQWxCO1FBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLEtBQUssV0FBVyxDQUFDO0lBQzVDLENBQUM7SUFDTCx5QkFBQztBQUFELENBekZBLEFBeUZDLElBQUE7QUF0Rkc7SUFEQyxZQUFLLEVBQUU7O3NEQUNXO0FBR25CO0lBREMsWUFBSyxFQUFFOztzREFDUTtBQUdoQjtJQURDLFlBQUssRUFBRTs7b0RBQ2lCO0FBR3pCO0lBREMsWUFBSyxFQUFFOzt1REFDeUI7QUFHakM7SUFEQyxZQUFLLEVBQUU7O3VEQUN3QjtBQUdoQztJQURDLFlBQUssRUFBRTs7dURBQ3FCO0FBRzdCO0lBREMsYUFBTSxFQUFFOztxREFDc0I7QUFyQnRCLGtCQUFrQjtJQVo5QixnQkFBUyxDQUFDO1FBQ1AsUUFBUSxFQUFFLHdCQUF3QjtRQUNsQyxRQUFRLEVBQUUsa25CQVFUO0tBQ0osQ0FBQztxQ0EyQmtDLHNDQUFrQjtRQUNsQiw4QkFBVTtHQTNCakMsa0JBQWtCLENBeUY5QjtBQXpGWSxnREFBa0IiLCJmaWxlIjoid2Vic2NyaXB0LmNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBbGZyZXNjb0FwaVNlcnZpY2UsIExvZ1NlcnZpY2UgfSBmcm9tICduZzItYWxmcmVzY28tY29yZSc7XG5pbXBvcnQgeyBPYmplY3REYXRhVGFibGVBZGFwdGVyIH0gZnJvbSAnbmcyLWFsZnJlc2NvLWRhdGF0YWJsZSc7XG5cbi8qKlxuICogPGFsZnJlc2NvLXdlYnNjcmlwdC1nZXQgW3NjcmlwdFBhdGhdPVwic3RyaW5nXCJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIFtzY3JpcHRBcmdzXT1cIk9iamVjdFwiXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICBbY29udGV4dFJvb3RdPVwic3RyaW5nXCJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIFtzZXJ2aWNlUGF0aF09XCJzdHJpbmdcIlxuICogICAgICAgICAgICAgICAgICAgICAgICAgW2NvbnRlbnRUeXBlXT1cIkpTT058SFRNTHxEQVRBVEFCTEVcIlxuICogICAgICAgICAgICAgICAgICAgICAgICAgKG9uU3VjY2Vzcyk9XCJjdXN0b21NZXRob2QoJGV2ZW50KT5cbiAqIDwvYWxmcmVzY28td2Vic2NyaXB0LWdldD5cbiAqXG4gKiBUaGlzIGNvbXBvbmVudCwgcHJvdmlkZSBhIGdldCB3ZWJzY3JpcHQgdmlld2VyXG4gKlxuICogQElucHV0UGFyYW0ge3N0cmluZ30gc2NyaXB0UGF0aCBwYXRoIHRvIFdlYiBTY3JpcHQgKGFzIGRlZmluZWQgYnkgV2ViIFNjcmlwdClcbiAqIEBJbnB1dFBhcmFtIHtPYmplY3R9IHNjcmlwdEFyZ3MgYXJndW1lbnRzIHRvIHBhc3MgdG8gV2ViIFNjcmlwdFxuICogQElucHV0UGFyYW0ge3N0cmluZ30gY29udGV4dFJvb3QgcGF0aCB3aGVyZSBhcHBsaWNhdGlvbiBpcyBkZXBsb3llZCBkZWZhdWx0IHZhbHVlICdhbGZyZXNjbydcbiAqIEBJbnB1dFBhcmFtIHtzdHJpbmd9IHNlcnZpY2VQYXRoIHBhdGggd2hlcmUgV2ViIFNjcmlwdCBzZXJ2aWNlIGlzIG1hcHBlZCBkZWZhdWx0IHZhbHVlICdzZXJ2aWNlJ1xuICogQElucHV0UGFyYW0ge3N0cmluZ30gY29udGVudFR5cGUgSlNPTiB8IEhUTUwgfCBEQVRBVEFCTEUgfCBURVhUXG4gKlxuICogQE91dHB1dCAtIG9uU3VjY2VzcyAtIFRoZSBldmVudCBpcyBlbWl0dGVkIHdoZW4gdGhlIGRhdGEgYXJlIHJlY2l2ZWRcbiAqXG4gKiBAcmV0dXJucyB7V2Vic2NyaXB0Q29tcG9uZW50fSAuXG4gKi9cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWxmcmVzY28td2Vic2NyaXB0LWdldCcsXG4gICAgdGVtcGxhdGU6IGBcbiAgICAgICAgPGRpdiAqbmdJZj1cInNob3dEYXRhXCI+XG4gICAgICAgICAgICA8ZGl2ICpuZ0lmPVwiY29udGVudFR5cGUgPT09ICdKU09OJ1wiIGlkPVwid2Vic2NyaXB0LWRhdGEtSlNPTlwiPnt7ZGF0YSB8IGpzb259fTwvZGl2PlxuICAgICAgICAgICAgPGRpdiAqbmdJZj1cImNvbnRlbnRUeXBlID09PSAnSFRNTCdcIiBpZD1cIndlYnNjcmlwdC1kYXRhLUhUTUxcIiBbaW5uZXJIVE1MXT1cImRhdGFcIj48L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgKm5nSWY9XCJjb250ZW50VHlwZSA9PT0gJ1RFWFQnXCIgaWQ9XCJ3ZWJzY3JpcHQtZGF0YS1URVhUXCIgPnt7ZGF0YX19PC9kaXY+XG4gICAgICAgICAgICA8ZGl2ICpuZ0lmPVwiaXNEYXRhVGFibGVDb250ZW50KClcIj48YWxmcmVzY28tZGF0YXRhYmxlIGlkPVwid2Vic2NyaXB0LWRhdGF0YWJsZS13cmFwcGVyXCIgW2RhdGFdPVwiZGF0YVwiPjwvYWxmcmVzY28tZGF0YXRhYmxlPjxkaXY+XG4gICAgICAgICAgICA8ZGl2ICpuZ0lmPVwic2hvd0Vycm9yXCIgaWQ9XCJlcnJvclwiPkVycm9yIGR1cmluZyB0aGUgZGVzZXJpYWxpemF0aW9uIG9mIHt7ZGF0YX19IGFzIHt7Y29udGVudFR5cGV9fTwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICBgXG59KVxuZXhwb3J0IGNsYXNzIFdlYnNjcmlwdENvbXBvbmVudCB7XG5cbiAgICBASW5wdXQoKVxuICAgIHNjcmlwdFBhdGg6IHN0cmluZztcblxuICAgIEBJbnB1dCgpXG4gICAgc2NyaXB0QXJnczogYW55O1xuXG4gICAgQElucHV0KClcbiAgICBzaG93RGF0YTogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBASW5wdXQoKVxuICAgIGNvbnRleHRSb290OiBzdHJpbmcgPSAnYWxmcmVzY28nO1xuXG4gICAgQElucHV0KClcbiAgICBzZXJ2aWNlUGF0aDogc3RyaW5nID0gJ3NlcnZpY2UnO1xuXG4gICAgQElucHV0KClcbiAgICBjb250ZW50VHlwZTogc3RyaW5nID0gJ1RFWFQnO1xuXG4gICAgQE91dHB1dCgpXG4gICAgb25TdWNjZXNzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgZGF0YTogYW55ID0gdW5kZWZpbmVkO1xuICAgIHNob3dFcnJvcjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhcGlTZXJ2aWNlOiBBbGZyZXNjb0FwaVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlKSB7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlcykge1xuICAgICAgICBpZiAodGhpcy5zaG93RGF0YSkge1xuICAgICAgICAgICAgdGhpcy5jbGVhbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpLndlYlNjcmlwdC5leGVjdXRlV2ViU2NyaXB0KCdHRVQnLCB0aGlzLnNjcmlwdFBhdGgsIHRoaXMuc2NyaXB0QXJncywgdGhpcy5jb250ZXh0Um9vdCwgdGhpcy5zZXJ2aWNlUGF0aCkudGhlbigod2ViU2NyaXB0ZGF0YSkgPT4ge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gd2ViU2NyaXB0ZGF0YTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNob3dEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnRUeXBlID09PSAnREFUQVRBQkxFJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5zaG93RGF0YUFzRGF0YVRhYmxlKHdlYlNjcmlwdGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5vblN1Y2Nlc3MuZW1pdCh0aGlzLmRhdGEpO1xuXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmxvZygnRXJyb3InICsgZXJyb3IpO1xuICAgICAgICAgICAgICAgIHJlamVjdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHNob3cgdGhlIGRhdGEgaW4gYSBuZzItYWxmcmVzY28tZGF0YXRhYmxlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAqXG4gICAgICogQHJldHV0bnMgdGhlIGRhdGEgYXMgZGF0YXRhYmxlXG4gICAgICovXG4gICAgc2hvd0RhdGFBc0RhdGFUYWJsZShkYXRhOiBhbnkpIHtcbiAgICAgICAgbGV0IGRhdGF0YWJsZURhdGE6IGFueSA9IG51bGw7XG4gICAgICAgIHRyeSB7XG5cbiAgICAgICAgICAgIGlmICghZGF0YS5zY2hlbWEpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnNjaGVtYSA9IE9iamVjdERhdGFUYWJsZUFkYXB0ZXIuZ2VuZXJhdGVTY2hlbWEoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRhdGEuc2NoZW1hICYmIGRhdGEuc2NoZW1hLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBuZXcgT2JqZWN0RGF0YVRhYmxlQWRhcHRlcihkYXRhLmRhdGEsIGRhdGEuc2NoZW1hKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoJ2Vycm9yIGR1cmluZyB0aGUgY2FzdCBhcyBkYXRhdGFibGUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkYXRhdGFibGVEYXRhO1xuICAgIH1cblxuICAgIGNsZWFuKCkge1xuICAgICAgICB0aGlzLmRhdGEgPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgaXNEYXRhVGFibGVDb250ZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb250ZW50VHlwZSA9PT0gJ0RBVEFUQUJMRSc7XG4gICAgfVxufVxuIl19
