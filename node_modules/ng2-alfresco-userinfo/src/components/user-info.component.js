/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var ecm_user_service_1 = require("./../services/ecm-user.service");
var bpm_user_service_1 = require("./../services/bpm-user.service");
var UserInfoComponent = (function () {
    function UserInfoComponent(ecmUserService, bpmUserService, authService, translateService) {
        var _this = this;
        this.ecmUserService = ecmUserService;
        this.bpmUserService = bpmUserService;
        this.authService = authService;
        this.translateService = translateService;
        this.menuOpenType = 'right';
        this.baseComponentPath = module.id.replace('components/user-info.component.js', '');
        this.anonymousImageUrl = this.baseComponentPath + '/assets/images/anonymous.gif';
        if (translateService) {
            translateService.addTranslationFolder('ng2-alfresco-userinfo', 'node_modules/ng2-alfresco-userinfo/src');
        }
        authService.loginSubject.subscribe(function (response) {
            _this.getUserInfo();
        });
    }
    UserInfoComponent.prototype.ngOnInit = function () {
        this.getUserInfo();
    };
    UserInfoComponent.prototype.getUserInfo = function () {
        this.getEcmUserInfo();
        this.getBpmUserInfo();
    };
    UserInfoComponent.prototype.isLoggedIn = function () {
        return this.authService.isLoggedIn();
    };
    UserInfoComponent.prototype.getEcmUserInfo = function () {
        var _this = this;
        if (this.authService.isEcmLoggedIn()) {
            this.ecmUserService.getCurrentUserInfo()
                .subscribe(function (res) {
                _this.ecmUser = res;
                _this.getEcmAvatar();
            });
        }
        else {
            this.ecmUser = null;
            this.ecmUserImage = null;
        }
    };
    UserInfoComponent.prototype.getBpmUserInfo = function () {
        var _this = this;
        if (this.authService.isBpmLoggedIn()) {
            this.bpmUserService.getCurrentUserInfo()
                .subscribe(function (res) {
                _this.bpmUser = res;
            });
            this.bpmUserImage = this.bpmUserService.getCurrentUserProfileImage();
        }
        else {
            this.bpmUser = null;
            this.bpmUserImage = null;
        }
    };
    UserInfoComponent.prototype.onImageLoadingError = function (event) {
        if (event) {
            var element = event.target;
            element.src = this.fallBackThumbnailImage || this.anonymousImageUrl;
        }
    };
    UserInfoComponent.prototype.stopClosing = function (event) {
        event.stopPropagation();
    };
    UserInfoComponent.prototype.getUserNameHeaderFor = function (env) {
        if (this.ecmUser && env === 'ECM') {
            return this.ecmUser.firstName || this.ecmUser.lastName;
        }
        if (this.bpmUser && env === 'BPM') {
            return this.formatValue(this.bpmUser.firstName) ||
                this.formatValue(this.bpmUser.lastName) ||
                this.formatValue(this.bpmUser.fullname);
        }
    };
    UserInfoComponent.prototype.getEcmAvatar = function () {
        this.ecmUserImage = this.ecmUserService.getUserProfileImage(this.ecmUser.avatarId);
    };
    UserInfoComponent.prototype.getUserAvatar = function () {
        return this.ecmUserImage || this.bpmUserImage;
    };
    UserInfoComponent.prototype.getBpmUserAvatar = function () {
        return this.bpmUserImage;
    };
    UserInfoComponent.prototype.getEcmUserAvatar = function () {
        return this.ecmUserImage;
    };
    UserInfoComponent.prototype.formatValue = function (value) {
        return value === 'null' ? null : value;
    };
    return UserInfoComponent;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], UserInfoComponent.prototype, "ecmBackgroundImage", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], UserInfoComponent.prototype, "bpmBackgroundImage", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], UserInfoComponent.prototype, "menuOpenType", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], UserInfoComponent.prototype, "fallBackThumbnailImage", void 0);
UserInfoComponent = __decorate([
    core_1.Component({
        selector: 'ng2-alfresco-userinfo',
        moduleId: module.id,
        styles: [".profile-image {   text-align: center;   border-radius: 90%;   width: 40px;   height: 40px;   margin-right: 0%;   cursor: pointer;   border: 1px solid #999999;   vertical-align: middle;   background-color:white;; }  .button-profile {   display: inline-block;   border: 0px;   vertical-align: middle; }  .detail-user-profile-list-mdl{     padding: 0px 0; }  @media only screen and (min-device-width: 480px) {     .user-profile-list-mdl{         max-height: 450px;         min-width: 450px;         overflow: auto;         padding:0px;     } }  .header-profile{     color: rgb(255,152,0);     margin-left: 10px; }  hr.title-start {     border: 0;     height: 1px;     background: #333;     background-image: linear-gradient(to right, #ccc, #333, #ccc); }  span.role-label-user{     font-weight: 400;     line-height: 1;     letter-spacing: 0;     color: rgba(0,0,0,.87); }  .custom-role-style{     font-size: 14px;     color: #9e9e9e; }  .truncate-long-names{     text-overflow: ellipsis; } .demo-card-wide.mdl-card {     width: inherit; } .demo-card-wide > .mdl-card__title {     color: #fff;     height: 176px; } .demo-card-wide > .mdl-card__menu {     color: #fff; }  .card-title__option{     height: 100px!important; }  img.profile-picture {     background-color: white;     background-size: cover;     border-radius: 50%;     box-shadow: inset 1px 1px 3px rgba(0,0,0,0.2), 1px 1px 4px rgba(0,0,0,0.3);     height: 80px;     width: 80px;     z-index: 3;     margin-left: 0px;     margin-right: 8px; }"],
        template: "<div id=\"userinfo_container\" *ngIf=\"isLoggedIn()\">     <div *ngIf=\"ecmUser || bpmUser\">         <div class=\"button-profile\" id=\"user-profile\" data-automation-id=\"user-profile\">             <img id=\"logged-user-img\"                  [src]=\"getUserAvatar()\"                  alt=\"user-info-profile-button\"                  (error)=\"onImageLoadingError($event)\"                  class=\"profile-image\"/>         </div>         <div mdl id=\"user-profile-lists\" class=\"user-profile-list-mdl mdl-menu mdl-js-menu mdl-js-ripple-effect\"              [class.mdl-menu--bottom-left]=\"menuOpenType === 'left'? true : false\"              [class.mdl-menu--bottom-right]=\"menuOpenType === 'right'? true : false\"              for=\"user-profile\" (click)=\"stopClosing($event)\">             <div class=\"mdl-tabs mdl-js-tabs mdl-js-ripple-effect menu-container__items\">                 <div id=\"tab-bar-env\" class=\"mdl-tabs__tab-bar\" [hidden]=\"!(ecmUser && bpmUser)\">                     <a href=\"#ecm-panel\" id=\"ecm-tab\" class=\"mdl-tabs__tab is-active\">ECM</a>                     <a href=\"#bpm-panel\" id=\"bpm-tab\" class=\"mdl-tabs__tab\">BPM</a>                 </div>                 <div class=\"mdl-tabs__panel\" [class.is-active]=\"ecmUser?true:false\" id=\"ecm-panel\">                     <div class=\"detail-user-profile-list-mdl mdl-list\" *ngIf=\"ecmUser\">                         <div class=\"demo-card-wide mdl-card\">                             <div class=\"card-title__option mdl-card__title\"                                  id=\"ecm-background-image\"                                  [style.background-image]=\"'url(' + ( ecmBackgroundImage || baseComponentPath + '/assets/images/ecm-background.png')+')'\">                                 <img class=\"profile-picture\"                                      id=\"ecm-user-detail-image\"                                      alt=\"ecm-profile-image\"                                      (error)=\"onImageLoadingError($event)\"                                      [src]=\"getEcmUserAvatar()\"/>                                 <h2 class=\"mdl-card__title-text\" id=\"ecm-username\">{{getUserNameHeaderFor('ECM')}}</h2>                             </div>                             <div class=\"mdl-card__supporting-text\">                                 <li class=\"mdl-list__item mdl-list__item--two-line\">                                     <span class=\"mdl-list__item-primary-content\">                                     <span id=\"ecm-full-name\" class=\"truncate-long-names\">                                         {{ formatValue(ecmUser.firstName) }} {{ formatValue(ecmUser.lastName) }}                                     </span>                                     <span id=\"ecm-email\" class=\"mdl-list__item-sub-title\">{{ecmUser.email}}</span>                                     </span>                                     <span id=\"ecm-job-title\" class=\"mdl-list__item-secondary-content custom-role-style\">                                         <span                                             class=\"role-label-user\">{{ 'USER_PROFILE.LABELS.ECM.JOB_TITLE' | translate }}</span>                                         {{ecmUser.jobTitle?ecmUser.jobTitle:'N/A'}}                                     </span>                                 </li>                             </div>                         </div>                     </div>                 </div>                 <div class=\"mdl-tabs__panel\" [class.is-active]=\"bpmUser && !ecmUser?true:false\" id=\"bpm-panel\">                     <div class=\"detail-user-profile-list-mdl mdl-list\" *ngIf=\"bpmUser\">                         <div class=\"demo-card-wide mdl-card\">                             <div class=\"card-title__option mdl-card__title\"                                  id=\"bpm-background-image\"                                  [style.background-image]=\"'url(' + (bpmBackgroundImage || baseComponentPath + '/assets/images/bpm-background.png')+')'\">                                 <img class=\"profile-picture\"                                      id=\"bpm-user-detail-image\"                                      alt=\"bpm-profile-image\"                                      (error)=\"onImageLoadingError($event)\"                                      [src]=\"getBpmUserAvatar()\"/>                                 <h2 class=\"mdl-card__title-text\" id=\"bpm-username\">{{getUserNameHeaderFor('BPM')}}</h2>                             </div>                             <div class=\"mdl-card__supporting-text\">                                 <li class=\"mdl-list__item mdl-list__item--two-line\">                             <span class=\"mdl-list__item-primary-content\">                             <span id=\"bpm-full-name\" class=\"truncate-long-names\">                                 {{ formatValue(bpmUser.firstName) }} {{ formatValue(bpmUser.lastName) }}                             </span>                             <span id=\"bpm-email\" class=\"mdl-list__item-sub-title\">{{bpmUser.email}}</span>                             </span>                                     <span id=\"bpm-tenant\" class=\"mdl-list__item-secondary-content custom-role-style\">                                 <span class=\"role-label-user\">{{ 'USER_PROFILE.LABELS.BPM.TENANT' | translate }}</span>                                 {{bpmUser.tenantName}}                             </span>                                 </li>                             </div>                         </div>                     </div>                 </div>             </div>         </div>      </div> </div>"
    }),
    __metadata("design:paramtypes", [ecm_user_service_1.EcmUserService,
        bpm_user_service_1.BpmUserService,
        ng2_alfresco_core_1.AlfrescoAuthenticationService,
        ng2_alfresco_core_1.AlfrescoTranslationService])
], UserInfoComponent);
exports.UserInfoComponent = UserInfoComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvdXNlci1pbmZvLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7Ozs7Ozs7Ozs7O0FBRUgsc0NBQXlEO0FBQ3pELHVEQUE4RjtBQUc5RixtRUFBZ0U7QUFDaEUsbUVBQWdFO0FBVWhFLElBQWEsaUJBQWlCO0lBMEIxQiwyQkFBb0IsY0FBOEIsRUFDOUIsY0FBOEIsRUFDOUIsV0FBMEMsRUFDMUMsZ0JBQTRDO1FBSGhFLGlCQVVDO1FBVm1CLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsZ0JBQVcsR0FBWCxXQUFXLENBQStCO1FBQzFDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBNEI7UUFwQmhFLGlCQUFZLEdBQVcsT0FBTyxDQUFDO1FBS3ZCLHNCQUFpQixHQUFHLE1BQU0sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLG1DQUFtQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBTXZGLHNCQUFpQixHQUFXLElBQUksQ0FBQyxpQkFBaUIsR0FBRyw4QkFBOEIsQ0FBQztRQVVoRixFQUFFLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7WUFDbkIsZ0JBQWdCLENBQUMsb0JBQW9CLENBQUMsdUJBQXVCLEVBQUUsd0NBQXdDLENBQUMsQ0FBQztRQUM3RyxDQUFDO1FBQ0QsV0FBVyxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsVUFBQyxRQUFRO1lBQ3hDLEtBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN2QixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxvQ0FBUSxHQUFSO1FBQ0ksSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCx1Q0FBVyxHQUFYO1FBQ0ksSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUMxQixDQUFDO0lBRUQsc0NB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QUFDLElBQUksQ0FBQyxZQUFZLENBQUM7SUFDN0IsQ0FBQztJQUVELDRDQUFnQixHQUFoQjtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBQzdCLENBQUM7SUFFRCx1Q0FBVyxHQUFYLFVBQVksS0FBYTtRQUNyQixNQUFNLENBQUMsS0FBSyxLQUFLLE1BQU0sR0FBRyxJQUFJLEdBQUcsS0FBSyxDQUFDO0lBQzNDLENBQUM7SUFDTCx3QkFBQztBQUFELENBeEhBLEFBd0hDLElBQUE7QUFySEc7SUFEQyxZQUFLLEVBQUU7OzZEQUNtQjtBQUczQjtJQURDLFlBQUssRUFBRTs7NkRBQ21CO0FBRzNCO0lBREMsWUFBSyxFQUFFOzt1REFDdUI7QUFHL0I7SUFEQyxZQUFLLEVBQUU7O2lFQUN1QjtBQVp0QixpQkFBaUI7SUFON0IsZ0JBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSx1QkFBdUI7UUFDakMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1FBQ25CLE1BQU0sRUFBRSxDQUFDLGcrQ0FBZytDLENBQUM7UUFDMStDLFFBQVEsRUFBRSw4a0xBQThrTDtLQUMzbEwsQ0FBQztxQ0EyQnNDLGlDQUFjO1FBQ2QsaUNBQWM7UUFDakIsaURBQTZCO1FBQ3hCLDhDQUEwQjtHQTdCdkQsaUJBQWlCLENBd0g3QjtBQXhIWSw4Q0FBaUIiLCJmaWxlIjoiY29tcG9uZW50cy91c2VyLWluZm8uY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSwgQWxmcmVzY29BdXRoZW50aWNhdGlvblNlcnZpY2UgfSBmcm9tICduZzItYWxmcmVzY28tY29yZSc7XG5pbXBvcnQgeyBFY21Vc2VyTW9kZWwgfSBmcm9tICcuLy4uL21vZGVscy9lY20tdXNlci5tb2RlbCc7XG5pbXBvcnQgeyBCcG1Vc2VyTW9kZWwgfSBmcm9tICcuLy4uL21vZGVscy9icG0tdXNlci5tb2RlbCc7XG5pbXBvcnQgeyBFY21Vc2VyU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvZWNtLXVzZXIuc2VydmljZSc7XG5pbXBvcnQgeyBCcG1Vc2VyU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvYnBtLXVzZXIuc2VydmljZSc7XG5cbmRlY2xhcmUgbGV0IGNvbXBvbmVudEhhbmRsZXI6IGFueTtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICduZzItYWxmcmVzY28tdXNlcmluZm8nLFxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc3R5bGVzOiBbXCIucHJvZmlsZS1pbWFnZSB7ICAgdGV4dC1hbGlnbjogY2VudGVyOyAgIGJvcmRlci1yYWRpdXM6IDkwJTsgICB3aWR0aDogNDBweDsgICBoZWlnaHQ6IDQwcHg7ICAgbWFyZ2luLXJpZ2h0OiAwJTsgICBjdXJzb3I6IHBvaW50ZXI7ICAgYm9yZGVyOiAxcHggc29saWQgIzk5OTk5OTsgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOyAgIGJhY2tncm91bmQtY29sb3I6d2hpdGU7OyB9ICAuYnV0dG9uLXByb2ZpbGUgeyAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsgICBib3JkZXI6IDBweDsgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOyB9ICAuZGV0YWlsLXVzZXItcHJvZmlsZS1saXN0LW1kbHsgICAgIHBhZGRpbmc6IDBweCAwOyB9ICBAbWVkaWEgb25seSBzY3JlZW4gYW5kIChtaW4tZGV2aWNlLXdpZHRoOiA0ODBweCkgeyAgICAgLnVzZXItcHJvZmlsZS1saXN0LW1kbHsgICAgICAgICBtYXgtaGVpZ2h0OiA0NTBweDsgICAgICAgICBtaW4td2lkdGg6IDQ1MHB4OyAgICAgICAgIG92ZXJmbG93OiBhdXRvOyAgICAgICAgIHBhZGRpbmc6MHB4OyAgICAgfSB9ICAuaGVhZGVyLXByb2ZpbGV7ICAgICBjb2xvcjogcmdiKDI1NSwxNTIsMCk7ICAgICBtYXJnaW4tbGVmdDogMTBweDsgfSAgaHIudGl0bGUtc3RhcnQgeyAgICAgYm9yZGVyOiAwOyAgICAgaGVpZ2h0OiAxcHg7ICAgICBiYWNrZ3JvdW5kOiAjMzMzOyAgICAgYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCAjY2NjLCAjMzMzLCAjY2NjKTsgfSAgc3Bhbi5yb2xlLWxhYmVsLXVzZXJ7ICAgICBmb250LXdlaWdodDogNDAwOyAgICAgbGluZS1oZWlnaHQ6IDE7ICAgICBsZXR0ZXItc3BhY2luZzogMDsgICAgIGNvbG9yOiByZ2JhKDAsMCwwLC44Nyk7IH0gIC5jdXN0b20tcm9sZS1zdHlsZXsgICAgIGZvbnQtc2l6ZTogMTRweDsgICAgIGNvbG9yOiAjOWU5ZTllOyB9ICAudHJ1bmNhdGUtbG9uZy1uYW1lc3sgICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOyB9IC5kZW1vLWNhcmQtd2lkZS5tZGwtY2FyZCB7ICAgICB3aWR0aDogaW5oZXJpdDsgfSAuZGVtby1jYXJkLXdpZGUgPiAubWRsLWNhcmRfX3RpdGxlIHsgICAgIGNvbG9yOiAjZmZmOyAgICAgaGVpZ2h0OiAxNzZweDsgfSAuZGVtby1jYXJkLXdpZGUgPiAubWRsLWNhcmRfX21lbnUgeyAgICAgY29sb3I6ICNmZmY7IH0gIC5jYXJkLXRpdGxlX19vcHRpb257ICAgICBoZWlnaHQ6IDEwMHB4IWltcG9ydGFudDsgfSAgaW1nLnByb2ZpbGUtcGljdHVyZSB7ICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsgICAgIGJhY2tncm91bmQtc2l6ZTogY292ZXI7ICAgICBib3JkZXItcmFkaXVzOiA1MCU7ICAgICBib3gtc2hhZG93OiBpbnNldCAxcHggMXB4IDNweCByZ2JhKDAsMCwwLDAuMiksIDFweCAxcHggNHB4IHJnYmEoMCwwLDAsMC4zKTsgICAgIGhlaWdodDogODBweDsgICAgIHdpZHRoOiA4MHB4OyAgICAgei1pbmRleDogMzsgICAgIG1hcmdpbi1sZWZ0OiAwcHg7ICAgICBtYXJnaW4tcmlnaHQ6IDhweDsgfVwiXSxcbiAgICB0ZW1wbGF0ZTogXCI8ZGl2IGlkPVxcXCJ1c2VyaW5mb19jb250YWluZXJcXFwiICpuZ0lmPVxcXCJpc0xvZ2dlZEluKClcXFwiPiAgICAgPGRpdiAqbmdJZj1cXFwiZWNtVXNlciB8fCBicG1Vc2VyXFxcIj4gICAgICAgICA8ZGl2IGNsYXNzPVxcXCJidXR0b24tcHJvZmlsZVxcXCIgaWQ9XFxcInVzZXItcHJvZmlsZVxcXCIgZGF0YS1hdXRvbWF0aW9uLWlkPVxcXCJ1c2VyLXByb2ZpbGVcXFwiPiAgICAgICAgICAgICA8aW1nIGlkPVxcXCJsb2dnZWQtdXNlci1pbWdcXFwiICAgICAgICAgICAgICAgICAgW3NyY109XFxcImdldFVzZXJBdmF0YXIoKVxcXCIgICAgICAgICAgICAgICAgICBhbHQ9XFxcInVzZXItaW5mby1wcm9maWxlLWJ1dHRvblxcXCIgICAgICAgICAgICAgICAgICAoZXJyb3IpPVxcXCJvbkltYWdlTG9hZGluZ0Vycm9yKCRldmVudClcXFwiICAgICAgICAgICAgICAgICAgY2xhc3M9XFxcInByb2ZpbGUtaW1hZ2VcXFwiLz4gICAgICAgICA8L2Rpdj4gICAgICAgICA8ZGl2IG1kbCBpZD1cXFwidXNlci1wcm9maWxlLWxpc3RzXFxcIiBjbGFzcz1cXFwidXNlci1wcm9maWxlLWxpc3QtbWRsIG1kbC1tZW51IG1kbC1qcy1tZW51IG1kbC1qcy1yaXBwbGUtZWZmZWN0XFxcIiAgICAgICAgICAgICAgW2NsYXNzLm1kbC1tZW51LS1ib3R0b20tbGVmdF09XFxcIm1lbnVPcGVuVHlwZSA9PT0gJ2xlZnQnPyB0cnVlIDogZmFsc2VcXFwiICAgICAgICAgICAgICBbY2xhc3MubWRsLW1lbnUtLWJvdHRvbS1yaWdodF09XFxcIm1lbnVPcGVuVHlwZSA9PT0gJ3JpZ2h0Jz8gdHJ1ZSA6IGZhbHNlXFxcIiAgICAgICAgICAgICAgZm9yPVxcXCJ1c2VyLXByb2ZpbGVcXFwiIChjbGljayk9XFxcInN0b3BDbG9zaW5nKCRldmVudClcXFwiPiAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtdGFicyBtZGwtanMtdGFicyBtZGwtanMtcmlwcGxlLWVmZmVjdCBtZW51LWNvbnRhaW5lcl9faXRlbXNcXFwiPiAgICAgICAgICAgICAgICAgPGRpdiBpZD1cXFwidGFiLWJhci1lbnZcXFwiIGNsYXNzPVxcXCJtZGwtdGFic19fdGFiLWJhclxcXCIgW2hpZGRlbl09XFxcIiEoZWNtVXNlciAmJiBicG1Vc2VyKVxcXCI+ICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj1cXFwiI2VjbS1wYW5lbFxcXCIgaWQ9XFxcImVjbS10YWJcXFwiIGNsYXNzPVxcXCJtZGwtdGFic19fdGFiIGlzLWFjdGl2ZVxcXCI+RUNNPC9hPiAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XFxcIiNicG0tcGFuZWxcXFwiIGlkPVxcXCJicG0tdGFiXFxcIiBjbGFzcz1cXFwibWRsLXRhYnNfX3RhYlxcXCI+QlBNPC9hPiAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtdGFic19fcGFuZWxcXFwiIFtjbGFzcy5pcy1hY3RpdmVdPVxcXCJlY21Vc2VyP3RydWU6ZmFsc2VcXFwiIGlkPVxcXCJlY20tcGFuZWxcXFwiPiAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImRldGFpbC11c2VyLXByb2ZpbGUtbGlzdC1tZGwgbWRsLWxpc3RcXFwiICpuZ0lmPVxcXCJlY21Vc2VyXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiZGVtby1jYXJkLXdpZGUgbWRsLWNhcmRcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiY2FyZC10aXRsZV9fb3B0aW9uIG1kbC1jYXJkX190aXRsZVxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ9XFxcImVjbS1iYWNrZ3JvdW5kLWltYWdlXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbc3R5bGUuYmFja2dyb3VuZC1pbWFnZV09XFxcIid1cmwoJyArICggZWNtQmFja2dyb3VuZEltYWdlIHx8IGJhc2VDb21wb25lbnRQYXRoICsgJy9hc3NldHMvaW1hZ2VzL2VjbS1iYWNrZ3JvdW5kLnBuZycpKycpJ1xcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGltZyBjbGFzcz1cXFwicHJvZmlsZS1waWN0dXJlXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ9XFxcImVjbS11c2VyLWRldGFpbC1pbWFnZVxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdD1cXFwiZWNtLXByb2ZpbGUtaW1hZ2VcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZXJyb3IpPVxcXCJvbkltYWdlTG9hZGluZ0Vycm9yKCRldmVudClcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbc3JjXT1cXFwiZ2V0RWNtVXNlckF2YXRhcigpXFxcIi8+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzPVxcXCJtZGwtY2FyZF9fdGl0bGUtdGV4dFxcXCIgaWQ9XFxcImVjbS11c2VybmFtZVxcXCI+e3tnZXRVc2VyTmFtZUhlYWRlckZvcignRUNNJyl9fTwvaDI+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1jYXJkX19zdXBwb3J0aW5nLXRleHRcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBjbGFzcz1cXFwibWRsLWxpc3RfX2l0ZW0gbWRsLWxpc3RfX2l0ZW0tLXR3by1saW5lXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcIm1kbC1saXN0X19pdGVtLXByaW1hcnktY29udGVudFxcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPVxcXCJlY20tZnVsbC1uYW1lXFxcIiBjbGFzcz1cXFwidHJ1bmNhdGUtbG9uZy1uYW1lc1xcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBmb3JtYXRWYWx1ZShlY21Vc2VyLmZpcnN0TmFtZSkgfX0ge3sgZm9ybWF0VmFsdWUoZWNtVXNlci5sYXN0TmFtZSkgfX0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD1cXFwiZWNtLWVtYWlsXFxcIiBjbGFzcz1cXFwibWRsLWxpc3RfX2l0ZW0tc3ViLXRpdGxlXFxcIj57e2VjbVVzZXIuZW1haWx9fTwvc3Bhbj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD1cXFwiZWNtLWpvYi10aXRsZVxcXCIgY2xhc3M9XFxcIm1kbC1saXN0X19pdGVtLXNlY29uZGFyeS1jb250ZW50IGN1c3RvbS1yb2xlLXN0eWxlXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9XFxcInJvbGUtbGFiZWwtdXNlclxcXCI+e3sgJ1VTRVJfUFJPRklMRS5MQUJFTFMuRUNNLkpPQl9USVRMRScgfCB0cmFuc2xhdGUgfX08L3NwYW4+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7e2VjbVVzZXIuam9iVGl0bGU/ZWNtVXNlci5qb2JUaXRsZTonTi9BJ319ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtdGFic19fcGFuZWxcXFwiIFtjbGFzcy5pcy1hY3RpdmVdPVxcXCJicG1Vc2VyICYmICFlY21Vc2VyP3RydWU6ZmFsc2VcXFwiIGlkPVxcXCJicG0tcGFuZWxcXFwiPiAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImRldGFpbC11c2VyLXByb2ZpbGUtbGlzdC1tZGwgbWRsLWxpc3RcXFwiICpuZ0lmPVxcXCJicG1Vc2VyXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiZGVtby1jYXJkLXdpZGUgbWRsLWNhcmRcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiY2FyZC10aXRsZV9fb3B0aW9uIG1kbC1jYXJkX190aXRsZVxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ9XFxcImJwbS1iYWNrZ3JvdW5kLWltYWdlXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbc3R5bGUuYmFja2dyb3VuZC1pbWFnZV09XFxcIid1cmwoJyArIChicG1CYWNrZ3JvdW5kSW1hZ2UgfHwgYmFzZUNvbXBvbmVudFBhdGggKyAnL2Fzc2V0cy9pbWFnZXMvYnBtLWJhY2tncm91bmQucG5nJykrJyknXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPVxcXCJwcm9maWxlLXBpY3R1cmVcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZD1cXFwiYnBtLXVzZXItZGV0YWlsLWltYWdlXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWx0PVxcXCJicG0tcHJvZmlsZS1pbWFnZVxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlcnJvcik9XFxcIm9uSW1hZ2VMb2FkaW5nRXJyb3IoJGV2ZW50KVxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtzcmNdPVxcXCJnZXRCcG1Vc2VyQXZhdGFyKClcXFwiLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9XFxcIm1kbC1jYXJkX190aXRsZS10ZXh0XFxcIiBpZD1cXFwiYnBtLXVzZXJuYW1lXFxcIj57e2dldFVzZXJOYW1lSGVhZGVyRm9yKCdCUE0nKX19PC9oMj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwibWRsLWNhcmRfX3N1cHBvcnRpbmctdGV4dFxcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPVxcXCJtZGwtbGlzdF9faXRlbSBtZGwtbGlzdF9faXRlbS0tdHdvLWxpbmVcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcIm1kbC1saXN0X19pdGVtLXByaW1hcnktY29udGVudFxcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD1cXFwiYnBtLWZ1bGwtbmFtZVxcXCIgY2xhc3M9XFxcInRydW5jYXRlLWxvbmctbmFtZXNcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGZvcm1hdFZhbHVlKGJwbVVzZXIuZmlyc3ROYW1lKSB9fSB7eyBmb3JtYXRWYWx1ZShicG1Vc2VyLmxhc3ROYW1lKSB9fSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9XFxcImJwbS1lbWFpbFxcXCIgY2xhc3M9XFxcIm1kbC1saXN0X19pdGVtLXN1Yi10aXRsZVxcXCI+e3ticG1Vc2VyLmVtYWlsfX08L3NwYW4+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPVxcXCJicG0tdGVuYW50XFxcIiBjbGFzcz1cXFwibWRsLWxpc3RfX2l0ZW0tc2Vjb25kYXJ5LWNvbnRlbnQgY3VzdG9tLXJvbGUtc3R5bGVcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJyb2xlLWxhYmVsLXVzZXJcXFwiPnt7ICdVU0VSX1BST0ZJTEUuTEFCRUxTLkJQTS5URU5BTlQnIHwgdHJhbnNsYXRlIH19PC9zcGFuPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt7YnBtVXNlci50ZW5hbnROYW1lfX0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgIDwvZGl2PiAgICAgIDwvZGl2PiA8L2Rpdj5cIlxufSlcbmV4cG9ydCBjbGFzcyBVc2VySW5mb0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBASW5wdXQoKVxuICAgIGVjbUJhY2tncm91bmRJbWFnZTogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICBicG1CYWNrZ3JvdW5kSW1hZ2U6IHN0cmluZztcblxuICAgIEBJbnB1dCgpXG4gICAgbWVudU9wZW5UeXBlOiBzdHJpbmcgPSAncmlnaHQnO1xuXG4gICAgQElucHV0KClcbiAgICBmYWxsQmFja1RodW1ibmFpbEltYWdlOiBzdHJpbmc7XG5cbiAgICBwcml2YXRlIGJhc2VDb21wb25lbnRQYXRoID0gbW9kdWxlLmlkLnJlcGxhY2UoJ2NvbXBvbmVudHMvdXNlci1pbmZvLmNvbXBvbmVudC5qcycsICcnKTtcblxuICAgIGVjbVVzZXI6IEVjbVVzZXJNb2RlbDtcblxuICAgIGJwbVVzZXI6IEJwbVVzZXJNb2RlbDtcblxuICAgIGFub255bW91c0ltYWdlVXJsOiBzdHJpbmcgPSB0aGlzLmJhc2VDb21wb25lbnRQYXRoICsgJy9hc3NldHMvaW1hZ2VzL2Fub255bW91cy5naWYnO1xuXG4gICAgYnBtVXNlckltYWdlOiBhbnk7XG5cbiAgICBlY21Vc2VySW1hZ2U6IGFueTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWNtVXNlclNlcnZpY2U6IEVjbVVzZXJTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYnBtVXNlclNlcnZpY2U6IEJwbVVzZXJTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYXV0aFNlcnZpY2U6IEFsZnJlc2NvQXV0aGVudGljYXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgaWYgKHRyYW5zbGF0ZVNlcnZpY2UpIHtcbiAgICAgICAgICAgIHRyYW5zbGF0ZVNlcnZpY2UuYWRkVHJhbnNsYXRpb25Gb2xkZXIoJ25nMi1hbGZyZXNjby11c2VyaW5mbycsICdub2RlX21vZHVsZXMvbmcyLWFsZnJlc2NvLXVzZXJpbmZvL3NyYycpO1xuICAgICAgICB9XG4gICAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luU3ViamVjdC5zdWJzY3JpYmUoKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmdldFVzZXJJbmZvKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLmdldFVzZXJJbmZvKCk7XG4gICAgfVxuXG4gICAgZ2V0VXNlckluZm8oKSB7XG4gICAgICAgIHRoaXMuZ2V0RWNtVXNlckluZm8oKTtcbiAgICAgICAgdGhpcy5nZXRCcG1Vc2VySW5mbygpO1xuICAgIH1cblxuICAgIGlzTG9nZ2VkSW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKTtcbiAgICB9XG5cbiAgICBnZXRFY21Vc2VySW5mbygpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuYXV0aFNlcnZpY2UuaXNFY21Mb2dnZWRJbigpKSB7XG4gICAgICAgICAgICB0aGlzLmVjbVVzZXJTZXJ2aWNlLmdldEN1cnJlbnRVc2VySW5mbygpXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZSgocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVjbVVzZXIgPSA8RWNtVXNlck1vZGVsPiByZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEVjbUF2YXRhcigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZWNtVXNlciA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmVjbVVzZXJJbWFnZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRCcG1Vc2VySW5mbygpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuYXV0aFNlcnZpY2UuaXNCcG1Mb2dnZWRJbigpKSB7XG4gICAgICAgICAgICB0aGlzLmJwbVVzZXJTZXJ2aWNlLmdldEN1cnJlbnRVc2VySW5mbygpXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZSgocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnBtVXNlciA9IDxCcG1Vc2VyTW9kZWw+IHJlcztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuYnBtVXNlckltYWdlID0gdGhpcy5icG1Vc2VyU2VydmljZS5nZXRDdXJyZW50VXNlclByb2ZpbGVJbWFnZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5icG1Vc2VyID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuYnBtVXNlckltYWdlID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uSW1hZ2VMb2FkaW5nRXJyb3IoZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgICAgICBsZXQgZWxlbWVudCA9IDxhbnk+IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgIGVsZW1lbnQuc3JjID0gdGhpcy5mYWxsQmFja1RodW1ibmFpbEltYWdlIHx8IHRoaXMuYW5vbnltb3VzSW1hZ2VVcmw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdG9wQ2xvc2luZyhldmVudCkge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG5cbiAgICBnZXRVc2VyTmFtZUhlYWRlckZvcihlbnY6IHN0cmluZykge1xuICAgICAgICBpZiAodGhpcy5lY21Vc2VyICYmIGVudiA9PT0gJ0VDTScpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVjbVVzZXIuZmlyc3ROYW1lIHx8IHRoaXMuZWNtVXNlci5sYXN0TmFtZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmJwbVVzZXIgJiYgZW52ID09PSAnQlBNJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0VmFsdWUodGhpcy5icG1Vc2VyLmZpcnN0TmFtZSkgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1hdFZhbHVlKHRoaXMuYnBtVXNlci5sYXN0TmFtZSkgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1hdFZhbHVlKHRoaXMuYnBtVXNlci5mdWxsbmFtZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEVjbUF2YXRhcigpIHtcbiAgICAgICAgdGhpcy5lY21Vc2VySW1hZ2UgPSB0aGlzLmVjbVVzZXJTZXJ2aWNlLmdldFVzZXJQcm9maWxlSW1hZ2UodGhpcy5lY21Vc2VyLmF2YXRhcklkKTtcbiAgICB9XG5cbiAgICBnZXRVc2VyQXZhdGFyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lY21Vc2VySW1hZ2UgfHwgdGhpcy5icG1Vc2VySW1hZ2U7XG4gICAgfVxuXG4gICAgZ2V0QnBtVXNlckF2YXRhcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnBtVXNlckltYWdlO1xuICAgIH1cblxuICAgIGdldEVjbVVzZXJBdmF0YXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVjbVVzZXJJbWFnZTtcbiAgICB9XG5cbiAgICBmb3JtYXRWYWx1ZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZSA9PT0gJ251bGwnID8gbnVsbCA6IHZhbHVlO1xuICAgIH1cbn1cbiJdfQ==
