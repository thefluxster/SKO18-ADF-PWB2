/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var document_list_service_1 = require("./../services/document-list.service");
var ERROR_FOLDER_ALREADY_EXIST = 409;
var DocumentMenuActionComponent = (function () {
    function DocumentMenuActionComponent(documentListService, translateService, logService) {
        this.documentListService = documentListService;
        this.translateService = translateService;
        this.logService = logService;
        this.success = new core_1.EventEmitter();
        this.error = new core_1.EventEmitter();
        this.actions = [];
        this.folderName = '';
        if (translateService) {
            translateService.addTranslationFolder('ng2-alfresco-documentlist', 'node_modules/ng2-alfresco-documentlist/src');
        }
    }
    DocumentMenuActionComponent.prototype.createFolder = function (name) {
        var _this = this;
        this.cancel();
        this.documentListService.createFolder(name, this.folderId)
            .subscribe(function (res) {
            _this.folderName = '';
            _this.logService.info(res.entry);
            _this.success.emit({ node: res.entry });
        }, function (error) {
            var errorMessagePlaceholder = _this.getErrorMessage(error.response);
            if (errorMessagePlaceholder) {
                _this.message = _this.formatString(errorMessagePlaceholder, [name]);
                _this.error.emit({ message: _this.message });
                _this.logService.error(_this.message);
            }
            else {
                _this.error.emit(error);
                _this.logService.error(error);
            }
        });
    };
    DocumentMenuActionComponent.prototype.showDialog = function () {
        if (!this.dialog.nativeElement.showModal) {
            dialogPolyfill.registerDialog(this.dialog.nativeElement);
        }
        this.dialog.nativeElement.showModal();
    };
    DocumentMenuActionComponent.prototype.cancel = function () {
        if (this.dialog) {
            this.dialog.nativeElement.close();
        }
    };
    DocumentMenuActionComponent.prototype.getErrorMessage = function (response) {
        if (response.body && response.body.error.statusCode === ERROR_FOLDER_ALREADY_EXIST) {
            var errorMessage = void 0;
            errorMessage = this.translateService.get('FILE_UPLOAD.MESSAGES.FOLDER_ALREADY_EXIST');
            return errorMessage.value;
        }
    };
    DocumentMenuActionComponent.prototype.formatString = function (message, keys) {
        var i = keys.length;
        while (i--) {
            message = message.replace(new RegExp('\\{' + i + '\\}', 'gm'), keys[i]);
        }
        return message;
    };
    DocumentMenuActionComponent.prototype.isFolderNameEmpty = function () {
        return this.folderName === '' ? true : false;
    };
    return DocumentMenuActionComponent;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], DocumentMenuActionComponent.prototype, "folderId", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], DocumentMenuActionComponent.prototype, "success", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", Object)
], DocumentMenuActionComponent.prototype, "error", void 0);
__decorate([
    core_1.ViewChild('dialog'),
    __metadata("design:type", Object)
], DocumentMenuActionComponent.prototype, "dialog", void 0);
DocumentMenuActionComponent = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'alfresco-document-menu-action',
        styles: [".container {     display: -webkit-box;     display: -moz-box;     display: -ms-flexbox;     display: -webkit-flex;     display: flex;     -webkit-flex-direction: row;     flex-direction: row;     background-color: #fafafa;     border-bottom: 1px solid transparent;     border-top: 1px solid #e5e5e5;     -webkit-box-shadow: 0 2px 4px rgba(0,0,0,.2);     box-shadow: 0 2px 4px rgba(0,0,0,.2);     height: 53px;     position: relative;     -webkit-transition: height .35s cubic-bezier(0.4,0.0,1,1),border-color .4s;     transition: height .35s cubic-bezier(0.4,0.0,1,1),border-color .4s;     z-index: 5; }  .action {     max-width: 394px;     min-width: 150px; }  .action {     -webkit-align-items: flex-end;     align-items: flex-end;     display: -webkit-box;     display: -moz-box;     display: -ms-flexbox;     display: -webkit-flex;     display: flex;     -webkit-box-sizing: border-box;     box-sizing: border-box;     padding: 13px 0 11px 30px;     -webkit-transition: padding .35s cubic-bezier(0.4, 0.0, 1, 1);     transition: padding .35s cubic-bezier(0.4, 0.0, 1, 1); }  .mdl-menu__item-primary-content {     box-sizing: border-box;     display: -webkit-flex;     display: -ms-flexbox;     display: flex;     -webkit-align-items: center;     -ms-flex-align: center;     align-items: center; }  .mdl-menu__item-primary-content {     -webkit-order: 0;     -ms-flex-order: 0;     order: 0;     -webkit-flex-grow: 2;     -ms-flex-positive: 2;     flex-grow: 2;     text-decoration: none; }  .mdl-menu__item-primary-content {     box-sizing: border-box;     display: -webkit-flex;     display: -ms-flexbox;     display: flex;     -webkit-align-items: center;     -ms-flex-align: center;     align-items: center;  }  .mdl-menu__item-icon {     margin-right: 32px;     margin-top: 10px;     margin-left: 10px; }  .mdl-menu--bottom-left {     width: 200px; }  .mdl-menu__text {     float: right;     margin-right: 22px; }"],
        template: "<div class=\"container\">     <div class=\"action\">         <button id=\"actions\" class=\"mdl-button mdl-js-button mdl-button--raised\">             <i class=\"material-icons\">add</i> {{ 'BUTTON.ACTION_CREATE' | translate }}         </button>         <ul alfresco-mdl-menu class=\"mdl-menu--bottom-left\"             [attr.for]=\"'actions'\">             <li class=\"mdl-menu__item\"                 (click)=\"showDialog()\" >                 <i style=\"float: left;\" class=\"material-icons mdl-menu__item-icon\">folder</i>                 <span class=\"mdl-menu__text\">{{ 'BUTTON.ACTION_NEW_FOLDER' | translate }}</span>             </li>         </ul>     </div> </div>  <dialog class=\"mdl-dialog\" #dialog>     <h4 class=\"mdl-dialog__title\">{{ 'BUTTON.ACTION_NEW_FOLDER' | translate }}</h4>     <div class=\"mdl-dialog__content\">         <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">             <input                     type=\"text\"                     class=\"mdl-textfield__input\"                     id=\"name\"                     required                     [(ngModel)]=\"folderName\"                     placeholder=\"Folder name\"                     data-automation-id=\"name\"                     autocapitalize=\"none\" #name/>         </div>     </div>     <div class=\"mdl-dialog__actions\">         <button type=\"button\" [disabled]=\"isFolderNameEmpty()\" (click)=\"createFolder(folderName)\" class=\"mdl-button\">{{ 'BUTTON.CREATE' | translate }}</button>         <button type=\"button\" (click)=\"cancel()\" class=\"mdl-button close\">{{ 'BUTTON.CANCEL' | translate}}</button>     </div> </dialog>"
    }),
    __metadata("design:paramtypes", [document_list_service_1.DocumentListService,
        ng2_alfresco_core_1.AlfrescoTranslationService,
        ng2_alfresco_core_1.LogService])
], DocumentMenuActionComponent);
exports.DocumentMenuActionComponent = DocumentMenuActionComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvZG9jdW1lbnQtbWVudS1hY3Rpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRzs7Ozs7Ozs7Ozs7QUFFSCxzQ0FBa0Y7QUFDbEYsdURBQTJFO0FBRzNFLDZFQUEwRTtBQUsxRSxJQUFNLDBCQUEwQixHQUFHLEdBQUcsQ0FBQztBQVF2QyxJQUFhLDJCQUEyQjtJQW9CcEMscUNBQW9CLG1CQUF3QyxFQUN4QyxnQkFBNEMsRUFDNUMsVUFBc0I7UUFGdEIsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtRQUN4QyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQTRCO1FBQzVDLGVBQVUsR0FBVixVQUFVLENBQVk7UUFoQjFDLFlBQU8sR0FBRyxJQUFJLG1CQUFZLEVBQUUsQ0FBQztRQUc3QixVQUFLLEdBQUcsSUFBSSxtQkFBWSxFQUFFLENBQUM7UUFLM0IsWUFBTyxHQUF5QixFQUFFLENBQUM7UUFJbkMsZUFBVSxHQUFXLEVBQUUsQ0FBQztRQU1wQixFQUFFLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7WUFDbkIsZ0JBQWdCLENBQUMsb0JBQW9CLENBQUMsMkJBQTJCLEVBQUUsNENBQTRDLENBQUMsQ0FBQztRQUNySCxDQUFDO0lBQ0wsQ0FBQztJQUVNLGtEQUFZLEdBQW5CLFVBQW9CLElBQVk7UUFBaEMsaUJBcUJDO1FBcEJHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNkLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUM7YUFDckQsU0FBUyxDQUNOLFVBQUMsR0FBc0I7WUFDbkIsS0FBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7WUFDckIsS0FBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2hDLEtBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxD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USxFQUFFLE1BQU0sQ0FBQyxFQUFFO1FBQ25CLFFBQVEsRUFBRSwrQkFBK0I7UUFDekMsTUFBTSxFQUFFLENBQUMsbTREQUFtNEQsQ0FBQztRQUM3NEQsUUFBUSxFQUFFLGlvREFBaW9EO0tBQzlvRCxDQUFDO3FDQXFCMkMsMkNBQW1CO1FBQ3RCLDhDQUEwQjtRQUNoQyw4QkFBVTtHQXRCakMsMkJBQTJCLENBK0Z2QztBQS9GWSxrRUFBMkIiLCJmaWxlIjoiY29tcG9uZW50cy9kb2N1bWVudC1tZW51LWFjdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNiBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSwgTG9nU2VydmljZSB9IGZyb20gJ25nMi1hbGZyZXNjby1jb3JlJztcbmltcG9ydCB7IE1pbmltYWxOb2RlRW50aXR5IH0gZnJvbSAnYWxmcmVzY28tanMtYXBpJztcblxuaW1wb3J0IHsgRG9jdW1lbnRMaXN0U2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvZG9jdW1lbnQtbGlzdC5zZXJ2aWNlJztcbmltcG9ydCB7IENvbnRlbnRBY3Rpb25Nb2RlbCB9IGZyb20gJy4vLi4vbW9kZWxzL2NvbnRlbnQtYWN0aW9uLm1vZGVsJztcblxuZGVjbGFyZSBsZXQgZGlhbG9nUG9seWZpbGw6IGFueTtcblxuY29uc3QgRVJST1JfRk9MREVSX0FMUkVBRFlfRVhJU1QgPSA0MDk7XG5cbkBDb21wb25lbnQoe1xuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc2VsZWN0b3I6ICdhbGZyZXNjby1kb2N1bWVudC1tZW51LWFjdGlvbicsXG4gICAgc3R5bGVzOiBbXCIuY29udGFpbmVyIHsgICAgIGRpc3BsYXk6IC13ZWJraXQtYm94OyAgICAgZGlzcGxheTogLW1vei1ib3g7ICAgICBkaXNwbGF5OiAtbXMtZmxleGJveDsgICAgIGRpc3BsYXk6IC13ZWJraXQtZmxleDsgICAgIGRpc3BsYXk6IGZsZXg7ICAgICAtd2Via2l0LWZsZXgtZGlyZWN0aW9uOiByb3c7ICAgICBmbGV4LWRpcmVjdGlvbjogcm93OyAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZhZmFmYTsgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB0cmFuc3BhcmVudDsgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZTVlNWU1OyAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwuMik7ICAgICBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwuMik7ICAgICBoZWlnaHQ6IDUzcHg7ICAgICBwb3NpdGlvbjogcmVsYXRpdmU7ICAgICAtd2Via2l0LXRyYW5zaXRpb246IGhlaWdodCAuMzVzIGN1YmljLWJlemllcigwLjQsMC4wLDEsMSksYm9yZGVyLWNvbG9yIC40czsgICAgIHRyYW5zaXRpb246IGhlaWdodCAuMzVzIGN1YmljLWJlemllcigwLjQsMC4wLDEsMSksYm9yZGVyLWNvbG9yIC40czsgICAgIHotaW5kZXg6IDU7IH0gIC5hY3Rpb24geyAgICAgbWF4LXdpZHRoOiAzOTRweDsgICAgIG1pbi13aWR0aDogMTUwcHg7IH0gIC5hY3Rpb24geyAgICAgLXdlYmtpdC1hbGlnbi1pdGVtczogZmxleC1lbmQ7ICAgICBhbGlnbi1pdGVtczogZmxleC1lbmQ7ICAgICBkaXNwbGF5OiAtd2Via2l0LWJveDsgICAgIGRpc3BsYXk6IC1tb3otYm94OyAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7ICAgICBkaXNwbGF5OiAtd2Via2l0LWZsZXg7ICAgICBkaXNwbGF5OiBmbGV4OyAgICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94OyAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsgICAgIHBhZGRpbmc6IDEzcHggMCAxMXB4IDMwcHg7ICAgICAtd2Via2l0LXRyYW5zaXRpb246IHBhZGRpbmcgLjM1cyBjdWJpYy1iZXppZXIoMC40LCAwLjAsIDEsIDEpOyAgICAgdHJhbnNpdGlvbjogcGFkZGluZyAuMzVzIGN1YmljLWJlemllcigwLjQsIDAuMCwgMSwgMSk7IH0gIC5tZGwtbWVudV9faXRlbS1wcmltYXJ5LWNvbnRlbnQgeyAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsgICAgIGRpc3BsYXk6IC13ZWJraXQtZmxleDsgICAgIGRpc3BsYXk6IC1tcy1mbGV4Ym94OyAgICAgZGlzcGxheTogZmxleDsgICAgIC13ZWJraXQtYWxpZ24taXRlbXM6IGNlbnRlcjsgICAgIC1tcy1mbGV4LWFsaWduOiBjZW50ZXI7ICAgICBhbGlnbi1pdGVtczogY2VudGVyOyB9ICAubWRsLW1lbnVfX2l0ZW0tcHJpbWFyeS1jb250ZW50IHsgICAgIC13ZWJraXQtb3JkZXI6IDA7ICAgICAtbXMtZmxleC1vcmRlcjogMDsgICAgIG9yZGVyOiAwOyAgICAgLXdlYmtpdC1mbGV4LWdyb3c6IDI7ICAgICAtbXMtZmxleC1wb3NpdGl2ZTogMjsgICAgIGZsZXgtZ3JvdzogMjsgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsgfSAgLm1kbC1tZW51X19pdGVtLXByaW1hcnktY29udGVudCB7ICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OyAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4OyAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7ICAgICBkaXNwbGF5OiBmbGV4OyAgICAgLXdlYmtpdC1hbGlnbi1pdGVtczogY2VudGVyOyAgICAgLW1zLWZsZXgtYWxpZ246IGNlbnRlcjsgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7ICB9ICAubWRsLW1lbnVfX2l0ZW0taWNvbiB7ICAgICBtYXJnaW4tcmlnaHQ6IDMycHg7ICAgICBtYXJnaW4tdG9wOiAxMHB4OyAgICAgbWFyZ2luLWxlZnQ6IDEwcHg7IH0gIC5tZGwtbWVudS0tYm90dG9tLWxlZnQgeyAgICAgd2lkdGg6IDIwMHB4OyB9ICAubWRsLW1lbnVfX3RleHQgeyAgICAgZmxvYXQ6IHJpZ2h0OyAgICAgbWFyZ2luLXJpZ2h0OiAyMnB4OyB9XCJdLFxuICAgIHRlbXBsYXRlOiBcIjxkaXYgY2xhc3M9XFxcImNvbnRhaW5lclxcXCI+ICAgICA8ZGl2IGNsYXNzPVxcXCJhY3Rpb25cXFwiPiAgICAgICAgIDxidXR0b24gaWQ9XFxcImFjdGlvbnNcXFwiIGNsYXNzPVxcXCJtZGwtYnV0dG9uIG1kbC1qcy1idXR0b24gbWRsLWJ1dHRvbi0tcmFpc2VkXFxcIj4gICAgICAgICAgICAgPGkgY2xhc3M9XFxcIm1hdGVyaWFsLWljb25zXFxcIj5hZGQ8L2k+IHt7ICdCVVRUT04uQUNUSU9OX0NSRUFURScgfCB0cmFuc2xhdGUgfX0gICAgICAgICA8L2J1dHRvbj4gICAgICAgICA8dWwgYWxmcmVzY28tbWRsLW1lbnUgY2xhc3M9XFxcIm1kbC1tZW51LS1ib3R0b20tbGVmdFxcXCIgICAgICAgICAgICAgW2F0dHIuZm9yXT1cXFwiJ2FjdGlvbnMnXFxcIj4gICAgICAgICAgICAgPGxpIGNsYXNzPVxcXCJtZGwtbWVudV9faXRlbVxcXCIgICAgICAgICAgICAgICAgIChjbGljayk9XFxcInNob3dEaWFsb2coKVxcXCIgPiAgICAgICAgICAgICAgICAgPGkgc3R5bGU9XFxcImZsb2F0OiBsZWZ0O1xcXCIgY2xhc3M9XFxcIm1hdGVyaWFsLWljb25zIG1kbC1tZW51X19pdGVtLWljb25cXFwiPmZvbGRlcjwvaT4gICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJtZGwtbWVudV9fdGV4dFxcXCI+e3sgJ0JVVFRPTi5BQ1RJT05fTkVXX0ZPTERFUicgfCB0cmFuc2xhdGUgfX08L3NwYW4+ICAgICAgICAgICAgIDwvbGk+ICAgICAgICAgPC91bD4gICAgIDwvZGl2PiA8L2Rpdj4gIDxkaWFsb2cgY2xhc3M9XFxcIm1kbC1kaWFsb2dcXFwiICNkaWFsb2c+ICAgICA8aDQgY2xhc3M9XFxcIm1kbC1kaWFsb2dfX3RpdGxlXFxcIj57eyAnQlVUVE9OLkFDVElPTl9ORVdfRk9MREVSJyB8IHRyYW5zbGF0ZSB9fTwvaDQ+ICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtZGlhbG9nX19jb250ZW50XFxcIj4gICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkIG1kbC1qcy10ZXh0ZmllbGQgbWRsLXRleHRmaWVsZC0tZmxvYXRpbmctbGFiZWxcXFwiPiAgICAgICAgICAgICA8aW5wdXQgICAgICAgICAgICAgICAgICAgICB0eXBlPVxcXCJ0ZXh0XFxcIiAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkX19pbnB1dFxcXCIgICAgICAgICAgICAgICAgICAgICBpZD1cXFwibmFtZVxcXCIgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZCAgICAgICAgICAgICAgICAgICAgIFsobmdNb2RlbCldPVxcXCJmb2xkZXJOYW1lXFxcIiAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVxcXCJGb2xkZXIgbmFtZVxcXCIgICAgICAgICAgICAgICAgICAgICBkYXRhLWF1dG9tYXRpb24taWQ9XFxcIm5hbWVcXFwiICAgICAgICAgICAgICAgICAgICAgYXV0b2NhcGl0YWxpemU9XFxcIm5vbmVcXFwiICNuYW1lLz4gICAgICAgICA8L2Rpdj4gICAgIDwvZGl2PiAgICAgPGRpdiBjbGFzcz1cXFwibWRsLWRpYWxvZ19fYWN0aW9uc1xcXCI+ICAgICAgICAgPGJ1dHRvbiB0eXBlPVxcXCJidXR0b25cXFwiIFtkaXNhYmxlZF09XFxcImlzRm9sZGVyTmFtZUVtcHR5KClcXFwiIChjbGljayk9XFxcImNyZWF0ZUZvbGRlcihmb2xkZXJOYW1lKVxcXCIgY2xhc3M9XFxcIm1kbC1idXR0b25cXFwiPnt7ICdCVVRUT04uQ1JFQVRFJyB8IHRyYW5zbGF0ZSB9fTwvYnV0dG9uPiAgICAgICAgIDxidXR0b24gdHlwZT1cXFwiYnV0dG9uXFxcIiAoY2xpY2spPVxcXCJjYW5jZWwoKVxcXCIgY2xhc3M9XFxcIm1kbC1idXR0b24gY2xvc2VcXFwiPnt7ICdCVVRUT04uQ0FOQ0VMJyB8IHRyYW5zbGF0ZX19PC9idXR0b24+ICAgICA8L2Rpdj4gPC9kaWFsb2c+XCJcbn0pXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRNZW51QWN0aW9uQ29tcG9uZW50IHtcblxuICAgIEBJbnB1dCgpXG4gICAgZm9sZGVySWQ6IHN0cmluZztcblxuICAgIEBPdXRwdXQoKVxuICAgIHN1Y2Nlc3MgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIEBWaWV3Q2hpbGQoJ2RpYWxvZycpXG4gICAgZGlhbG9nOiBhbnk7XG5cbiAgICBhY3Rpb25zOiBDb250ZW50QWN0aW9uTW9kZWxbXSA9IFtdO1xuXG4gICAgbWVzc2FnZTogc3RyaW5nO1xuXG4gICAgZm9sZGVyTmFtZTogc3RyaW5nID0gJyc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRvY3VtZW50TGlzdFNlcnZpY2U6IERvY3VtZW50TGlzdFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB0cmFuc2xhdGVTZXJ2aWNlOiBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UpIHtcblxuICAgICAgICBpZiAodHJhbnNsYXRlU2VydmljZSkge1xuICAgICAgICAgICAgdHJhbnNsYXRlU2VydmljZS5hZGRUcmFuc2xhdGlvbkZvbGRlcignbmcyLWFsZnJlc2NvLWRvY3VtZW50bGlzdCcsICdub2RlX21vZHVsZXMvbmcyLWFsZnJlc2NvLWRvY3VtZW50bGlzdC9zcmMnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVGb2xkZXIobmFtZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuY2FuY2VsKCk7XG4gICAgICAgIHRoaXMuZG9jdW1lbnRMaXN0U2VydmljZS5jcmVhdGVGb2xkZXIobmFtZSwgdGhpcy5mb2xkZXJJZClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHJlczogTWluaW1hbE5vZGVFbnRpdHkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2xkZXJOYW1lID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5pbmZvKHJlcy5lbnRyeSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3VjY2Vzcy5lbWl0KHtub2RlOiByZXMuZW50cnl9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGVycm9yTWVzc2FnZVBsYWNlaG9sZGVyID0gdGhpcy5nZXRFcnJvck1lc3NhZ2UoZXJyb3IucmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JNZXNzYWdlUGxhY2Vob2xkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZSA9IHRoaXMuZm9ybWF0U3RyaW5nKGVycm9yTWVzc2FnZVBsYWNlaG9sZGVyLCBbbmFtZV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KHttZXNzYWdlOiB0aGlzLm1lc3NhZ2V9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcih0aGlzLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBzaG93RGlhbG9nKCkge1xuICAgICAgICBpZiAoIXRoaXMuZGlhbG9nLm5hdGl2ZUVsZW1lbnQuc2hvd01vZGFsKSB7XG4gICAgICAgICAgICBkaWFsb2dQb2x5ZmlsbC5yZWdpc3RlckRpYWxvZyh0aGlzLmRpYWxvZy5uYXRpdmVFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpYWxvZy5uYXRpdmVFbGVtZW50LnNob3dNb2RhbCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjYW5jZWwoKSB7XG4gICAgICAgIGlmICh0aGlzLmRpYWxvZykge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2cubmF0aXZlRWxlbWVudC5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0cml2ZSB0aGUgZXJyb3IgbWVzc2FnZSB1c2luZyB0aGUgZXJyb3Igc3RhdHVzIGNvZGVcbiAgICAgKiBAcGFyYW0gcmVzcG9uc2UgLSBvYmplY3QgdGhhdCBjb250YWluIHRoZSBIVFRQIHJlc3BvbnNlXG4gICAgICogQHJldHVybnMge3N0cmluZ31cbiAgICAgKi9cbiAgICBwcml2YXRlIGdldEVycm9yTWVzc2FnZShyZXNwb25zZTogYW55KTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmJvZHkgJiYgcmVzcG9uc2UuYm9keS5lcnJvci5zdGF0dXNDb2RlID09PSBFUlJPUl9GT0xERVJfQUxSRUFEWV9FWElTVCkge1xuICAgICAgICAgICAgbGV0IGVycm9yTWVzc2FnZTogYW55O1xuICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gdGhpcy50cmFuc2xhdGVTZXJ2aWNlLmdldCgnRklMRV9VUExPQUQuTUVTU0FHRVMuRk9MREVSX0FMUkVBRFlfRVhJU1QnKTtcbiAgICAgICAgICAgIHJldHVybiBlcnJvck1lc3NhZ2UudmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlIGEgcGxhY2Vob2xkZXIgezB9IGluIGEgbWVzc2FnZSB3aXRoIHRoZSBpbnB1dCBrZXlzXG4gICAgICogQHBhcmFtIG1lc3NhZ2UgLSB0aGUgbWVzc2FnZSB0aGF0IGNvbmFpbnMgdGhlIHBsYWNlaG9sZGVyXG4gICAgICogQHBhcmFtIGtleXMgLSBhcnJheSBvZiB2YWx1ZVxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IC0gVGhlIG1lc3NhZ2Ugd2l0aG91dCBwbGFjZWhvbGRlclxuICAgICAqL1xuICAgIHByaXZhdGUgZm9ybWF0U3RyaW5nKG1lc3NhZ2U6IHN0cmluZywga2V5czogYW55IFtdKSB7XG4gICAgICAgIGxldCBpID0ga2V5cy5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlLnJlcGxhY2UobmV3IFJlZ0V4cCgnXFxcXHsnICsgaSArICdcXFxcfScsICdnbScpLCBrZXlzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICB9XG5cbiAgICBpc0ZvbGRlck5hbWVFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9sZGVyTmFtZSA9PT0gJycgPyB0cnVlIDogZmFsc2U7XG4gICAgfVxufVxuIl19
