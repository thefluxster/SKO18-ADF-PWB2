/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var Rx_1 = require("rxjs/Rx");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var ng2_alfresco_datatable_1 = require("ng2-alfresco-datatable");
var document_list_service_1 = require("./../services/document-list.service");
var share_datatable_adapter_1 = require("./../data/share-datatable-adapter");
var DocumentListComponent = DocumentListComponent_1 = (function () {
    function DocumentListComponent(documentListService, ngZone, translateService) {
        this.documentListService = documentListService;
        this.ngZone = ngZone;
        this.translateService = translateService;
        this.baseComponentPath = module.id.replace('/components/document-list.component.js', '');
        this.fallbackThumbnail = this.baseComponentPath + '/assets/images/ft_ic_miscellaneous.svg';
        this.navigate = true;
        this.navigationMode = DocumentListComponent_1.DOUBLE_CLICK_NAVIGATION;
        this.thumbnails = false;
        this.multiselect = false;
        this.enablePagination = true;
        this.contentActions = false;
        this.contextMenuActions = false;
        this.creationMenuActions = true;
        this.pageSize = DocumentListComponent_1.DEFAULT_PAGE_SIZE;
        this.skipCount = 0;
        this.currentFolderId = null;
        this.folderNode = null;
        this.node = null;
        this.nodeClick = new core_1.EventEmitter();
        this.nodeDblClick = new core_1.EventEmitter();
        this.folderChange = new core_1.EventEmitter();
        this.preview = new core_1.EventEmitter();
        this.success = new core_1.EventEmitter();
        this.error = new core_1.EventEmitter();
        this.actions = [];
        this.contextActionHandler = new Rx_1.Subject();
        this.data = new share_datatable_adapter_1.ShareDataTableAdapter(this.documentListService, this.baseComponentPath, []);
        if (translateService) {
            translateService.addTranslationFolder('ng2-alfresco-documentlist', 'node_modules/ng2-alfresco-documentlist/src');
        }
    }
    Object.defineProperty(DocumentListComponent.prototype, "rowFilter", {
        set: function (value) {
            if (this.data && value && this.currentFolderId) {
                this.data.setFilter(value);
                this.loadFolderNodesByFolderNodeId(this.currentFolderId, this.pageSize, this.skipCount);
            }
        },
        enumerable: true,
        configurable: true
    });
    ;
    Object.defineProperty(DocumentListComponent.prototype, "imageResolver", {
        set: function (value) {
            if (this.data) {
                this.data.setImageResolver(value);
            }
        },
        enumerable: true,
        configurable: true
    });
    DocumentListComponent.prototype.getContextActions = function (node) {
        var _this = this;
        if (node && node.entry) {
            var actions = this.getNodeActions(node);
            if (actions && actions.length > 0) {
                return actions.map(function (a) {
                    return {
                        model: a,
                        node: node,
                        subject: _this.contextActionHandler
                    };
                });
            }
        }
        return null;
    };
    DocumentListComponent.prototype.contextActionCallback = function (action) {
        if (action) {
            this.executeContentAction(action.node, action.model);
        }
    };
    DocumentListComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.data.thumbnails = this.thumbnails;
        this.contextActionHandler.subscribe(function (val) { return _this.contextActionCallback(val); });
        this.enforceSingleClickNavigationForMobile();
    };
    DocumentListComponent.prototype.enforceSingleClickNavigationForMobile = function () {
        if (this.isMobile()) {
            this.navigationMode = DocumentListComponent_1.SINGLE_CLICK_NAVIGATION;
        }
    };
    DocumentListComponent.prototype.ngAfterContentInit = function () {
        var columns = this.data.getColumns();
        if (!columns || columns.length === 0) {
            this.setupDefaultColumns();
        }
    };
    DocumentListComponent.prototype.ngOnChanges = function (changes) {
        if (changes['folderNode'] && changes['folderNode'].currentValue) {
            this.loadFolder();
            return;
        }
        if (changes['currentFolderId'] && changes['currentFolderId'].currentValue) {
            this.loadFolderByNodeId(changes['currentFolderId'].currentValue);
            return;
        }
        if (changes['node'] && changes['node'].currentValue) {
            this.data.loadPage(changes['node'].currentValue);
            return;
        }
    };
    DocumentListComponent.prototype.reload = function () {
        var _this = this;
        this.ngZone.run(function () {
            if (_this.folderNode) {
                _this.loadFolder();
                return;
            }
            if (_this.currentFolderId) {
                _this.loadFolderByNodeId(_this.currentFolderId);
                return;
            }
            if (_this.node) {
                _this.data.loadPage(_this.node);
                return;
            }
        });
    };
    DocumentListComponent.prototype.isEmptyTemplateDefined = function () {
        if (this.dataTable) {
            if (this.emptyFolderTemplate) {
                return true;
            }
        }
        return false;
    };
    DocumentListComponent.prototype.isMobile = function () {
        return !!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    };
    DocumentListComponent.prototype.getNodeActions = function (node) {
        var target = null;
        if (node && node.entry) {
            if (node.entry.isFile) {
                target = 'document';
            }
            if (node.entry.isFolder) {
                target = 'folder';
            }
            if (target) {
                var ltarget_1 = target.toLowerCase();
                return this.actions.filter(function (entry) {
                    return entry.target.toLowerCase() === ltarget_1;
                });
            }
        }
        return [];
    };
    DocumentListComponent.prototype.onShowContextMenu = function (e) {
        if (e) {
            e.preventDefault();
        }
    };
    DocumentListComponent.prototype.performNavigation = function (node) {
        if (node && node.entry && node.entry.isFolder) {
            this.currentFolderId = node.entry.id;
            this.folderNode = node.entry;
            this.loadFolder();
            this.folderChange.emit({ node: node.entry });
            return true;
        }
        return false;
    };
    DocumentListComponent.prototype.executeContentAction = function (node, action) {
        if (node && node.entry && action) {
            action.handler(node, this);
        }
    };
    DocumentListComponent.prototype.loadFolder = function () {
        var _this = this;
        var nodeId = this.folderNode ? this.folderNode.id : this.currentFolderId;
        if (nodeId) {
            this.loadFolderNodesByFolderNodeId(nodeId, this.pageSize, this.skipCount).catch(function (err) { return _this.error.emit(err); });
        }
    };
    DocumentListComponent.prototype.loadFolderByNodeId = function (nodeId) {
        var _this = this;
        this.documentListService.getFolderNode(nodeId).then(function (node) {
            _this.folderNode = node;
            _this.currentFolderId = node.id;
            _this.loadFolderNodesByFolderNodeId(node.id, _this.pageSize, _this.skipCount).catch(function (err) { return _this.error.emit(err); });
        })
            .catch(function (err) { return _this.error.emit(err); });
    };
    DocumentListComponent.prototype.loadFolderNodesByFolderNodeId = function (id, maxItems, skipCount) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            if (id && _this.documentListService) {
                _this.documentListService
                    .getFolder(null, {
                    maxItems: maxItems,
                    skipCount: skipCount,
                    rootFolderId: id
                })
                    .subscribe(function (val) {
                    _this.data.loadPage(val);
                    _this.pagination = val.list.pagination;
                    resolve(true);
                }, function (error) {
                    reject(error);
                });
            }
            else {
                resolve(false);
            }
        });
    };
    DocumentListComponent.prototype.setupDefaultColumns = function () {
        var colThumbnail = new ng2_alfresco_datatable_1.ObjectDataColumn({
            type: 'image',
            key: '$thumbnail',
            title: '',
            srTitle: 'Thumbnail'
        });
        var colName = new ng2_alfresco_datatable_1.ObjectDataColumn({
            type: 'text',
            key: 'name',
            title: 'Name',
            cssClass: 'full-width',
            sortable: true
        });
        this.data.setColumns([colThumbnail, colName]);
    };
    DocumentListComponent.prototype.onPreviewFile = function (node) {
        if (node) {
            this.preview.emit({
                value: node
            });
        }
    };
    DocumentListComponent.prototype.onNodeClick = function (node) {
        this.nodeClick.emit({
            value: node
        });
        if (this.navigate && this.navigationMode === DocumentListComponent_1.SINGLE_CLICK_NAVIGATION) {
            if (node && node.entry) {
                if (node.entry.isFile) {
                    this.onPreviewFile(node);
                }
                if (node.entry.isFolder) {
                    this.performNavigation(node);
                }
            }
        }
    };
    DocumentListComponent.prototype.onRowClick = function (event) {
        var item = event.value.node;
        this.onNodeClick(item);
    };
    DocumentListComponent.prototype.onNodeDblClick = function (node) {
        this.nodeDblClick.emit({
            value: node
        });
        if (this.navigate && this.navigationMode === DocumentListComponent_1.DOUBLE_CLICK_NAVIGATION) {
            if (node && node.entry) {
                if (node.entry.isFile) {
                    this.onPreviewFile(node);
                }
                if (node.entry.isFolder) {
                    this.performNavigation(node);
                }
            }
        }
    };
    DocumentListComponent.prototype.onRowDblClick = function (event) {
        var item = event.value.node;
        this.onNodeDblClick(item);
    };
    DocumentListComponent.prototype.onShowRowContextMenu = function (event) {
        if (this.contextMenuActions) {
            var args = event.args;
            var node = args.row.node;
            if (node) {
                args.actions = this.getContextActions(node) || [];
            }
        }
    };
    DocumentListComponent.prototype.onShowRowActionsMenu = function (event) {
        if (this.contentActions) {
            var args = event.args;
            var node = args.row.node;
            if (node) {
                args.actions = this.getNodeActions(node) || [];
            }
        }
    };
    DocumentListComponent.prototype.onExecuteRowAction = function (event) {
        if (this.contentActions) {
            var args = event.args;
            var node = args.row.node;
            var action = args.action;
            this.executeContentAction(node, action);
        }
    };
    DocumentListComponent.prototype.onActionMenuError = function (event) {
        this.error.emit(event);
    };
    DocumentListComponent.prototype.onActionMenuSuccess = function (event) {
        this.reload();
        this.success.emit(event);
    };
    DocumentListComponent.prototype.onChangePageSize = function (event) {
        this.pageSize = event.maxItems;
        this.reload();
    };
    DocumentListComponent.prototype.onNextPage = function (event) {
        this.skipCount = event.skipCount;
        this.reload();
    };
    DocumentListComponent.prototype.onPrevPage = function (event) {
        this.skipCount = event.skipCount;
        this.reload();
    };
    return DocumentListComponent;
}());
DocumentListComponent.SINGLE_CLICK_NAVIGATION = 'click';
DocumentListComponent.DOUBLE_CLICK_NAVIGATION = 'dblclick';
DocumentListComponent.DEFAULT_PAGE_SIZE = 20;
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], DocumentListComponent.prototype, "fallbackThumbnail", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], DocumentListComponent.prototype, "navigate", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], DocumentListComponent.prototype, "navigationMode", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], DocumentListComponent.prototype, "thumbnails", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], DocumentListComponent.prototype, "multiselect", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], DocumentListComponent.prototype, "enablePagination", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], DocumentListComponent.prototype, "contentActions", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], DocumentListComponent.prototype, "contextMenuActions", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], DocumentListComponent.prototype, "creationMenuActions", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Number)
], DocumentListComponent.prototype, "pageSize", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Function])
], DocumentListComponent.prototype, "rowFilter", null);
__decorate([
    core_1.Input(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Function])
], DocumentListComponent.prototype, "imageResolver", null);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], DocumentListComponent.prototype, "currentFolderId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], DocumentListComponent.prototype, "folderNode", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], DocumentListComponent.prototype, "node", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], DocumentListComponent.prototype, "nodeClick", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], DocumentListComponent.prototype, "nodeDblClick", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], DocumentListComponent.prototype, "folderChange", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], DocumentListComponent.prototype, "preview", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], DocumentListComponent.prototype, "success", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], DocumentListComponent.prototype, "error", void 0);
__decorate([
    core_1.ViewChild(ng2_alfresco_datatable_1.DataTableComponent),
    __metadata("design:type", ng2_alfresco_datatable_1.DataTableComponent)
], DocumentListComponent.prototype, "dataTable", void 0);
__decorate([
    core_1.HostListener('contextmenu', ['$event']),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Event]),
    __metadata("design:returntype", void 0)
], DocumentListComponent.prototype, "onShowContextMenu", null);
DocumentListComponent = DocumentListComponent_1 = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'alfresco-document-list',
        styles: [".document-list_empty_template {     text-align: center;     margin-top: 20px;     margin-bottom: 20px; }  .document-list__this-space-is-empty {     height: 32px;     opacity: 0.26;     font-family: Muli, Helvetica, Arial, sans-serif;     font-size: 24px;     line-height: 1.33;     letter-spacing: -1px;     color: #000000; }  .document-list__drag-drop {     height: 56px;     opacity: 0.54;     font-family: Muli, Helvetica, Arial, sans-serif;     font-size: 56px;     line-height: 1;     letter-spacing: -2px;     color: #000000;     margin-top: 40px; }  .document-list__any-files-here-to-add {     height: 24px;     opacity: 0.54;     font-family: Muli, Helvetica, Arial, sans-serif;     font-size: 16px;     line-height: 1.5;     letter-spacing: -0.4px;     color: #000000;     margin-top: 17px; }  .document-list__empty_doc_lib {     width: 565px;     height: 161px;     object-fit: contain;     margin-top: 17px; }"],
        template: "<alfresco-document-menu-action     *ngIf=\"creationMenuActions\"     [folderId]=\"currentFolderId\"     (success)=\"onActionMenuSuccess($event)\"     (error)=\"onActionMenuError($event)\"> </alfresco-document-menu-action> <alfresco-datatable     [data]=\"data\"     [actions]=\"contentActions\"     [multiselect]=\"multiselect\"     [fallbackThumbnail]=\"fallbackThumbnail\"     (showRowContextMenu)=\"onShowRowContextMenu($event)\"     (showRowActionsMenu)=\"onShowRowActionsMenu($event)\"     (executeRowAction)=\"onExecuteRowAction($event)\"     (rowClick)=\"onRowClick($event)\"     (rowDblClick)=\"onRowDblClick($event)\">     <div *ngIf=\"!isEmptyTemplateDefined()\">         <no-content-template>             <template>                 <div class=\"document-list_empty_template\">                     <div class=\"document-list__this-space-is-empty\">This folder is empty</div>                     <div class=\"document-list__drag-drop\">Drag and Drop</div>                     <div class=\"document-list__any-files-here-to-add\">any files here to add</div>                     <img [src]=\"baseComponentPath + '/assets/images/empty_doc_lib.svg'\" class=\"document-list__empty_doc_lib\">                 </div>             </template>         </no-content-template>     </div> </alfresco-datatable> <alfresco-pagination *ngIf=\"enablePagination\"     (changePageSize)=\"onChangePageSize($event)\"     (nextPage)=\"onNextPage($event)\"     (prevPage)=\"onPrevPage($event)\"     [pagination]=\"pagination\"     [supportedPageSizes]=\"[5, 10, 15, 20]\"> </alfresco-pagination>"
    }),
    __metadata("design:paramtypes", [document_list_service_1.DocumentListService,
        core_1.NgZone,
        ng2_alfresco_core_1.AlfrescoTranslationService])
], DocumentListComponent);
exports.DocumentListComponent = DocumentListComponent;
var DocumentListComponent_1;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvZG9jdW1lbnQtbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQWF1QjtBQUN2Qiw4QkFBa0M7QUFFbEMsdURBQStEO0FBQy9ELGlFQUE0RjtBQUM1Riw2RUFBMEU7QUFFMUUsNkVBQWtIO0FBVWxILElBQWEscUJBQXFCO0lBOEY5QiwrQkFBb0IsbUJBQXdDLEVBQ3hDLE1BQWMsRUFDZCxnQkFBNEM7UUFGNUMsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtRQUN4QyxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QscUJBQWdCLEdBQWhCLGdCQUFnQixDQUE0QjtRQTFGaEUsc0JBQWlCLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsd0NBQXdDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFHcEYsc0JBQWlCLEdBQVcsSUFBSSxDQUFDLGlCQUFpQixHQUFHLHdDQUF3QyxDQUFDO1FBRzlGLGFBQVEsR0FBWSxJQUFJLENBQUM7UUFHekIsbUJBQWMsR0FBVyx1QkFBcUIsQ0FBQyx1QkFBdUIsQ0FBQztRQUd2RSxlQUFVLEdBQVksS0FBSyxDQUFDO1FBRzVCLGdCQUFXLEdBQVksS0FBSyxDQUFDO1FBRzdCLHFCQUFnQixHQUFZLElBQUksQ0FBQztRQUdqQyxtQkFBYyxHQUFZLEtBQUssQ0FBQztRQUdoQyx1QkFBa0IsR0FBWSxLQUFLLENBQUM7UUFHcEMsd0JBQW1CLEdBQVksSUFBSSxDQUFDO1FBR3BDLGFBQVEsR0FBVyx1QkFBcUIsQ0FBQyxpQkFBaUIsQ0FBQztRQUUzRCxjQUFTLEdBQVcsQ0FBQyxDQUFDO1FBcUJ0QixvQkFBZSxHQUFXLElBQUksQ0FBQztRQUcvQixlQUFVLEdBQTJCLElBQUksQ0FBQztRQUcxQyxTQUFJLEdBQWUsSUFBSSxDQUFDO1FBR3hCLGNBQVMsR0FBc0IsSUFBSSxtQkFBWSxFQUFFLENBQUM7UUFHbEQs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OiJjb21wb25lbnRzL2RvY3VtZW50LWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBDb21wb25lbnQsXG4gICAgT25Jbml0LFxuICAgIElucHV0LFxuICAgIE9uQ2hhbmdlcyxcbiAgICBPdXRwdXQsXG4gICAgU2ltcGxlQ2hhbmdlcyxcbiAgICBFdmVudEVtaXR0ZXIsXG4gICAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgICBUZW1wbGF0ZVJlZixcbiAgICBOZ1pvbmUsXG4gICAgVmlld0NoaWxkLFxuICAgIEhvc3RMaXN0ZW5lclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzL1J4JztcbmltcG9ydCB7IE1pbmltYWxOb2RlRW50aXR5LCBNaW5pbWFsTm9kZUVudHJ5RW50aXR5LCBOb2RlUGFnaW5nLCBQYWdpbmF0aW9uIH0gZnJvbSAnYWxmcmVzY28tanMtYXBpJztcbmltcG9ydCB7IEFsZnJlc2NvVHJhbnNsYXRpb25TZXJ2aWNlIH0gZnJvbSAnbmcyLWFsZnJlc2NvLWNvcmUnO1xuaW1wb3J0IHsgRGF0YVJvd0V2ZW50LCBEYXRhVGFibGVDb21wb25lbnQsIE9iamVjdERhdGFDb2x1bW4gfSBmcm9tICduZzItYWxmcmVzY28tZGF0YXRhYmxlJztcbmltcG9ydCB7IERvY3VtZW50TGlzdFNlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL2RvY3VtZW50LWxpc3Quc2VydmljZSc7XG5pbXBvcnQgeyBDb250ZW50QWN0aW9uTW9kZWwgfSBmcm9tICcuLy4uL21vZGVscy9jb250ZW50LWFjdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBTaGFyZURhdGFUYWJsZUFkYXB0ZXIsIFNoYXJlRGF0YVJvdywgUm93RmlsdGVyLCBJbWFnZVJlc29sdmVyIH0gZnJvbSAnLi8uLi9kYXRhL3NoYXJlLWRhdGF0YWJsZS1hZGFwdGVyJztcblxuZGVjbGFyZSB2YXIgbW9kdWxlOiBhbnk7XG5cbkBDb21wb25lbnQoe1xuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc2VsZWN0b3I6ICdhbGZyZXNjby1kb2N1bWVudC1saXN0JyxcbiAgICBzdHlsZXM6IFtcIi5kb2N1bWVudC1saXN0X2VtcHR5X3RlbXBsYXRlIHsgICAgIHRleHQtYWxpZ246IGNlbnRlcjsgICAgIG1hcmdpbi10b3A6IDIwcHg7ICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OyB9ICAuZG9jdW1lbnQtbGlzdF9fdGhpcy1zcGFjZS1pcy1lbXB0eSB7ICAgICBoZWlnaHQ6IDMycHg7ICAgICBvcGFjaXR5OiAwLjI2OyAgICAgZm9udC1mYW1pbHk6IE11bGksIEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7ICAgICBmb250LXNpemU6IDI0cHg7ICAgICBsaW5lLWhlaWdodDogMS4zMzsgICAgIGxldHRlci1zcGFjaW5nOiAtMXB4OyAgICAgY29sb3I6ICMwMDAwMDA7IH0gIC5kb2N1bWVudC1saXN0X19kcmFnLWRyb3AgeyAgICAgaGVpZ2h0OiA1NnB4OyAgICAgb3BhY2l0eTogMC41NDsgICAgIGZvbnQtZmFtaWx5OiBNdWxpLCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOyAgICAgZm9udC1zaXplOiA1NnB4OyAgICAgbGluZS1oZWlnaHQ6IDE7ICAgICBsZXR0ZXItc3BhY2luZzogLTJweDsgICAgIGNvbG9yOiAjMDAwMDAwOyAgICAgbWFyZ2luLXRvcDogNDBweDsgfSAgLmRvY3VtZW50LWxpc3RfX2FueS1maWxlcy1oZXJlLXRvLWFkZCB7ICAgICBoZWlnaHQ6IDI0cHg7ICAgICBvcGFjaXR5OiAwLjU0OyAgICAgZm9udC1mYW1pbHk6IE11bGksIEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7ICAgICBmb250LXNpemU6IDE2cHg7ICAgICBsaW5lLWhlaWdodDogMS41OyAgICAgbGV0dGVyLXNwYWNpbmc6IC0wLjRweDsgICAgIGNvbG9yOiAjMDAwMDAwOyAgICAgbWFyZ2luLXRvcDogMTdweDsgfSAgLmRvY3VtZW50LWxpc3RfX2VtcHR5X2RvY19saWIgeyAgICAgd2lkdGg6IDU2NXB4OyAgICAgaGVpZ2h0OiAxNjFweDsgICAgIG9iamVjdC1maXQ6IGNvbnRhaW47ICAgICBtYXJnaW4tdG9wOiAxN3B4OyB9XCJdLFxuICAgIHRlbXBsYXRlOiBcIjxhbGZyZXNjby1kb2N1bWVudC1tZW51LWFjdGlvbiAgICAgKm5nSWY9XFxcImNyZWF0aW9uTWVudUFjdGlvbnNcXFwiICAgICBbZm9sZGVySWRdPVxcXCJjdXJyZW50Rm9sZGVySWRcXFwiICAgICAoc3VjY2Vzcyk9XFxcIm9uQWN0aW9uTWVudVN1Y2Nlc3MoJGV2ZW50KVxcXCIgICAgIChlcnJvcik9XFxcIm9uQWN0aW9uTWVudUVycm9yKCRldmVudClcXFwiPiA8L2FsZnJlc2NvLWRvY3VtZW50LW1lbnUtYWN0aW9uPiA8YWxmcmVzY28tZGF0YXRhYmxlICAgICBbZGF0YV09XFxcImRhdGFcXFwiICAgICBbYWN0aW9uc109XFxcImNvbnRlbnRBY3Rpb25zXFxcIiAgICAgW211bHRpc2VsZWN0XT1cXFwibXVsdGlzZWxlY3RcXFwiICAgICBbZmFsbGJhY2tUaHVtYm5haWxdPVxcXCJmYWxsYmFja1RodW1ibmFpbFxcXCIgICAgIChzaG93Um93Q29udGV4dE1lbnUpPVxcXCJvblNob3dSb3dDb250ZXh0TWVudSgkZXZlbnQpXFxcIiAgICAgKHNob3dSb3dBY3Rpb25zTWVudSk9XFxcIm9uU2hvd1Jvd0FjdGlvbnNNZW51KCRldmVudClcXFwiICAgICAoZXhlY3V0ZVJvd0FjdGlvbik9XFxcIm9uRXhlY3V0ZVJvd0FjdGlvbigkZXZlbnQpXFxcIiAgICAgKHJvd0NsaWNrKT1cXFwib25Sb3dDbGljaygkZXZlbnQpXFxcIiAgICAgKHJvd0RibENsaWNrKT1cXFwib25Sb3dEYmxDbGljaygkZXZlbnQpXFxcIj4gICAgIDxkaXYgKm5nSWY9XFxcIiFpc0VtcHR5VGVtcGxhdGVEZWZpbmVkKClcXFwiPiAgICAgICAgIDxuby1jb250ZW50LXRlbXBsYXRlPiAgICAgICAgICAgICA8dGVtcGxhdGU+ICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJkb2N1bWVudC1saXN0X2VtcHR5X3RlbXBsYXRlXFxcIj4gICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJkb2N1bWVudC1saXN0X190aGlzLXNwYWNlLWlzLWVtcHR5XFxcIj5UaGlzIGZvbGRlciBpcyBlbXB0eTwvZGl2PiAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImRvY3VtZW50LWxpc3RfX2RyYWctZHJvcFxcXCI+RHJhZyBhbmQgRHJvcDwvZGl2PiAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImRvY3VtZW50LWxpc3RfX2FueS1maWxlcy1oZXJlLXRvLWFkZFxcXCI+YW55IGZpbGVzIGhlcmUgdG8gYWRkPC9kaXY+ICAgICAgICAgICAgICAgICAgICAgPGltZyBbc3JjXT1cXFwiYmFzZUNvbXBvbmVudFBhdGggKyAnL2Fzc2V0cy9pbWFnZXMvZW1wdHlfZG9jX2xpYi5zdmcnXFxcIiBjbGFzcz1cXFwiZG9jdW1lbnQtbGlzdF9fZW1wdHlfZG9jX2xpYlxcXCI+ICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgPC90ZW1wbGF0ZT4gICAgICAgICA8L25vLWNvbnRlbnQtdGVtcGxhdGU+ICAgICA8L2Rpdj4gPC9hbGZyZXNjby1kYXRhdGFibGU+IDxhbGZyZXNjby1wYWdpbmF0aW9uICpuZ0lmPVxcXCJlbmFibGVQYWdpbmF0aW9uXFxcIiAgICAgKGNoYW5nZVBhZ2VTaXplKT1cXFwib25DaGFuZ2VQYWdlU2l6ZSgkZXZlbnQpXFxcIiAgICAgKG5leHRQYWdlKT1cXFwib25OZXh0UGFnZSgkZXZlbnQpXFxcIiAgICAgKHByZXZQYWdlKT1cXFwib25QcmV2UGFnZSgkZXZlbnQpXFxcIiAgICAgW3BhZ2luYXRpb25dPVxcXCJwYWdpbmF0aW9uXFxcIiAgICAgW3N1cHBvcnRlZFBhZ2VTaXplc109XFxcIls1LCAxMCwgMTUsIDIwXVxcXCI+IDwvYWxmcmVzY28tcGFnaW5hdGlvbj5cIlxufSlcbmV4cG9ydCBjbGFzcyBEb2N1bWVudExpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJDb250ZW50SW5pdCB7XG5cbiAgICBzdGF0aWMgU0lOR0xFX0NMSUNLX05BVklHQVRJT046IHN0cmluZyA9ICdjbGljayc7XG4gICAgc3RhdGljIERPVUJMRV9DTElDS19OQVZJR0FUSU9OOiBzdHJpbmcgPSAnZGJsY2xpY2snO1xuICAgIHN0YXRpYyBERUZBVUxUX1BBR0VfU0laRTogbnVtYmVyID0gMjA7XG5cbiAgICBiYXNlQ29tcG9uZW50UGF0aCA9IG1vZHVsZS5pZC5yZXBsYWNlKCcvY29tcG9uZW50cy9kb2N1bWVudC1saXN0LmNvbXBvbmVudC5qcycsICcnKTtcblxuICAgIEBJbnB1dCgpXG4gICAgZmFsbGJhY2tUaHVtYm5haWw6IHN0cmluZyA9IHRoaXMuYmFzZUNvbXBvbmVudFBhdGggKyAnL2Fzc2V0cy9pbWFnZXMvZnRfaWNfbWlzY2VsbGFuZW91cy5zdmcnO1xuXG4gICAgQElucHV0KClcbiAgICBuYXZpZ2F0ZTogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBASW5wdXQoKVxuICAgIG5hdmlnYXRpb25Nb2RlOiBzdHJpbmcgPSBEb2N1bWVudExpc3RDb21wb25lbnQuRE9VQkxFX0NMSUNLX05BVklHQVRJT047IC8vIGNsaWNrfGRibGNsaWNrXG5cbiAgICBASW5wdXQoKVxuICAgIHRodW1ibmFpbHM6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBJbnB1dCgpXG4gICAgbXVsdGlzZWxlY3Q6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBJbnB1dCgpXG4gICAgZW5hYmxlUGFnaW5hdGlvbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBASW5wdXQoKVxuICAgIGNvbnRlbnRBY3Rpb25zOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBASW5wdXQoKVxuICAgIGNvbnRleHRNZW51QWN0aW9uczogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgQElucHV0KClcbiAgICBjcmVhdGlvbk1lbnVBY3Rpb25zOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIEBJbnB1dCgpXG4gICAgcGFnZVNpemU6IG51bWJlciA9IERvY3VtZW50TGlzdENvbXBvbmVudC5ERUZBVUxUX1BBR0VfU0laRTtcblxuICAgIHNraXBDb3VudDogbnVtYmVyID0gMDtcblxuICAgIHBhZ2luYXRpb246IFBhZ2luYXRpb247XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCByb3dGaWx0ZXIodmFsdWU6IFJvd0ZpbHRlcikge1xuICAgICAgICBpZiAodGhpcy5kYXRhICYmIHZhbHVlICYmIHRoaXMuY3VycmVudEZvbGRlcklkKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGEuc2V0RmlsdGVyKHZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMubG9hZEZvbGRlck5vZGVzQnlGb2xkZXJOb2RlSWQodGhpcy5jdXJyZW50Rm9sZGVySWQsIHRoaXMucGFnZVNpemUsIHRoaXMuc2tpcENvdW50KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCBpbWFnZVJlc29sdmVyKHZhbHVlOiBJbWFnZVJlc29sdmVyKSB7XG4gICAgICAgIGlmICh0aGlzLmRhdGEpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YS5zZXRJbWFnZVJlc29sdmVyKHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFRoZSBpZGVudGlmaWVyIG9mIGEgbm9kZS4gWW91IGNhbiBhbHNvIHVzZSBvbmUgb2YgdGhlc2Ugd2VsbC1rbm93biBhbGlhc2VzOiAtbXktIHwgLXNoYXJlZC0gfCAtcm9vdC1cbiAgICBASW5wdXQoKVxuICAgIGN1cnJlbnRGb2xkZXJJZDogc3RyaW5nID0gbnVsbDtcblxuICAgIEBJbnB1dCgpXG4gICAgZm9sZGVyTm9kZTogTWluaW1hbE5vZGVFbnRyeUVudGl0eSA9IG51bGw7XG5cbiAgICBASW5wdXQoKVxuICAgIG5vZGU6IE5vZGVQYWdpbmcgPSBudWxsO1xuXG4gICAgQE91dHB1dCgpXG4gICAgbm9kZUNsaWNrOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIG5vZGVEYmxDbGljazogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBmb2xkZXJDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgcHJldmlldzogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBzdWNjZXNzOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIGVycm9yOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIEBWaWV3Q2hpbGQoRGF0YVRhYmxlQ29tcG9uZW50KVxuICAgIGRhdGFUYWJsZTogRGF0YVRhYmxlQ29tcG9uZW50O1xuXG4gICAgZXJyb3JNZXNzYWdlO1xuICAgIGFjdGlvbnM6IENvbnRlbnRBY3Rpb25Nb2RlbFtdID0gW107XG4gICAgZW1wdHlGb2xkZXJUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcbiAgICBjb250ZXh0QWN0aW9uSGFuZGxlcjogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3QoKTtcbiAgICBkYXRhOiBTaGFyZURhdGFUYWJsZUFkYXB0ZXI7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRvY3VtZW50TGlzdFNlcnZpY2U6IERvY3VtZW50TGlzdFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHRyYW5zbGF0ZVNlcnZpY2U6IEFsZnJlc2NvVHJhbnNsYXRpb25TZXJ2aWNlKSB7XG5cbiAgICAgICAgdGhpcy5kYXRhID0gbmV3IFNoYXJlRGF0YVRhYmxlQWRhcHRlcih0aGlzLmRvY3VtZW50TGlzdFNlcnZpY2UsIHRoaXMuYmFzZUNvbXBvbmVudFBhdGgsIFtdKTtcblxuICAgICAgICBpZiAodHJhbnNsYXRlU2VydmljZSkge1xuICAgICAgICAgICAgdHJhbnNsYXRlU2VydmljZS5hZGRUcmFuc2xhdGlvbkZvbGRlcignbmcyLWFsZnJlc2NvLWRvY3VtZW50bGlzdCcsICdub2RlX21vZHVsZXMvbmcyLWFsZnJlc2NvLWRvY3VtZW50bGlzdC9zcmMnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldENvbnRleHRBY3Rpb25zKG5vZGU6IE1pbmltYWxOb2RlRW50aXR5KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZW50cnkpIHtcbiAgICAgICAgICAgIGxldCBhY3Rpb25zID0gdGhpcy5nZXROb2RlQWN0aW9ucyhub2RlKTtcbiAgICAgICAgICAgIGlmIChhY3Rpb25zICYmIGFjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25zLm1hcChhID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsOiBhLFxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogbm9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3Q6IHRoaXMuY29udGV4dEFjdGlvbkhhbmRsZXJcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb250ZXh0QWN0aW9uQ2FsbGJhY2soYWN0aW9uKSB7XG4gICAgICAgIGlmIChhY3Rpb24pIHtcbiAgICAgICAgICAgIHRoaXMuZXhlY3V0ZUNvbnRlbnRBY3Rpb24oYWN0aW9uLm5vZGUsIGFjdGlvbi5tb2RlbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5kYXRhLnRodW1ibmFpbHMgPSB0aGlzLnRodW1ibmFpbHM7XG4gICAgICAgIHRoaXMuY29udGV4dEFjdGlvbkhhbmRsZXIuc3Vic2NyaWJlKHZhbCA9PiB0aGlzLmNvbnRleHRBY3Rpb25DYWxsYmFjayh2YWwpKTtcblxuICAgICAgICB0aGlzLmVuZm9yY2VTaW5nbGVDbGlja05hdmlnYXRpb25Gb3JNb2JpbGUoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGVuZm9yY2VTaW5nbGVDbGlja05hdmlnYXRpb25Gb3JNb2JpbGUoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmlzTW9iaWxlKCkpIHtcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvbk1vZGUgPSBEb2N1bWVudExpc3RDb21wb25lbnQuU0lOR0xFX0NMSUNLX05BVklHQVRJT047XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgICAgIGxldCBjb2x1bW5zID0gdGhpcy5kYXRhLmdldENvbHVtbnMoKTtcbiAgICAgICAgaWYgKCFjb2x1bW5zIHx8IGNvbHVtbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnNldHVwRGVmYXVsdENvbHVtbnMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgaWYgKGNoYW5nZXNbJ2ZvbGRlck5vZGUnXSAmJiBjaGFuZ2VzWydmb2xkZXJOb2RlJ10uY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRGb2xkZXIoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjaGFuZ2VzWydjdXJyZW50Rm9sZGVySWQnXSAmJiBjaGFuZ2VzWydjdXJyZW50Rm9sZGVySWQnXS5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZEZvbGRlckJ5Tm9kZUlkKGNoYW5nZXNbJ2N1cnJlbnRGb2xkZXJJZCddLmN1cnJlbnRWYWx1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2hhbmdlc1snbm9kZSddICYmIGNoYW5nZXNbJ25vZGUnXS5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YS5sb2FkUGFnZShjaGFuZ2VzWydub2RlJ10uY3VycmVudFZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlbG9hZCgpIHtcbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmZvbGRlck5vZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRGb2xkZXIoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRGb2xkZXJJZCkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9hZEZvbGRlckJ5Tm9kZUlkKHRoaXMuY3VycmVudEZvbGRlcklkKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm5vZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEubG9hZFBhZ2UodGhpcy5ub2RlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGlzRW1wdHlUZW1wbGF0ZURlZmluZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLmRhdGFUYWJsZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZW1wdHlGb2xkZXJUZW1wbGF0ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpc01vYmlsZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICEhL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxCbGFja0JlcnJ5fElFTW9iaWxlfE9wZXJhIE1pbmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpO1xuICAgIH1cblxuICAgIGdldE5vZGVBY3Rpb25zKG5vZGU6IE1pbmltYWxOb2RlRW50aXR5KTogQ29udGVudEFjdGlvbk1vZGVsW10ge1xuICAgICAgICBsZXQgdGFyZ2V0ID0gbnVsbDtcblxuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmVudHJ5KSB7XG4gICAgICAgICAgICBpZiAobm9kZS5lbnRyeS5pc0ZpbGUpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSAnZG9jdW1lbnQnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobm9kZS5lbnRyeS5pc0ZvbGRlcikge1xuICAgICAgICAgICAgICAgIHRhcmdldCA9ICdmb2xkZXInO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGFyZ2V0KSB7XG5cbiAgICAgICAgICAgICAgICBsZXQgbHRhcmdldCA9IHRhcmdldC50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWN0aW9ucy5maWx0ZXIoZW50cnkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZW50cnkudGFyZ2V0LnRvTG93ZXJDYXNlKCkgPT09IGx0YXJnZXQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcignY29udGV4dG1lbnUnLCBbJyRldmVudCddKVxuICAgIG9uU2hvd0NvbnRleHRNZW51KGU/OiBFdmVudCkge1xuICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcGVyZm9ybU5hdmlnYXRpb24obm9kZTogTWluaW1hbE5vZGVFbnRpdHkpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5lbnRyeSAmJiBub2RlLmVudHJ5LmlzRm9sZGVyKSB7XG5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudEZvbGRlcklkID0gbm9kZS5lbnRyeS5pZDtcbiAgICAgICAgICAgIHRoaXMuZm9sZGVyTm9kZSA9IG5vZGUuZW50cnk7XG5cbiAgICAgICAgICAgIHRoaXMubG9hZEZvbGRlcigpO1xuICAgICAgICAgICAgdGhpcy5mb2xkZXJDaGFuZ2UuZW1pdCh7bm9kZTogbm9kZS5lbnRyeX0pO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEludm9rZWQgd2hlbiBleGVjdXRpbmcgY29udGVudCBhY3Rpb24gZm9yIGEgZG9jdW1lbnQgb3IgZm9sZGVyLlxuICAgICAqIEBwYXJhbSBub2RlIE5vZGUgdG8gYmUgdGhlIGNvbnRleHQgb2YgdGhlIGV4ZWN1dGlvbi5cbiAgICAgKiBAcGFyYW0gYWN0aW9uIEFjdGlvbiB0byBiZSBleGVjdXRlZCBhZ2FpbnN0IHRoZSBjb250ZXh0LlxuICAgICAqL1xuICAgIGV4ZWN1dGVDb250ZW50QWN0aW9uKG5vZGU6IE1pbmltYWxOb2RlRW50aXR5LCBhY3Rpb246IENvbnRlbnRBY3Rpb25Nb2RlbCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmVudHJ5ICYmIGFjdGlvbikge1xuICAgICAgICAgICAgYWN0aW9uLmhhbmRsZXIobm9kZSwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkRm9sZGVyKCkge1xuICAgICAgICBsZXQgbm9kZUlkID0gdGhpcy5mb2xkZXJOb2RlID8gdGhpcy5mb2xkZXJOb2RlLmlkIDogdGhpcy5jdXJyZW50Rm9sZGVySWQ7XG4gICAgICAgIGlmIChub2RlSWQpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZEZvbGRlck5vZGVzQnlGb2xkZXJOb2RlSWQobm9kZUlkLCB0aGlzLnBhZ2VTaXplLCB0aGlzLnNraXBDb3VudCkuY2F0Y2goZXJyID0+IHRoaXMuZXJyb3IuZW1pdChlcnIpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGdldHMgZm9sZGVyIG5vZGUgYW5kIGl0cyBjb250ZW50XG4gICAgbG9hZEZvbGRlckJ5Tm9kZUlkKG5vZGVJZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuZG9jdW1lbnRMaXN0U2VydmljZS5nZXRGb2xkZXJOb2RlKG5vZGVJZCkudGhlbihub2RlID0+IHtcbiAgICAgICAgICAgIHRoaXMuZm9sZGVyTm9kZSA9IG5vZGU7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRGb2xkZXJJZCA9IG5vZGUuaWQ7XG4gICAgICAgICAgICB0aGlzLmxvYWRGb2xkZXJOb2Rlc0J5Rm9sZGVyTm9kZUlkKG5vZGUuaWQsIHRoaXMucGFnZVNpemUsIHRoaXMuc2tpcENvdW50KS5jYXRjaChlcnIgPT4gdGhpcy5lcnJvci5lbWl0KGVycikpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB0aGlzLmVycm9yLmVtaXQoZXJyKSk7XG4gICAgfVxuXG4gICAgbG9hZEZvbGRlck5vZGVzQnlGb2xkZXJOb2RlSWQoaWQ6IHN0cmluZywgbWF4SXRlbXM6IG51bWJlciwgc2tpcENvdW50OiBudW1iZXIpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgaWYgKGlkICYmIHRoaXMuZG9jdW1lbnRMaXN0U2VydmljZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRMaXN0U2VydmljZVxuICAgICAgICAgICAgICAgICAgICAuZ2V0Rm9sZGVyKG51bGwsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEl0ZW1zOiBtYXhJdGVtcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNraXBDb3VudDogc2tpcENvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgcm9vdEZvbGRlcklkOiBpZFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKHZhbCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhLmxvYWRQYWdlKDxOb2RlUGFnaW5nPnZhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdpbmF0aW9uID0gdmFsLmxpc3QucGFnaW5hdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBzZXQgb2YgcHJlZGVmaW5lZCBjb2x1bW5zLlxuICAgICAqL1xuICAgIHNldHVwRGVmYXVsdENvbHVtbnMoKTogdm9pZCB7XG4gICAgICAgIGxldCBjb2xUaHVtYm5haWwgPSBuZXcgT2JqZWN0RGF0YUNvbHVtbih7XG4gICAgICAgICAgICB0eXBlOiAnaW1hZ2UnLFxuICAgICAgICAgICAga2V5OiAnJHRodW1ibmFpbCcsXG4gICAgICAgICAgICB0aXRsZTogJycsXG4gICAgICAgICAgICBzclRpdGxlOiAnVGh1bWJuYWlsJ1xuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgY29sTmFtZSA9IG5ldyBPYmplY3REYXRhQ29sdW1uKHtcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGtleTogJ25hbWUnLFxuICAgICAgICAgICAgdGl0bGU6ICdOYW1lJyxcbiAgICAgICAgICAgIGNzc0NsYXNzOiAnZnVsbC13aWR0aCcsXG4gICAgICAgICAgICBzb3J0YWJsZTogdHJ1ZVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmRhdGEuc2V0Q29sdW1ucyhbY29sVGh1bWJuYWlsLCBjb2xOYW1lXSk7XG4gICAgfVxuXG4gICAgb25QcmV2aWV3RmlsZShub2RlOiBNaW5pbWFsTm9kZUVudGl0eSkge1xuICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgdGhpcy5wcmV2aWV3LmVtaXQoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBub2RlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uTm9kZUNsaWNrKG5vZGU6IE1pbmltYWxOb2RlRW50aXR5KSB7XG4gICAgICAgIHRoaXMubm9kZUNsaWNrLmVtaXQoe1xuICAgICAgICAgICAgdmFsdWU6IG5vZGVcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHRoaXMubmF2aWdhdGUgJiYgdGhpcy5uYXZpZ2F0aW9uTW9kZSA9PT0gRG9jdW1lbnRMaXN0Q29tcG9uZW50LlNJTkdMRV9DTElDS19OQVZJR0FUSU9OKSB7XG4gICAgICAgICAgICBpZiAobm9kZSAmJiBub2RlLmVudHJ5KSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUuZW50cnkuaXNGaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25QcmV2aWV3RmlsZShub2RlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobm9kZS5lbnRyeS5pc0ZvbGRlcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBlcmZvcm1OYXZpZ2F0aW9uKG5vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uUm93Q2xpY2soZXZlbnQ6IERhdGFSb3dFdmVudCkge1xuICAgICAgICBsZXQgaXRlbSA9ICg8U2hhcmVEYXRhUm93PiBldmVudC52YWx1ZSkubm9kZTtcbiAgICAgICAgdGhpcy5vbk5vZGVDbGljayhpdGVtKTtcbiAgICB9XG5cbiAgICBvbk5vZGVEYmxDbGljayhub2RlOiBNaW5pbWFsTm9kZUVudGl0eSkge1xuICAgICAgICB0aGlzLm5vZGVEYmxDbGljay5lbWl0KHtcbiAgICAgICAgICAgIHZhbHVlOiBub2RlXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh0aGlzLm5hdmlnYXRlICYmIHRoaXMubmF2aWdhdGlvbk1vZGUgPT09IERvY3VtZW50TGlzdENvbXBvbmVudC5ET1VCTEVfQ0xJQ0tfTkFWSUdBVElPTikge1xuICAgICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5lbnRyeSkge1xuICAgICAgICAgICAgICAgIGlmIChub2RlLmVudHJ5LmlzRmlsZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uUHJldmlld0ZpbGUobm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUuZW50cnkuaXNGb2xkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wZXJmb3JtTmF2aWdhdGlvbihub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvblJvd0RibENsaWNrKGV2ZW50PzogRGF0YVJvd0V2ZW50KSB7XG4gICAgICAgIGxldCBpdGVtID0gKDxTaGFyZURhdGFSb3c+IGV2ZW50LnZhbHVlKS5ub2RlO1xuICAgICAgICB0aGlzLm9uTm9kZURibENsaWNrKGl0ZW0pO1xuICAgIH1cblxuICAgIG9uU2hvd1Jvd0NvbnRleHRNZW51KGV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLmNvbnRleHRNZW51QWN0aW9ucykge1xuICAgICAgICAgICAgbGV0IGFyZ3MgPSBldmVudC5hcmdzO1xuICAgICAgICAgICAgbGV0IG5vZGUgPSAoPFNoYXJlRGF0YVJvdz4gYXJncy5yb3cpLm5vZGU7XG4gICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgIGFyZ3MuYWN0aW9ucyA9IHRoaXMuZ2V0Q29udGV4dEFjdGlvbnMobm9kZSkgfHwgW107XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvblNob3dSb3dBY3Rpb25zTWVudShldmVudCkge1xuICAgICAgICBpZiAodGhpcy5jb250ZW50QWN0aW9ucykge1xuICAgICAgICAgICAgbGV0IGFyZ3MgPSBldmVudC5hcmdzO1xuICAgICAgICAgICAgbGV0IG5vZGUgPSAoPFNoYXJlRGF0YVJvdz4gYXJncy5yb3cpLm5vZGU7XG4gICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgIGFyZ3MuYWN0aW9ucyA9IHRoaXMuZ2V0Tm9kZUFjdGlvbnMobm9kZSkgfHwgW107XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbkV4ZWN1dGVSb3dBY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuY29udGVudEFjdGlvbnMpIHtcbiAgICAgICAgICAgIGxldCBhcmdzID0gZXZlbnQuYXJncztcbiAgICAgICAgICAgIGxldCBub2RlID0gKDxTaGFyZURhdGFSb3c+IGFyZ3Mucm93KS5ub2RlO1xuICAgICAgICAgICAgbGV0IGFjdGlvbiA9ICg8Q29udGVudEFjdGlvbk1vZGVsPiBhcmdzLmFjdGlvbik7XG4gICAgICAgICAgICB0aGlzLmV4ZWN1dGVDb250ZW50QWN0aW9uKG5vZGUsIGFjdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbkFjdGlvbk1lbnVFcnJvcihldmVudCkge1xuICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXZlbnQpO1xuICAgIH1cblxuICAgIG9uQWN0aW9uTWVudVN1Y2Nlc3MoZXZlbnQpIHtcbiAgICAgICAgdGhpcy5yZWxvYWQoKTtcbiAgICAgICAgdGhpcy5zdWNjZXNzLmVtaXQoZXZlbnQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbkNoYW5nZVBhZ2VTaXplKGV2ZW50OiBQYWdpbmF0aW9uKTogdm9pZCB7XG4gICAgICAgIHRoaXMucGFnZVNpemUgPSBldmVudC5tYXhJdGVtcztcbiAgICAgICAgdGhpcy5yZWxvYWQoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgb25OZXh0UGFnZShldmVudDogUGFnaW5hdGlvbik6IHZvaWQge1xuICAgICAgICB0aGlzLnNraXBDb3VudCA9IGV2ZW50LnNraXBDb3VudDtcbiAgICAgICAgdGhpcy5yZWxvYWQoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgb25QcmV2UGFnZShldmVudDogUGFnaW5hdGlvbik6IHZvaWQge1xuICAgICAgICB0aGlzLnNraXBDb3VudCA9IGV2ZW50LnNraXBDb3VudDtcbiAgICAgICAgdGhpcy5yZWxvYWQoKTtcbiAgICB9XG59XG4iXX0=
