/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var Rx_1 = require("rxjs/Rx");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var activiti_people_service_1 = require("../services/activiti-people.service");
var ActivitiPeople = (function () {
    function ActivitiPeople(translateService, peopleService, logService) {
        var _this = this;
        this.translateService = translateService;
        this.peopleService = peopleService;
        this.logService = logService;
        this.baseComponentPath = module.id.replace('/activiti-people.component.js', '');
        this.people = [];
        this.taskId = '';
        this.readOnly = false;
        if (translateService) {
            translateService.addTranslationFolder('ng2-activiti-tasklist', 'node_modules/ng2-activiti-tasklist/src');
        }
        this.peopleSearch$ = new Rx_1.Observable(function (observer) { return _this.peopleSearchObserver = observer; }).share();
    }
    ActivitiPeople.prototype.showDialog = function () {
        if (!this.dialog.nativeElement.showModal) {
            dialogPolyfill.registerDialog(this.dialog.nativeElement);
        }
        if (this.dialog) {
            this.dialog.nativeElement.showModal();
        }
    };
    ActivitiPeople.prototype.closeDialog = function () {
        if (this.dialog) {
            this.dialog.nativeElement.close();
            this.peopleSearchObserver.next([]);
            this.activitipeoplesearch.searchUser.reset();
        }
    };
    ActivitiPeople.prototype.searchUser = function (searchedWord) {
        var _this = this;
        this.peopleService.getWorkflowUsers(this.taskId, searchedWord)
            .subscribe(function (users) {
            _this.peopleSearchObserver.next(users);
        }, function (error) { return _this.logService.error('Could not load users'); });
    };
    ActivitiPeople.prototype.involveUser = function (user) {
        var _this = this;
        this.peopleService.involveUserWithTask(this.taskId, user.id.toString())
            .subscribe(function () {
            _this.people.push(user);
        }, function (error) { return _this.logService.error('Impossible to involve user with task'); });
    };
    ActivitiPeople.prototype.removeInvolvedUser = function (user) {
        var _this = this;
        this.peopleService.removeInvolvedUser(this.taskId, user.id.toString())
            .subscribe(function () {
            _this.people = _this.people.filter(function (involvedUser) {
                return involvedUser.id !== user.id;
            });
        }, function (error) { return _this.logService.error('Impossible to remove involved user from task'); });
    };
    ActivitiPeople.prototype.getDisplayUser = function (user) {
        var firstName = user.firstName && user.firstName !== 'null' ? user.firstName : 'N/A';
        var lastName = user.lastName && user.lastName !== 'null' ? user.lastName : 'N/A';
        return firstName + ' ' + lastName;
    };
    return ActivitiPeople;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiPeople.prototype, "iconImageUrl", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Array)
], ActivitiPeople.prototype, "people", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiPeople.prototype, "taskId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiPeople.prototype, "readOnly", void 0);
__decorate([
    core_1.ViewChild('dialog'),
    __metadata("design:type", Object)
], ActivitiPeople.prototype, "dialog", void 0);
__decorate([
    core_1.ViewChild('activitipeoplesearch'),
    __metadata("design:type", Object)
], ActivitiPeople.prototype, "activitipeoplesearch", void 0);
ActivitiPeople = __decorate([
    core_1.Component({
        selector: 'activiti-people',
        moduleId: module.id,
        template: "<span class=\"activiti-label mdl-badge\" id=\"people-title\"       [attr.data-badge]=\"people?.length\">{{ 'TASK_DETAILS.LABELS.PEOPLE' | translate }}</span> <div *ngIf=\"!readOnly\" id=\"addPeople\" (click)=\"showDialog()\" class=\"icon material-icons people__icon\">add</div> <div *ngIf=\"!readOnly\" class=\"mdl-tooltip\" data-mdl-for=\"addPeople\">     Add a person </div> <div class=\"menu-container\" *ngIf=\"people?.length > 0\">     <ul class='mdl-list'>         <li class=\"mdl-list__item\" *ngFor=\"let user of people\">             <span class=\"mdl-chip mdl-chip--contact mdl-chip--deletable\">                 <img class=\"mdl-chip__contact\" [src]=\"iconImageUrl || baseComponentPath + '/../assets/images/user.jpg'\" />                 <span id=\"user-{{user.id}}\" class=\"mdl-chip__text\">{{getDisplayUser(user)}}</span>                 <a *ngIf=\"!readOnly\" class=\"mdl-chip__action\"><i id=\"remove-{{user.id}}\" (click)=\"removeInvolvedUser(user)\" class=\"material-icons people__icon\">cancel</i></a>             </span>         </li>     </ul> </div> <div *ngIf=\"people?.length === 0\" id=\"no-people-label\">     {{ 'TASK_DETAILS.PEOPLE.NONE' | translate }} </div>  <dialog class=\"mdl-dialog\" id=\"add-people-dialog\" #dialog>     <h4 class=\"mdl-dialog__title\" id=\"add-people-dialog-title\">Involve User</h4>     <div class=\"mdl-dialog__content add-people-dialog__content\">         <activiti-people-search (onSearch)=\"searchUser($event)\"                                 (onRowClicked)=\"involveUser($event)\"                                 [results]=\"peopleSearch$\"                                 [iconImageUrl]=\"iconImageUrl\" #activitipeoplesearch>         </activiti-people-search>     </div>     <div class=\"mdl-dialog__actions\">         <button type=\"button\" id=\"close-people-dialog\" (click)=\"closeDialog()\" class=\"mdl-button close\">             {{'PEOPLE.DIALOG_CLOSE' | translate }}         </button>     </div> </dialog>",
        styles: [":host {     width: 100%; }  .activiti-label {     font-weight: bolder; }  .material-icons.people__icon:hover {     color: rgb(255, 152, 0); }  .add-people-dialog__content {     padding: 20px 24px 2px; }  .mdl-tooltip {     will-change: unset; }  .material-icons {     cursor: pointer; }"]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        activiti_people_service_1.ActivitiPeopleService,
        ng2_alfresco_core_1.LogService])
], ActivitiPeople);
exports.ActivitiPeople = ActivitiPeople;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktcGVvcGxlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7Ozs7Ozs7Ozs7O0FBRUgsc0NBQTREO0FBQzVELDhCQUErQztBQUMvQyx1REFBMkU7QUFFM0UsK0VBQTRFO0FBVTVFLElBQWEsY0FBYztJQThCdkIsd0JBQW9CLGdCQUE0QyxFQUM1QyxhQUFvQyxFQUNwQyxVQUFzQjtRQUYxQyxpQkFPQztRQVBtQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQTRCO1FBQzVDLGtCQUFhLEdBQWIsYUFBYSxDQUF1QjtRQUNwQyxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBOUIxQyxzQkFBaUIsR0FBRyxNQUFNLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQywrQkFBK0IsRUFBRSxFQUFFLENBQUMsQ0FBQztRQU0zRSxXQUFNLEdBQVksRUFBRSxDQUFDO1FBR3JCLFdBQU0sR0FBVyxFQUFFLENBQUM7UUFHcEIsYUFBUSxHQUFZLEtBQUssQ0FBQztRQW1CdEIsRUFBRSxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1lBQ25CLGdCQUFnQixDQUFDLG9CQUFvQixDQUFDLHVCQUF1QixFQUFFLHdDQUF3QyxDQUFDLENBQUM7UUFDN0csQ0FBQztRQUNELElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxlQUFVLENBQVMsVUFBQSxRQUFRLElBQUksT0FBQSxLQUFJLENBQUMsb0JBQW9CLEdBQUcsUUFBUSxFQUFwQyxDQUFvQyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDMUcsQ0FBQztJQUVNLG1DQUFVLEdBQWpCO1FBQ0ksRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ3ZDLGNBQWMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUM3RCxDQUFD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O0FBRzFCO0lBREMsZ0JBQVMsQ0FBQyxRQUFRLENBQUM7OzhDQUNSO0FBR1o7SUFEQyxnQkFBUyxDQUFDLHNCQUFzQixDQUFDOzs0REFDUjtBQXBCakIsY0FBYztJQU4xQixnQkFBUyxDQUFDO1FBQ1AsUUFBUSxFQUFFLGlCQUFpQjtRQUMzQixRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7UUFDbkIsUUFBUSxFQUFFLDA3REFBMDdEO1FBQ3A4RCxNQUFNLEVBQUUsQ0FBQyxnU0FBZ1MsQ0FBQztLQUM3UyxDQUFDO3FDQStCd0MsOENBQTBCO1FBQzdCLCtDQUFxQjtRQUN4Qiw4QkFBVTtHQWhDakMsY0FBYyxDQXFGMUI7QUFyRlksd0NBQWMiLCJmaWxlIjoiY29tcG9uZW50cy9hY3Rpdml0aS1wZW9wbGUuY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZlciwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMvUngnO1xuaW1wb3J0IHsgQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UsIExvZ1NlcnZpY2UgfSBmcm9tICduZzItYWxmcmVzY28tY29yZSc7XG5pbXBvcnQgeyBVc2VyIH0gZnJvbSAnLi4vbW9kZWxzL3VzZXIubW9kZWwnO1xuaW1wb3J0IHsgQWN0aXZpdGlQZW9wbGVTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYWN0aXZpdGktcGVvcGxlLnNlcnZpY2UnO1xuXG5kZWNsYXJlIGxldCBkaWFsb2dQb2x5ZmlsbDogYW55O1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FjdGl2aXRpLXBlb3BsZScsXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICB0ZW1wbGF0ZTogXCI8c3BhbiBjbGFzcz1cXFwiYWN0aXZpdGktbGFiZWwgbWRsLWJhZGdlXFxcIiBpZD1cXFwicGVvcGxlLXRpdGxlXFxcIiAgICAgICBbYXR0ci5kYXRhLWJhZGdlXT1cXFwicGVvcGxlPy5sZW5ndGhcXFwiPnt7ICdUQVNLX0RFVEFJTFMuTEFCRUxTLlBFT1BMRScgfCB0cmFuc2xhdGUgfX08L3NwYW4+IDxkaXYgKm5nSWY9XFxcIiFyZWFkT25seVxcXCIgaWQ9XFxcImFkZFBlb3BsZVxcXCIgKGNsaWNrKT1cXFwic2hvd0RpYWxvZygpXFxcIiBjbGFzcz1cXFwiaWNvbiBtYXRlcmlhbC1pY29ucyBwZW9wbGVfX2ljb25cXFwiPmFkZDwvZGl2PiA8ZGl2ICpuZ0lmPVxcXCIhcmVhZE9ubHlcXFwiIGNsYXNzPVxcXCJtZGwtdG9vbHRpcFxcXCIgZGF0YS1tZGwtZm9yPVxcXCJhZGRQZW9wbGVcXFwiPiAgICAgQWRkIGEgcGVyc29uIDwvZGl2PiA8ZGl2IGNsYXNzPVxcXCJtZW51LWNvbnRhaW5lclxcXCIgKm5nSWY9XFxcInBlb3BsZT8ubGVuZ3RoID4gMFxcXCI+ICAgICA8dWwgY2xhc3M9J21kbC1saXN0Jz4gICAgICAgICA8bGkgY2xhc3M9XFxcIm1kbC1saXN0X19pdGVtXFxcIiAqbmdGb3I9XFxcImxldCB1c2VyIG9mIHBlb3BsZVxcXCI+ICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJtZGwtY2hpcCBtZGwtY2hpcC0tY29udGFjdCBtZGwtY2hpcC0tZGVsZXRhYmxlXFxcIj4gICAgICAgICAgICAgICAgIDxpbWcgY2xhc3M9XFxcIm1kbC1jaGlwX19jb250YWN0XFxcIiBbc3JjXT1cXFwiaWNvbkltYWdlVXJsIHx8IGJhc2VDb21wb25lbnRQYXRoICsgJy8uLi9hc3NldHMvaW1hZ2VzL3VzZXIuanBnJ1xcXCIgLz4gICAgICAgICAgICAgICAgIDxzcGFuIGlkPVxcXCJ1c2VyLXt7dXNlci5pZH19XFxcIiBjbGFzcz1cXFwibWRsLWNoaXBfX3RleHRcXFwiPnt7Z2V0RGlzcGxheVVzZXIodXNlcil9fTwvc3Bhbj4gICAgICAgICAgICAgICAgIDxhICpuZ0lmPVxcXCIhcmVhZE9ubHlcXFwiIGNsYXNzPVxcXCJtZGwtY2hpcF9fYWN0aW9uXFxcIj48aSBpZD1cXFwicmVtb3ZlLXt7dXNlci5pZH19XFxcIiAoY2xpY2spPVxcXCJyZW1vdmVJbnZvbHZlZFVzZXIodXNlcilcXFwiIGNsYXNzPVxcXCJtYXRlcmlhbC1pY29ucyBwZW9wbGVfX2ljb25cXFwiPmNhbmNlbDwvaT48L2E+ICAgICAgICAgICAgIDwvc3Bhbj4gICAgICAgICA8L2xpPiAgICAgPC91bD4gPC9kaXY+IDxkaXYgKm5nSWY9XFxcInBlb3BsZT8ubGVuZ3RoID09PSAwXFxcIiBpZD1cXFwibm8tcGVvcGxlLWxhYmVsXFxcIj4gICAgIHt7ICdUQVNLX0RFVEFJTFMuUEVPUExFLk5PTkUnIHwgdHJhbnNsYXRlIH19IDwvZGl2PiAgPGRpYWxvZyBjbGFzcz1cXFwibWRsLWRpYWxvZ1xcXCIgaWQ9XFxcImFkZC1wZW9wbGUtZGlhbG9nXFxcIiAjZGlhbG9nPiAgICAgPGg0IGNsYXNzPVxcXCJtZGwtZGlhbG9nX190aXRsZVxcXCIgaWQ9XFxcImFkZC1wZW9wbGUtZGlhbG9nLXRpdGxlXFxcIj5JbnZvbHZlIFVzZXI8L2g0PiAgICAgPGRpdiBjbGFzcz1cXFwibWRsLWRpYWxvZ19fY29udGVudCBhZGQtcGVvcGxlLWRpYWxvZ19fY29udGVudFxcXCI+ICAgICAgICAgPGFjdGl2aXRpLXBlb3BsZS1zZWFyY2ggKG9uU2VhcmNoKT1cXFwic2VhcmNoVXNlcigkZXZlbnQpXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvblJvd0NsaWNrZWQpPVxcXCJpbnZvbHZlVXNlcigkZXZlbnQpXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtyZXN1bHRzXT1cXFwicGVvcGxlU2VhcmNoJFxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbaWNvbkltYWdlVXJsXT1cXFwiaWNvbkltYWdlVXJsXFxcIiAjYWN0aXZpdGlwZW9wbGVzZWFyY2g+ICAgICAgICAgPC9hY3Rpdml0aS1wZW9wbGUtc2VhcmNoPiAgICAgPC9kaXY+ICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtZGlhbG9nX19hY3Rpb25zXFxcIj4gICAgICAgICA8YnV0dG9uIHR5cGU9XFxcImJ1dHRvblxcXCIgaWQ9XFxcImNsb3NlLXBlb3BsZS1kaWFsb2dcXFwiIChjbGljayk9XFxcImNsb3NlRGlhbG9nKClcXFwiIGNsYXNzPVxcXCJtZGwtYnV0dG9uIGNsb3NlXFxcIj4gICAgICAgICAgICAge3snUEVPUExFLkRJQUxPR19DTE9TRScgfCB0cmFuc2xhdGUgfX0gICAgICAgICA8L2J1dHRvbj4gICAgIDwvZGl2PiA8L2RpYWxvZz5cIixcbiAgICBzdHlsZXM6IFtcIjpob3N0IHsgICAgIHdpZHRoOiAxMDAlOyB9ICAuYWN0aXZpdGktbGFiZWwgeyAgICAgZm9udC13ZWlnaHQ6IGJvbGRlcjsgfSAgLm1hdGVyaWFsLWljb25zLnBlb3BsZV9faWNvbjpob3ZlciB7ICAgICBjb2xvcjogcmdiKDI1NSwgMTUyLCAwKTsgfSAgLmFkZC1wZW9wbGUtZGlhbG9nX19jb250ZW50IHsgICAgIHBhZGRpbmc6IDIwcHggMjRweCAycHg7IH0gIC5tZGwtdG9vbHRpcCB7ICAgICB3aWxsLWNoYW5nZTogdW5zZXQ7IH0gIC5tYXRlcmlhbC1pY29ucyB7ICAgICBjdXJzb3I6IHBvaW50ZXI7IH1cIl1cbn0pXG5leHBvcnQgY2xhc3MgQWN0aXZpdGlQZW9wbGUge1xuXG4gICAgYmFzZUNvbXBvbmVudFBhdGggPSBtb2R1bGUuaWQucmVwbGFjZSgnL2FjdGl2aXRpLXBlb3BsZS5jb21wb25lbnQuanMnLCAnJyk7XG5cbiAgICBASW5wdXQoKVxuICAgIGljb25JbWFnZVVybDogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICBwZW9wbGU6IFVzZXIgW10gPSBbXTtcblxuICAgIEBJbnB1dCgpXG4gICAgdGFza0lkOiBzdHJpbmcgPSAnJztcblxuICAgIEBJbnB1dCgpXG4gICAgcmVhZE9ubHk6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBWaWV3Q2hpbGQoJ2RpYWxvZycpXG4gICAgZGlhbG9nOiBhbnk7XG5cbiAgICBAVmlld0NoaWxkKCdhY3Rpdml0aXBlb3BsZXNlYXJjaCcpXG4gICAgYWN0aXZpdGlwZW9wbGVzZWFyY2g6IGFueTtcblxuICAgIHByaXZhdGUgcGVvcGxlU2VhcmNoT2JzZXJ2ZXI6IE9ic2VydmVyPFVzZXJbXT47XG4gICAgcGVvcGxlU2VhcmNoJDogT2JzZXJ2YWJsZTxVc2VyW10+O1xuXG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0gdHJhbnNsYXRlXG4gICAgICogQHBhcmFtIHBlb3BsZSBzZXJ2aWNlXG4gICAgICovXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSB0cmFuc2xhdGVTZXJ2aWNlOiBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHBlb3BsZVNlcnZpY2U6IEFjdGl2aXRpUGVvcGxlU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UpIHtcbiAgICAgICAgaWYgKHRyYW5zbGF0ZVNlcnZpY2UpIHtcbiAgICAgICAgICAgIHRyYW5zbGF0ZVNlcnZpY2UuYWRkVHJhbnNsYXRpb25Gb2xkZXIoJ25nMi1hY3Rpdml0aS10YXNrbGlzdCcsICdub2RlX21vZHVsZXMvbmcyLWFjdGl2aXRpLXRhc2tsaXN0L3NyYycpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGVvcGxlU2VhcmNoJCA9IG5ldyBPYnNlcnZhYmxlPFVzZXJbXT4ob2JzZXJ2ZXIgPT4gdGhpcy5wZW9wbGVTZWFyY2hPYnNlcnZlciA9IG9ic2VydmVyKS5zaGFyZSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzaG93RGlhbG9nKCkge1xuICAgICAgICBpZiAoIXRoaXMuZGlhbG9nLm5hdGl2ZUVsZW1lbnQuc2hvd01vZGFsKSB7XG4gICAgICAgICAgICBkaWFsb2dQb2x5ZmlsbC5yZWdpc3RlckRpYWxvZyh0aGlzLmRpYWxvZy5uYXRpdmVFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5kaWFsb2cpIHtcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nLm5hdGl2ZUVsZW1lbnQuc2hvd01vZGFsKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgY2xvc2VEaWFsb2coKSB7XG4gICAgICAgIGlmICh0aGlzLmRpYWxvZykge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2cubmF0aXZlRWxlbWVudC5jbG9zZSgpO1xuICAgICAgICAgICAgdGhpcy5wZW9wbGVTZWFyY2hPYnNlcnZlci5uZXh0KFtdKTtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlwZW9wbGVzZWFyY2guc2VhcmNoVXNlci5yZXNldCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2VhcmNoVXNlcihzZWFyY2hlZFdvcmQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLnBlb3BsZVNlcnZpY2UuZ2V0V29ya2Zsb3dVc2Vycyh0aGlzLnRhc2tJZCwgc2VhcmNoZWRXb3JkKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgodXNlcnMpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBlb3BsZVNlYXJjaE9ic2VydmVyLm5leHQodXNlcnMpO1xuICAgICAgICAgICAgfSwgZXJyb3IgPT4gdGhpcy5sb2dTZXJ2aWNlLmVycm9yKCdDb3VsZCBub3QgbG9hZCB1c2VycycpKTtcbiAgICB9XG5cbiAgICBpbnZvbHZlVXNlcih1c2VyOiBVc2VyKSB7XG4gICAgICAgIHRoaXMucGVvcGxlU2VydmljZS5pbnZvbHZlVXNlcldpdGhUYXNrKHRoaXMudGFza0lkLCB1c2VyLmlkLnRvU3RyaW5nKCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBlb3BsZS5wdXNoKHVzZXIpO1xuICAgICAgICAgICAgfSwgZXJyb3IgPT4gdGhpcy5sb2dTZXJ2aWNlLmVycm9yKCdJbXBvc3NpYmxlIHRvIGludm9sdmUgdXNlciB3aXRoIHRhc2snKSk7XG4gICAgfVxuXG4gICAgcmVtb3ZlSW52b2x2ZWRVc2VyKHVzZXI6IFVzZXIpIHtcbiAgICAgICAgdGhpcy5wZW9wbGVTZXJ2aWNlLnJlbW92ZUludm9sdmVkVXNlcih0aGlzLnRhc2tJZCwgdXNlci5pZC50b1N0cmluZygpKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wZW9wbGUgPSB0aGlzLnBlb3BsZS5maWx0ZXIoKGludm9sdmVkVXNlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW52b2x2ZWRVc2VyLmlkICE9PSB1c2VyLmlkO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgZXJyb3IgPT4gdGhpcy5sb2dTZXJ2aWNlLmVycm9yKCdJbXBvc3NpYmxlIHRvIHJlbW92ZSBpbnZvbHZlZCB1c2VyIGZyb20gdGFzaycpKTtcbiAgICB9XG5cbiAgICBnZXREaXNwbGF5VXNlcih1c2VyOiBVc2VyKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGZpcnN0TmFtZSA9IHVzZXIuZmlyc3ROYW1lICYmIHVzZXIuZmlyc3ROYW1lICE9PSAnbnVsbCcgPyB1c2VyLmZpcnN0TmFtZSA6ICdOL0EnO1xuICAgICAgICBsZXQgbGFzdE5hbWUgPSAgdXNlci5sYXN0TmFtZSAmJiB1c2VyLmxhc3ROYW1lICE9PSAnbnVsbCcgPyB1c2VyLmxhc3ROYW1lIDogJ04vQSc7XG4gICAgICAgIHJldHVybiBmaXJzdE5hbWUgKyAnICcgKyBsYXN0TmFtZTtcbiAgICB9XG5cbn1cbiJdfQ==
