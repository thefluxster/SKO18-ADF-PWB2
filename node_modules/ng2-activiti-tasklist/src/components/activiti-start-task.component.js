/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var task_details_model_1 = require("../models/task-details.model");
var activiti_tasklist_service_1 = require("./../services/activiti-tasklist.service");
var ActivitiStartTaskButton = (function () {
    function ActivitiStartTaskButton(translateService, taskService, logService) {
        this.translateService = translateService;
        this.taskService = taskService;
        this.logService = logService;
        this.onSuccess = new core_1.EventEmitter();
        this.formId = null;
        if (translateService) {
            translateService.addTranslationFolder('ng2-activiti-tasklist', 'node_modules/ng2-activiti-tasklist/src');
        }
    }
    ActivitiStartTaskButton.prototype.start = function () {
        var _this = this;
        if (this.name) {
            this.taskService.createNewTask(new task_details_model_1.TaskDetailsModel({
                name: this.name,
                description: this.description,
                category: this.appId ? '' + this.appId : null
            })).subscribe(function (res) {
                _this.onSuccess.emit(res);
                _this.closeDialog();
                _this.resetForm();
                _this.attachForm(res.id);
            }, function (err) {
                window.alert('An error occurred while trying to add the task');
                _this.logService.error(err);
            });
        }
    };
    ActivitiStartTaskButton.prototype.attachForm = function (taskId) {
        if (this.formId && taskId) {
            this.taskService.attachFormToATask(taskId, Number(this.formId));
            this.formId = null;
        }
    };
    ActivitiStartTaskButton.prototype.cancel = function () {
        this.closeDialog();
    };
    ActivitiStartTaskButton.prototype.showDialog = function () {
        if (!this.dialog.nativeElement.showModal) {
            dialogPolyfill.registerDialog(this.dialog.nativeElement);
        }
        this.loadFormsTask();
        if (this.dialog) {
            this.dialog.nativeElement.showModal();
        }
    };
    ActivitiStartTaskButton.prototype.loadFormsTask = function () {
        var _this = this;
        this.taskService.getFormList().subscribe(function (res) {
            _this.forms = res;
        }, function (err) {
            window.alert('An error occurred while trying to get the forms');
            _this.logService.error(err);
        });
    };
    ActivitiStartTaskButton.prototype.closeDialog = function () {
        if (this.dialog) {
            this.dialog.nativeElement.close();
        }
    };
    ActivitiStartTaskButton.prototype.resetForm = function () {
        this.name = '';
        this.description = '';
    };
    return ActivitiStartTaskButton;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiStartTaskButton.prototype, "appId", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiStartTaskButton.prototype, "onSuccess", void 0);
__decorate([
    core_1.ViewChild('dialog'),
    __metadata("design:type", Object)
], ActivitiStartTaskButton.prototype, "dialog", void 0);
ActivitiStartTaskButton = __decorate([
    core_1.Component({
        selector: 'activiti-start-task',
        moduleId: module.id,
        template: "<button type=\"button\" (click)=\"showDialog()\" class=\"mdl-button\" id=\"start-task-button\">     {{'START_TASK.BUTTON'|translate}} </button>  <dialog class=\"mdl-dialog\" id=\"start-task-dialog\" #dialog>     <h4 class=\"mdl-dialog__title\" id=\"start-task-dialog-title\">{{'START_TASK.DIALOG.TITLE'|translate}}</h4>     <div class=\"mdl-dialog__content\">         <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">             <input class=\"mdl-textfield__input\" type=\"text\" [(ngModel)]=\"name\" id=\"taskName\"/>             <label class=\"mdl-textfield__label\" for=\"taskName\">{{'START_TASK.DIALOG.LABEL.NAME'|translate}}</label>         </div>         <div class=\"mdl-textfield mdl-js-textfield\">             <textarea class=\"mdl-textfield__input\" type=\"text\" [(ngModel)]=\"description\" rows=\"3\"                       id=\"taskDescription\"></textarea>             <label class=\"mdl-textfield__label\" id=\"task-description-label\"                    for=\"taskDescription\">{{'START_TASK.DIALOG.LABEL.DESCRIPTION'|translate}}</label>         </div>         <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">             <label class=\"mdl-textfield__label\" >{{'START_TASK.DIALOG.LABEL.ATTACHFORM'|translate}}</label>         </div>         <div class=\"mdl-textfield mdl-js-textfield alf-mdl-selectfield\">             <select name=\"taskForm\" [(ngModel)]=\"formId\" >                 <option value=\"null\">{{'START_TASK.DIALOG.LABEL.NONE'|translate}}</option>                 <option *ngFor=\"let form of forms\" [value]=\"form.id\">                     {{form.name}}                 </option>             </select>         </div>     </div>     <div class=\"mdl-dialog__actions\">         <button type=\"button\" id=\"button-start\" (click)=\"start()\" class=\"mdl-button\">             {{'START_TASK.DIALOG.ACTION.START'|translate}}         </button>         <button type=\"button\" id=\"button-cancel\" (click)=\"cancel()\" class=\"mdl-button close\">             {{'START_TASK.DIALOG.ACTION.CANCEL'|translate}}         </button>     </div> </dialog>",
        styles: [":host {     width: 100%; }  .activiti-label {     font-weight: bolder; }"]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        activiti_tasklist_service_1.ActivitiTaskListService,
        ng2_alfresco_core_1.LogService])
], ActivitiStartTaskButton);
exports.ActivitiStartTaskButton = ActivitiStartTaskButton;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktc3RhcnQtdGFzay5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQUFrRjtBQUNsRix1REFBMkU7QUFDM0UsbUVBQWdFO0FBQ2hFLHFGQUFrRjtBQVlsRixJQUFhLHVCQUF1QjtJQXdCaEMsaUNBQW9CLGdCQUE0QyxFQUM1QyxXQUFvQyxFQUNwQyxVQUFzQjtRQUZ0QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQTRCO1FBQzVDLGdCQUFXLEdBQVgsV0FBVyxDQUF5QjtRQUNwQyxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBcEIxQyxjQUFTLEdBQXNCLElBQUksbUJBQVksRUFBTyxDQUFDO1FBT3ZELFdBQU0sR0FBVyxJQUFJLENBQUM7UUFlbEIsRUFBRSxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1lBQ25CLGdCQUFnQixDQUFDLG9CQUFvQixDQUFDLHVCQUF1QixFQUFFLHdDQUF3QyxDQUFDLENBQUM7UUFDN0csQ0FBQztJQUNMLENBQUM7SUFFTSx1Q0FBSyxHQUFaO1FBQUEsaUJBbUJDO1FBbEJHLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ1osSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsSUFBSSxxQ0FBZ0IsQ0FBQztnQkFDaEQsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO2dCQUNmLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVztnQkFDN0IsUUFBUSxFQUFFLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSTthQUNoRCxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQ1QsVUFBQyxHQUFRO2dCQUNMLEtBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUN6QixLQUFJLENBQUMsV0FBVyxFQUFF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ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFsZnJlc2NvVHJhbnNsYXRpb25TZXJ2aWNlLCBMb2dTZXJ2aWNlIH0gZnJvbSAnbmcyLWFsZnJlc2NvLWNvcmUnO1xuaW1wb3J0IHsgVGFza0RldGFpbHNNb2RlbCB9IGZyb20gJy4uL21vZGVscy90YXNrLWRldGFpbHMubW9kZWwnO1xuaW1wb3J0IHsgQWN0aXZpdGlUYXNrTGlzdFNlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL2FjdGl2aXRpLXRhc2tsaXN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgRm9ybSB9IGZyb20gJy4uL21vZGVscy9mb3JtLm1vZGVsJztcblxuZGVjbGFyZSBsZXQgY29tcG9uZW50SGFuZGxlcjogYW55O1xuZGVjbGFyZSBsZXQgZGlhbG9nUG9seWZpbGw6IGFueTtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhY3Rpdml0aS1zdGFydC10YXNrJyxcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHRlbXBsYXRlOiBcIjxidXR0b24gdHlwZT1cXFwiYnV0dG9uXFxcIiAoY2xpY2spPVxcXCJzaG93RGlhbG9nKClcXFwiIGNsYXNzPVxcXCJtZGwtYnV0dG9uXFxcIiBpZD1cXFwic3RhcnQtdGFzay1idXR0b25cXFwiPiAgICAge3snU1RBUlRfVEFTSy5CVVRUT04nfHRyYW5zbGF0ZX19IDwvYnV0dG9uPiAgPGRpYWxvZyBjbGFzcz1cXFwibWRsLWRpYWxvZ1xcXCIgaWQ9XFxcInN0YXJ0LXRhc2stZGlhbG9nXFxcIiAjZGlhbG9nPiAgICAgPGg0IGNsYXNzPVxcXCJtZGwtZGlhbG9nX190aXRsZVxcXCIgaWQ9XFxcInN0YXJ0LXRhc2stZGlhbG9nLXRpdGxlXFxcIj57eydTVEFSVF9UQVNLLkRJQUxPRy5USVRMRSd8dHJhbnNsYXRlfX08L2g0PiAgICAgPGRpdiBjbGFzcz1cXFwibWRsLWRpYWxvZ19fY29udGVudFxcXCI+ICAgICAgICAgPGRpdiBjbGFzcz1cXFwibWRsLXRleHRmaWVsZCBtZGwtanMtdGV4dGZpZWxkIG1kbC10ZXh0ZmllbGQtLWZsb2F0aW5nLWxhYmVsXFxcIj4gICAgICAgICAgICAgPGlucHV0IGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkX19pbnB1dFxcXCIgdHlwZT1cXFwidGV4dFxcXCIgWyhuZ01vZGVsKV09XFxcIm5hbWVcXFwiIGlkPVxcXCJ0YXNrTmFtZVxcXCIvPiAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGRfX2xhYmVsXFxcIiBmb3I9XFxcInRhc2tOYW1lXFxcIj57eydTVEFSVF9UQVNLLkRJQUxPRy5MQUJFTC5OQU1FJ3x0cmFuc2xhdGV9fTwvbGFiZWw+ICAgICAgICAgPC9kaXY+ICAgICAgICAgPGRpdiBjbGFzcz1cXFwibWRsLXRleHRmaWVsZCBtZGwtanMtdGV4dGZpZWxkXFxcIj4gICAgICAgICAgICAgPHRleHRhcmVhIGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkX19pbnB1dFxcXCIgdHlwZT1cXFwidGV4dFxcXCIgWyhuZ01vZGVsKV09XFxcImRlc2NyaXB0aW9uXFxcIiByb3dzPVxcXCIzXFxcIiAgICAgICAgICAgICAgICAgICAgICAgaWQ9XFxcInRhc2tEZXNjcmlwdGlvblxcXCI+PC90ZXh0YXJlYT4gICAgICAgICAgICAgPGxhYmVsIGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkX19sYWJlbFxcXCIgaWQ9XFxcInRhc2stZGVzY3JpcHRpb24tbGFiZWxcXFwiICAgICAgICAgICAgICAgICAgICBmb3I9XFxcInRhc2tEZXNjcmlwdGlvblxcXCI+e3snU1RBUlRfVEFTSy5ESUFMT0cuTEFCRUwuREVTQ1JJUFRJT04nfHRyYW5zbGF0ZX19PC9sYWJlbD4gICAgICAgICA8L2Rpdj4gICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtdGV4dGZpZWxkIG1kbC1qcy10ZXh0ZmllbGQgbWRsLXRleHRmaWVsZC0tZmxvYXRpbmctbGFiZWxcXFwiPiAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGRfX2xhYmVsXFxcIiA+e3snU1RBUlRfVEFTSy5ESUFMT0cuTEFCRUwuQVRUQUNIRk9STSd8dHJhbnNsYXRlfX08L2xhYmVsPiAgICAgICAgIDwvZGl2PiAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGQgbWRsLWpzLXRleHRmaWVsZCBhbGYtbWRsLXNlbGVjdGZpZWxkXFxcIj4gICAgICAgICAgICAgPHNlbGVjdCBuYW1lPVxcXCJ0YXNrRm9ybVxcXCIgWyhuZ01vZGVsKV09XFxcImZvcm1JZFxcXCIgPiAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cXFwibnVsbFxcXCI+e3snU1RBUlRfVEFTSy5ESUFMT0cuTEFCRUwuTk9ORSd8dHJhbnNsYXRlfX08L29wdGlvbj4gICAgICAgICAgICAgICAgIDxvcHRpb24gKm5nRm9yPVxcXCJsZXQgZm9ybSBvZiBmb3Jtc1xcXCIgW3ZhbHVlXT1cXFwiZm9ybS5pZFxcXCI+ICAgICAgICAgICAgICAgICAgICAge3tmb3JtLm5hbWV9fSAgICAgICAgICAgICAgICAgPC9vcHRpb24+ICAgICAgICAgICAgIDwvc2VsZWN0PiAgICAgICAgIDwvZGl2PiAgICAgPC9kaXY+ICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtZGlhbG9nX19hY3Rpb25zXFxcIj4gICAgICAgICA8YnV0dG9uIHR5cGU9XFxcImJ1dHRvblxcXCIgaWQ9XFxcImJ1dHRvbi1zdGFydFxcXCIgKGNsaWNrKT1cXFwic3RhcnQoKVxcXCIgY2xhc3M9XFxcIm1kbC1idXR0b25cXFwiPiAgICAgICAgICAgICB7eydTVEFSVF9UQVNLLkRJQUxPRy5BQ1RJT04uU1RBUlQnfHRyYW5zbGF0ZX19ICAgICAgICAgPC9idXR0b24+ICAgICAgICAgPGJ1dHRvbiB0eXBlPVxcXCJidXR0b25cXFwiIGlkPVxcXCJidXR0b24tY2FuY2VsXFxcIiAoY2xpY2spPVxcXCJjYW5jZWwoKVxcXCIgY2xhc3M9XFxcIm1kbC1idXR0b24gY2xvc2VcXFwiPiAgICAgICAgICAgICB7eydTVEFSVF9UQVNLLkRJQUxPRy5BQ1RJT04uQ0FOQ0VMJ3x0cmFuc2xhdGV9fSAgICAgICAgIDwvYnV0dG9uPiAgICAgPC9kaXY+IDwvZGlhbG9nPlwiLFxuICAgIHN0eWxlczogW1wiOmhvc3QgeyAgICAgd2lkdGg6IDEwMCU7IH0gIC5hY3Rpdml0aS1sYWJlbCB7ICAgICBmb250LXdlaWdodDogYm9sZGVyOyB9XCJdXG59KVxuZXhwb3J0IGNsYXNzIEFjdGl2aXRpU3RhcnRUYXNrQnV0dG9uIHtcblxuICAgIEBJbnB1dCgpXG4gICAgYXBwSWQ6IHN0cmluZztcblxuICAgIEBPdXRwdXQoKVxuICAgIG9uU3VjY2VzczogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIEBWaWV3Q2hpbGQoJ2RpYWxvZycpXG4gICAgZGlhbG9nOiBhbnk7XG5cbiAgICBmb3JtczogRm9ybSBbXTtcblxuICAgIGZvcm1JZDogc3RyaW5nID0gbnVsbDtcblxuICAgIG5hbWU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0gYXV0aFxuICAgICAqIEBwYXJhbSB0cmFuc2xhdGVcbiAgICAgKiBAcGFyYW0gdGFza1NlcnZpY2VcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHRyYW5zbGF0ZVNlcnZpY2U6IEFsZnJlc2NvVHJhbnNsYXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgdGFza1NlcnZpY2U6IEFjdGl2aXRpVGFza0xpc3RTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgbG9nU2VydmljZTogTG9nU2VydmljZSkge1xuXG4gICAgICAgIGlmICh0cmFuc2xhdGVTZXJ2aWNlKSB7XG4gICAgICAgICAgICB0cmFuc2xhdGVTZXJ2aWNlLmFkZFRyYW5zbGF0aW9uRm9sZGVyKCduZzItYWN0aXZpdGktdGFza2xpc3QnLCAnbm9kZV9tb2R1bGVzL25nMi1hY3Rpdml0aS10YXNrbGlzdC9zcmMnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGFydCgpIHtcbiAgICAgICAgaWYgKHRoaXMubmFtZSkge1xuICAgICAgICAgICAgdGhpcy50YXNrU2VydmljZS5jcmVhdGVOZXdUYXNrKG5ldyBUYXNrRGV0YWlsc01vZGVsKHtcbiAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnk6IHRoaXMuYXBwSWQgPyAnJyArIHRoaXMuYXBwSWQgOiBudWxsXG4gICAgICAgICAgICB9KSkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uU3VjY2Vzcy5lbWl0KHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VEaWFsb2coKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldEZvcm0oKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdHRhY2hGb3JtKHJlcy5pZCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hbGVydCgnQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIGFkZCB0aGUgdGFzaycpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhdHRhY2hGb3JtKHRhc2tJZDogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0aGlzLmZvcm1JZCAmJiB0YXNrSWQpIHtcbiAgICAgICAgICAgIHRoaXMudGFza1NlcnZpY2UuYXR0YWNoRm9ybVRvQVRhc2sodGFza0lkLCBOdW1iZXIodGhpcy5mb3JtSWQpKTtcbiAgICAgICAgICAgIHRoaXMuZm9ybUlkID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBjYW5jZWwoKSB7XG4gICAgICAgIHRoaXMuY2xvc2VEaWFsb2coKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2hvd0RpYWxvZygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmRpYWxvZy5uYXRpdmVFbGVtZW50LnNob3dNb2RhbCkge1xuICAgICAgICAgICAgZGlhbG9nUG9seWZpbGwucmVnaXN0ZXJEaWFsb2codGhpcy5kaWFsb2cubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmxvYWRGb3Jtc1Rhc2soKTtcblxuICAgICAgICBpZiAodGhpcy5kaWFsb2cpIHtcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nLm5hdGl2ZUVsZW1lbnQuc2hvd01vZGFsKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGxvYWRGb3Jtc1Rhc2soKSB7XG4gICAgICAgIHRoaXMudGFza1NlcnZpY2UuZ2V0Rm9ybUxpc3QoKS5zdWJzY3JpYmUoKHJlczogRm9ybVtdKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5mb3JtcyA9IHJlcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KCdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSB0cnlpbmcgdG8gZ2V0IHRoZSBmb3JtcycpO1xuICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjbG9zZURpYWxvZygpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlhbG9nKSB7XG4gICAgICAgICAgICB0aGlzLmRpYWxvZy5uYXRpdmVFbGVtZW50LmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHJlc2V0Rm9ybSgpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gJyc7XG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSAnJztcbiAgICB9XG59XG4iXX0=
