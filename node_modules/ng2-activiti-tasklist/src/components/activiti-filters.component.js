/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var Rx_1 = require("rxjs/Rx");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var activiti_tasklist_service_1 = require("./../services/activiti-tasklist.service");
var ActivitiFilters = (function () {
    function ActivitiFilters(translateService, activiti, logService) {
        var _this = this;
        this.translateService = translateService;
        this.activiti = activiti;
        this.logService = logService;
        this.filterClick = new core_1.EventEmitter();
        this.onSuccess = new core_1.EventEmitter();
        this.onError = new core_1.EventEmitter();
        this.filters = [];
        this.filter$ = new Rx_1.Observable(function (observer) { return _this.filterObserver = observer; }).share();
        if (translateService) {
            translateService.addTranslationFolder('ng2-activiti-tasklist', 'node_modules/ng2-activiti-tasklist/src');
        }
    }
    ActivitiFilters.prototype.ngOnInit = function () {
        var _this = this;
        this.filter$.subscribe(function (filter) {
            _this.filters.push(filter);
        });
    };
    ActivitiFilters.prototype.ngOnChanges = function (changes) {
        var appId = changes['appId'];
        if (appId && (appId.currentValue || appId.currentValue === null)) {
            this.getFiltersByAppId(appId.currentValue);
            return;
        }
        var appName = changes['appName'];
        if (appName && appName !== null && appName.currentValue) {
            this.getFiltersByAppName(appName.currentValue);
            return;
        }
        this.getFiltersByAppId();
    };
    ActivitiFilters.prototype.getFilters = function (appId, appName) {
        if (appName) {
            this.getFiltersByAppName(appName);
        }
        else {
            this.getFiltersByAppId(appId);
        }
    };
    ActivitiFilters.prototype.getFiltersByAppId = function (appId) {
        var _this = this;
        this.activiti.getTaskListFilters(appId).subscribe(function (res) {
            _this.resetFilter();
            res.forEach(function (filter) {
                _this.filterObserver.next(filter);
            });
            _this.selectFirstFilter();
            _this.onSuccess.emit(res);
        }, function (err) {
            _this.logService.error(err);
            _this.onError.emit(err);
        });
    };
    ActivitiFilters.prototype.getFiltersByAppName = function (appName) {
        var _this = this;
        this.activiti.getDeployedApplications(appName).subscribe(function (application) {
            _this.getFiltersByAppId(application.id);
            _this.selectFirstFilter();
        }, function (err) {
            _this.logService.error(err);
            _this.onError.emit(err);
        });
    };
    ActivitiFilters.prototype.selectFilter = function (filter) {
        this.currentFilter = filter;
        this.filterClick.emit(filter);
    };
    ActivitiFilters.prototype.selectFirstFilter = function () {
        if (!this.isFilterListEmpty()) {
            this.currentFilter = this.filters[0];
        }
        else {
            this.currentFilter = null;
        }
    };
    ActivitiFilters.prototype.getCurrentFilter = function () {
        return this.currentFilter;
    };
    ActivitiFilters.prototype.isFilterListEmpty = function () {
        return this.filters === undefined || (this.filters && this.filters.length === 0);
    };
    ActivitiFilters.prototype.resetFilter = function () {
        this.filters = [];
        this.currentFilter = null;
    };
    return ActivitiFilters;
}());
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiFilters.prototype, "filterClick", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiFilters.prototype, "onSuccess", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiFilters.prototype, "onError", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiFilters.prototype, "appId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiFilters.prototype, "appName", void 0);
ActivitiFilters = __decorate([
    core_1.Component({
        selector: 'activiti-filters',
        moduleId: module.id,
        template: "<div class=\"menu-container\">     <ul class='mdl-list'>         <li class=\"mdl-list__item activiti-filters__entry\" (click)=\"selectFilter(filter)\" *ngFor=\"let filter of filters\"             [class.active]=\"currentFilter === filter\">             <span class=\"mdl-list__item-primary-content\">             <i class=\"material-icons mdl-list__item-icon activiti-filters__entry-icon\" [attr.data-automation-id]=\"filter.name + '_filter'\" >assignment</i>             {{filter.name}}             </span>         </li>     </ul> </div>",
        styles: [".mdl-list__item {     cursor: pointer; }  .activiti-filters__entry {     cursor: pointer; }  .activiti-filters__entry-icon {     margin-right: 12px !important; }  .activiti-filters__entry.active {     color: rgb(68,138,255); }  .activiti-filters__entry.active .activiti-filters__entry-icon {     color: rgb(68,138,255); }"],
        providers: [activiti_tasklist_service_1.ActivitiTaskListService]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        activiti_tasklist_service_1.ActivitiTaskListService,
        ng2_alfresco_core_1.LogService])
], ActivitiFilters);
exports.ActivitiFilters = ActivitiFilters;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktZmlsdGVycy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQUF5RztBQUN6Ryw4QkFBK0M7QUFDL0MsdURBQTJFO0FBQzNFLHFGQUFrRjtBQVlsRixJQUFhLGVBQWU7SUF3QnhCLHlCQUFvQixnQkFBNEMsRUFDNUMsUUFBaUMsRUFDakMsVUFBc0I7UUFGMUMsaUJBUUM7UUFSbUIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUE0QjtRQUM1QyxhQUFRLEdBQVIsUUFBUSxDQUF5QjtRQUNqQyxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBdkIxQyxnQkFBVyxHQUE0QyxJQUFJLG1CQUFZLEVBQTZCLENBQUM7UUFHckcsY0FBUyxHQUFzQixJQUFJLG1CQUFZLEVBQU8sQ0FBQztRQUd2RCxZQUFPLEdBQXNCLElBQUksbUJBQVksRUFBTyxDQUFDO1FBYXJELFlBQU8sR0FBaUMsRUFBRSxDQUFDO1FBS3ZDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxlQUFVLENBQTRCLFVBQUEsUUFBUSxJQUFJLE9BQUEsS0FBSSxDQUFDLGNBQWMsR0FBRyxRQUFRLEVBQTlCLENBQThCLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUU3RyxFQUFFLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7WUFDbkIsZ0JBQWdCLENBQUMsb0JBQW9CLENBQUMsdUJBQXVCLEVBQUUsd0NBQXdDLENBQUMsQ0FBQztRQUM3RyxDQUFDO0lBQ0wsQ0FBQztJQUVELGtDQUFRLEdBQVI7UUFBQSxpQkFJQztRQUhHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFVBQUMsTUFBaUM7WUFDckQsS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQscUNBQVcsR0FBWCxVQUFZ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ZmlsdGVycy5jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNiBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBPbkluaXQsIElucHV0LCBTaW1wbGVDaGFuZ2VzLCBPbkNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmVyLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcy9SeCc7XG5pbXBvcnQgeyBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSwgTG9nU2VydmljZSB9IGZyb20gJ25nMi1hbGZyZXNjby1jb3JlJztcbmltcG9ydCB7IEFjdGl2aXRpVGFza0xpc3RTZXJ2aWNlIH0gZnJvbSAnLi8uLi9zZXJ2aWNlcy9hY3Rpdml0aS10YXNrbGlzdC5zZXJ2aWNlJztcbmltcG9ydCB7IEZpbHRlclJlcHJlc2VudGF0aW9uTW9kZWwgfSBmcm9tICcuLi9tb2RlbHMvZmlsdGVyLm1vZGVsJztcblxuZGVjbGFyZSBsZXQgY29tcG9uZW50SGFuZGxlcjogYW55O1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FjdGl2aXRpLWZpbHRlcnMnLFxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgdGVtcGxhdGU6IFwiPGRpdiBjbGFzcz1cXFwibWVudS1jb250YWluZXJcXFwiPiAgICAgPHVsIGNsYXNzPSdtZGwtbGlzdCc+ICAgICAgICAgPGxpIGNsYXNzPVxcXCJtZGwtbGlzdF9faXRlbSBhY3Rpdml0aS1maWx0ZXJzX19lbnRyeVxcXCIgKGNsaWNrKT1cXFwic2VsZWN0RmlsdGVyKGZpbHRlcilcXFwiICpuZ0Zvcj1cXFwibGV0IGZpbHRlciBvZiBmaWx0ZXJzXFxcIiAgICAgICAgICAgICBbY2xhc3MuYWN0aXZlXT1cXFwiY3VycmVudEZpbHRlciA9PT0gZmlsdGVyXFxcIj4gICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcIm1kbC1saXN0X19pdGVtLXByaW1hcnktY29udGVudFxcXCI+ICAgICAgICAgICAgIDxpIGNsYXNzPVxcXCJtYXRlcmlhbC1pY29ucyBtZGwtbGlzdF9faXRlbS1pY29uIGFjdGl2aXRpLWZpbHRlcnNfX2VudHJ5LWljb25cXFwiIFthdHRyLmRhdGEtYXV0b21hdGlvbi1pZF09XFxcImZpbHRlci5uYW1lICsgJ19maWx0ZXInXFxcIiA+YXNzaWdubWVudDwvaT4gICAgICAgICAgICAge3tmaWx0ZXIubmFtZX19ICAgICAgICAgICAgIDwvc3Bhbj4gICAgICAgICA8L2xpPiAgICAgPC91bD4gPC9kaXY+XCIsXG4gICAgc3R5bGVzOiBbXCIubWRsLWxpc3RfX2l0ZW0geyAgICAgY3Vyc29yOiBwb2ludGVyOyB9ICAuYWN0aXZpdGktZmlsdGVyc19fZW50cnkgeyAgICAgY3Vyc29yOiBwb2ludGVyOyB9ICAuYWN0aXZpdGktZmlsdGVyc19fZW50cnktaWNvbiB7ICAgICBtYXJnaW4tcmlnaHQ6IDEycHggIWltcG9ydGFudDsgfSAgLmFjdGl2aXRpLWZpbHRlcnNfX2VudHJ5LmFjdGl2ZSB7ICAgICBjb2xvcjogcmdiKDY4LDEzOCwyNTUpOyB9ICAuYWN0aXZpdGktZmlsdGVyc19fZW50cnkuYWN0aXZlIC5hY3Rpdml0aS1maWx0ZXJzX19lbnRyeS1pY29uIHsgICAgIGNvbG9yOiByZ2IoNjgsMTM4LDI1NSk7IH1cIl0sXG4gICAgcHJvdmlkZXJzOiBbQWN0aXZpdGlUYXNrTGlzdFNlcnZpY2VdXG59KVxuZXhwb3J0IGNsYXNzIEFjdGl2aXRpRmlsdGVycyBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcblxuICAgIEBPdXRwdXQoKVxuICAgIGZpbHRlckNsaWNrOiBFdmVudEVtaXR0ZXI8RmlsdGVyUmVwcmVzZW50YXRpb25Nb2RlbD4gPSBuZXcgRXZlbnRFbWl0dGVyPEZpbHRlclJlcHJlc2VudGF0aW9uTW9kZWw+KCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBvblN1Y2Nlc3M6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBvbkVycm9yOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgQElucHV0KClcbiAgICBhcHBJZDogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICBhcHBOYW1lOiBzdHJpbmc7XG5cbiAgICBwcml2YXRlIGZpbHRlck9ic2VydmVyOiBPYnNlcnZlcjxGaWx0ZXJSZXByZXNlbnRhdGlvbk1vZGVsPjtcbiAgICBmaWx0ZXIkOiBPYnNlcnZhYmxlPEZpbHRlclJlcHJlc2VudGF0aW9uTW9kZWw+O1xuXG4gICAgY3VycmVudEZpbHRlcjogRmlsdGVyUmVwcmVzZW50YXRpb25Nb2RlbDtcblxuICAgIGZpbHRlcnM6IEZpbHRlclJlcHJlc2VudGF0aW9uTW9kZWwgW10gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhY3Rpdml0aTogQWN0aXZpdGlUYXNrTGlzdFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuZmlsdGVyJCA9IG5ldyBPYnNlcnZhYmxlPEZpbHRlclJlcHJlc2VudGF0aW9uTW9kZWw+KG9ic2VydmVyID0+IHRoaXMuZmlsdGVyT2JzZXJ2ZXIgPSBvYnNlcnZlcikuc2hhcmUoKTtcblxuICAgICAgICBpZiAodHJhbnNsYXRlU2VydmljZSkge1xuICAgICAgICAgICAgdHJhbnNsYXRlU2VydmljZS5hZGRUcmFuc2xhdGlvbkZvbGRlcignbmcyLWFjdGl2aXRpLXRhc2tsaXN0JywgJ25vZGVfbW9kdWxlcy9uZzItYWN0aXZpdGktdGFza2xpc3Qvc3JjJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5maWx0ZXIkLnN1YnNjcmliZSgoZmlsdGVyOiBGaWx0ZXJSZXByZXNlbnRhdGlvbk1vZGVsKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmZpbHRlcnMucHVzaChmaWx0ZXIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGxldCBhcHBJZCA9IGNoYW5nZXNbJ2FwcElkJ107XG4gICAgICAgIGlmIChhcHBJZCAmJiAoYXBwSWQuY3VycmVudFZhbHVlIHx8IGFwcElkLmN1cnJlbnRWYWx1ZSA9PT0gbnVsbCkpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0RmlsdGVyc0J5QXBwSWQoYXBwSWQuY3VycmVudFZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgYXBwTmFtZSA9IGNoYW5nZXNbJ2FwcE5hbWUnXTtcbiAgICAgICAgaWYgKGFwcE5hbWUgJiYgYXBwTmFtZSAhPT0gbnVsbCAmJiBhcHBOYW1lLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5nZXRGaWx0ZXJzQnlBcHBOYW1lKGFwcE5hbWUuY3VycmVudFZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ2V0RmlsdGVyc0J5QXBwSWQoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdGhlIHRhc2sgbGlzdCBmaWx0ZXJlZCBieSBhcHBJZCBvciBieSBhcHBOYW1lXG4gICAgICogQHBhcmFtIGFwcElkXG4gICAgICogQHBhcmFtIGFwcE5hbWVcbiAgICAgKi9cbiAgICBnZXRGaWx0ZXJzKGFwcElkPzogc3RyaW5nLCBhcHBOYW1lPzogc3RyaW5nKSB7XG4gICAgICAgIGlmIChhcHBOYW1lKSB7XG4gICAgICAgICAgICB0aGlzLmdldEZpbHRlcnNCeUFwcE5hbWUoYXBwTmFtZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmdldEZpbHRlcnNCeUFwcElkKGFwcElkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgZmlsdGVyIGxpc3QgZmlsdGVyZWQgYnkgYXBwSWRcbiAgICAgKiBAcGFyYW0gYXBwSWQgLSBvcHRpb25hbFxuICAgICAqL1xuICAgIGdldEZpbHRlcnNCeUFwcElkKGFwcElkPzogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuYWN0aXZpdGkuZ2V0VGFza0xpc3RGaWx0ZXJzKGFwcElkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAocmVzOiBGaWx0ZXJSZXByZXNlbnRhdGlvbk1vZGVsW10pID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0RmlsdGVyKCk7XG4gICAgICAgICAgICAgICAgcmVzLmZvckVhY2goKGZpbHRlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbHRlck9ic2VydmVyLm5leHQoZmlsdGVyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdEZpcnN0RmlsdGVyKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5vblN1Y2Nlc3MuZW1pdChyZXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IuZW1pdChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgZmlsdGVyIGxpc3QgZmlsdGVyZWQgYnkgYXBwTmFtZVxuICAgICAqIEBwYXJhbSBhcHBOYW1lXG4gICAgICovXG4gICAgZ2V0RmlsdGVyc0J5QXBwTmFtZShhcHBOYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5hY3Rpdml0aS5nZXREZXBsb3llZEFwcGxpY2F0aW9ucyhhcHBOYW1lKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICBhcHBsaWNhdGlvbiA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRGaWx0ZXJzQnlBcHBJZChhcHBsaWNhdGlvbi5pZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RGaXJzdEZpbHRlcigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IuZW1pdChlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUGFzcyB0aGUgc2VsZWN0ZWQgZmlsdGVyIGFzIG5leHRcbiAgICAgKiBAcGFyYW0gZmlsdGVyXG4gICAgICovXG4gICAgcHVibGljIHNlbGVjdEZpbHRlcihmaWx0ZXI6IEZpbHRlclJlcHJlc2VudGF0aW9uTW9kZWwpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50RmlsdGVyID0gZmlsdGVyO1xuICAgICAgICB0aGlzLmZpbHRlckNsaWNrLmVtaXQoZmlsdGVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWxlY3QgdGhlIGZpcnN0IGZpbHRlciBvZiBhIGxpc3QgaWYgcHJlc2VudFxuICAgICAqL1xuICAgIHB1YmxpYyBzZWxlY3RGaXJzdEZpbHRlcigpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzRmlsdGVyTGlzdEVtcHR5KCkpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEZpbHRlciA9IHRoaXMuZmlsdGVyc1swXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEZpbHRlciA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdGhlIGN1cnJlbnQgdGFza1xuICAgICAqIEByZXR1cm5zIHtGaWx0ZXJSZXByZXNlbnRhdGlvbk1vZGVsfVxuICAgICAqL1xuICAgIGdldEN1cnJlbnRGaWx0ZXIoKTogRmlsdGVyUmVwcmVzZW50YXRpb25Nb2RlbCB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRGaWx0ZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgdGhlIGZpbHRlciBsaXN0IGlzIGVtcHR5XG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgaXNGaWx0ZXJMaXN0RW1wdHkoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbHRlcnMgPT09IHVuZGVmaW5lZCB8fCAodGhpcy5maWx0ZXJzICYmIHRoaXMuZmlsdGVycy5sZW5ndGggPT09IDApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc2V0IHRoZSBmaWx0ZXJzIHByb3BlcnRpZXNcbiAgICAgKi9cbiAgICBwcml2YXRlIHJlc2V0RmlsdGVyKCkge1xuICAgICAgICB0aGlzLmZpbHRlcnMgPSBbXTtcbiAgICAgICAgdGhpcy5jdXJyZW50RmlsdGVyID0gbnVsbDtcbiAgICB9XG59XG4iXX0=
