/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var forms_1 = require("@angular/forms");
var Observable_1 = require("rxjs/Observable");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var ActivitiPeopleSearch = (function () {
    function ActivitiPeopleSearch(translateService) {
        var _this = this;
        this.translateService = translateService;
        this.baseComponentPath = module.id.replace('/activiti-people-search.component.js', '');
        this.onSearch = new core_1.EventEmitter();
        this.onRowClicked = new core_1.EventEmitter();
        this.searchUser = new forms_1.FormControl();
        this.userList = [];
        if (translateService) {
            translateService.addTranslationFolder('ng2-activiti-tasklist', 'node_modules/ng2-activiti-tasklist/src');
        }
        this.searchUser
            .valueChanges
            .debounceTime(200)
            .subscribe(function (event) {
            if (event && event.trim()) {
                _this.onSearch.emit(event);
            }
            else {
                _this.userList = [];
            }
        });
    }
    ActivitiPeopleSearch.prototype.ngOnInit = function () {
        var _this = this;
        this.results.subscribe(function (list) {
            _this.userList = list;
        });
    };
    ActivitiPeopleSearch.prototype.ngAfterViewInit = function () {
        this.setupMaterialComponents(componentHandler);
    };
    ActivitiPeopleSearch.prototype.setupMaterialComponents = function (handler) {
        var isUpgraded = false;
        if (handler) {
            handler.upgradeAllRegistered();
            isUpgraded = true;
        }
        return isUpgraded;
    };
    ActivitiPeopleSearch.prototype.onRowClick = function (userClicked) {
        var _this = this;
        this.onRowClicked.emit(userClicked);
        this.userList = this.userList.filter(function (user) {
            _this.searchUser.reset();
            return user.id !== userClicked.id;
        });
    };
    ActivitiPeopleSearch.prototype.getDisplayUser = function (user) {
        var firstName = user.firstName && user.firstName !== 'null' ? user.firstName : 'N/A';
        var lastName = user.lastName && user.lastName !== 'null' ? user.lastName : 'N/A';
        return firstName + ' - ' + lastName;
    };
    return ActivitiPeopleSearch;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiPeopleSearch.prototype, "iconImageUrl", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Observable_1.Observable)
], ActivitiPeopleSearch.prototype, "results", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiPeopleSearch.prototype, "onSearch", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiPeopleSearch.prototype, "onRowClicked", void 0);
ActivitiPeopleSearch = __decorate([
    core_1.Component({
        selector: 'activiti-people-search',
        moduleId: module.id,
        template: "<div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">     <input class=\"mdl-textfield__input\" type=\"text\" id=\"userSearchText\" [value]=\"\"            [formControl]=\"searchUser\"/>     <label class=\"mdl-textfield__label\" for=\"userSearchText\">Search user</label> </div> <ul class='mdl-list'>     <li class=\"mdl-list__item fix-element-user-list\" *ngFor=\"let user of userList\">         <button (click)=\"onRowClick(user)\" id=\"user-{{user.id}}\" class=\"mdl-chip mdl-chip--contact mdl-chip-search-people\">             <img class=\"mdl-chip__contact\" [src]=\"iconImageUrl || baseComponentPath + '/../assets/images/user.jpg'\" />             <span class=\"mdl-chip__text mdl-chip-search-people__text\">{{getDisplayUser(user)}}</span>         </button>     </li>     <div *ngIf=\"userList?.length === 0\" id=\"no-user-found\">         {{'PEOPLE.SEARCH.NO_USERS' | translate }}     </div> </ul>",
        styles: [":host {     width: 100%; }  .activiti-label {     font-weight: bolder; }  .material-icons.people-search__icon:hover {     color: rgb(255, 152, 0); }  .fix-element-user-list{     padding-top: 0px;     padding-right: 0px;     padding-bottom: 0px;     padding-left: 0px; }  .mdl-chip-search-people{     margin: auto;     min-width: 60%; }  .mdl-chip-search-people:hover{     background-color: #c1c1c1;     cursor: pointer;  }  .mdl-chip-search-people img{     margin-left: -30px; }  .mdl-chip-search-people__text{     padding-left: 10px; }"]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService])
], ActivitiPeopleSearch);
exports.ActivitiPeopleSearch = ActivitiPeopleSearch;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktcGVvcGxlLXNlYXJjaC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7Ozs7Ozs7OztBQUVILHNDQUE4RjtBQUM5Rix3Q0FBNkM7QUFFN0MsOENBQTZDO0FBQzdDLHVEQUErRDtBQVcvRCxJQUFhLG9CQUFvQjtJQW9CN0IsOEJBQW9CLGdCQUE0QztRQUFoRSxpQkFlQztRQWZtQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQTRCO1FBbEJoRSxzQkFBaUIsR0FBRyxNQUFNLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxzQ0FBc0MsRUFBRSxFQUFFLENBQUMsQ0FBQztRQVNsRixhQUFRLEdBQXNCLElBQUksbUJBQVksRUFBRSxDQUFDO1FBR2pELGlCQUFZLEdBQXNCLElBQUksbUJBQVksRUFBRSxDQUFDO1FBRXJELGVBQVUsR0FBZ0IsSUFBSSxtQkFBVyxFQUFFLENBQUM7UUFFNUMsYUFBUSxHQUFXLEVBQUUsQ0FBQztRQUdsQixFQUFFLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7WUFDbkIsZ0JBQWdCLENBQUMsb0JBQW9CLENBQUMsdUJBQXVCLEVBQUUsd0NBQXdDLENBQUMsQ0FBQztRQUM3RyxDQUFDO1FBRUQsSUFBSSxDQUFDLFVBQVU7YUFDVixZQUFZO2FBQ1osWUFBWSxDQUFDLEdBQUcsQ0FBQzthQUNqQixTQUFTLENBQUMsVUFBQyxLQUFhO1lBQ3JCLEVBQUUsQ0FBQyxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUN4QixLQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM5QixDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ0osS0FBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7WUFDdkIsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUVELHVDQUFRLEdBQVI7UUFBQSxpQkFJQztRQUhHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFVBQUMsSUFBSTtZQUN4QixLQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCw4Q0FBZSxHQUFmO1FBQ0ksSUFBSSxDQUFDLHVCQUF1QixDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVELHNEQUF1QixHQUF2QixVQUF3QixPQUFhO1FBRWpDLElBQUksVUFBVSxHQUFZLEtBQUssQ0FBQztRQUNoQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ1YsT0FBTyxDQUFDLG9CQUFvQixFQUFFLENBQUM7WUFDL0IsVUFBVSxHQUFHLElBQUksQ0FBQztRQUN0QixDQUFDO1FBQ0QsTUFBTSxDQUFDLFVBQVUsQ0FBQztJQUN0QixDQUFDO0lBRUQseUNBQVUsR0FBVixVQUFXLFdBQWlCO1FBQTVCLGlCQU1DO1FBTEcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFDLElBQUk7WUFDdEMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUN4QixNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxXQUFXLENBQUMsRUFBRSxDQUFDO1FBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELDZDQUFjLEdBQWQsVUFBZSxJQUFVO1FBQ3JCLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLFNBQVMsS0FBSyxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7UUFDckYsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxLQUFLLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztRQUNqRixNQUFNLENBQUMsU0FBUyxHQUFHLEtBQUssR0FBRyxRQUFRLENBQUM7SUFDeEMsQ0FBQztJQUNMLDJCQUFDO0FBQUQsQ0F0RUEsQUFzRUMsSUFBQTtBQWpFRztJQURDLFlBQUssRUFBRTs7MERBQ2E7QUFHckI7SUFEQyxZQUFLLEVBQUU7OEJBQ0MsdUJBQVU7cURBQVM7QUFHNUI7SUFEQyxhQUFNLEVBQUU7OEJBQ0MsbUJBQVk7c0RBQTJCO0FBR2pEO0lBREMsYUFBTSxFQUFFOzhCQUNLLG1CQUFZOzBEQUEyQjtBQWQ1QyxvQkFBb0I7SUFQaEMsZ0JBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSx3QkFBd0I7UUFDbEMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1FBQ25CLFFBQVEsRUFBRSxpNkJBQWk2QjtRQUMzNkIsTUFBTSxFQUFFLENBQUMsMGhCQUEwaEIsQ0FBQztLQUN2aUIsQ0FBQztxQ0FzQndDLDhDQUEwQjtHQXBCdkQsb0JBQW9CLENBc0VoQztBQXRFWSxvREFBb0IiLCJmaWxlIjoiY29tcG9uZW50cy9hY3Rpdml0aS1wZW9wbGUtc2VhcmNoLmNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBPbkluaXQsIEFmdGVyVmlld0luaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gJy4uL21vZGVscy91c2VyLm1vZGVsJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzL09ic2VydmFibGUnO1xuaW1wb3J0IHsgQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UgfSBmcm9tICduZzItYWxmcmVzY28tY29yZSc7XG5cbmRlY2xhcmUgbGV0IGNvbXBvbmVudEhhbmRsZXI6IGFueTtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhY3Rpdml0aS1wZW9wbGUtc2VhcmNoJyxcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHRlbXBsYXRlOiBcIjxkaXYgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGQgbWRsLWpzLXRleHRmaWVsZCBtZGwtdGV4dGZpZWxkLS1mbG9hdGluZy1sYWJlbFxcXCI+ICAgICA8aW5wdXQgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGRfX2lucHV0XFxcIiB0eXBlPVxcXCJ0ZXh0XFxcIiBpZD1cXFwidXNlclNlYXJjaFRleHRcXFwiIFt2YWx1ZV09XFxcIlxcXCIgICAgICAgICAgICBbZm9ybUNvbnRyb2xdPVxcXCJzZWFyY2hVc2VyXFxcIi8+ICAgICA8bGFiZWwgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGRfX2xhYmVsXFxcIiBmb3I9XFxcInVzZXJTZWFyY2hUZXh0XFxcIj5TZWFyY2ggdXNlcjwvbGFiZWw+IDwvZGl2PiA8dWwgY2xhc3M9J21kbC1saXN0Jz4gICAgIDxsaSBjbGFzcz1cXFwibWRsLWxpc3RfX2l0ZW0gZml4LWVsZW1lbnQtdXNlci1saXN0XFxcIiAqbmdGb3I9XFxcImxldCB1c2VyIG9mIHVzZXJMaXN0XFxcIj4gICAgICAgICA8YnV0dG9uIChjbGljayk9XFxcIm9uUm93Q2xpY2sodXNlcilcXFwiIGlkPVxcXCJ1c2VyLXt7dXNlci5pZH19XFxcIiBjbGFzcz1cXFwibWRsLWNoaXAgbWRsLWNoaXAtLWNvbnRhY3QgbWRsLWNoaXAtc2VhcmNoLXBlb3BsZVxcXCI+ICAgICAgICAgICAgIDxpbWcgY2xhc3M9XFxcIm1kbC1jaGlwX19jb250YWN0XFxcIiBbc3JjXT1cXFwiaWNvbkltYWdlVXJsIHx8IGJhc2VDb21wb25lbnRQYXRoICsgJy8uLi9hc3NldHMvaW1hZ2VzL3VzZXIuanBnJ1xcXCIgLz4gICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcIm1kbC1jaGlwX190ZXh0IG1kbC1jaGlwLXNlYXJjaC1wZW9wbGVfX3RleHRcXFwiPnt7Z2V0RGlzcGxheVVzZXIodXNlcil9fTwvc3Bhbj4gICAgICAgICA8L2J1dHRvbj4gICAgIDwvbGk+ICAgICA8ZGl2ICpuZ0lmPVxcXCJ1c2VyTGlzdD8ubGVuZ3RoID09PSAwXFxcIiBpZD1cXFwibm8tdXNlci1mb3VuZFxcXCI+ICAgICAgICAge3snUEVPUExFLlNFQVJDSC5OT19VU0VSUycgfCB0cmFuc2xhdGUgfX0gICAgIDwvZGl2PiA8L3VsPlwiLFxuICAgIHN0eWxlczogW1wiOmhvc3QgeyAgICAgd2lkdGg6IDEwMCU7IH0gIC5hY3Rpdml0aS1sYWJlbCB7ICAgICBmb250LXdlaWdodDogYm9sZGVyOyB9ICAubWF0ZXJpYWwtaWNvbnMucGVvcGxlLXNlYXJjaF9faWNvbjpob3ZlciB7ICAgICBjb2xvcjogcmdiKDI1NSwgMTUyLCAwKTsgfSAgLmZpeC1lbGVtZW50LXVzZXItbGlzdHsgICAgIHBhZGRpbmctdG9wOiAwcHg7ICAgICBwYWRkaW5nLXJpZ2h0OiAwcHg7ICAgICBwYWRkaW5nLWJvdHRvbTogMHB4OyAgICAgcGFkZGluZy1sZWZ0OiAwcHg7IH0gIC5tZGwtY2hpcC1zZWFyY2gtcGVvcGxleyAgICAgbWFyZ2luOiBhdXRvOyAgICAgbWluLXdpZHRoOiA2MCU7IH0gIC5tZGwtY2hpcC1zZWFyY2gtcGVvcGxlOmhvdmVyeyAgICAgYmFja2dyb3VuZC1jb2xvcjogI2MxYzFjMTsgICAgIGN1cnNvcjogcG9pbnRlcjsgIH0gIC5tZGwtY2hpcC1zZWFyY2gtcGVvcGxlIGltZ3sgICAgIG1hcmdpbi1sZWZ0OiAtMzBweDsgfSAgLm1kbC1jaGlwLXNlYXJjaC1wZW9wbGVfX3RleHR7ICAgICBwYWRkaW5nLWxlZnQ6IDEwcHg7IH1cIl1cbn0pXG5cbmV4cG9ydCBjbGFzcyBBY3Rpdml0aVBlb3BsZVNlYXJjaCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XG5cbiAgICBiYXNlQ29tcG9uZW50UGF0aCA9IG1vZHVsZS5pZC5yZXBsYWNlKCcvYWN0aXZpdGktcGVvcGxlLXNlYXJjaC5jb21wb25lbnQuanMnLCAnJyk7XG5cbiAgICBASW5wdXQoKVxuICAgIGljb25JbWFnZVVybDogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICByZXN1bHRzOiBPYnNlcnZhYmxlPFVzZXJbXT47XG5cbiAgICBAT3V0cHV0KClcbiAgICBvblNlYXJjaDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBvblJvd0NsaWNrZWQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgc2VhcmNoVXNlcjogRm9ybUNvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woKTtcblxuICAgIHVzZXJMaXN0OiBVc2VyW10gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgaWYgKHRyYW5zbGF0ZVNlcnZpY2UpIHtcbiAgICAgICAgICAgIHRyYW5zbGF0ZVNlcnZpY2UuYWRkVHJhbnNsYXRpb25Gb2xkZXIoJ25nMi1hY3Rpdml0aS10YXNrbGlzdCcsICdub2RlX21vZHVsZXMvbmcyLWFjdGl2aXRpLXRhc2tsaXN0L3NyYycpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZWFyY2hVc2VyXG4gICAgICAgICAgICAudmFsdWVDaGFuZ2VzXG4gICAgICAgICAgICAuZGVib3VuY2VUaW1lKDIwMClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKGV2ZW50OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQudHJpbSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25TZWFyY2guZW1pdChldmVudCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyTGlzdCA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnJlc3VsdHMuc3Vic2NyaWJlKChsaXN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVzZXJMaXN0ID0gbGlzdDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgICAgICB0aGlzLnNldHVwTWF0ZXJpYWxDb21wb25lbnRzKGNvbXBvbmVudEhhbmRsZXIpO1xuICAgIH1cblxuICAgIHNldHVwTWF0ZXJpYWxDb21wb25lbnRzKGhhbmRsZXI/OiBhbnkpOiBib29sZWFuIHtcbiAgICAgICAgLy8gd29ya2Fyb3VuZCBmb3IgTURMIGlzc3VlcyB3aXRoIGR5bmFtaWMgY29tcG9uZW50c1xuICAgICAgICBsZXQgaXNVcGdyYWRlZDogYm9vbGVhbiA9IGZhbHNlO1xuICAgICAgICBpZiAoaGFuZGxlcikge1xuICAgICAgICAgICAgaGFuZGxlci51cGdyYWRlQWxsUmVnaXN0ZXJlZCgpO1xuICAgICAgICAgICAgaXNVcGdyYWRlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzVXBncmFkZWQ7XG4gICAgfVxuXG4gICAgb25Sb3dDbGljayh1c2VyQ2xpY2tlZDogVXNlcikge1xuICAgICAgICB0aGlzLm9uUm93Q2xpY2tlZC5lbWl0KHVzZXJDbGlja2VkKTtcbiAgICAgICAgdGhpcy51c2VyTGlzdCA9IHRoaXMudXNlckxpc3QuZmlsdGVyKCh1c2VyKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlYXJjaFVzZXIucmVzZXQoKTtcbiAgICAgICAgICAgIHJldHVybiB1c2VyLmlkICE9PSB1c2VyQ2xpY2tlZC5pZDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0RGlzcGxheVVzZXIodXNlcjogVXNlcik6IHN0cmluZyB7XG4gICAgICAgIGxldCBmaXJzdE5hbWUgPSB1c2VyLmZpcnN0TmFtZSAmJiB1c2VyLmZpcnN0TmFtZSAhPT0gJ251bGwnID8gdXNlci5maXJzdE5hbWUgOiAnTi9BJztcbiAgICAgICAgbGV0IGxhc3ROYW1lID0gdXNlci5sYXN0TmFtZSAmJiB1c2VyLmxhc3ROYW1lICE9PSAnbnVsbCcgPyB1c2VyLmxhc3ROYW1lIDogJ04vQSc7XG4gICAgICAgIHJldHVybiBmaXJzdE5hbWUgKyAnIC0gJyArIGxhc3ROYW1lO1xuICAgIH1cbn1cbiJdfQ==
