/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var activiti_tasklist_service_1 = require("./../services/activiti-tasklist.service");
var user_model_1 = require("../models/user.model");
var ng2_activiti_form_1 = require("ng2-activiti-form");
var filter_model_1 = require("../models/filter.model");
var ActivitiTaskDetails = (function () {
    function ActivitiTaskDetails(translateService, activitiForm, activitiTaskList, logService) {
        this.translateService = translateService;
        this.activitiForm = activitiForm;
        this.activitiTaskList = activitiTaskList;
        this.logService = logService;
        this.showNextTask = true;
        this.showFormTitle = true;
        this.showFormCompleteButton = true;
        this.showFormSaveButton = true;
        this.readOnlyForm = false;
        this.showFormRefreshButton = true;
        this.formSaved = new core_1.EventEmitter();
        this.formCompleted = new core_1.EventEmitter();
        this.formLoaded = new core_1.EventEmitter();
        this.taskCreated = new core_1.EventEmitter();
        this.onError = new core_1.EventEmitter();
        this.executeOutcome = new core_1.EventEmitter();
        this.taskFormName = null;
        this.taskPeople = [];
        if (translateService) {
            translateService.addTranslationFolder('ng2-activiti-tasklist', 'node_modules/ng2-activiti-tasklist/src');
        }
    }
    ActivitiTaskDetails.prototype.ngOnInit = function () {
        if (this.taskId) {
            this.loadDetails(this.taskId);
        }
    };
    ActivitiTaskDetails.prototype.ngOnChanges = function (changes) {
        var taskId = changes['taskId'];
        if (taskId && !taskId.currentValue) {
            this.reset();
            return;
        }
        if (taskId && taskId.currentValue) {
            this.loadDetails(taskId.currentValue);
            return;
        }
    };
    ActivitiTaskDetails.prototype.reset = function () {
        this.taskDetails = null;
    };
    ActivitiTaskDetails.prototype.hasFormKey = function () {
        return (this.taskDetails
            && this.taskDetails.formKey
            && this.taskDetails.formKey !== 'null');
    };
    ActivitiTaskDetails.prototype.isTaskActive = function () {
        return this.taskDetails && this.taskDetails.duration === null;
    };
    ActivitiTaskDetails.prototype.loadDetails = function (taskId) {
        var _this = this;
        this.taskPeople = [];
        this.taskFormName = null;
        if (taskId) {
            this.activitiTaskList.getTaskDetails(taskId).subscribe(function (res) {
                _this.taskDetails = res;
                if (_this.taskDetails.name === 'null') {
                    _this.taskDetails.name = 'No name';
                }
                var endDate = res.endDate;
                _this.readOnlyForm = !!(endDate && !isNaN(endDate.getTime()));
                if (_this.taskDetails && _this.taskDetails.involvedPeople) {
                    _this.taskDetails.involvedPeople.forEach(function (user) {
                        _this.taskPeople.push(new user_model_1.User(user));
                    });
                }
            });
        }
    };
    ActivitiTaskDetails.prototype.isAssignedToMe = function () {
        return this.taskDetails.assignee ? true : false;
    };
    ActivitiTaskDetails.prototype.loadNextTask = function (processInstanceId, processDefinitionId) {
        var _this = this;
        var requestNode = new filter_model_1.TaskQueryRequestRepresentationModel({
            processInstanceId: processInstanceId,
            processDefinitionId: processDefinitionId
        });
        this.activitiTaskList.getTasks(requestNode).subscribe(function (response) {
            if (response && response.length > 0) {
                _this.taskDetails = response[0];
            }
            else {
                _this.reset();
            }
        }, function (error) {
            _this.logService.error(error);
            _this.onError.emit(error);
        });
    };
    ActivitiTaskDetails.prototype.onComplete = function () {
        var _this = this;
        this.activitiTaskList.completeTask(this.taskId).subscribe(function (res) { return _this.onFormCompleted(null); });
    };
    ActivitiTaskDetails.prototype.onFormSaved = function (form) {
        this.formSaved.emit(form);
    };
    ActivitiTaskDetails.prototype.onFormCompleted = function (form) {
        this.formCompleted.emit(form);
        if (this.showNextTask) {
            this.loadNextTask(this.taskDetails.processInstanceId, this.taskDetails.processDefinitionId);
        }
    };
    ActivitiTaskDetails.prototype.onFormLoaded = function (form) {
        this.taskFormName = null;
        if (form && form.name) {
            this.taskFormName = form.name;
        }
        this.formLoaded.emit(form);
    };
    ActivitiTaskDetails.prototype.onChecklistTaskCreated = function (task) {
        this.taskCreated.emit(task);
    };
    ActivitiTaskDetails.prototype.onFormError = function (error) {
        this.errorDialog.nativeElement.showModal();
        this.onError.emit(error);
    };
    ActivitiTaskDetails.prototype.onFormExecuteOutcome = function (event) {
        this.executeOutcome.emit(event);
    };
    ActivitiTaskDetails.prototype.closeErrorDialog = function () {
        this.errorDialog.nativeElement.close();
    };
    ActivitiTaskDetails.prototype.onClaimTask = function (taskId) {
        this.loadDetails(taskId);
    };
    return ActivitiTaskDetails;
}());
__decorate([
    core_1.ViewChild('activiticomments'),
    __metadata("design:type", Object)
], ActivitiTaskDetails.prototype, "activiticomments", void 0);
__decorate([
    core_1.ViewChild('activitichecklist'),
    __metadata("design:type", Object)
], ActivitiTaskDetails.prototype, "activitichecklist", void 0);
__decorate([
    core_1.ViewChild('errorDialog'),
    __metadata("design:type", core_1.DebugElement)
], ActivitiTaskDetails.prototype, "errorDialog", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiTaskDetails.prototype, "taskId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiTaskDetails.prototype, "showNextTask", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiTaskDetails.prototype, "showFormTitle", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiTaskDetails.prototype, "showFormCompleteButton", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiTaskDetails.prototype, "showFormSaveButton", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiTaskDetails.prototype, "readOnlyForm", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiTaskDetails.prototype, "showFormRefreshButton", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiTaskDetails.prototype, "peopleIconImageUrl", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiTaskDetails.prototype, "formSaved", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiTaskDetails.prototype, "formCompleted", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiTaskDetails.prototype, "formLoaded", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiTaskDetails.prototype, "taskCreated", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiTaskDetails.prototype, "onError", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiTaskDetails.prototype, "executeOutcome", void 0);
ActivitiTaskDetails = __decorate([
    core_1.Component({
        selector: 'activiti-task-details',
        moduleId: module.id,
        template: "<div *ngIf=\"!taskDetails\">     <template *ngIf=\"noTaskDetailsTemplateComponent\" ngFor [ngForOf]=\"[data]\"               [ngForTemplate]=\"noTaskDetailsTemplateComponent\">         {{ 'TASK_DETAILS.MESSAGES.NONE' | translate }}     </template>     <div *ngIf=\"!noTaskDetailsTemplateComponent\">         {{ 'TASK_DETAILS.MESSAGES.NONE' | translate }}     </div> </div> <div *ngIf=\"taskDetails\">     <h2 class=\"mdl-card__title-text\">{{taskDetails.name}}</h2>     <activiti-task-header             [taskDetails]=\"taskDetails\"             [formName]=\"taskFormName\"             (claim)=\"onClaimTask($event)\"></activiti-task-header>     <div class=\"mdl-grid\">         <div class=\"mdl-cell mdl-cell--4-col\">             <activiti-people [iconImageUrl]=\"peopleIconImageUrl\" [people]=\"taskPeople\" [readOnly]=\"readOnlyForm\"                              [taskId]=\"taskDetails.id\"></activiti-people>         </div>         <div class=\"mdl-cell mdl-cell--4-col\">             <activiti-comments [readOnly]=\"readOnlyForm\" [taskId]=\"taskDetails.id\"                                #activiticomments></activiti-comments>         </div>         <div class=\"mdl-cell mdl-cell--4-col\">             <activiti-checklist [readOnly]=\"readOnlyForm\" [taskId]=\"taskDetails.id\" [assignee]=\"taskDetails?.assignee?.id\"                                 (checklistTaskCreated)=\"onChecklistTaskCreated($event)\" #activitichecklist></activiti-checklist>         </div>     </div>     <div *ngIf=\"isAssignedToMe()\">         <activiti-form *ngIf=\"hasFormKey()\" [taskId]=\"taskDetails.id\"                        [showTitle]=\"showFormTitle\"                        [showRefreshButton]=\"showFormRefreshButton\"                        [showCompleteButton]=\"showFormCompleteButton\"                        [showSaveButton]=\"showFormSaveButton\"                        [readOnly]=\"readOnlyForm\"                        (formSaved)='onFormSaved($event)'                        (formCompleted)='onFormCompleted($event)'                        (formLoaded)='onFormLoaded($event)'                        (onError)='onFormError($event)'                        (executeOutcome)='onFormExecuteOutcome($event)'                        #activitiForm>         </activiti-form>     </div>     <div *ngIf=\"!isAssignedToMe()\">         {{ 'TASK_DETAILS.MESSAGES.CLAIM' | translate }}     </div>     <button type=\"button\" class=\"mdl-button\" *ngIf=\"!hasFormKey() && isTaskActive()\" (click)=\"onComplete()\">         {{ 'TASK_DETAILS.BUTTON.COMPLETE' | translate }}     </button>     <dialog class=\"mdl-dialog error-dialog\" #errorDialog>         <div class=\"mdl-dialog__content\">             <h3>{{'TASK_DETAILS.ERROR.TITLE'|translate}}</h3>             <p>{{'TASK_DETAILS.ERROR.DESCRIPTION'|translate}}</p>             <button type=\"button\" class=\"mdl-button\" (click)=\"closeErrorDialog()\">{{'TASK_DETAILS.ERROR.CLOSE'|translate}}</button>         </div>     </dialog> </div>",
        styles: [":host {     width: 100%; }  .error-dialog h3 {     margin: 16px 0; }"]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        ng2_activiti_form_1.FormService,
        activiti_tasklist_service_1.ActivitiTaskListService,
        ng2_alfresco_core_1.LogService])
], ActivitiTaskDetails);
exports.ActivitiTaskDetails = ActivitiTaskDetails;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktdGFzay1kZXRhaWxzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7Ozs7Ozs7Ozs7O0FBRUgsc0NBQThJO0FBQzlJLHVEQUEyRTtBQUMzRSxxRkFBa0Y7QUFFbEYsbURBQTRDO0FBQzVDLHVEQUE2RTtBQUM3RSx1REFBNkU7QUFRN0UsSUFBYSxtQkFBbUI7SUFtRTVCLDZCQUFvQixnQkFBNEMsRUFDNUMsWUFBeUIsRUFDekIsZ0JBQXlDLEVBQ3pDLFVBQXNCO1FBSHRCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBNEI7UUFDNUMsaUJBQVksR0FBWixZQUFZLENBQWE7UUFDekIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUF5QjtRQUN6QyxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBdkQxQyxpQkFBWSxHQUFZLElBQUksQ0FBQztRQUc3QixrQkFBYSxHQUFZLElBQUksQ0FBQztRQUc5QiwyQkFBc0IsR0FBWSxJQUFJLENBQUM7UUFHdkMsdUJBQWtCLEdBQVksSUFBSSxDQUFDO1FBR25DLGlCQUFZLEdBQVksS0FBSyxDQUFDO1FBRzlCLDBCQUFxQixHQUFZLElBQUksQ0FBQztRQU10QyxjQUFTLEdBQTRCLElBQUksbUJBQVksRUFBYSxDQUFDO1FBR25FLGtCQUFhLEdBQTRCLElBQUksbUJBQVksRUFBYSxDQUFDO1FBR3ZFLGVBQVUsR0FBNEIsSUFBSSxtQkFBWSxFQUFhLENBQUM7UUFHcEUsZ0JBQVcsR0FBbUMsSUFBSSxtQkFBWSxFQUFvQixDQUFDO1FBR25GLFlBQU8sR0FBc0IsSUFBSSxtQkFBWSxFQUFPLENBQUM7UUFHckQsbUJBQWMsR0FBbUMsSUFBSSxtQkFBWSxFQUFvQixDQUFDO1FBR3RGLGlCQUFZLEdBQVcsSUFBSSxDQUFDO1FBRTVCLGVBQVUsR0FBVyxFQUFFLENBQUM7UUFnQnBCLEVBQUUsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztZQUNuQixnQkFBZ0IsQ0FBQyxvQkFBb0IsQ0FBQyx1QkFBdUIsRUFBRSx3Q0FBd0MsQ0FBQyxDQUFDO1FBQzdHLENBQUM7SUFDTCxDQUFDO0lBRUQsc0NBQVEsR0FBUjtRQUNJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ2QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDbEMsQ0FBQztJQUNMLENBQUM7SUFFRCx5Q0FBVyxHQUFYLFVBQVksT0FBc0I7UUFDOUIsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQy9CLEVBQUUsQ0FBQyxDQUFDLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNiLE1BQU0sQ0FBQztRQUNYLENBQUM7UUFDRCxFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDaEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDdEMsTUFBTSxDQUFDO1FBQ1gsQ0FBQztJQUNMLENBQUM7SUFLTyxtQ0FBSyxHQUFiO1FBQ0ksSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7SUFDNUIsQ0FBQztJQU1ELHdDQUFVLEdBQVY7UUFDSSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVztlQUNyQixJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU87ZUFDeEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEtBQUssTUFBTSxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVELDBDQUFZLEdBQVo7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsS0FBSyxJQUFJLENBQUM7SUFDbEUsQ0FBQztJQU1PLHlDQUFXLEdBQW5CLFVBQW9CLE1BQWM7UUFBbEMsaUJBc0JDO1FBckJHLElBQUksQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDVCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FDbEQsVUFBQyxHQUFxQjtnQkFDbEIsS0FBSSxDQUFDLFdBQVcsR0FBRyxHQUFHLENBQUM7Z0JBRXZCLEVBQUUsQ0FBQyxDQUFDLEtBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxLQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUM7b0JBQ25DLEtBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQztnQkFDdEMsQ0FBQztnQkFFRCxJQUFJLE9BQU8sR0FBUSxHQUFHLENBQUMsT0FBTyxDQUFDO2dCQUMvQixLQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUU3RCxFQUFFLENBQUMsQ0FBQyxLQUFJLENBQUMsV0FBVyxJQUFJLEtBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztvQkFDdEQsS0FBSSxDQUFDLFdBQVcsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLFVBQUMsSUFBSTt3QkFDekMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxpQkFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQ3pDLENBQUMsQ0FBQyxDQUFDO2dCQUNQLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztRQUNYLENBQUM7SUFDTCxDQUFDO0lBRUQsNENBQWMsR0FBZDtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsR0FBRyxJQUFJLEdBQUcsS0FBSyxDQUFDO0lBQ3BELENBQUM7SUFPTywwQ0FBWSxHQUFwQixVQUFxQixpQkFBeUIsRUFBRSxtQkFBMkI7UUFBM0UsaUJBa0JDO1FBakJHLElBQUksV0FBVyxHQUFHLElBQUksa0RBQW1DLENBQ3JEO1lBQ0ksaUJBQWlCLEVBQUUsaUJBQWlCO1lBQ3BDLG1CQUFtQixFQUFFLG1CQUFtQjtTQUMzQyxDQUNKLENBQUM7UUFDRixJQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FDakQsVUFBQyxRQUFRO1lBQ0wsRUFBRSxDQUFDLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbEMsS0FBSSxDQUFDLFdBQVcsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkMsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNKLEtBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNqQixDQUFDO1FBQ0wsQ0FBQyxFQUFFLFVBQUMsS0FBSztZQUNMLEtBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzdCLEtBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdCLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUtELHdDQUFVLEdBQVY7UUFBQSxpQkFJQztRQUhHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FDckQsVUFBQyxHQUFHLElBQUssT0FBQSxLQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxFQUExQixDQUEwQixDQUN0QyxDQUFDO0lBQ04sQ0FBQztJQUVELHlDQUFXLEdBQVgsVUFBWSxJQUFlO1FBQ3ZCLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFRCw2Q0FBZSxHQUFmLFVBQWdCLElBQWU7UUFDM0IsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDcEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUNoRyxDQUFDO0lBQ0wsQ0FBQztJQUVELDBDQUFZLEdBQVosVUFBYSxJQUFlO1FBQ3hCLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLEVBQUUsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNwQixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDbEMsQ0FBQztRQUNELElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFFRCxvREFBc0IsR0FBdEIsVUFBdUIsSUFBc0I7UUFDekMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVELHlDQUFXLEdBQVgsVUFBWSxLQUFVO1FBQ2xCLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzNDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRCxrREFBb0IsR0FBcEIsVUFBcUIsS0FBdUI7UUFDeEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDcEMsQ0FBQztJQUVELDhDQUFnQixHQUFoQjtRQUNJLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzNDLENBQUM7SUFFRCx5Q0FBVyxHQUFYLFVBQVksTUFBYztRQUN0QixJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFDTCwwQkFBQztBQUFELENBN05BLEFBNk5DLElBQUE7QUExTkc7SUFEQyxnQkFBUyxDQUFDLGtCQUFrQixDQUFDOzs2REFDUjtBQUd0QjtJQURDLGdCQUFTLENBQUMsbUJBQW1CLENBQUM7OzhEQUNSO0FBR3ZCO0lBREMsZ0JBQVMsQ0FBQyxhQUFhLENBQUM7OEJBQ1osbUJBQVk7d0RBQUM7QUFHMUI7SUFEQyxZQUFLLEVBQUU7O21EQUNPO0FBR2Y7SUFEQyxZQUFLLEVBQUU7O3lEQUNxQjtBQUc3QjtJQURDLFlBQUssRUFBRTs7MERBQ3NCO0FBRzlCO0lBREMsWUFBSyxFQUFFOzttRUFDK0I7QUFHdkM7SUFEQyxZQUFLLEVBQUU7OytEQUMyQjtBQUduQztJQURDLFlBQUssRUFBRTs7eURBQ3NCO0FBRzlCO0lBREMsWUFBSyxFQUFFOztrRUFDOEI7QUFHdEM7SUFEQyxZQUFLLEVBQUU7OytEQUNtQjtBQUczQjtJQURDLGFBQU0sRUFBRTs4QkFDRSxtQkFBWTtzREFBNEM7QUFHbkU7SUFEQyxhQUFNLEVBQUU7OEJBQ00sbUJBQVk7MERBQTRDO0FBR3ZFO0lBREMsYUFBTSxFQUFFOzhCQUNHLG1CQUFZO3VEQUE0QztBQUdwRTtJQURDLGFBQU0sRUFBRTs4QkFDSSxtQkFBWTt3REFBMEQ7QUFHbkY7SUFEQyxhQUFNLEVBQUU7OEJBQ0EsbUJBQVk7b0RBQWdDO0FBR3JEO0lBREMsYUFBTSxFQUFFOzhCQUNPLG1CQUFZOzJEQUEwRDtBQW5EN0UsbUJBQW1CO0lBTi9CLGdCQUFTLENBQUM7UUFDUCxRQUFRLEVBQUUsdUJBQXVCO1FBQ2pDLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtRQUNuQixRQUFRLEVBQUUseTZGQUF5NkY7UUFDbjdGLE1BQU0sRUFBRSxDQUFDLHNFQUFzRSxDQUFDO0tBQ25GLENBQUM7cUNBb0V3Qyw4Q0FBMEI7UUFDOUIsK0JBQVc7UUFDUCxtREFBdUI7UUFDN0IsOEJBQVU7R0F0RWpDLG1CQUFtQixDQTZOL0I7QUE3Tlksa0RBQW1CIiwiZmlsZSI6ImNvbXBvbmVudHMvYWN0aXZpdGktdGFzay1kZXRhaWxzLmNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgVmlld0NoaWxkLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVGVtcGxhdGVSZWYsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgRGVidWdFbGVtZW50fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFsZnJlc2NvVHJhbnNsYXRpb25TZXJ2aWNlLCBMb2dTZXJ2aWNlIH0gZnJvbSAnbmcyLWFsZnJlc2NvLWNvcmUnO1xuaW1wb3J0IHsgQWN0aXZpdGlUYXNrTGlzdFNlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL2FjdGl2aXRpLXRhc2tsaXN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgVGFza0RldGFpbHNNb2RlbCB9IGZyb20gJy4uL21vZGVscy90YXNrLWRldGFpbHMubW9kZWwnO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gJy4uL21vZGVscy91c2VyLm1vZGVsJztcbmltcG9ydCB7IEZvcm1TZXJ2aWNlLCBGb3JtTW9kZWwsIEZvcm1PdXRjb21lRXZlbnQgfSBmcm9tICduZzItYWN0aXZpdGktZm9ybSc7XG5pbXBvcnQgeyBUYXNrUXVlcnlSZXF1ZXN0UmVwcmVzZW50YXRpb25Nb2RlbCB9IGZyb20gJy4uL21vZGVscy9maWx0ZXIubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FjdGl2aXRpLXRhc2stZGV0YWlscycsXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICB0ZW1wbGF0ZTogXCI8ZGl2ICpuZ0lmPVxcXCIhdGFza0RldGFpbHNcXFwiPiAgICAgPHRlbXBsYXRlICpuZ0lmPVxcXCJub1Rhc2tEZXRhaWxzVGVtcGxhdGVDb21wb25lbnRcXFwiIG5nRm9yIFtuZ0Zvck9mXT1cXFwiW2RhdGFdXFxcIiAgICAgICAgICAgICAgIFtuZ0ZvclRlbXBsYXRlXT1cXFwibm9UYXNrRGV0YWlsc1RlbXBsYXRlQ29tcG9uZW50XFxcIj4gICAgICAgICB7eyAnVEFTS19ERVRBSUxTLk1FU1NBR0VTLk5PTkUnIHwgdHJhbnNsYXRlIH19ICAgICA8L3RlbXBsYXRlPiAgICAgPGRpdiAqbmdJZj1cXFwiIW5vVGFza0RldGFpbHNUZW1wbGF0ZUNvbXBvbmVudFxcXCI+ICAgICAgICAge3sgJ1RBU0tfREVUQUlMUy5NRVNTQUdFUy5OT05FJyB8IHRyYW5zbGF0ZSB9fSAgICAgPC9kaXY+IDwvZGl2PiA8ZGl2ICpuZ0lmPVxcXCJ0YXNrRGV0YWlsc1xcXCI+ICAgICA8aDIgY2xhc3M9XFxcIm1kbC1jYXJkX190aXRsZS10ZXh0XFxcIj57e3Rhc2tEZXRhaWxzLm5hbWV9fTwvaDI+ICAgICA8YWN0aXZpdGktdGFzay1oZWFkZXIgICAgICAgICAgICAgW3Rhc2tEZXRhaWxzXT1cXFwidGFza0RldGFpbHNcXFwiICAgICAgICAgICAgIFtmb3JtTmFtZV09XFxcInRhc2tGb3JtTmFtZVxcXCIgICAgICAgICAgICAgKGNsYWltKT1cXFwib25DbGFpbVRhc2soJGV2ZW50KVxcXCI+PC9hY3Rpdml0aS10YXNrLWhlYWRlcj4gICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1ncmlkXFxcIj4gICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtY2VsbCBtZGwtY2VsbC0tNC1jb2xcXFwiPiAgICAgICAgICAgICA8YWN0aXZpdGktcGVvcGxlIFtpY29uSW1hZ2VVcmxdPVxcXCJwZW9wbGVJY29uSW1hZ2VVcmxcXFwiIFtwZW9wbGVdPVxcXCJ0YXNrUGVvcGxlXFxcIiBbcmVhZE9ubHldPVxcXCJyZWFkT25seUZvcm1cXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW3Rhc2tJZF09XFxcInRhc2tEZXRhaWxzLmlkXFxcIj48L2FjdGl2aXRpLXBlb3BsZT4gICAgICAgICA8L2Rpdj4gICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtY2VsbCBtZGwtY2VsbC0tNC1jb2xcXFwiPiAgICAgICAgICAgICA8YWN0aXZpdGktY29tbWVudHMgW3JlYWRPbmx5XT1cXFwicmVhZE9ubHlGb3JtXFxcIiBbdGFza0lkXT1cXFwidGFza0RldGFpbHMuaWRcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjYWN0aXZpdGljb21tZW50cz48L2FjdGl2aXRpLWNvbW1lbnRzPiAgICAgICAgIDwvZGl2PiAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1jZWxsIG1kbC1jZWxsLS00LWNvbFxcXCI+ICAgICAgICAgICAgIDxhY3Rpdml0aS1jaGVja2xpc3QgW3JlYWRPbmx5XT1cXFwicmVhZE9ubHlGb3JtXFxcIiBbdGFza0lkXT1cXFwidGFza0RldGFpbHMuaWRcXFwiIFthc3NpZ25lZV09XFxcInRhc2tEZXRhaWxzPy5hc3NpZ25lZT8uaWRcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNoZWNrbGlzdFRhc2tDcmVhdGVkKT1cXFwib25DaGVja2xpc3RUYXNrQ3JlYXRlZCgkZXZlbnQpXFxcIiAjYWN0aXZpdGljaGVja2xpc3Q+PC9hY3Rpdml0aS1jaGVja2xpc3Q+ICAgICAgICAgPC9kaXY+ICAgICA8L2Rpdj4gICAgIDxkaXYgKm5nSWY9XFxcImlzQXNzaWduZWRUb01lKClcXFwiPiAgICAgICAgIDxhY3Rpdml0aS1mb3JtICpuZ0lmPVxcXCJoYXNGb3JtS2V5KClcXFwiIFt0YXNrSWRdPVxcXCJ0YXNrRGV0YWlscy5pZFxcXCIgICAgICAgICAgICAgICAgICAgICAgICBbc2hvd1RpdGxlXT1cXFwic2hvd0Zvcm1UaXRsZVxcXCIgICAgICAgICAgICAgICAgICAgICAgICBbc2hvd1JlZnJlc2hCdXR0b25dPVxcXCJzaG93Rm9ybVJlZnJlc2hCdXR0b25cXFwiICAgICAgICAgICAgICAgICAgICAgICAgW3Nob3dDb21wbGV0ZUJ1dHRvbl09XFxcInNob3dGb3JtQ29tcGxldGVCdXR0b25cXFwiICAgICAgICAgICAgICAgICAgICAgICAgW3Nob3dTYXZlQnV0dG9uXT1cXFwic2hvd0Zvcm1TYXZlQnV0dG9uXFxcIiAgICAgICAgICAgICAgICAgICAgICAgIFtyZWFkT25seV09XFxcInJlYWRPbmx5Rm9ybVxcXCIgICAgICAgICAgICAgICAgICAgICAgICAoZm9ybVNhdmVkKT0nb25Gb3JtU2F2ZWQoJGV2ZW50KScgICAgICAgICAgICAgICAgICAgICAgICAoZm9ybUNvbXBsZXRlZCk9J29uRm9ybUNvbXBsZXRlZCgkZXZlbnQpJyAgICAgICAgICAgICAgICAgICAgICAgIChmb3JtTG9hZGVkKT0nb25Gb3JtTG9hZGVkKCRldmVudCknICAgICAgICAgICAgICAgICAgICAgICAgKG9uRXJyb3IpPSdvbkZvcm1FcnJvcigkZXZlbnQpJyAgICAgICAgICAgICAgICAgICAgICAgIChleGVjdXRlT3V0Y29tZSk9J29uRm9ybUV4ZWN1dGVPdXRjb21lKCRldmVudCknICAgICAgICAgICAgICAgICAgICAgICAgI2FjdGl2aXRpRm9ybT4gICAgICAgICA8L2FjdGl2aXRpLWZvcm0+ICAgICA8L2Rpdj4gICAgIDxkaXYgKm5nSWY9XFxcIiFpc0Fzc2lnbmVkVG9NZSgpXFxcIj4gICAgICAgICB7eyAnVEFTS19ERVRBSUxTLk1FU1NBR0VTLkNMQUlNJyB8IHRyYW5zbGF0ZSB9fSAgICAgPC9kaXY+ICAgICA8YnV0dG9uIHR5cGU9XFxcImJ1dHRvblxcXCIgY2xhc3M9XFxcIm1kbC1idXR0b25cXFwiICpuZ0lmPVxcXCIhaGFzRm9ybUtleSgpICYmIGlzVGFza0FjdGl2ZSgpXFxcIiAoY2xpY2spPVxcXCJvbkNvbXBsZXRlKClcXFwiPiAgICAgICAgIHt7ICdUQVNLX0RFVEFJTFMuQlVUVE9OLkNPTVBMRVRFJyB8IHRyYW5zbGF0ZSB9fSAgICAgPC9idXR0b24+ICAgICA8ZGlhbG9nIGNsYXNzPVxcXCJtZGwtZGlhbG9nIGVycm9yLWRpYWxvZ1xcXCIgI2Vycm9yRGlhbG9nPiAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1kaWFsb2dfX2NvbnRlbnRcXFwiPiAgICAgICAgICAgICA8aDM+e3snVEFTS19ERVRBSUxTLkVSUk9SLlRJVExFJ3x0cmFuc2xhdGV9fTwvaDM+ICAgICAgICAgICAgIDxwPnt7J1RBU0tfREVUQUlMUy5FUlJPUi5ERVNDUklQVElPTid8dHJhbnNsYXRlfX08L3A+ICAgICAgICAgICAgIDxidXR0b24gdHlwZT1cXFwiYnV0dG9uXFxcIiBjbGFzcz1cXFwibWRsLWJ1dHRvblxcXCIgKGNsaWNrKT1cXFwiY2xvc2VFcnJvckRpYWxvZygpXFxcIj57eydUQVNLX0RFVEFJTFMuRVJST1IuQ0xPU0UnfHRyYW5zbGF0ZX19PC9idXR0b24+ICAgICAgICAgPC9kaXY+ICAgICA8L2RpYWxvZz4gPC9kaXY+XCIsXG4gICAgc3R5bGVzOiBbXCI6aG9zdCB7ICAgICB3aWR0aDogMTAwJTsgfSAgLmVycm9yLWRpYWxvZyBoMyB7ICAgICBtYXJnaW46IDE2cHggMDsgfVwiXVxufSlcbmV4cG9ydCBjbGFzcyBBY3Rpdml0aVRhc2tEZXRhaWxzIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuXG4gICAgQFZpZXdDaGlsZCgnYWN0aXZpdGljb21tZW50cycpXG4gICAgYWN0aXZpdGljb21tZW50czogYW55O1xuXG4gICAgQFZpZXdDaGlsZCgnYWN0aXZpdGljaGVja2xpc3QnKVxuICAgIGFjdGl2aXRpY2hlY2tsaXN0OiBhbnk7XG5cbiAgICBAVmlld0NoaWxkKCdlcnJvckRpYWxvZycpXG4gICAgZXJyb3JEaWFsb2c6IERlYnVnRWxlbWVudDtcblxuICAgIEBJbnB1dCgpXG4gICAgdGFza0lkOiBzdHJpbmc7XG5cbiAgICBASW5wdXQoKVxuICAgIHNob3dOZXh0VGFzazogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBASW5wdXQoKVxuICAgIHNob3dGb3JtVGl0bGU6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgQElucHV0KClcbiAgICBzaG93Rm9ybUNvbXBsZXRlQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIEBJbnB1dCgpXG4gICAgc2hvd0Zvcm1TYXZlQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIEBJbnB1dCgpXG4gICAgcmVhZE9ubHlGb3JtOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBASW5wdXQoKVxuICAgIHNob3dGb3JtUmVmcmVzaEJ1dHRvbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBASW5wdXQoKVxuICAgIHBlb3BsZUljb25JbWFnZVVybDogc3RyaW5nO1xuXG4gICAgQE91dHB1dCgpXG4gICAgZm9ybVNhdmVkOiBFdmVudEVtaXR0ZXI8Rm9ybU1vZGVsPiA9IG5ldyBFdmVudEVtaXR0ZXI8Rm9ybU1vZGVsPigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgZm9ybUNvbXBsZXRlZDogRXZlbnRFbWl0dGVyPEZvcm1Nb2RlbD4gPSBuZXcgRXZlbnRFbWl0dGVyPEZvcm1Nb2RlbD4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIGZvcm1Mb2FkZWQ6IEV2ZW50RW1pdHRlcjxGb3JtTW9kZWw+ID0gbmV3IEV2ZW50RW1pdHRlcjxGb3JtTW9kZWw+KCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICB0YXNrQ3JlYXRlZDogRXZlbnRFbWl0dGVyPFRhc2tEZXRhaWxzTW9kZWw+ID0gbmV3IEV2ZW50RW1pdHRlcjxUYXNrRGV0YWlsc01vZGVsPigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgb25FcnJvcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIGV4ZWN1dGVPdXRjb21lOiBFdmVudEVtaXR0ZXI8Rm9ybU91dGNvbWVFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPEZvcm1PdXRjb21lRXZlbnQ+KCk7XG5cbiAgICB0YXNrRGV0YWlsczogVGFza0RldGFpbHNNb2RlbDtcbiAgICB0YXNrRm9ybU5hbWU6IHN0cmluZyA9IG51bGw7XG5cbiAgICB0YXNrUGVvcGxlOiBVc2VyW10gPSBbXTtcblxuICAgIG5vVGFza0RldGFpbHNUZW1wbGF0ZUNvbXBvbmVudDogVGVtcGxhdGVSZWY8YW55PjtcblxuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIGF1dGggQXV0aGVudGljYXRpb24gc2VydmljZVxuICAgICAqIEBwYXJhbSB0cmFuc2xhdGUgVHJhbnNsYXRpb24gc2VydmljZVxuICAgICAqIEBwYXJhbSBhY3Rpdml0aUZvcm0gRm9ybSBzZXJ2aWNlXG4gICAgICogQHBhcmFtIGFjdGl2aXRpVGFza0xpc3QgVGFzayBzZXJ2aWNlXG4gICAgICovXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSB0cmFuc2xhdGVTZXJ2aWNlOiBBbGZyZXNjb1RyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFjdGl2aXRpRm9ybTogRm9ybVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhY3Rpdml0aVRhc2tMaXN0OiBBY3Rpdml0aVRhc2tMaXN0U2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UpIHtcblxuICAgICAgICBpZiAodHJhbnNsYXRlU2VydmljZSkge1xuICAgICAgICAgICAgdHJhbnNsYXRlU2VydmljZS5hZGRUcmFuc2xhdGlvbkZvbGRlcignbmcyLWFjdGl2aXRpLXRhc2tsaXN0JywgJ25vZGVfbW9kdWxlcy9uZzItYWN0aXZpdGktdGFza2xpc3Qvc3JjJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMudGFza0lkKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWREZXRhaWxzKHRoaXMudGFza0lkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgbGV0IHRhc2tJZCA9IGNoYW5nZXNbJ3Rhc2tJZCddO1xuICAgICAgICBpZiAodGFza0lkICYmICF0YXNrSWQuY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhc2tJZCAmJiB0YXNrSWQuY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWREZXRhaWxzKHRhc2tJZC5jdXJyZW50VmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzZXQgdGhlIHRhc2sgZGV0YWlsc1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMudGFza0RldGFpbHMgPSBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRoZSB0YXNrIGhhcyBhIGZvcm1cbiAgICAgKiBAcmV0dXJucyB7VGFza0RldGFpbHNNb2RlbHxzdHJpbmd8Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBoYXNGb3JtS2V5KCkge1xuICAgICAgICByZXR1cm4gKHRoaXMudGFza0RldGFpbHNcbiAgICAgICAgJiYgdGhpcy50YXNrRGV0YWlscy5mb3JtS2V5XG4gICAgICAgICYmIHRoaXMudGFza0RldGFpbHMuZm9ybUtleSAhPT0gJ251bGwnKTtcbiAgICB9XG5cbiAgICBpc1Rhc2tBY3RpdmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tEZXRhaWxzICYmIHRoaXMudGFza0RldGFpbHMuZHVyYXRpb24gPT09IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZCB0aGUgYWN0aXZpdGkgdGFzayBkZXRhaWxzXG4gICAgICogQHBhcmFtIHRhc2tJZFxuICAgICAqL1xuICAgIHByaXZhdGUgbG9hZERldGFpbHModGFza0lkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy50YXNrUGVvcGxlID0gW107XG4gICAgICAgIHRoaXMudGFza0Zvcm1OYW1lID0gbnVsbDtcbiAgICAgICAgaWYgKHRhc2tJZCkge1xuICAgICAgICAgICAgdGhpcy5hY3Rpdml0aVRhc2tMaXN0LmdldFRhc2tEZXRhaWxzKHRhc2tJZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChyZXM6IFRhc2tEZXRhaWxzTW9kZWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXNrRGV0YWlscyA9IHJlcztcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50YXNrRGV0YWlscy5uYW1lID09PSAnbnVsbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGFza0RldGFpbHMubmFtZSA9ICdObyBuYW1lJztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGxldCBlbmREYXRlOiBhbnkgPSByZXMuZW5kRGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWFkT25seUZvcm0gPSAhIShlbmREYXRlICYmICFpc05hTihlbmREYXRlLmdldFRpbWUoKSkpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRhc2tEZXRhaWxzICYmIHRoaXMudGFza0RldGFpbHMuaW52b2x2ZWRQZW9wbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGFza0RldGFpbHMuaW52b2x2ZWRQZW9wbGUuZm9yRWFjaCgodXNlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGFza1Blb3BsZS5wdXNoKG5ldyBVc2VyKHVzZXIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpc0Fzc2lnbmVkVG9NZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGFza0RldGFpbHMuYXNzaWduZWUgPyB0cnVlIDogZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgdGhlIG5leHQgb3BlbiB0YXNrXG4gICAgICogQHBhcmFtIHByb2Nlc3NJbnN0YW5jZUlkXG4gICAgICogQHBhcmFtIHByb2Nlc3NEZWZpbml0aW9uSWRcbiAgICAgKi9cbiAgICBwcml2YXRlIGxvYWROZXh0VGFzayhwcm9jZXNzSW5zdGFuY2VJZDogc3RyaW5nLCBwcm9jZXNzRGVmaW5pdGlvbklkOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IHJlcXVlc3ROb2RlID0gbmV3IFRhc2tRdWVyeVJlcXVlc3RSZXByZXNlbnRhdGlvbk1vZGVsKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb2Nlc3NJbnN0YW5jZUlkOiBwcm9jZXNzSW5zdGFuY2VJZCxcbiAgICAgICAgICAgICAgICBwcm9jZXNzRGVmaW5pdGlvbklkOiBwcm9jZXNzRGVmaW5pdGlvbklkXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuYWN0aXZpdGlUYXNrTGlzdC5nZXRUYXNrcyhyZXF1ZXN0Tm9kZSkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXNrRGV0YWlscyA9IHJlc3BvbnNlWzBdO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIHRoaXMub25FcnJvci5lbWl0KGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbXBsZXRlIGJ1dHRvbiBjbGlja2VkXG4gICAgICovXG4gICAgb25Db21wbGV0ZSgpIHtcbiAgICAgICAgdGhpcy5hY3Rpdml0aVRhc2tMaXN0LmNvbXBsZXRlVGFzayh0aGlzLnRhc2tJZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKHJlcykgPT4gdGhpcy5vbkZvcm1Db21wbGV0ZWQobnVsbClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBvbkZvcm1TYXZlZChmb3JtOiBGb3JtTW9kZWwpIHtcbiAgICAgICAgdGhpcy5mb3JtU2F2ZWQuZW1pdChmb3JtKTtcbiAgICB9XG5cbiAgICBvbkZvcm1Db21wbGV0ZWQoZm9ybTogRm9ybU1vZGVsKSB7XG4gICAgICAgIHRoaXMuZm9ybUNvbXBsZXRlZC5lbWl0KGZvcm0pO1xuICAgICAgICBpZiAodGhpcy5zaG93TmV4dFRhc2spIHtcbiAgICAgICAgICAgIHRoaXMubG9hZE5leHRUYXNrKHRoaXMudGFza0RldGFpbHMucHJvY2Vzc0luc3RhbmNlSWQsIHRoaXMudGFza0RldGFpbHMucHJvY2Vzc0RlZmluaXRpb25JZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbkZvcm1Mb2FkZWQoZm9ybTogRm9ybU1vZGVsKSB7XG4gICAgICAgIHRoaXMudGFza0Zvcm1OYW1lID0gbnVsbDtcbiAgICAgICAgaWYgKGZvcm0gJiYgZm9ybS5uYW1lKSB7XG4gICAgICAgICAgICB0aGlzLnRhc2tGb3JtTmFtZSA9IGZvcm0ubmFtZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZvcm1Mb2FkZWQuZW1pdChmb3JtKTtcbiAgICB9XG5cbiAgICBvbkNoZWNrbGlzdFRhc2tDcmVhdGVkKHRhc2s6IFRhc2tEZXRhaWxzTW9kZWwpIHtcbiAgICAgICAgdGhpcy50YXNrQ3JlYXRlZC5lbWl0KHRhc2spO1xuICAgIH1cblxuICAgIG9uRm9ybUVycm9yKGVycm9yOiBhbnkpIHtcbiAgICAgICAgdGhpcy5lcnJvckRpYWxvZy5uYXRpdmVFbGVtZW50LnNob3dNb2RhbCgpO1xuICAgICAgICB0aGlzLm9uRXJyb3IuZW1pdChlcnJvcik7XG4gICAgfVxuXG4gICAgb25Gb3JtRXhlY3V0ZU91dGNvbWUoZXZlbnQ6IEZvcm1PdXRjb21lRXZlbnQpIHtcbiAgICAgICAgdGhpcy5leGVjdXRlT3V0Y29tZS5lbWl0KGV2ZW50KTtcbiAgICB9XG5cbiAgICBjbG9zZUVycm9yRGlhbG9nKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVycm9yRGlhbG9nLm5hdGl2ZUVsZW1lbnQuY2xvc2UoKTtcbiAgICB9XG5cbiAgICBvbkNsYWltVGFzayh0YXNrSWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLmxvYWREZXRhaWxzKHRhc2tJZCk7XG4gICAgfVxufVxuIl19
