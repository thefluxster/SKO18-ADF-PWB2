/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var activiti_tasklist_service_1 = require("./../services/activiti-tasklist.service");
var task_details_model_1 = require("../models/task-details.model");
var Rx_1 = require("rxjs/Rx");
var ActivitiChecklist = (function () {
    function ActivitiChecklist(translateService, activitiTaskList, logService) {
        var _this = this;
        this.translateService = translateService;
        this.activitiTaskList = activitiTaskList;
        this.logService = logService;
        this.readOnly = false;
        this.checklistTaskCreated = new core_1.EventEmitter();
        this.checklist = [];
        if (translateService) {
            translateService.addTranslationFolder('ng2-activiti-tasklist', 'node_modules/ng2-activiti-tasklist/src');
        }
        this.task$ = new Rx_1.Observable(function (observer) { return _this.taskObserver = observer; }).share();
    }
    ActivitiChecklist.prototype.ngOnInit = function () {
        var _this = this;
        this.task$.subscribe(function (task) {
            _this.checklist.push(task);
        });
    };
    ActivitiChecklist.prototype.ngOnChanges = function (changes) {
        var taskId = changes['taskId'];
        if (taskId && taskId.currentValue) {
            this.getTaskChecklist(taskId.currentValue);
            return;
        }
    };
    ActivitiChecklist.prototype.getTaskChecklist = function (taskId) {
        var _this = this;
        this.checklist = [];
        if (this.taskId) {
            this.activitiTaskList.getTaskChecklist(this.taskId).subscribe(function (res) {
                res.forEach(function (task) {
                    _this.taskObserver.next(task);
                });
            }, function (err) {
                _this.logService.error(err);
            });
        }
        else {
            this.checklist = [];
        }
    };
    ActivitiChecklist.prototype.showDialog = function () {
        if (this.dialog) {
            if (!this.dialog.nativeElement.showModal) {
                dialogPolyfill.registerDialog(this.dialog.nativeElement);
            }
            this.dialog.nativeElement.showModal();
        }
    };
    ActivitiChecklist.prototype.add = function () {
        var _this = this;
        var newTask = new task_details_model_1.TaskDetailsModel({
            name: this.taskName,
            parentTaskId: this.taskId,
            assignee: { id: this.assignee }
        });
        this.activitiTaskList.addTask(newTask).subscribe(function (res) {
            _this.checklist.push(res);
            _this.checklistTaskCreated.emit(res);
            _this.taskName = '';
        }, function (err) {
            _this.logService.error(err);
        });
        this.cancel();
    };
    ActivitiChecklist.prototype.cancel = function () {
        if (this.dialog) {
            this.dialog.nativeElement.close();
        }
        this.taskName = '';
    };
    return ActivitiChecklist;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiChecklist.prototype, "taskId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiChecklist.prototype, "readOnly", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiChecklist.prototype, "assignee", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiChecklist.prototype, "checklistTaskCreated", void 0);
__decorate([
    core_1.ViewChild('dialog'),
    __metadata("design:type", Object)
], ActivitiChecklist.prototype, "dialog", void 0);
ActivitiChecklist = __decorate([
    core_1.Component({
        selector: 'activiti-checklist',
        moduleId: module.id,
        template: "<span class=\"activiti-label mdl-badge\" id=\"checklist-label\"       [attr.data-badge]=\"checklist?.length\">{{ 'TASK_DETAILS.LABELS.CHECKLIST' | translate }}</span> <div *ngIf=\"!readOnly\" id=\"addChecklist\" (click)=\"showDialog()\" id=\"add-checklist\" class=\"icon material-icons\">add</div> <div *ngIf=\"!readOnly\" class=\"mdl-tooltip\" for=\"add-checklist\">     Add a checklist </div> <div class=\"menu-container\" *ngIf=\"checklist?.length > 0\">     <ul class='mdl-list'>         <li class=\"mdl-list__item\" *ngFor=\"let check of checklist\">             <span class=\"mdl-list__item-primary-content\" id=\"check-{{check.id}}\">             <i class=\"material-icons mdl-list__item-icon\">done</i>             {{check.name}}             </span>         </li>     </ul> </div> <div *ngIf=\"checklist?.length === 0\" id=\"checklist-none-message\">     {{ 'TASK_DETAILS.CHECKLIST.NONE' | translate }} </div>  <dialog class=\"mdl-dialog\" id=\"checklist-dialog\" #dialog>     <h4 class=\"mdl-dialog__title\" id=\"add-checklist-title\">New Check</h4>     <div class=\"mdl-dialog__content\">         <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">             <input class=\"mdl-textfield__input\" type=\"text\" [(ngModel)]=\"taskName\" id=\"checklist-name\"/>             <label class=\"mdl-textfield__label\" for=\"checklist-name\">Name</label>         </div>     </div>     <div class=\"mdl-dialog__actions\">         <button type=\"button\" id=\"add-check\" (click)=\"add()\" class=\"mdl-button\">Add Checklist</button>         <button type=\"button\" id=\"close-check-dialog\" (click)=\"cancel()\" class=\"mdl-button close\">Cancel</button>     </div> </dialog>",
        styles: [":host {     width: 100%; }  .activiti-label {     font-weight: bolder; }  .material-icons:hover {     color: rgb(255, 152, 0); }  .mdl-tooltip {     will-change: unset; }  .material-icons {     cursor: pointer; }"],
        providers: [activiti_tasklist_service_1.ActivitiTaskListService]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        activiti_tasklist_service_1.ActivitiTaskListService,
        ng2_alfresco_core_1.LogService])
], ActivitiChecklist);
exports.ActivitiChecklist = ActivitiChecklist;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktY2hlY2tsaXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7Ozs7Ozs7Ozs7O0FBRUgsc0NBQW9IO0FBQ3BILHVEQUEyRTtBQUMzRSxxRkFBa0Y7QUFDbEYsbUVBQWdFO0FBQ2hFLDhCQUErQztBQVcvQyxJQUFhLGlCQUFpQjtJQTZCMUIsMkJBQW9CLGdCQUE0QyxFQUM1QyxnQkFBeUMsRUFDekMsVUFBc0I7UUFGMUMsaUJBUUM7UUFSbUIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUE0QjtRQUM1QyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQXlCO1FBQ3pDLGVBQVUsR0FBVixVQUFVLENBQVk7UUF6QjFDLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFNMUIseUJBQW9CLEdBQW1DLElBQUksbUJBQVksRUFBb0IsQ0FBQztRQU81RixjQUFTLEdBQXdCLEVBQUUsQ0FBQztRQWNoQyxFQUFFLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7WUFDbkIsZ0JBQWdCLENBQUMsb0JBQW9CLENBQUMsdUJBQXVCLEVBQUUsd0NBQXdDLENBQUMsQ0FBQztRQUM3RyxDQUFDO1FBQ0QsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLGVBQVUsQ0FBbUIsVUFBQSxRQUFRLElBQUksT0FBQSxLQUFJLENBQUMsWUFBWSxHQUFHLFFBQVEsRUFBNUIsQ0FBNEIsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3BHLENBQUM7SUFFRCxvQ0FBUSxHQUFSO1FBQUEsaUJBSUM7UUFIRyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxVQUFDLElBQXNCO1lBQ3hDLEtBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELHVDQUFXLEdBQVgsVUFBWSxPQUFzQjtRQUM5QixJQUFJLE1BQU0sR0FB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O21EQUNTO0FBR2pCO0lBREMsYUFBTSxFQUFFOzhCQUNhLG1CQUFZOytEQUEwRDtBQUc1RjtJQURDLGdCQUFTLENBQUMsUUFBUSxDQUFDOztpREFDUjtBQWZILGlCQUFpQjtJQVA3QixnQkFBUyxDQUFDO1FBQ1AsUUFBUSxFQUFFLG9CQUFvQjtRQUM5QixRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7UUFDbkIsUUFBUSxFQUFFLHdxREFBd3FEO1FBQ2xyRCxNQUFNLEVBQUUsQ0FBQyxzTkFBc04sQ0FBQztRQUNoTyxTQUFTLEVBQUUsQ0FBQyxtREFBdUIsQ0FBQztLQUN2QyxDQUFDO3FDQThCd0MsOENBQTBCO1FBQzFCLG1EQUF1QjtRQUM3Qiw4QkFBVTtHQS9CakMsaUJBQWlCLENBeUc3QjtBQXpHWSw4Q0FBaUIiLCJmaWxlIjoiY29tcG9uZW50cy9hY3Rpdml0aS1jaGVja2xpc3QuY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBWaWV3Q2hpbGQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgRXZlbnRFbWl0dGVyLCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFsZnJlc2NvVHJhbnNsYXRpb25TZXJ2aWNlLCBMb2dTZXJ2aWNlIH0gZnJvbSAnbmcyLWFsZnJlc2NvLWNvcmUnO1xuaW1wb3J0IHsgQWN0aXZpdGlUYXNrTGlzdFNlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL2FjdGl2aXRpLXRhc2tsaXN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgVGFza0RldGFpbHNNb2RlbCB9IGZyb20gJy4uL21vZGVscy90YXNrLWRldGFpbHMubW9kZWwnO1xuaW1wb3J0IHsgT2JzZXJ2ZXIsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzL1J4JztcblxuZGVjbGFyZSBsZXQgZGlhbG9nUG9seWZpbGw6IGFueTtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhY3Rpdml0aS1jaGVja2xpc3QnLFxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgdGVtcGxhdGU6IFwiPHNwYW4gY2xhc3M9XFxcImFjdGl2aXRpLWxhYmVsIG1kbC1iYWRnZVxcXCIgaWQ9XFxcImNoZWNrbGlzdC1sYWJlbFxcXCIgICAgICAgW2F0dHIuZGF0YS1iYWRnZV09XFxcImNoZWNrbGlzdD8ubGVuZ3RoXFxcIj57eyAnVEFTS19ERVRBSUxTLkxBQkVMUy5DSEVDS0xJU1QnIHwgdHJhbnNsYXRlIH19PC9zcGFuPiA8ZGl2ICpuZ0lmPVxcXCIhcmVhZE9ubHlcXFwiIGlkPVxcXCJhZGRDaGVja2xpc3RcXFwiIChjbGljayk9XFxcInNob3dEaWFsb2coKVxcXCIgaWQ9XFxcImFkZC1jaGVja2xpc3RcXFwiIGNsYXNzPVxcXCJpY29uIG1hdGVyaWFsLWljb25zXFxcIj5hZGQ8L2Rpdj4gPGRpdiAqbmdJZj1cXFwiIXJlYWRPbmx5XFxcIiBjbGFzcz1cXFwibWRsLXRvb2x0aXBcXFwiIGZvcj1cXFwiYWRkLWNoZWNrbGlzdFxcXCI+ICAgICBBZGQgYSBjaGVja2xpc3QgPC9kaXY+IDxkaXYgY2xhc3M9XFxcIm1lbnUtY29udGFpbmVyXFxcIiAqbmdJZj1cXFwiY2hlY2tsaXN0Py5sZW5ndGggPiAwXFxcIj4gICAgIDx1bCBjbGFzcz0nbWRsLWxpc3QnPiAgICAgICAgIDxsaSBjbGFzcz1cXFwibWRsLWxpc3RfX2l0ZW1cXFwiICpuZ0Zvcj1cXFwibGV0IGNoZWNrIG9mIGNoZWNrbGlzdFxcXCI+ICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJtZGwtbGlzdF9faXRlbS1wcmltYXJ5LWNvbnRlbnRcXFwiIGlkPVxcXCJjaGVjay17e2NoZWNrLmlkfX1cXFwiPiAgICAgICAgICAgICA8aSBjbGFzcz1cXFwibWF0ZXJpYWwtaWNvbnMgbWRsLWxpc3RfX2l0ZW0taWNvblxcXCI+ZG9uZTwvaT4gICAgICAgICAgICAge3tjaGVjay5uYW1lfX0gICAgICAgICAgICAgPC9zcGFuPiAgICAgICAgIDwvbGk+ICAgICA8L3VsPiA8L2Rpdj4gPGRpdiAqbmdJZj1cXFwiY2hlY2tsaXN0Py5sZW5ndGggPT09IDBcXFwiIGlkPVxcXCJjaGVja2xpc3Qtbm9uZS1tZXNzYWdlXFxcIj4gICAgIHt7ICdUQVNLX0RFVEFJTFMuQ0hFQ0tMSVNULk5PTkUnIHwgdHJhbnNsYXRlIH19IDwvZGl2PiAgPGRpYWxvZyBjbGFzcz1cXFwibWRsLWRpYWxvZ1xcXCIgaWQ9XFxcImNoZWNrbGlzdC1kaWFsb2dcXFwiICNkaWFsb2c+ICAgICA8aDQgY2xhc3M9XFxcIm1kbC1kaWFsb2dfX3RpdGxlXFxcIiBpZD1cXFwiYWRkLWNoZWNrbGlzdC10aXRsZVxcXCI+TmV3IENoZWNrPC9oND4gICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1kaWFsb2dfX2NvbnRlbnRcXFwiPiAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGQgbWRsLWpzLXRleHRmaWVsZCBtZGwtdGV4dGZpZWxkLS1mbG9hdGluZy1sYWJlbFxcXCI+ICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz1cXFwibWRsLXRleHRmaWVsZF9faW5wdXRcXFwiIHR5cGU9XFxcInRleHRcXFwiIFsobmdNb2RlbCldPVxcXCJ0YXNrTmFtZVxcXCIgaWQ9XFxcImNoZWNrbGlzdC1uYW1lXFxcIi8+ICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz1cXFwibWRsLXRleHRmaWVsZF9fbGFiZWxcXFwiIGZvcj1cXFwiY2hlY2tsaXN0LW5hbWVcXFwiPk5hbWU8L2xhYmVsPiAgICAgICAgIDwvZGl2PiAgICAgPC9kaXY+ICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtZGlhbG9nX19hY3Rpb25zXFxcIj4gICAgICAgICA8YnV0dG9uIHR5cGU9XFxcImJ1dHRvblxcXCIgaWQ9XFxcImFkZC1jaGVja1xcXCIgKGNsaWNrKT1cXFwiYWRkKClcXFwiIGNsYXNzPVxcXCJtZGwtYnV0dG9uXFxcIj5BZGQgQ2hlY2tsaXN0PC9idXR0b24+ICAgICAgICAgPGJ1dHRvbiB0eXBlPVxcXCJidXR0b25cXFwiIGlkPVxcXCJjbG9zZS1jaGVjay1kaWFsb2dcXFwiIChjbGljayk9XFxcImNhbmNlbCgpXFxcIiBjbGFzcz1cXFwibWRsLWJ1dHRvbiBjbG9zZVxcXCI+Q2FuY2VsPC9idXR0b24+ICAgICA8L2Rpdj4gPC9kaWFsb2c+XCIsXG4gICAgc3R5bGVzOiBbXCI6aG9zdCB7ICAgICB3aWR0aDogMTAwJTsgfSAgLmFjdGl2aXRpLWxhYmVsIHsgICAgIGZvbnQtd2VpZ2h0OiBib2xkZXI7IH0gIC5tYXRlcmlhbC1pY29uczpob3ZlciB7ICAgICBjb2xvcjogcmdiKDI1NSwgMTUyLCAwKTsgfSAgLm1kbC10b29sdGlwIHsgICAgIHdpbGwtY2hhbmdlOiB1bnNldDsgfSAgLm1hdGVyaWFsLWljb25zIHsgICAgIGN1cnNvcjogcG9pbnRlcjsgfVwiXSxcbiAgICBwcm92aWRlcnM6IFtBY3Rpdml0aVRhc2tMaXN0U2VydmljZV1cbn0pXG5leHBvcnQgY2xhc3MgQWN0aXZpdGlDaGVja2xpc3QgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG5cbiAgICBASW5wdXQoKVxuICAgIHRhc2tJZDogc3RyaW5nO1xuXG4gICAgQElucHV0KClcbiAgICByZWFkT25seTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgQElucHV0KClcbiAgICBhc3NpZ25lZTogc3RyaW5nO1xuXG4gICAgQE91dHB1dCgpXG4gICAgY2hlY2tsaXN0VGFza0NyZWF0ZWQ6IEV2ZW50RW1pdHRlcjxUYXNrRGV0YWlsc01vZGVsPiA9IG5ldyBFdmVudEVtaXR0ZXI8VGFza0RldGFpbHNNb2RlbD4oKTtcblxuICAgIEBWaWV3Q2hpbGQoJ2RpYWxvZycpXG4gICAgZGlhbG9nOiBhbnk7XG5cbiAgICB0YXNrTmFtZTogc3RyaW5nO1xuXG4gICAgY2hlY2tsaXN0OiBUYXNrRGV0YWlsc01vZGVsIFtdID0gW107XG5cbiAgICBwcml2YXRlIHRhc2tPYnNlcnZlcjogT2JzZXJ2ZXI8VGFza0RldGFpbHNNb2RlbD47XG4gICAgdGFzayQ6IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD47XG5cbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSBhdXRoXG4gICAgICogQHBhcmFtIHRyYW5zbGF0ZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhY3Rpdml0aVRhc2tMaXN0OiBBY3Rpdml0aVRhc2tMaXN0U2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UpIHtcblxuICAgICAgICBpZiAodHJhbnNsYXRlU2VydmljZSkge1xuICAgICAgICAgICAgdHJhbnNsYXRlU2VydmljZS5hZGRUcmFuc2xhdGlvbkZvbGRlcignbmcyLWFjdGl2aXRpLXRhc2tsaXN0JywgJ25vZGVfbW9kdWxlcy9uZzItYWN0aXZpdGktdGFza2xpc3Qvc3JjJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50YXNrJCA9IG5ldyBPYnNlcnZhYmxlPFRhc2tEZXRhaWxzTW9kZWw+KG9ic2VydmVyID0+IHRoaXMudGFza09ic2VydmVyID0gb2JzZXJ2ZXIpLnNoYXJlKCk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMudGFzayQuc3Vic2NyaWJlKCh0YXNrOiBUYXNrRGV0YWlsc01vZGVsKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNoZWNrbGlzdC5wdXNoKHRhc2spO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGxldCB0YXNrSWQgPSBjaGFuZ2VzWyd0YXNrSWQnXTtcbiAgICAgICAgaWYgKHRhc2tJZCAmJiB0YXNrSWQuY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmdldFRhc2tDaGVja2xpc3QodGFza0lkLmN1cnJlbnRWYWx1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0VGFza0NoZWNrbGlzdCh0YXNrSWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLmNoZWNrbGlzdCA9IFtdO1xuICAgICAgICBpZiAodGhpcy50YXNrSWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlUYXNrTGlzdC5nZXRUYXNrQ2hlY2tsaXN0KHRoaXMudGFza0lkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHJlczogVGFza0RldGFpbHNNb2RlbFtdKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcy5mb3JFYWNoKCh0YXNrKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRhc2tPYnNlcnZlci5uZXh0KHRhc2spO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2hlY2tsaXN0ID0gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc2hvd0RpYWxvZygpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlhbG9nKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuZGlhbG9nLm5hdGl2ZUVsZW1lbnQuc2hvd01vZGFsKSB7XG4gICAgICAgICAgICAgICAgZGlhbG9nUG9seWZpbGwucmVnaXN0ZXJEaWFsb2codGhpcy5kaWFsb2cubmF0aXZlRWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmRpYWxvZy5uYXRpdmVFbGVtZW50LnNob3dNb2RhbCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGFkZCgpIHtcbiAgICAgICAgbGV0IG5ld1Rhc2sgPSBuZXcgVGFza0RldGFpbHNNb2RlbCh7XG4gICAgICAgICAgICBuYW1lOiB0aGlzLnRhc2tOYW1lLFxuICAgICAgICAgICAgcGFyZW50VGFza0lkOiB0aGlzLnRhc2tJZCxcbiAgICAgICAgICAgIGFzc2lnbmVlOiB7IGlkOiB0aGlzLmFzc2lnbmVlIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYWN0aXZpdGlUYXNrTGlzdC5hZGRUYXNrKG5ld1Rhc2spLnN1YnNjcmliZShcbiAgICAgICAgICAgIChyZXM6IFRhc2tEZXRhaWxzTW9kZWwpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrbGlzdC5wdXNoKHJlcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja2xpc3RUYXNrQ3JlYXRlZC5lbWl0KHJlcyk7XG4gICAgICAgICAgICAgICAgdGhpcy50YXNrTmFtZSA9ICcnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5jYW5jZWwoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY2FuY2VsKCkge1xuICAgICAgICBpZiAodGhpcy5kaWFsb2cpIHtcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nLm5hdGl2ZUVsZW1lbnQuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRhc2tOYW1lID0gJyc7XG4gICAgfVxufVxuIl19
