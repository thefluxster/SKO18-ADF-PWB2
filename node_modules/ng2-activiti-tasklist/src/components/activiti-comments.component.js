/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var activiti_tasklist_service_1 = require("./../services/activiti-tasklist.service");
var Rx_1 = require("rxjs/Rx");
var ActivitiComments = (function () {
    function ActivitiComments(translateService, activitiTaskList) {
        var _this = this;
        this.translateService = translateService;
        this.activitiTaskList = activitiTaskList;
        this.readOnly = false;
        this.error = new core_1.EventEmitter();
        this.comments = [];
        if (translateService) {
            translateService.addTranslationFolder('ng2-activiti-tasklist', 'node_modules/ng2-activiti-tasklist/src');
        }
        this.comment$ = new Rx_1.Observable(function (observer) { return _this.commentObserver = observer; }).share();
        this.comment$.subscribe(function (comment) {
            _this.comments.push(comment);
        });
    }
    ActivitiComments.prototype.ngOnChanges = function (changes) {
        var taskId = changes['taskId'];
        if (taskId) {
            if (taskId.currentValue) {
                this.getTaskComments(taskId.currentValue);
            }
            else {
                this.resetComments();
            }
        }
    };
    ActivitiComments.prototype.getTaskComments = function (taskId) {
        var _this = this;
        this.resetComments();
        if (taskId) {
            this.activitiTaskList.getTaskComments(taskId).subscribe(function (res) {
                res.forEach(function (comment) {
                    _this.commentObserver.next(comment);
                });
            }, function (err) {
                _this.error.emit(err);
            });
        }
        else {
            this.resetComments();
        }
    };
    ActivitiComments.prototype.resetComments = function () {
        this.comments = [];
    };
    ActivitiComments.prototype.showDialog = function () {
        if (!this.dialog.nativeElement.showModal) {
            dialogPolyfill.registerDialog(this.dialog.nativeElement);
        }
        this.dialog.nativeElement.showModal();
    };
    ActivitiComments.prototype.add = function () {
        var _this = this;
        this.activitiTaskList.addTaskComment(this.taskId, this.message).subscribe(function (res) {
            _this.comments.push(res);
            _this.message = '';
        }, function (err) {
            _this.error.emit(err);
        });
        this.cancel();
    };
    ActivitiComments.prototype.cancel = function () {
        if (this.dialog) {
            this.dialog.nativeElement.close();
        }
    };
    return ActivitiComments;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ActivitiComments.prototype, "taskId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ActivitiComments.prototype, "readOnly", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ActivitiComments.prototype, "error", void 0);
__decorate([
    core_1.ViewChild('dialog'),
    __metadata("design:type", Object)
], ActivitiComments.prototype, "dialog", void 0);
ActivitiComments = __decorate([
    core_1.Component({
        selector: 'activiti-comments',
        moduleId: module.id,
        template: "<span class=\"activiti-label mdl-badge\"       [attr.data-badge]=\"comments?.length\">{{ 'TASK_DETAILS.LABELS.COMMENTS' |translate }}</span> <div *ngIf=\"!readOnly\" id=\"addComment\" (click)=\"showDialog()\" class=\"icon material-icons\">add</div> <div *ngIf=\"!readOnly\" class=\"mdl-tooltip\" for=\"addComment\">     {{ 'TASK_DETAILS.COMMENTS.ADD' | translate }} </div>  <div class=\"menu-container\" *ngIf=\"comments?.length > 0\">     <ul class='mdl-list'>         <li class=\"mdl-list__item list-wrap\" *ngFor=\"let comment of comments\">             <span class=\"mdl-list__item-primary-content hide-long-names\"><i class=\"material-icons mdl-list__item-icon\">comment</i>{{comment.message}}</span>         </li>     </ul> </div> <div *ngIf=\"comments?.length === 0\" data-automation-id=\"comments-none\">     {{ 'TASK_DETAILS.COMMENTS.NONE' | translate }} </div>   <dialog class=\"mdl-dialog\" #dialog>     <h4 class=\"mdl-dialog__title\">{{ 'TASK_DETAILS.COMMENTS.DIALOG.TITLE' | translate }}</h4>     <div class=\"mdl-dialog__content\">         <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">             <textarea class=\"mdl-textfield__input\" type=\"text\" [(ngModel)]=\"message\" rows=\"1\" id=\"commentText\"></textarea>             <label class=\"mdl-textfield__label\" for=\"commentText\">{{ 'TASK_DETAILS.COMMENTS.DIALOG.LABELS.MESSAGE' | translate }}</label>         </div>     </div>     <div class=\"mdl-dialog__actions\">         <button type=\"button\" (click)=\"add()\" class=\"mdl-button\">{{ 'TASK_DETAILS.COMMENTS.DIALOG.BUTTON.ADD' | translate }}</button>         <button type=\"button\" (click)=\"cancel()\" class=\"mdl-button close\">{{ 'TASK_DETAILS.COMMENTS.DIALOG.BUTTON.CANCEL' | translate }}</button>     </div> </dialog>",
        styles: [":host {     width: 100%; }  .activiti-label {     font-weight: bolder; }  .material-icons:hover {     color: rgb(255, 152, 0); }  .mdl-tooltip {     will-change: unset; }  .material-icons {     cursor: pointer; }  .list-wrap {     word-wrap: break-word;     word-break: break-all;     -moz-hyphens:auto;     -webkit-hyphens:auto;     -o-hyphens:auto;     hyphens:auto; }  .hide-long-names {     overflow: auto; }"],
        providers: [activiti_tasklist_service_1.ActivitiTaskListService]
    }),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoTranslationService,
        activiti_tasklist_service_1.ActivitiTaskListService])
], ActivitiComments);
exports.ActivitiComments = ActivitiComments;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYWN0aXZpdGktY29tbWVudHMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRzs7Ozs7Ozs7Ozs7QUFFSCxzQ0FBNEc7QUFDNUcsdURBQStEO0FBQy9ELHFGQUFrRjtBQUVsRiw4QkFBK0M7QUFXL0MsSUFBYSxnQkFBZ0I7SUEwQnpCLDBCQUFvQixnQkFBNEMsRUFDNUMsZ0JBQXlDO1FBRDdELGlCQVdDO1FBWG1CLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBNEI7UUFDNUMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUF5QjtRQXJCN0QsYUFBUSxHQUFZLEtBQUssQ0FBQztRQUcxQixVQUFLLEdBQXNCLElBQUksbUJBQVksRUFBTyxDQUFDO1FBS25ELGFBQVEsR0FBZSxFQUFFLENBQUM7UUFldEIsRUFBRSxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1lBQ25CLGdCQUFnQixDQUFDLG9CQUFvQixDQUFDLHVCQUF1QixFQUFFLHdDQUF3QyxDQUFDLENBQUM7UUFDN0csQ0FBQztRQUVELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxlQUFVLENBQVUsVUFBQSxRQUFRLElBQUssT0FBQSxLQUFJLENBQUMsZUFBZSxHQUFHLFFBQVEsRUFBL0IsQ0FBK0IsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzlGLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLFVBQUMsT0FBZ0I7WUFDckMsS0FBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsc0NBQVcsR0FBWCxVQUFZLE9BQXNCO1FBQzlCLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvQixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ1QsRUFBRSxDQUFDLENBQUMsTUFBTSxD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QjtHQTNCcEQsZ0JBQWdCLENBaUc1QjtBQWpHWSw0Q0FBZ0IiLCJmaWxlIjoiY29tcG9uZW50cy9hY3Rpdml0aS1jb21tZW50cy5jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNiBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPdXRwdXQsIFZpZXdDaGlsZCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFsZnJlc2NvVHJhbnNsYXRpb25TZXJ2aWNlIH0gZnJvbSAnbmcyLWFsZnJlc2NvLWNvcmUnO1xuaW1wb3J0IHsgQWN0aXZpdGlUYXNrTGlzdFNlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL2FjdGl2aXRpLXRhc2tsaXN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29tbWVudCB9IGZyb20gJy4uL21vZGVscy9jb21tZW50Lm1vZGVsJztcbmltcG9ydCB7IE9ic2VydmVyLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcy9SeCc7XG5cbmRlY2xhcmUgbGV0IGRpYWxvZ1BvbHlmaWxsOiBhbnk7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWN0aXZpdGktY29tbWVudHMnLFxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgdGVtcGxhdGU6IFwiPHNwYW4gY2xhc3M9XFxcImFjdGl2aXRpLWxhYmVsIG1kbC1iYWRnZVxcXCIgICAgICAgW2F0dHIuZGF0YS1iYWRnZV09XFxcImNvbW1lbnRzPy5sZW5ndGhcXFwiPnt7ICdUQVNLX0RFVEFJTFMuTEFCRUxTLkNPTU1FTlRTJyB8dHJhbnNsYXRlIH19PC9zcGFuPiA8ZGl2ICpuZ0lmPVxcXCIhcmVhZE9ubHlcXFwiIGlkPVxcXCJhZGRDb21tZW50XFxcIiAoY2xpY2spPVxcXCJzaG93RGlhbG9nKClcXFwiIGNsYXNzPVxcXCJpY29uIG1hdGVyaWFsLWljb25zXFxcIj5hZGQ8L2Rpdj4gPGRpdiAqbmdJZj1cXFwiIXJlYWRPbmx5XFxcIiBjbGFzcz1cXFwibWRsLXRvb2x0aXBcXFwiIGZvcj1cXFwiYWRkQ29tbWVudFxcXCI+ICAgICB7eyAnVEFTS19ERVRBSUxTLkNPTU1FTlRTLkFERCcgfCB0cmFuc2xhdGUgfX0gPC9kaXY+ICA8ZGl2IGNsYXNzPVxcXCJtZW51LWNvbnRhaW5lclxcXCIgKm5nSWY9XFxcImNvbW1lbnRzPy5sZW5ndGggPiAwXFxcIj4gICAgIDx1bCBjbGFzcz0nbWRsLWxpc3QnPiAgICAgICAgIDxsaSBjbGFzcz1cXFwibWRsLWxpc3RfX2l0ZW0gbGlzdC13cmFwXFxcIiAqbmdGb3I9XFxcImxldCBjb21tZW50IG9mIGNvbW1lbnRzXFxcIj4gICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcIm1kbC1saXN0X19pdGVtLXByaW1hcnktY29udGVudCBoaWRlLWxvbmctbmFtZXNcXFwiPjxpIGNsYXNzPVxcXCJtYXRlcmlhbC1pY29ucyBtZGwtbGlzdF9faXRlbS1pY29uXFxcIj5jb21tZW50PC9pPnt7Y29tbWVudC5tZXNzYWdlfX08L3NwYW4+ICAgICAgICAgPC9saT4gICAgIDwvdWw+IDwvZGl2PiA8ZGl2ICpuZ0lmPVxcXCJjb21tZW50cz8ubGVuZ3RoID09PSAwXFxcIiBkYXRhLWF1dG9tYXRpb24taWQ9XFxcImNvbW1lbnRzLW5vbmVcXFwiPiAgICAge3sgJ1RBU0tfREVUQUlMUy5DT01NRU5UUy5OT05FJyB8IHRyYW5zbGF0ZSB9fSA8L2Rpdj4gICA8ZGlhbG9nIGNsYXNzPVxcXCJtZGwtZGlhbG9nXFxcIiAjZGlhbG9nPiAgICAgPGg0IGNsYXNzPVxcXCJtZGwtZGlhbG9nX190aXRsZVxcXCI+e3sgJ1RBU0tfREVUQUlMUy5DT01NRU5UUy5ESUFMT0cuVElUTEUnIHwgdHJhbnNsYXRlIH19PC9oND4gICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1kaWFsb2dfX2NvbnRlbnRcXFwiPiAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC10ZXh0ZmllbGQgbWRsLWpzLXRleHRmaWVsZCBtZGwtdGV4dGZpZWxkLS1mbG9hdGluZy1sYWJlbFxcXCI+ICAgICAgICAgICAgIDx0ZXh0YXJlYSBjbGFzcz1cXFwibWRsLXRleHRmaWVsZF9faW5wdXRcXFwiIHR5cGU9XFxcInRleHRcXFwiIFsobmdNb2RlbCldPVxcXCJtZXNzYWdlXFxcIiByb3dzPVxcXCIxXFxcIiBpZD1cXFwiY29tbWVudFRleHRcXFwiPjwvdGV4dGFyZWE+ICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz1cXFwibWRsLXRleHRmaWVsZF9fbGFiZWxcXFwiIGZvcj1cXFwiY29tbWVudFRleHRcXFwiPnt7ICdUQVNLX0RFVEFJTFMuQ09NTUVOVFMuRElBTE9HLkxBQkVMUy5NRVNTQUdFJyB8IHRyYW5zbGF0ZSB9fTwvbGFiZWw+ICAgICAgICAgPC9kaXY+ICAgICA8L2Rpdj4gICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1kaWFsb2dfX2FjdGlvbnNcXFwiPiAgICAgICAgIDxidXR0b24gdHlwZT1cXFwiYnV0dG9uXFxcIiAoY2xpY2spPVxcXCJhZGQoKVxcXCIgY2xhc3M9XFxcIm1kbC1idXR0b25cXFwiPnt7ICdUQVNLX0RFVEFJTFMuQ09NTUVOVFMuRElBTE9HLkJVVFRPTi5BREQnIHwgdHJhbnNsYXRlIH19PC9idXR0b24+ICAgICAgICAgPGJ1dHRvbiB0eXBlPVxcXCJidXR0b25cXFwiIChjbGljayk9XFxcImNhbmNlbCgpXFxcIiBjbGFzcz1cXFwibWRsLWJ1dHRvbiBjbG9zZVxcXCI+e3sgJ1RBU0tfREVUQUlMUy5DT01NRU5UUy5ESUFMT0cuQlVUVE9OLkNBTkNFTCcgfCB0cmFuc2xhdGUgfX08L2J1dHRvbj4gICAgIDwvZGl2PiA8L2RpYWxvZz5cIixcbiAgICBzdHlsZXM6IFtcIjpob3N0IHsgICAgIHdpZHRoOiAxMDAlOyB9ICAuYWN0aXZpdGktbGFiZWwgeyAgICAgZm9udC13ZWlnaHQ6IGJvbGRlcjsgfSAgLm1hdGVyaWFsLWljb25zOmhvdmVyIHsgICAgIGNvbG9yOiByZ2IoMjU1LCAxNTIsIDApOyB9ICAubWRsLXRvb2x0aXAgeyAgICAgd2lsbC1jaGFuZ2U6IHVuc2V0OyB9ICAubWF0ZXJpYWwtaWNvbnMgeyAgICAgY3Vyc29yOiBwb2ludGVyOyB9ICAubGlzdC13cmFwIHsgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsgICAgIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsgICAgIC1tb3otaHlwaGVuczphdXRvOyAgICAgLXdlYmtpdC1oeXBoZW5zOmF1dG87ICAgICAtby1oeXBoZW5zOmF1dG87ICAgICBoeXBoZW5zOmF1dG87IH0gIC5oaWRlLWxvbmctbmFtZXMgeyAgICAgb3ZlcmZsb3c6IGF1dG87IH1cIl0sXG4gICAgcHJvdmlkZXJzOiBbQWN0aXZpdGlUYXNrTGlzdFNlcnZpY2VdXG59KVxuZXhwb3J0IGNsYXNzIEFjdGl2aXRpQ29tbWVudHMgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuXG4gICAgQElucHV0KClcbiAgICB0YXNrSWQ6IHN0cmluZztcblxuICAgIEBJbnB1dCgpXG4gICAgcmVhZE9ubHk6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBPdXRwdXQoKVxuICAgIGVycm9yOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgQFZpZXdDaGlsZCgnZGlhbG9nJylcbiAgICBkaWFsb2c6IGFueTtcblxuICAgIGNvbW1lbnRzOiBDb21tZW50IFtdID0gW107XG5cbiAgICBwcml2YXRlIGNvbW1lbnRPYnNlcnZlcjogT2JzZXJ2ZXI8Q29tbWVudD47XG4gICAgY29tbWVudCQ6IE9ic2VydmFibGU8Q29tbWVudD47XG5cbiAgICBtZXNzYWdlOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSB0cmFuc2xhdGUgVHJhbnNsYXRpb24gc2VydmljZVxuICAgICAqIEBwYXJhbSBhY3Rpdml0aVRhc2tMaXN0IFRhc2sgc2VydmljZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogQWxmcmVzY29UcmFuc2xhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhY3Rpdml0aVRhc2tMaXN0OiBBY3Rpdml0aVRhc2tMaXN0U2VydmljZSkge1xuXG4gICAgICAgIGlmICh0cmFuc2xhdGVTZXJ2aWNlKSB7XG4gICAgICAgICAgICB0cmFuc2xhdGVTZXJ2aWNlLmFkZFRyYW5zbGF0aW9uRm9sZGVyKCduZzItYWN0aXZpdGktdGFza2xpc3QnLCAnbm9kZV9tb2R1bGVzL25nMi1hY3Rpdml0aS10YXNrbGlzdC9zcmMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY29tbWVudCQgPSBuZXcgT2JzZXJ2YWJsZTxDb21tZW50PihvYnNlcnZlciA9PiAgdGhpcy5jb21tZW50T2JzZXJ2ZXIgPSBvYnNlcnZlcikuc2hhcmUoKTtcbiAgICAgICAgdGhpcy5jb21tZW50JC5zdWJzY3JpYmUoKGNvbW1lbnQ6IENvbW1lbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY29tbWVudHMucHVzaChjb21tZW50KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgICAgICBsZXQgdGFza0lkID0gY2hhbmdlc1sndGFza0lkJ107XG4gICAgICAgIGlmICh0YXNrSWQpIHtcbiAgICAgICAgICAgIGlmICh0YXNrSWQuY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRUYXNrQ29tbWVudHModGFza0lkLmN1cnJlbnRWYWx1ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRDb21tZW50cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRUYXNrQ29tbWVudHModGFza0lkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5yZXNldENvbW1lbnRzKCk7XG4gICAgICAgIGlmICh0YXNrSWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlUYXNrTGlzdC5nZXRUYXNrQ29tbWVudHModGFza0lkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHJlczogQ29tbWVudFtdKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcy5mb3JFYWNoKChjb21tZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbW1lbnRPYnNlcnZlci5uZXh0KGNvbW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVzZXRDb21tZW50cygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZXNldENvbW1lbnRzKCkge1xuICAgICAgICB0aGlzLmNvbW1lbnRzID0gW107XG4gICAgfVxuXG4gICAgcHVibGljIHNob3dEaWFsb2coKSB7XG4gICAgICAgIGlmICghdGhpcy5kaWFsb2cubmF0aXZlRWxlbWVudC5zaG93TW9kYWwpIHtcbiAgICAgICAgICAgIGRpYWxvZ1BvbHlmaWxsLnJlZ2lzdGVyRGlhbG9nKHRoaXMuZGlhbG9nLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGlhbG9nLm5hdGl2ZUVsZW1lbnQuc2hvd01vZGFsKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFkZCgpIHtcbiAgICAgICAgdGhpcy5hY3Rpdml0aVRhc2tMaXN0LmFkZFRhc2tDb21tZW50KHRoaXMudGFza0lkLCB0aGlzLm1lc3NhZ2UpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChyZXM6IENvbW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbW1lbnRzLnB1c2gocmVzKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSAnJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuY2FuY2VsKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGNhbmNlbCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlhbG9nKSB7XG4gICAgICAgICAgICB0aGlzLmRpYWxvZy5uYXRpdmVFbGVtZW50LmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=
