/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var core_1 = require("@angular/core");
var platform_browser_1 = require("@angular/platform-browser");
var ng2_alfresco_core_1 = require("ng2-alfresco-core");
var ViewerComponent = (function () {
    function ViewerComponent(apiService, element, document, logService) {
        this.apiService = apiService;
        this.element = element;
        this.document = document;
        this.logService = logService;
        this.urlFile = '';
        this.fileNodeId = null;
        this.overlayMode = false;
        this.showViewer = true;
        this.showToolbar = true;
        this.showViewerChange = new core_1.EventEmitter();
        this.loaded = false;
    }
    ViewerComponent.prototype.ngOnChanges = function (changes) {
        var _this = this;
        if (this.showViewer) {
            this.hideOtherHeaderBar();
            this.blockOtherScrollBar();
            if (!this.urlFile && !this.fileNodeId) {
                throw new Error('Attribute urlFile or fileNodeId is required');
            }
            return new Promise(function (resolve, reject) {
                var alfrescoApi = _this.apiService.getInstance();
                if (_this.urlFile) {
                    var filenameFromUrl = _this.getFilenameFromUrl(_this.urlFile);
                    _this.displayName = filenameFromUrl ? filenameFromUrl : '';
                    _this.extension = _this.getFileExtension(filenameFromUrl);
                    _this.urlFileContent = _this.urlFile;
                    resolve();
                }
                else if (_this.fileNodeId) {
                    alfrescoApi.nodes.getNodeInfo(_this.fileNodeId).then(function (data) {
                        _this.mimeType = data.content.mimeType;
                        _this.displayName = data.name;
                        _this.urlFileContent = alfrescoApi.content.getContentUrl(data.id);
                        _this.loaded = true;
                        resolve();
                    }, function (error) {
                        reject(error);
                        this.logService.error('This node does not exist');
                    });
                }
            });
        }
    };
    ViewerComponent.prototype.close = function () {
        this.unblockOtherScrollBar();
        if (this.otherMenu) {
            this.otherMenu.hidden = false;
        }
        this.cleanup();
        this.showViewer = false;
        this.showViewerChange.emit(this.showViewer);
    };
    ViewerComponent.prototype.cleanup = function () {
        this.urlFileContent = '';
        this.displayName = '';
        this.fileNodeId = null;
        this.loaded = false;
        this.extension = null;
        this.mimeType = null;
    };
    ViewerComponent.prototype.ngOnDestroy = function () {
        this.cleanup();
    };
    ViewerComponent.prototype.getFilenameFromUrl = function (url) {
        var anchor = url.indexOf('#');
        var query = url.indexOf('?');
        var end = Math.min(anchor > 0 ? anchor : url.length, query > 0 ? query : url.length);
        return url.substring(url.lastIndexOf('/', end) + 1, end);
    };
    ViewerComponent.prototype.getFileExtension = function (fileName) {
        return fileName.split('.').pop().toLowerCase();
    };
    ViewerComponent.prototype.isImage = function () {
        return this.isImageExtension() || this.isImageMimeType();
    };
    ViewerComponent.prototype.isMedia = function () {
        return this.isMediaExtension(this.extension) || this.isMediaMimeType();
    };
    ViewerComponent.prototype.isImageExtension = function () {
        return this.extension === 'png' || this.extension === 'jpg' ||
            this.extension === 'jpeg' || this.extension === 'gif' || this.extension === 'bmp';
    };
    ViewerComponent.prototype.isMediaMimeType = function () {
        var mimeExtension;
        if (this.mimeType && this.mimeType.indexOf('/')) {
            mimeExtension = this.mimeType.substr(this.mimeType.indexOf('/') + 1, this.mimeType.length);
        }
        return this.mimeType && this.mimeType.indexOf('video/') === 0 && this.isMediaExtension(mimeExtension);
    };
    ViewerComponent.prototype.isMediaExtension = function (extension) {
        return extension === 'mp4' || extension === 'WebM' || extension === 'Ogg';
    };
    ViewerComponent.prototype.isImageMimeType = function () {
        return this.mimeType && this.mimeType.indexOf('image/') === 0;
    };
    ViewerComponent.prototype.isPdf = function () {
        return this.extension === 'pdf' || this.mimeType === 'application/pdf';
    };
    ViewerComponent.prototype.supportedExtension = function () {
        return this.isImage() || this.isPdf() || this.isMedia();
    };
    ViewerComponent.prototype.handleKeyboardEvent = function (event) {
        var key = event.keyCode;
        if (key === 27 && this.overlayMode) {
            this.close();
        }
    };
    ViewerComponent.prototype.blockOtherScrollBar = function () {
        var mainElements = document.getElementsByTagName('main');
        for (var i = 0; i < mainElements.length; i++) {
            mainElements[i].style.overflow = 'hidden';
        }
    };
    ViewerComponent.prototype.unblockOtherScrollBar = function () {
        var mainElements = document.getElementsByTagName('main');
        for (var i = 0; i < mainElements.length; i++) {
            mainElements[i].style.overflow = '';
        }
    };
    ViewerComponent.prototype.isParentElementHeaderBar = function () {
        return !!this.closestElement(this.element.nativeElement, 'header');
    };
    ViewerComponent.prototype.closestElement = function (elelemnt, nodeName) {
        var parent = elelemnt.parentElement;
        if (parent) {
            if (parent.nodeName.toLowerCase() === nodeName) {
                return parent;
            }
            else {
                return this.closestElement(parent, nodeName);
            }
        }
        else {
            return null;
        }
    };
    ViewerComponent.prototype.hideOtherHeaderBar = function () {
        if (this.overlayMode && !this.isParentElementHeaderBar()) {
            this.otherMenu = document.querySelector('header');
            if (this.otherMenu) {
                this.otherMenu.hidden = true;
            }
        }
    };
    ViewerComponent.prototype.isLoaded = function () {
        return this.fileNodeId ? this.loaded : true;
    };
    return ViewerComponent;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ViewerComponent.prototype, "urlFile", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], ViewerComponent.prototype, "fileNodeId", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ViewerComponent.prototype, "overlayMode", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ViewerComponent.prototype, "showViewer", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Boolean)
], ViewerComponent.prototype, "showToolbar", void 0);
__decorate([
    core_1.Output(),
    __metadata("design:type", core_1.EventEmitter)
], ViewerComponent.prototype, "showViewerChange", void 0);
__decorate([
    core_1.HostListener('document:keydown', ['$event']),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [KeyboardEvent]),
    __metadata("design:returntype", void 0)
], ViewerComponent.prototype, "handleKeyboardEvent", null);
ViewerComponent = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'alfresco-viewer',
        template: "<div id=\"viewer\" *ngIf=\"showViewer\" [ngClass]=\"{'all-space': !overlayMode }\">     <div *ngIf=\"overlayMode\">         <div id=\"viewer-shadow-transparent\" class=\"viewer-shadow-transparent\"></div>     </div>      <div id=\"viewer-main-container\" class=\"all-space\" [ngClass]=\"{'viewer-overlay-view': overlayMode }\">          <!-- Start Layout -->         <div [ngClass]=\"{'mdl-layout mdl-js-layout mdl-layout--fixed-header': overlayMode, 'all-space': !overlayMode}\">              <header *ngIf=\"overlayMode\" class=\"mdl-layout__header\">                 <div class=\"mdl-layout__header-row\">                      <!-- File Title -->                     <span id=\"viewer-name-file\" class=\"mdl-layout-title viewer-name-file\">{{displayName}}</span>                      <span class=\"vertical-divider\"></span>                      <div class=\"mdl-layout-spacer\"></div>                      <!-- Start Navigation -->                     <nav class=\"mdl-navigation\">                         <div id=\"viewer-toolbar-view-options\">                             <button *ngIf=\"overlayMode\"                                     class=\"mdl-color--black mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored\"                                     (click)=\"close()\">                                 <i id=\"viewer-close-button\" class=\"icon material-icons\">close</i>                             </button>                         </div>                     </nav>                     <!-- End Navigation -->                 </div>             </header>             <!--<div class=\"mdl-layout__drawer\">-->             <!--<span class=\"mdl-layout-title\">Thumbnail</span>-->             <!--</div>-->             <main id=\"page-content\" class=\"mdl-layout__content\" [ngClass]=\"{'all-space': !overlayMode }\">                  <div class=\"mdl-grid\">                     <!--<div id=\"viewer-previous-file-button\" class=\"center-element mdl-cell mdl-cell&#45;&#45;2-col mdl-cell&#45;&#45;hide-tablet mdl-cell&#45;&#45;hide-phone\">-->                     <!--<button  *ngIf=\"false\"-->                     <!--class=\"center-element mdl-color&#45;&#45;black mdl-button mdl-js-button mdl-button&#45;&#45;fab mdl-button&#45;&#45;mini-fab mdl-button&#45;&#45;colored\"-->                     <!--(click)=\"previousFile()\">-->                     <!--<i class=\"icon material-icons \">keyboard_arrow_left</i>-->                     <!--</button>-->                     <!--</div>-->                      <div id=\"viewer-content-container\" *ngIf=\"isLoaded()\"                          class=\"center-element mdl-cell mdl-cell--12-col\">                          <!-- Start View Switch-->                         <div *ngIf=\"isPdf()\">                             <pdf-viewer [showToolbar]=\"showToolbar\" [urlFile]=\"urlFileContent\"                                         [nameFile]=\"displayName\"></pdf-viewer>                         </div>                         <div class=\"center-element\" *ngIf=\"isImage()\">                             <img-viewer [urlFile]=\"urlFileContent\" [nameFile]=\"displayName\"></img-viewer>                         </div>                         <div class=\"center-element\" *ngIf=\"isMedia()\">                             <media-player [urlFile]=\"urlFileContent\" [mimeType]=\"mimeType\"                                           [nameFile]=\"displayName\"></media-player>                         </div>                         <div *ngIf=\"!supportedExtension()\">                             <not-supported-format [urlFile]=\"urlFileContent\"                                                   [nameFile]=\"displayName\"></not-supported-format>                         </div>                         <!-- End View Switch -->                      </div>                      <!--<div id=\"viewer-next-file-button\" class=\"center-element mdl-cell mdl-cell&#45;&#45;2-col mdl-cell&#45;&#45;hide-tablet mdl-cell&#45;&#45;hide-phone\">-->                     <!--<button *ngIf=\"false\"-->                     <!--class=\"center-element mdl-color&#45;&#45;black mdl-button mdl-js-button mdl-button&#45;&#45;fab mdl-button&#45;&#45;mini-fab mdl-button&#45;&#45;colored\"-->                     <!--(click)=\"nextFile()\">-->                     <!--<i class=\"icon material-icons\">keyboard_arrow_right</i>-->                     <!--</button>-->                     <!--</div>-->                  </div>             </main>         </div>         <!-- End Layout -->     </div> </div>",
        styles: [".button-container {     padding: 0 40px; }  .left {     float: left; }  #page-content {     display: flex;     flex-direction: row;     flex-wrap: wrap;     flex: 1; }  .mdl-grid {     width: 100vw;     padding: 0px !important; }  .viewer-name-file {     width: 100%;     height: 21px;     overflow: hidden !important;     text-overflow: ellipsis;     white-space: nowrap;     padding-right: 60px;     margin-right: -40px; }  .viewer-shadow-transparent {     z-index: 1000;     background-color: #3E3E3E;     position: fixed;     top: 0;     bottom: 0;     left: 0;     right: 0;     opacity: .90; }  .viewer-overlay-view {     position: fixed;     top: 0px;     left: 0px;     z-index: 1000; }  img-viewer {     height: 100%; }  .center-element {     display: flex;     align-items: center;     justify-content: center; }  .all-space{     width: 100%;     height: 100%;     background-color: #515151; }"]
    }),
    __param(2, core_1.Inject(platform_browser_1.DOCUMENT)),
    __metadata("design:paramtypes", [ng2_alfresco_core_1.AlfrescoApiService,
        core_1.ElementRef, Object, ng2_alfresco_core_1.LogService])
], ViewerComponent);
exports.ViewerComponent = ViewerComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmV0cy92aWV3ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRzs7Ozs7Ozs7Ozs7Ozs7QUFFSCxzQ0FBeUc7QUFDekcsOERBQXFEO0FBRXJELHVEQUFtRTtBQVFuRSxJQUFhLGVBQWU7SUEyQnhCLHlCQUFvQixVQUE4QixFQUM5QixPQUFtQixFQUNELFFBQVEsRUFDMUIsVUFBc0I7UUFIdEIsZUFBVSxHQUFWLFVBQVUsQ0FBb0I7UUFDOUIsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQUNELGFBQVEsR0FBUixRQUFRLENBQUE7UUFDMUIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQTNCMUMsWUFBTyxHQUFXLEVBQUUsQ0FBQztRQUdyQixlQUFVLEdBQVcsSUFBSSxDQUFDO1FBRzFCLGdCQUFXLEdBQVksS0FBSyxDQUFDO1FBRzdCLGVBQVUsR0FBWSxJQUFJLENBQUM7UUFHM0IsZ0JBQVcsR0FBWSxJQUFJLENBQUM7UUFHNUIscUJBQWdCLEdBQTBCLElBQUksbUJBQVksRUFBVyxDQUFDO1FBT3RFLFdBQU0sR0FBWSxLQUFLLENBQUM7SUFNeEIsQ0FBQztJQUVELHFDQUFXLEdBQVgsVUFBWSxPQUFPO1FBQW5CLGlCQTZCQztRQTVCRyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNsQixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUMxQixJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztZQUMzQixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztnQkFDcEMsTUFBTSxJQUFJLEtBQUssQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO1lBQ25FLENBQUM7WUFDRCxNQUFNLENBQUMsSUFBSSxPQUFPLENBQUMsVUFBQyxPQUFPLEVBQUUsTUFBTTtnQkFDL0IsSUFBSSxXQUFXLEdB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QUMsMkJBQVEsQ0FBQyxDQUFBO3FDQUZHLHNDQUFrQjtRQUNyQixpQkFBVSxVQUVQLDhCQUFVO0dBOUJqQyxlQUFlLENBcVIzQjtBQXJSWSwwQ0FBZSIsImZpbGUiOiJjb21wb25ldHMvdmlld2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgSW5wdXQsIE91dHB1dCwgSG9zdExpc3RlbmVyLCBFdmVudEVtaXR0ZXIsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbmltcG9ydCB7IE1pbmltYWxOb2RlRW50cnlFbnRpdHkgfSBmcm9tICdhbGZyZXNjby1qcy1hcGknO1xuaW1wb3J0IHsgQWxmcmVzY29BcGlTZXJ2aWNlLCBMb2dTZXJ2aWNlIH0gZnJvbSAnbmcyLWFsZnJlc2NvLWNvcmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHNlbGVjdG9yOiAnYWxmcmVzY28tdmlld2VyJyxcbiAgICB0ZW1wbGF0ZTogXCI8ZGl2IGlkPVxcXCJ2aWV3ZXJcXFwiICpuZ0lmPVxcXCJzaG93Vmlld2VyXFxcIiBbbmdDbGFzc109XFxcInsnYWxsLXNwYWNlJzogIW92ZXJsYXlNb2RlIH1cXFwiPiAgICAgPGRpdiAqbmdJZj1cXFwib3ZlcmxheU1vZGVcXFwiPiAgICAgICAgIDxkaXYgaWQ9XFxcInZpZXdlci1zaGFkb3ctdHJhbnNwYXJlbnRcXFwiIGNsYXNzPVxcXCJ2aWV3ZXItc2hhZG93LXRyYW5zcGFyZW50XFxcIj48L2Rpdj4gICAgIDwvZGl2PiAgICAgIDxkaXYgaWQ9XFxcInZpZXdlci1tYWluLWNvbnRhaW5lclxcXCIgY2xhc3M9XFxcImFsbC1zcGFjZVxcXCIgW25nQ2xhc3NdPVxcXCJ7J3ZpZXdlci1vdmVybGF5LXZpZXcnOiBvdmVybGF5TW9kZSB9XFxcIj4gICAgICAgICAgPCEtLSBTdGFydCBMYXlvdXQgLS0+ICAgICAgICAgPGRpdiBbbmdDbGFzc109XFxcInsnbWRsLWxheW91dCBtZGwtanMtbGF5b3V0IG1kbC1sYXlvdXQtLWZpeGVkLWhlYWRlcic6IG92ZXJsYXlNb2RlLCAnYWxsLXNwYWNlJzogIW92ZXJsYXlNb2RlfVxcXCI+ICAgICAgICAgICAgICA8aGVhZGVyICpuZ0lmPVxcXCJvdmVybGF5TW9kZVxcXCIgY2xhc3M9XFxcIm1kbC1sYXlvdXRfX2hlYWRlclxcXCI+ICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZGwtbGF5b3V0X19oZWFkZXItcm93XFxcIj4gICAgICAgICAgICAgICAgICAgICAgPCEtLSBGaWxlIFRpdGxlIC0tPiAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPVxcXCJ2aWV3ZXItbmFtZS1maWxlXFxcIiBjbGFzcz1cXFwibWRsLWxheW91dC10aXRsZSB2aWV3ZXItbmFtZS1maWxlXFxcIj57e2Rpc3BsYXlOYW1lfX08L3NwYW4+ICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJ2ZXJ0aWNhbC1kaXZpZGVyXFxcIj48L3NwYW4+ICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1sYXlvdXQtc3BhY2VyXFxcIj48L2Rpdj4gICAgICAgICAgICAgICAgICAgICAgPCEtLSBTdGFydCBOYXZpZ2F0aW9uIC0tPiAgICAgICAgICAgICAgICAgICAgIDxuYXYgY2xhc3M9XFxcIm1kbC1uYXZpZ2F0aW9uXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD1cXFwidmlld2VyLXRvb2xiYXItdmlldy1vcHRpb25zXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gKm5nSWY9XFxcIm92ZXJsYXlNb2RlXFxcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz1cXFwibWRsLWNvbG9yLS1ibGFjayBtZGwtYnV0dG9uIG1kbC1qcy1idXR0b24gbWRsLWJ1dHRvbi0tZmFiIG1kbC1idXR0b24tLW1pbmktZmFiIG1kbC1idXR0b24tLWNvbG9yZWRcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XFxcImNsb3NlKClcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGlkPVxcXCJ2aWV3ZXItY2xvc2UtYnV0dG9uXFxcIiBjbGFzcz1cXFwiaWNvbiBtYXRlcmlhbC1pY29uc1xcXCI+Y2xvc2U8L2k+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4gICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICAgICAgPC9uYXY+ICAgICAgICAgICAgICAgICAgICAgPCEtLSBFbmQgTmF2aWdhdGlvbiAtLT4gICAgICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICA8L2hlYWRlcj4gICAgICAgICAgICAgPCEtLTxkaXYgY2xhc3M9XFxcIm1kbC1sYXlvdXRfX2RyYXdlclxcXCI+LS0+ICAgICAgICAgICAgIDwhLS08c3BhbiBjbGFzcz1cXFwibWRsLWxheW91dC10aXRsZVxcXCI+VGh1bWJuYWlsPC9zcGFuPi0tPiAgICAgICAgICAgICA8IS0tPC9kaXY+LS0+ICAgICAgICAgICAgIDxtYWluIGlkPVxcXCJwYWdlLWNvbnRlbnRcXFwiIGNsYXNzPVxcXCJtZGwtbGF5b3V0X19jb250ZW50XFxcIiBbbmdDbGFzc109XFxcInsnYWxsLXNwYWNlJzogIW92ZXJsYXlNb2RlIH1cXFwiPiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1kbC1ncmlkXFxcIj4gICAgICAgICAgICAgICAgICAgICA8IS0tPGRpdiBpZD1cXFwidmlld2VyLXByZXZpb3VzLWZpbGUtYnV0dG9uXFxcIiBjbGFzcz1cXFwiY2VudGVyLWVsZW1lbnQgbWRsLWNlbGwgbWRsLWNlbGwmIzQ1OyYjNDU7Mi1jb2wgbWRsLWNlbGwmIzQ1OyYjNDU7aGlkZS10YWJsZXQgbWRsLWNlbGwmIzQ1OyYjNDU7aGlkZS1waG9uZVxcXCI+LS0+ICAgICAgICAgICAgICAgICAgICAgPCEtLTxidXR0b24gICpuZ0lmPVxcXCJmYWxzZVxcXCItLT4gICAgICAgICAgICAgICAgICAgICA8IS0tY2xhc3M9XFxcImNlbnRlci1lbGVtZW50IG1kbC1jb2xvciYjNDU7JiM0NTtibGFjayBtZGwtYnV0dG9uIG1kbC1qcy1idXR0b24gbWRsLWJ1dHRvbiYjNDU7JiM0NTtmYWIgbWRsLWJ1dHRvbiYjNDU7JiM0NTttaW5pLWZhYiBtZGwtYnV0dG9uJiM0NTsmIzQ1O2NvbG9yZWRcXFwiLS0+ICAgICAgICAgICAgICAgICAgICAgPCEtLShjbGljayk9XFxcInByZXZpb3VzRmlsZSgpXFxcIj4tLT4gICAgICAgICAgICAgICAgICAgICA8IS0tPGkgY2xhc3M9XFxcImljb24gbWF0ZXJpYWwtaWNvbnMgXFxcIj5rZXlib2FyZF9hcnJvd19sZWZ0PC9pPi0tPiAgICAgICAgICAgICAgICAgICAgIDwhLS08L2J1dHRvbj4tLT4gICAgICAgICAgICAgICAgICAgICA8IS0tPC9kaXY+LS0+ICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9XFxcInZpZXdlci1jb250ZW50LWNvbnRhaW5lclxcXCIgKm5nSWY9XFxcImlzTG9hZGVkKClcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz1cXFwiY2VudGVyLWVsZW1lbnQgbWRsLWNlbGwgbWRsLWNlbGwtLTEyLWNvbFxcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIFN0YXJ0IFZpZXcgU3dpdGNoLS0+ICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgKm5nSWY9XFxcImlzUGRmKClcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBkZi12aWV3ZXIgW3Nob3dUb29sYmFyXT1cXFwic2hvd1Rvb2xiYXJcXFwiIFt1cmxGaWxlXT1cXFwidXJsRmlsZUNvbnRlbnRcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbbmFtZUZpbGVdPVxcXCJkaXNwbGF5TmFtZVxcXCI+PC9wZGYtdmlld2VyPiAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiY2VudGVyLWVsZW1lbnRcXFwiICpuZ0lmPVxcXCJpc0ltYWdlKClcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGltZy12aWV3ZXIgW3VybEZpbGVdPVxcXCJ1cmxGaWxlQ29udGVudFxcXCIgW25hbWVGaWxlXT1cXFwiZGlzcGxheU5hbWVcXFwiPjwvaW1nLXZpZXdlcj4gICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImNlbnRlci1lbGVtZW50XFxcIiAqbmdJZj1cXFwiaXNNZWRpYSgpXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxtZWRpYS1wbGF5ZXIgW3VybEZpbGVdPVxcXCJ1cmxGaWxlQ29udGVudFxcXCIgW21pbWVUeXBlXT1cXFwibWltZVR5cGVcXFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtuYW1lRmlsZV09XFxcImRpc3BsYXlOYW1lXFxcIj48L21lZGlhLXBsYXllcj4gICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgKm5nSWY9XFxcIiFzdXBwb3J0ZWRFeHRlbnNpb24oKVxcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bm90LXN1cHBvcnRlZC1mb3JtYXQgW3VybEZpbGVdPVxcXCJ1cmxGaWxlQ29udGVudFxcXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbbmFtZUZpbGVdPVxcXCJkaXNwbGF5TmFtZVxcXCI+PC9ub3Qtc3VwcG9ydGVkLWZvcm1hdD4gICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gRW5kIFZpZXcgU3dpdGNoIC0tPiAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgICAgICAgICAgPCEtLTxkaXYgaWQ9XFxcInZpZXdlci1uZXh0LWZpbGUtYnV0dG9uXFxcIiBjbGFzcz1cXFwiY2VudGVyLWVsZW1lbnQgbWRsLWNlbGwgbWRsLWNlbGwmIzQ1OyYjNDU7Mi1jb2wgbWRsLWNlbGwmIzQ1OyYjNDU7aGlkZS10YWJsZXQgbWRsLWNlbGwmIzQ1OyYjNDU7aGlkZS1waG9uZVxcXCI+LS0+ICAgICAgICAgICAgICAgICAgICAgPCEtLTxidXR0b24gKm5nSWY9XFxcImZhbHNlXFxcIi0tPiAgICAgICAgICAgICAgICAgICAgIDwhLS1jbGFzcz1cXFwiY2VudGVyLWVsZW1lbnQgbWRsLWNvbG9yJiM0NTsmIzQ1O2JsYWNrIG1kbC1idXR0b24gbWRsLWpzLWJ1dHRvbiBtZGwtYnV0dG9uJiM0NTsmIzQ1O2ZhYiBtZGwtYnV0dG9uJiM0NTsmIzQ1O21pbmktZmFiIG1kbC1idXR0b24mIzQ1OyYjNDU7Y29sb3JlZFxcXCItLT4gICAgICAgICAgICAgICAgICAgICA8IS0tKGNsaWNrKT1cXFwibmV4dEZpbGUoKVxcXCI+LS0+ICAgICAgICAgICAgICAgICAgICAgPCEtLTxpIGNsYXNzPVxcXCJpY29uIG1hdGVyaWFsLWljb25zXFxcIj5rZXlib2FyZF9hcnJvd19yaWdodDwvaT4tLT4gICAgICAgICAgICAgICAgICAgICA8IS0tPC9idXR0b24+LS0+ICAgICAgICAgICAgICAgICAgICAgPCEtLTwvZGl2Pi0tPiAgICAgICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICA8L21haW4+ICAgICAgICAgPC9kaXY+ICAgICAgICAgPCEtLSBFbmQgTGF5b3V0IC0tPiAgICAgPC9kaXY+IDwvZGl2PlwiLFxuICAgIHN0eWxlczogW1wiLmJ1dHRvbi1jb250YWluZXIgeyAgICAgcGFkZGluZzogMCA0MHB4OyB9ICAubGVmdCB7ICAgICBmbG9hdDogbGVmdDsgfSAgI3BhZ2UtY29udGVudCB7ICAgICBkaXNwbGF5OiBmbGV4OyAgICAgZmxleC1kaXJlY3Rpb246IHJvdzsgICAgIGZsZXgtd3JhcDogd3JhcDsgICAgIGZsZXg6IDE7IH0gIC5tZGwtZ3JpZCB7ICAgICB3aWR0aDogMTAwdnc7ICAgICBwYWRkaW5nOiAwcHggIWltcG9ydGFudDsgfSAgLnZpZXdlci1uYW1lLWZpbGUgeyAgICAgd2lkdGg6IDEwMCU7ICAgICBoZWlnaHQ6IDIxcHg7ICAgICBvdmVyZmxvdzogaGlkZGVuICFpbXBvcnRhbnQ7ICAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7ICAgICBwYWRkaW5nLXJpZ2h0OiA2MHB4OyAgICAgbWFyZ2luLXJpZ2h0OiAtNDBweDsgfSAgLnZpZXdlci1zaGFkb3ctdHJhbnNwYXJlbnQgeyAgICAgei1pbmRleDogMTAwMDsgICAgIGJhY2tncm91bmQtY29sb3I6ICMzRTNFM0U7ICAgICBwb3NpdGlvbjogZml4ZWQ7ICAgICB0b3A6IDA7ICAgICBib3R0b206IDA7ICAgICBsZWZ0OiAwOyAgICAgcmlnaHQ6IDA7ICAgICBvcGFjaXR5OiAuOTA7IH0gIC52aWV3ZXItb3ZlcmxheS12aWV3IHsgICAgIHBvc2l0aW9uOiBmaXhlZDsgICAgIHRvcDogMHB4OyAgICAgbGVmdDogMHB4OyAgICAgei1pbmRleDogMTAwMDsgfSAgaW1nLXZpZXdlciB7ICAgICBoZWlnaHQ6IDEwMCU7IH0gIC5jZW50ZXItZWxlbWVudCB7ICAgICBkaXNwbGF5OiBmbGV4OyAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOyB9ICAuYWxsLXNwYWNleyAgICAgd2lkdGg6IDEwMCU7ICAgICBoZWlnaHQ6IDEwMCU7ICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjNTE1MTUxOyB9XCJdXG59KVxuZXhwb3J0IGNsYXNzIFZpZXdlckNvbXBvbmVudCB7XG5cbiAgICBASW5wdXQoKVxuICAgIHVybEZpbGU6IHN0cmluZyA9ICcnO1xuXG4gICAgQElucHV0KClcbiAgICBmaWxlTm9kZUlkOiBzdHJpbmcgPSBudWxsO1xuXG4gICAgQElucHV0KClcbiAgICBvdmVybGF5TW9kZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgQElucHV0KClcbiAgICBzaG93Vmlld2VyOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIEBJbnB1dCgpXG4gICAgc2hvd1Rvb2xiYXI6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgQE91dHB1dCgpXG4gICAgc2hvd1ZpZXdlckNoYW5nZTogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG4gICAgdXJsRmlsZUNvbnRlbnQ6IHN0cmluZztcbiAgICBvdGhlck1lbnU6IGFueTtcbiAgICBkaXNwbGF5TmFtZTogc3RyaW5nO1xuICAgIGV4dGVuc2lvbjogc3RyaW5nO1xuICAgIG1pbWVUeXBlOiBzdHJpbmc7XG4gICAgbG9hZGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFwaVNlcnZpY2U6IEFsZnJlc2NvQXBpU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXG4gICAgICAgICAgICAgICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudCxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzKSB7XG4gICAgICAgIGlmICh0aGlzLnNob3dWaWV3ZXIpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZU90aGVySGVhZGVyQmFyKCk7XG4gICAgICAgICAgICB0aGlzLmJsb2NrT3RoZXJTY3JvbGxCYXIoKTtcbiAgICAgICAgICAgIGlmICghdGhpcy51cmxGaWxlICYmICF0aGlzLmZpbGVOb2RlSWQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0F0dHJpYnV0ZSB1cmxGaWxlIG9yIGZpbGVOb2RlSWQgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGFsZnJlc2NvQXBpID0gdGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudXJsRmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgZmlsZW5hbWVGcm9tVXJsID0gdGhpcy5nZXRGaWxlbmFtZUZyb21VcmwodGhpcy51cmxGaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5TmFtZSA9IGZpbGVuYW1lRnJvbVVybCA/IGZpbGVuYW1lRnJvbVVybCA6ICcnO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4dGVuc2lvbiA9IHRoaXMuZ2V0RmlsZUV4dGVuc2lvbihmaWxlbmFtZUZyb21VcmwpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVybEZpbGVDb250ZW50ID0gdGhpcy51cmxGaWxlO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZpbGVOb2RlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYWxmcmVzY29BcGkubm9kZXMuZ2V0Tm9kZUluZm8odGhpcy5maWxlTm9kZUlkKS50aGVuKChkYXRhOiBNaW5pbWFsTm9kZUVudHJ5RW50aXR5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1pbWVUeXBlID0gZGF0YS5jb250ZW50Lm1pbWVUeXBlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5TmFtZSA9IGRhdGEubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXJsRmlsZUNvbnRlbnQgPSBhbGZyZXNjb0FwaS5jb250ZW50LmdldENvbnRlbnRVcmwoZGF0YS5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcignVGhpcyBub2RlIGRvZXMgbm90IGV4aXN0Jyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogY2xvc2UgdGhlIHZpZXdlclxuICAgICAqL1xuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLnVuYmxvY2tPdGhlclNjcm9sbEJhcigpO1xuICAgICAgICBpZiAodGhpcy5vdGhlck1lbnUpIHtcbiAgICAgICAgICAgIHRoaXMub3RoZXJNZW51LmhpZGRlbiA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2xlYW51cCgpO1xuICAgICAgICB0aGlzLnNob3dWaWV3ZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaG93Vmlld2VyQ2hhbmdlLmVtaXQodGhpcy5zaG93Vmlld2VyKTtcbiAgICB9XG5cbiAgICBjbGVhbnVwKCkge1xuICAgICAgICB0aGlzLnVybEZpbGVDb250ZW50ID0gJyc7XG4gICAgICAgIHRoaXMuZGlzcGxheU5hbWUgPSAnJztcbiAgICAgICAgdGhpcy5maWxlTm9kZUlkID0gbnVsbDtcbiAgICAgICAgdGhpcy5sb2FkZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5leHRlbnNpb24gPSBudWxsO1xuICAgICAgICB0aGlzLm1pbWVUeXBlID0gbnVsbDtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5jbGVhbnVwKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogZ2V0IEZpbGUgbmFtZSBmcm9tIHVybFxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIHVybCBmaWxlXG4gICAgICogQHJldHVybnMge3N0cmluZ30gbmFtZSBmaWxlXG4gICAgICovXG4gICAgZ2V0RmlsZW5hbWVGcm9tVXJsKHVybDogc3RyaW5nKSB7XG4gICAgICAgIGxldCBhbmNob3IgPSB1cmwuaW5kZXhPZignIycpO1xuICAgICAgICBsZXQgcXVlcnkgPSB1cmwuaW5kZXhPZignPycpO1xuICAgICAgICBsZXQgZW5kID0gTWF0aC5taW4oXG4gICAgICAgICAgICBhbmNob3IgPiAwID8gYW5jaG9yIDogdXJsLmxlbmd0aCxcbiAgICAgICAgICAgIHF1ZXJ5ID4gMCA/IHF1ZXJ5IDogdXJsLmxlbmd0aCk7XG4gICAgICAgIHJldHVybiB1cmwuc3Vic3RyaW5nKHVybC5sYXN0SW5kZXhPZignLycsIGVuZCkgKyAxLCBlbmQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdG9rZW4gZnJvbSB0aGUgbG9jYWwgc3RvcmFnZVxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGZpbGVOYW1lIC0gZmlsZSBuYW1lXG4gICAgICogQHJldHVybnMge3N0cmluZ30gZmlsZSBuYW1lIGV4dGVuc2lvblxuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0RmlsZUV4dGVuc2lvbihmaWxlTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBmaWxlTmFtZS5zcGxpdCgnLicpLnBvcCgpLnRvTG93ZXJDYXNlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgdGhlIGNvbnRlbnQgaXMgYW4gaW1hZ2UgdGhyb3VnaCB0aGUgZXh0ZW5zaW9uIG9yIG1pbWUgdHlwZVxuICAgICAqXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgcHJpdmF0ZSBpc0ltYWdlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pc0ltYWdlRXh0ZW5zaW9uKCkgfHwgdGhpcy5pc0ltYWdlTWltZVR5cGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgY29udGVudCBpcyBhIG1lZGlhIHRocm91Z2ggdGhlIGV4dGVuc2lvbiBvciBtaW1lIHR5cGVcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAqL1xuICAgIHByaXZhdGUgaXNNZWRpYSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNNZWRpYUV4dGVuc2lvbih0aGlzLmV4dGVuc2lvbikgfHwgdGhpcy5pc01lZGlhTWltZVR5cGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBjaGVjayBpZiB0aGUgY3VycmVudCBmaWxlIGlzIGEgc3VwcG9ydGVkIGltYWdlIGV4dGVuc2lvblxuICAgICAqXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgcHJpdmF0ZSBpc0ltYWdlRXh0ZW5zaW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5leHRlbnNpb24gPT09ICdwbmcnIHx8IHRoaXMuZXh0ZW5zaW9uID09PSAnanBnJyB8fFxuICAgICAgICAgICAgdGhpcy5leHRlbnNpb24gPT09ICdqcGVnJyB8fCB0aGlzLmV4dGVuc2lvbiA9PT0gJ2dpZicgfHwgdGhpcy5leHRlbnNpb24gPT09ICdibXAnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGNoZWNrIGlmIHRoZSBjdXJyZW50IGZpbGUgaGFzIGFuIGltYWdlLWJhc2VkIG1pbWV0eXBlXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBwcml2YXRlIGlzTWVkaWFNaW1lVHlwZSgpIHtcbiAgICAgICAgbGV0IG1pbWVFeHRlbnNpb247XG4gICAgICAgIGlmICh0aGlzLm1pbWVUeXBlICYmIHRoaXMubWltZVR5cGUuaW5kZXhPZignLycpKSB7XG4gICAgICAgICAgICBtaW1lRXh0ZW5zaW9uID0gdGhpcy5taW1lVHlwZS5zdWJzdHIodGhpcy5taW1lVHlwZS5pbmRleE9mKCcvJykgKyAxLCB0aGlzLm1pbWVUeXBlLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubWltZVR5cGUgJiYgdGhpcy5taW1lVHlwZS5pbmRleE9mKCd2aWRlby8nKSA9PT0gMCAmJiB0aGlzLmlzTWVkaWFFeHRlbnNpb24obWltZUV4dGVuc2lvbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogY2hlY2sgaWYgdGhlIGN1cnJlbnQgZmlsZSBpcyBhIHN1cHBvcnRlZCBtZWRpYSBleHRlbnNpb25cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXh0ZW5zaW9uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBwcml2YXRlIGlzTWVkaWFFeHRlbnNpb24oZXh0ZW5zaW9uOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIGV4dGVuc2lvbiA9PT0gJ21wNCcgfHwgZXh0ZW5zaW9uID09PSAnV2ViTScgfHwgZXh0ZW5zaW9uID09PSAnT2dnJztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBjaGVjayBpZiB0aGUgY3VycmVudCBmaWxlIGhhcyBhbiBpbWFnZS1iYXNlZCBtaW1ldHlwZVxuICAgICAqXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgcHJpdmF0ZSBpc0ltYWdlTWltZVR5cGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1pbWVUeXBlICYmIHRoaXMubWltZVR5cGUuaW5kZXhPZignaW1hZ2UvJykgPT09IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogY2hlY2sgaWYgdGhlIGN1cnJlbnQgZmlsZSBpcyBhIHN1cHBvcnRlZCBwZGYgZXh0ZW5zaW9uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBwcml2YXRlIGlzUGRmKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5leHRlbnNpb24gPT09ICdwZGYnIHx8IHRoaXMubWltZVR5cGUgPT09ICdhcHBsaWNhdGlvbi9wZGYnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGNoZWNrIGlmIHRoZSBjdXJyZW50IGZpbGUgaXMgIGEgc3VwcG9ydGVkIGV4dGVuc2lvblxuICAgICAqXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgc3VwcG9ydGVkRXh0ZW5zaW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pc0ltYWdlKCkgfHwgdGhpcy5pc1BkZigpIHx8IHRoaXMuaXNNZWRpYSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExpdGVuZXIgS2V5Ym9hcmQgRXZlbnRcbiAgICAgKiBAcGFyYW0ge0tleWJvYXJkRXZlbnR9IGV2ZW50XG4gICAgICovXG4gICAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6a2V5ZG93bicsIFsnJGV2ZW50J10pXG4gICAgaGFuZGxlS2V5Ym9hcmRFdmVudChldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgICAgICBsZXQga2V5ID0gZXZlbnQua2V5Q29kZTtcbiAgICAgICAgaWYgKGtleSA9PT0gMjcgJiYgdGhpcy5vdmVybGF5TW9kZSkgeyAvLyBlc2NcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIGluIHRoZSBkb2N1bWVudCB0aGVyZSBhcmUgc2Nyb2xsYWJsZSBtYWluIGFyZWEgYW5kIGRpc2FibGUgaXRcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAqL1xuICAgIHByaXZhdGUgYmxvY2tPdGhlclNjcm9sbEJhcigpIHtcbiAgICAgICAgbGV0IG1haW5FbGVtZW50czogYW55ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ21haW4nKTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1haW5FbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbWFpbkVsZW1lbnRzW2ldLnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiBpbiB0aGUgZG9jdW1lbnQgdGhlcmUgYXJlIHNjcm9sbGFibGUgbWFpbiBhcmVhIGFuZCByZW5hYmxlIGl0XG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBwcml2YXRlIHVuYmxvY2tPdGhlclNjcm9sbEJhcigpIHtcbiAgICAgICAgbGV0IG1haW5FbGVtZW50czogYW55ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ21haW4nKTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1haW5FbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbWFpbkVsZW1lbnRzW2ldLnN0eWxlLm92ZXJmbG93ID0gJyc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgdmlld2VyIGlzIHVzZWQgaW5zaWRlIGFuZCBoZWFkZXIgZWxlbWVudFxuICAgICAqXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgcHJpdmF0ZSBpc1BhcmVudEVsZW1lbnRIZWFkZXJCYXIoKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuY2xvc2VzdEVsZW1lbnQodGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQsICdoZWFkZXInKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgdmlld2VyIGlzIHVzZWQgaW5zaWRlIGFuZCBoZWFkZXIgZWxlbWVudFxuICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZWxlbW50XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5vZGVOYW1lXG4gICAgICogQHJldHVybnMge0hUTUxFbGVtZW50fVxuICAgICAqL1xuICAgIHByaXZhdGUgY2xvc2VzdEVsZW1lbnQoZWxlbGVtbnQ6IEhUTUxFbGVtZW50LCBub2RlTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIGxldCBwYXJlbnQgPSBlbGVsZW1udC5wYXJlbnRFbGVtZW50O1xuICAgICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgICAgICBpZiAocGFyZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5vZGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2VzdEVsZW1lbnQocGFyZW50LCBub2RlTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhpZGUgdGhlIG90aGVyIHBvc3NpYmxlIG1lbnUgaW4gdGhlIGFwcGxpY2F0aW9uXG4gICAgICovXG4gICAgcHJpdmF0ZSBoaWRlT3RoZXJIZWFkZXJCYXIoKSB7XG4gICAgICAgIGlmICh0aGlzLm92ZXJsYXlNb2RlICYmICF0aGlzLmlzUGFyZW50RWxlbWVudEhlYWRlckJhcigpKSB7XG4gICAgICAgICAgICB0aGlzLm90aGVyTWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2hlYWRlcicpO1xuICAgICAgICAgICAgaWYgKHRoaXMub3RoZXJNZW51KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vdGhlck1lbnUuaGlkZGVuID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHJldHVybiB0cnVlIGlmIHRoZSBkYXRhIGFib3V0IHRoZSBub2RlIGluIHRoZSBlY20gYXJlIGxvYWRlZFxuICAgICAqL1xuICAgIGlzTG9hZGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5maWxlTm9kZUlkID8gdGhpcy5sb2FkZWQgOiB0cnVlO1xuICAgIH1cbn1cbiJdfQ==
